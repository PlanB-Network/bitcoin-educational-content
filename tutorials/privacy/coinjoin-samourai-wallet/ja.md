---
name: Coinjoin - Samourai Wallet
description: Samourai Walletでcoinjoinを行う方法は？
---
![cover](assets/cover.webp)

"*ストリート向けのビットコインウォレット*"

このチュートリアルでは、coinjoinが何であるか、そしてSamourai WalletソフトウェアとWhirlpoolの実装を使用してcoinjoinを行う方法を学びます。

## ビットコインでのcoinjoinとは何か？
**Coinjoinは、ブロックチェーン上のビットコインの追跡可能性を断つ技術です**。これは、同名の特定の構造を持つ協力的なトランザクションに依存しています：coinjoinトランザクション。

Coinjoinsは、外部の観察者によるチェーン分析を複雑にすることで、ビットコインユーザーのプライバシーを向上させます。その構造は、異なるユーザーからの複数のコインを単一のトランザクションに統合することを可能にし、経路を曖昧にして、入力と出力のアドレス間のリンクを特定することを困難にします。

coinjoinの原理は、協力的なアプローチに基づいています：ビットコインを混ぜ合わせたい複数のユーザーが、同じトランザクションの入力として同額の金額を預けます。これらの金額は、各ユーザーに等価値の出力として再分配されます。トランザクションの終了時には、特定の出力を入力の既知のユーザーに関連付けることが不可能になります。入力と出力の間に直接的なリンクは存在せず、ユーザーとそのUTXO、および各コインの履歴間の関連付けが断たれます。
![coinjoin](assets/en/1.webp)

coinjoinトランザクションの例（私からではありません）： [323df21f0b0756f98336437aa3d2fb87e02b59f1946b714a7b09df04d429dec2](https://mempool.space/en/tx/323df21f0b0756f98336437aa3d2fb87e02b59f1946b714a7b09df04d429dec2)

各ユーザーが常に自分の資金をコントロールできるようにしながらcoinjoinを実行するために、プロセスはコーディネーターによるトランザクションの構築から始まり、その後参加者に伝達されます。各ユーザーは、それが自分に適していることを確認した後にトランザクションに署名します。最終的に、収集されたすべての署名がトランザクションに統合されます。ユーザーやコーディネーターによって、coinjoinトランザクションの出力を変更して資金を流用しようとする試みが行われた場合、署名は無効となり、トランザクションはノードによって拒否されます。

coinjoinの実装には、Whirlpool、JoinMarket、Wabisabiなどがあり、それぞれが参加者間の調整を管理し、coinjoinトランザクションの効率を高めることを目指しています。
このチュートリアルでは、ビットコインでcoinjoinsを実行するための最も効率的なソリューションと考えられる**Whirlpool**の実装について詳しく説明します。Dojoなしで、このチュートリアルではSamourai Walletモバイルアプリケーションでの使用に限定して探求します。

## なぜビットコインでcoinjoinsを行うのか？
あらゆるピアツーピア支払いシステムにおける初期の問題の1つは、二重支払いです：悪意のある個人が同じ通貨単位を複数回支払うことを、中央機関に仲裁を依頼することなくどのように防ぐか？

サトシ・ナカモトは、ビットコインプロトコルを通じて、このジレンマに対する解決策を提供しました。これは、任意の中央機関から独立して運営されるピアツーピアの電子支払いシステムです。彼のホワイトペーパーでは、二重支払いの不在を証明する唯一の方法は、支払いシステム内のすべてのトランザクションの可視性を確保することであると強調しています。
各参加者が取引について認識していることを保証するために、それらは公に開示されなければなりません。したがって、Bitcoinの運用は透明で分散されたインフラストラクチャに依存しており、任意のノードオペレーターが電子署名チェーン全体と、マイナーによるその作成からの各コインの履歴を検証できるようにしています。

Bitcoinのブロックチェーンの透明かつ分散された性質は、ネットワークのユーザーが他の参加者のすべての取引を追跡し分析できることを意味します。その結果、取引レベルでの匿名性は不可能です。しかし、個人識別のレベルでは匿名性が保持されます。伝統的な銀行システムでは各アカウントが個人の身元にリンクされているのに対し、Bitcoinでは資金が暗号鍵のペアに関連付けられており、ユーザーに暗号識別子の背後にある一種の擬似匿名性を提供します。

したがって、外部の観察者が特定のUTXOsを特定のユーザーと関連付けることができる場合、Bitcoin上での機密性は損なわれます。この関連付けが確立されると、その取引を追跡し、ビットコインの履歴を分析することが可能になります。Coinjoinは、まさにUTXOsの追跡可能性を破るために開発された技術であり、取引レベルでBitcoinユーザーにある程度の機密性の層を提供します。

## Whirlpoolはどのように機能しますか？
Whirlpoolは、"_ZeroLink_"トランザクションを使用することで他のcoinjoin方法と一線を画しています。これにより、すべての入力とすべての出力の間に技術的なリンクが絶対に存在しないことが保証されます。この完璧な混合は、各参加者が入力に同一の金額（マイニング手数料を除く）を寄与する構造を通じて達成され、完全に等しい金額の出力を生成します。
入力に対するこの制限的なアプローチは、Whirlpool coinjoin取引に独特の特徴を与えます：入力と出力の間の決定論的なリンクの完全な欠如。言い換えれば、各出力は、取引内の他のすべての出力と比較して、任意の参加者に帰属する可能性が等しくなります。
当初、Whirlpool coinjoinにおける参加者の数は5に限定されており、2人の新参加者と3人のリミキサー（これらの概念については後で説明します）でした。しかし、2023年に観測されたオンチェーン取引手数料の増加により、Samouraiチームはプライバシーを向上させると同時にコストを削減するためにモデルを再考しました。したがって、手数料の市場状況と参加者の数を考慮して、コーディネーターは現在、6、7、または8人の参加者を含むcoinjoinsを組織できます。これらの強化されたセッションは"_Surge Cycles_"として言及されます。設定に関係なく、Whirlpool coinjoinsには常に2人の新参加者のみが存在することに注意することが重要です。

したがって、Whirlpool取引は、入力と出力の数が同一であることが特徴です。これは以下のようになります：
- 5つの入力と5つの出力；
![coinjoin](assets/en/2.webp)
- 6つの入力と6つの出力；
![coinjoin](assets/en/3.webp)
- 7つの入力と7つの出力；
![coinjoin](assets/en/4.webp)
- 8つの入力と8つの出力。
![coinjoin](assets/en/5.webp)
Whirlpoolが提案するモデルは、小規模なcoinjoin取引に基づいています。WasabiやJoinMarketでは、単一サイクルの参加者のボリュームに匿名セットの堅牢性が依存しているのに対し、Whirlpoolは複数の小規模なサイクルの連鎖に賭けています。

このモデルでは、ユーザーはプールへの初回参加時にのみ手数料を支払い、追加の手数料なしで多数のリミックスに参加できます。新参加者がリミキサーのためのマイニング手数料を負担します。
コインが参加するコインジョインが増えるごとに、過去に遭遇した仲間とともに、匿名性セットは指数関数的に成長します。したがって、目標は、これらの無料のリミックスを利用することであり、それぞれの発生が各混合コインに関連する匿名性セットの密度を強化することに貢献します。
Whirlpoolは、2つの重要な要件を考慮して設計されました：
- Samourai Walletが主にスマートフォンアプリケーションであることを考慮して、モバイルデバイスでの実装のアクセシビリティ；
- 匿名性セットの顕著な増加を促進するためのリミックスサイクルの速度。
これらの命題は、Samourai Walletの開発者を導き、Whirlpoolの設計において、サイクルごとの参加者数を制限することにつながりました。参加者が少なすぎると、コインジョインの効率が損なわれ、各サイクルで生成される匿名性セットが劇的に減少してしまいます。一方、参加者が多すぎると、モバイルアプリケーションでの管理問題が発生し、サイクルの流れが妨げられる可能性があります。
**結局のところ、Whirlpoolでのコインジョインごとに多くの参加者を必要とすることはありません。なぜなら、匿名性セットは複数のコインジョインサイクルの蓄積を通じて達成されるからです。**

[-> Whirlpoolの匿名性セットについてもっと学ぶ。](https://planb.network/tutorials/privacy/wst-anonsets)

### プールとコインジョイン手数料
これらの複数のサイクルが混合コインの匿名性セットを効果的に増加させるためには、使用されるUTXOの金額を制限するための一定の枠組みを確立する必要があります。Whirlpoolは、異なるプールを定義します。

プールは、一緒に混合したいと望むユーザーのグループを表し、コインジョインプロセスを最適化するために使用するUTXOの金額に同意します。各プールはUTXOの固定金額を指定し、参加するためにはユーザーはこれに従わなければなりません。したがって、Whirlpoolでコインジョインを実行するには、プールを選択する必要があります。現在利用可能なプールは以下の通りです：
- 0.5ビットコイン；
- 0.05ビットコイン；
- 0.01ビットコイン；
- 0.001ビットコイン（= 100,000 sats）。

ビットコインをプールに参加させると、プール内の他の参加者と完全に均一なUTXOを生成するために分割されます。各プールには最大限度があります。したがって、この限度を超える金額の場合、同じプール内で2つの別々のエントリーを行うか、より高い金額の別のプールに向かう必要があります：

| プール (ビットコイン) | エントリーごとの最大金額 (ビットコイン) |
|----------------|------------------------------------|
| 0.5            | 35                                 |
| 0.05           | 3.5                                |
| 0.01           | 0.7                                |
| 0.001          | 0.025                              |

前述のように、UTXOはコインジョインに統合される準備ができているときにプールに属していると考えられます。しかし、これはユーザーがそれを所有していないことを意味するものではありません。**異なる混合サイクルを通じて、あなたは鍵と、その結果としてのビットコインを完全にコントロールします。**これがコインジョイン技術を他の中央集権的な混合技術と区別するものです。

コインジョインプールに入るためには、サービス手数料とマイニング手数料を支払う必要があります。サービス手数料は各プールごとに固定されており、Whirlpoolの開発と維持を担当するチームへの補償を目的としています。
Whirlpoolを使用するためのサービス手数料は、プールに入る際に一度だけ支払われます。このステップの後、追加の手数料なしで無制限のリミックスに参加する機会があります。こちらが各プールの現在の固定手数料です：
| プール (ビットコイン) | エントリー手数料 (ビットコイン)        |
|----------------|----------------------------|
| 0.5            | 0.0175                     || 0.05           | 0.00175                    |
| 0.01           | 0.0005 (50,000 sats)       |
| 0.001          | 0.00005 (5,000 sats)       |

これらの手数料は、coinjoinに投入する金額に関係なく、選択したプールへの入場券として機能します。したがって、0.01 BTCをちょうど0.01プールに参加する場合でも、0.5 BTCでそれに参加する場合でも、手数料は絶対値で同じままです。

coinjoinに進む前に、ユーザーは2つの戦略から選択することができます：
- サービス手数料を最小限に抑えるために小さなプールを選択するが、その結果として複数の小さなUTXOを受け取ることになる；
- または、より大きなプールを選択し、より少ない数の大きな価値のUTXOを得るために高い手数料を支払うことに同意する。

coinjoinサイクルの後で複数の混合されたUTXOを統合することは一般的には勧められていません。これは、特にCommon-Input-Ownership Heuristic (CIOH)によって、獲得した機密性が損なわれる可能性があるためです。したがって、出力として多くの小さな価値のUTXOを持つことを避けるために、より多くを支払うことを意味しても、より大きなプールを選択することが賢明かもしれません。ユーザーはこれらの妥協点を考慮して、好みのプールを選択する必要があります。

サービス手数料の他に、Bitcoin取引に固有のマイニング手数料も考慮する必要があります。Whirlpoolユーザーとして、準備トランザクション（`Tx0`）および最初のcoinjoinのためのマイニング手数料を支払う必要があります。その後のすべてのリミックスは、新規参入者の支払いに依存するWhirlpoolのモデルのおかげで無料です。

実際、Whirlpoolのcoinjoinでは、入力のうち2ユーザーが新規参入者です。他の入力はリミキサーから来ます。その結果、トランザクションのすべての参加者のマイニング手数料は、これら2人の新参加者によってカバーされ、彼らもまた無料のリミックスの恩恵を受けることになります：
![coinjoin](assets/en/6.webp)
この手数料システムのおかげで、Whirlpoolは他のcoinjoinサービスとは明確に異なります。なぜなら、UTXOのanonsetsはユーザーが支払った価格に比例しないからです。したがって、プールの入場料と2つのトランザクション（`Tx0`と初期ミックス）のマイニング手数料のみを支払うことで、かなり高いレベルの匿名性を達成することが可能です。
重要なのは、ユーザーが複数のcoinjoinを完了した後、プールからUTXOを引き出すためのマイニング手数料もカバーする必要があるということです。ただし、後で説明するチュートリアルで`mix to`オプションを選択した場合はこの限りではありません。

### Whirlpoolによって使用されるHDウォレットアカウント
Whirlpoolを介してcoinjoinを実行するために、ウォレットは複数の異なるアカウントを生成する必要があります。HD（*Hierarchical Deterministic*）ウォレットのコンテキストにおいて、アカウントは他と完全に隔離されたセクションを構成し、この分離はウォレットの階層の第3深度レベル、つまり`xpub`のレベルで発生します。

HDウォレットは理論的には`2^(32/2)`異なるアカウントを導出することができます。初期アカウントは、すべてのBitcoinウォレットでデフォルトで使用されるインデックス`0'`に対応します。

SamouraiやSparrowのようなWhirlpoolに適応したウォレットでは、coinjoinプロセスのニーズを満たすために4つのアカウントが使用されます：
- **預金**アカウント、インデックス`0'`によって識別されます；
- **悪徳銀行**（またはdoxxic change）口座は、インデックス`2 147 483 644`で識別されます。
- **プレミックス**口座は、インデックス`2 147 483 645`で識別されます。
- **ポストミックス**口座は、インデックス`2 147 483 646`で識別されます。

これらの各口座は、コインジョインプロセス内で特定の機能を果たします。

これらの口座はすべて単一のシードにリンクされており、ユーザーは回復フレーズと、該当する場合はパスフレーズを使用して、すべてのビットコインへのアクセスを回復できます。ただし、この回復操作中に、使用された異なるアカウントインデックスをソフトウェアに指定する必要があります。

これらの口座内のWhirlpoolコインジョインの異なる段階を見てみましょう。

### Whirlpoolでのコインジョインの異なる段階
**ステージ1: Tx0**
どのWhirlpoolコインジョインの出発点も、**預金**口座です。この口座は、新しいビットコインウォレットを作成するときに自動的に使用される口座です。この口座には、ミックスしたいビットコインを入金する必要があります。
`Tx0`はWhirlpoolミキシングプロセスの最初のステップを表し、コインジョインのためにUTXOを選択されたプールの金額に対応する単位に分割して準備し、ミックスの均一性を確保することを目的としています。均一化されたUTXOはその後、**プレミックス**口座に送られます。プールに入れない差額は、特定の口座：**悪徳銀行**（または"doxxic change"）に分けられます。
この初期トランザクション`Tx0`はまた、ミックスコーディネーターに支払うサービス料を決済するためにも使用されます。次のステップとは異なり、このトランザクションは協力的ではないため、ユーザーはすべてのマイニング料金を負担する必要があります：
![coinjoin](assets/en/7.webp)

この`Tx0`トランザクションの例では、**預金**口座からの`372,000 sats`の入力が複数の出力UTXOに分割され、以下のように配布されます：
- コーディネーターへのサービス料として`5,000 sats`、これは`100,000 sats`のプールへのエントリーに対応します；
- ミキシングのために準備され、コーディネーターに登録された3つのUTXOは、それぞれ`108,000 sats`で均一化され、将来の最初のミックスのためのマイニング料金をカバーします；
- プールに入れない余剰分は、小さすぎると考えられ、有害な変更とみなされます。これは特定の口座に送られます。ここでは、この変更は`40,000 sats`になります；
- 最後に、出力を構成しないが、`Tx0`の確認に必要なマイニング料金として`3,000 sats`があります。

例えば、こちらが実際のWhirlpool Tx0です（私のものではありません）：[edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46](https://mempool.space/en/tx/edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46)

**ステップ2: 悪徳変更**
プールに統合できなかった余剰分は、ここでは`40,000 sats`に相当し、ウォレット内の他のUTXOと厳格に分離するために、**bad bank**アカウント、別名「doxxic change」にリダイレクトされます。
このUTXOはユーザーのプライバシーにとって危険です。なぜなら、過去にまだ関連付けられており、したがって所有者の身元に可能性があるだけでなく、coinjoinを実行したユーザーに属していると記録されているからです。
このUTXOが混合された出力と統合されると、coinjoinサイクル中に得られたすべての機密性が失われることになります。特にCommon-Input-Ownership-Heuristic (CIOH)のためです。doxxic changeと統合されると、coinjoinサイクルの異なる入力がリンクされるため、ユーザーは機密性を失うリスクがあります。したがって、慎重に扱う必要があります。この有害なUTXOの管理方法は、この記事の最後の部分で詳しく説明され、将来のチュートリアルではこれらの方法をPlanB Networkでより深くカバーします。

**ステップ3: 初期ミックス**
`Tx0`が完了すると、等価化されたUTXOsは私たちのウォレットの**premix**アカウントに送られ、最初のcoinjoinサイクル、別名「初期ミックス」に導入される準備が整います。例えば、`Tx0`が複数のUTXOsをミキシング用に生成する場合、それぞれが別々の初期coinjoinに統合されます。

これらの最初のミックスの終わりには、**premix**アカウントは空になり、私たちのコインは、この最初のcoinjoinのために支払ったマイニング手数料を考慮して、選択したプールによって定義された金額に正確に調整されます。例えば、私たちの初期UTXOsの`108 000 sats`は、正確に`100 000 sats`に減少します。
![coinjoin](assets/en/8.webp)
**ステップ4: リミックス**
初期ミックスの後、UTXOsは**postmix**アカウントに転送されます。このアカウントは、すでに混合されたUTXOsとリミックスを待っているUTXOsを集めます。Whirlpoolクライアントがアクティブな場合、**postmix**アカウント内のUTXOsは自動的にリミックスに利用可能となり、これらの新しいサイクルにランダムに選ばれます。

リマインダーとして、リミックスはその後100%無料です：追加のサービス料やマイニング料は必要ありません。**postmix**アカウントにUTXOsを保持することで、その価値をそのまま維持し、同時にそのanonsetsを改善します。これが、これらのコインを複数のcoinjoinサイクルに参加させることが重要な理由です。それはあなたにとって厳密に何もコストがかからず、その匿名性のレベルを高めます。

混合されたUTXOsを使うとき、この**postmix**アカウントから直接行うことができます。混合されたUTXOsをこのアカウントに保持し、無料のリミックスの恩恵を受け、Whirlpool回路を離れることでその機密性が低下するのを避けることが推奨されます。

次のチュートリアルで見るように、`mix to`オプションもあり、これは定義された数のcoinjoinsの後に、例えばコールドウォレットのような別のウォレットに混合コインを自動的に送る可能性を提供します。
理論をカバーした後、Samourai Wallet Androidアプリを通じてWhirlpoolを使用するチュートリアルで実践に入りましょう！
## チュートリアル: Samourai WalletでのCoinjoin Whirlpool
Whirlpoolを使用するには多くのオプションがあります。ここで紹介したいのは、Android上のオープンソースBitcoinウォレット管理アプリケーションであるSamourai Walletオプション（Dojoなし）です。
SamouraiをDojoなしで使用するミキシングは、扱いやすく、設定が簡単で、Androidスマートフォンとインターネット接続だけで済むという利点があります。
しかし、この方法には2つの顕著な欠点があります：
- Coinjoinは、Samouraiがバックグラウンドで実行され、接続されているときにのみ発生します。これは、ビットコインを24/7でミックスおよびリミックスしたい場合、Samouraiを常にオンにしておく必要があることを意味します；
- 自分のDojoに接続することなくSamourai WalletでWhirlpoolを使用する場合、アプリケーションはSamouraiチームが維持するサーバーに接続する必要があり、ウォレットの`xpub`を彼らに明らかにすることになります。これらの匿名の情報は、アプリケーションがトランザクションを見つけるために必要です。

これらの制限を克服する理想的な解決策は、個人のBitcoinノード上でWhirlpool CLIインスタンスと関連付けられた自分のDojoを運用することです。この方法では、情報の漏洩を避け、完全な独立性を実現できます。以下に示すチュートリアルは、特定の目標や初心者には役立ちますが、coinjoinセッションを真に最適化するには、自分のDojoを使用することをお勧めします。この設定を設定するための詳細なガイドは、間もなくPlanB Networkで利用可能になります。

### Samourai Walletのインストール
まず、当然ながらSamourai Walletアプリケーションが必要になります。[公式ウェブサイト](https://samouraiwallet.com/download)からAPKで直接ダウンロードするか、[彼らのGitLab](https://code.samourai.io/wallet/samourai-wallet-android)、または[Google Play Store](https://play.google.com/store/apps/details?id=com.samourai.wallet&pcampaignid=web_share)からダウンロードできます。

### ソフトウェアウォレットの作成
ソフトウェアをインストールした後、SamouraiでBitcoinウォレットを作成する手続きに進む必要があります。すでにウォレットを持っている場合は、次のステップに直接進むことができます。

アプリケーションを開いたら、青い`Start`ボタンを押します。次に、新しいウォレットの暗号化バックアップが保存される電話のファイル内の場所を選択するように求められます。

![samourai](assets/en/9.webp)
対応するノッチをクリックしてTorを有効にします。この段階で、特定のDojoを選択するオプションもあります。しかし、このチュートリアルではデフォルトのDojoを続けるので、オプションを無効にしておいてください。Torが接続されたら、`Create a new wallet`ボタンを押します。
![samourai](assets/en/10.webp)

次に、Samourai WalletはBIP39パスフレーズの設定を促します。この追加のパスワードは非常に重要で、プライベートキーの導出に直接作用します。このパスフレーズを失うと、ビットコインにアクセスできなくなり、取り返しのつかない損失につながります。Samouraiウォレットを復元するには、12語のリカバリーフレーズとパスフレーズの両方が不可欠です。

したがって、堅牢なパスフレーズを選択し、紙や金属媒体に一つ以上の物理的なコピーを作成して、ビットコインのセキュリティを確保することが不可欠です。これらの作業を完了したら、`I am aware that in case of loss...`のボックスをチェックし、`NEXT`ボタンを押します。

![samourai](assets/en/11.webp)

次に、5桁から8桁のPINコードを定義する必要があります。このコードは、電話上のウォレットへのアクセスを保護します。Samouraiアプリケーションを開くたびにこのコードが要求されます。堅牢なPINコードを選択し、バックアップコピーを保持してください。その後、`NEXT`ボタンを押すことができます。
Samouraiは、確認のためもう一度PINコードの入力を求めます。入力してから`FINALIZE`を押してください。

その後、12語からなるリカバリーフレーズにアクセスします。このフレーズにより、以前入力したパスフレーズを使用してウォレットを回復できます。問題が発生した場合にビットコインのセキュリティを確保するため、このフレーズを紙や金属材料などの物理メディアに1つ以上コピーすることを強く推奨します。

これらのバックアップを作成した後、新しいSamouraiウォレットのインターフェースに案内されます。

PayNym Botを取得することが提案されます。希望する場合はリクエストできますが、このチュートリアルには必須ではありません。

この新しいウォレットでビットコインを受け取る前に、ウォレットのバックアップ（パスフレーズとリカバリーフレーズ）の有効性を再確認することを強く推奨します。パスフレーズを検証するには、画面の左上にあるPayNym Botのアイコンを選択し、次のパスをたどります：
```plaintext
Settings > Troubleshooting > Passphrase/backup test
```

パスフレーズを入力して検証を実行します。

Samouraiは、それが有効であるかを確認します。

リカバリーフレーズのバックアップを検証するには、画面の左上にあるPayNym Botのアイコンにアクセスし、このパスをたどります：
```plaintext
Settings > Wallet > Show 12-word recovery phrase
```

Samouraiはリカバリーフレーズを表示するウィンドウを表示します。物理的なバックアップと完全に一致することを確認してください。

完全な回復テストをさらに進めるには、ウォレットの証人要素（`xpubs`の1つなど）をメモし、その後ウォレットを削除します（まだ空の場合）。目的は、物理的なバックアップのみを使用してこの空のウォレットを復元しようとすることです。復元が成功した場合、バックアップが有効で信頼できることを示します。

### ビットコインの受け取り
ウォレットを作成した後、インデックス`0'`で識別される単一のアカウントから始めます。これは、前の部分で話した**預金**アカウントです。コインジョイン用に意図されたビットコインをこのアカウントに転送する必要があります。

これを行うには、画面の右下にある青い`+`記号をクリックします。

次に、緑の`Receive`ボタンをクリックします。

Samouraiは自動的にビットコインを受け取るための新しい空のアドレスを生成します。

そこにミックスするビットコインを送信できます。

### Tx0の作成
トランザクションが確認されたら、コインジョインのプロセスを開始できます。これを行うには、画面の右下にある青い`+`ボタンをクリックします。

次に、青い`Whirlpool`をクリックします。

Whirlpoolが初期化され、Samouraiが必要なアカウントを作成するのを待ちます。

その後、Whirlpoolのホームページに到着します。`Start`をクリックします。
**コインジョインサイクル**に送信したい**預金**口座のUTXOを選択し、`次へ`をクリックしてください。
![samourai](assets/en/26.webp)

次のステップでは、`Tx0`および最初のミックスに割り当てる手数料レベルを選択する必要があります。この設定は、`Tx0`および最初のコインジョイン（または初期のコインジョイン）が確認される速度を決定します。`Tx0`と最初のミックスのマイニング手数料はあなたの責任ですが、その後のリミックスに対してマイニング手数料を支払う必要はありません。`低`、`普通`、`高`のオプションから選択できます。

![samourai](assets/en/27.webp)

同じウィンドウで、参加するプールを選択するオプションがあります。私が初めに選択したUTXOが`454,258 sats`だったため、私に可能な選択肢は`100,000 sats`プールのみです。このページでは、マイニング手数料に加えて、プールのサービス手数料も提示されており、このコインジョインサイクルの総コストを知ることができます。すべてが適している場合は、適切なプールを選択し、青い`VERIFY CYCLE DETAILS`ボタンをクリックして続行してください。

![samourai](assets/en/28.webp)

次に、コインジョインサイクルのすべての詳細を確認できます：
- プールに入るUTXOの数；
- 発生する各種手数料；
- doxxic changeの量...

情報を確認し、緑の`START CYCLE`ボタンをクリックしてください。

![samourai](assets/en/29.webp)

コインジョインサイクルへの参加によって生じるtoxic changeを「使用不可」としてマークするオプションを提供するウィンドウが表示されます。`YES`を選択すると、このUTXOはウォレットに表示されず、将来のトランザクションで選択することはできません。ただし、ウォレットのUTXOリストでアクセス可能であり、手動でそのステータスを変更できます。このオプションを選択することで、後でプライバシーを損なう可能性のある操作ミスを避けることが推奨されます。`NO`を選択した場合、toxic changeはウォレットで使用可能なままになります。このtoxic changeの管理と使用についてもっと知りたい場合は、このチュートリアルの最後の部分を読むことをお勧めします。

![samourai](assets/en/30.webp)

Samouraiはその後、あなたのTx0をブロードキャストします。

![samourai](assets/en/31.webp)

### コインジョインの実行
Tx0がブロードキャストされると、Whirlpoolメニューの`Transactions`タブで見つけることができます。

![samourai](assets/en/32.webp)
ミックスされる準備ができているUTXOは、**Premix**アカウントに対応する`Mixing in progress...`タブにあります。
![samourai](assets/en/33.webp)

`Tx0`が確認されると、UTXOは自動的にコーディネーターに登録され、初期ミックスが自動的に連続して開始されます。

![samourai](assets/en/34.webp)
`Remixing`タブをチェックすることで、**Postmix**アカウントに対応する初期ミックスから生じたUTXOsを観察できます。これらのコインは、追加料金なしで後続のリミックスの準備ができています。リミックスプロセスとコインジョインサイクルの効率についてもっと学ぶために、この他の記事を参照することをお勧めします：[REMIX - WHIRLPOOL](https://planb.network/tutorials/privacy/remix-whirlpool)
![samourai](assets/en/35.webp)

UTXOのリミックスを一時的に中断するには、その右側にある一時停止ボタンを押します。再びリミックスの対象とするには、同じボタンをもう一度クリックするだけです。ユーザーとプールごとに同時に実行できるコインジョインは1つだけであることに注意が必要です。したがって、`100 000 sats`のUTXOsが6つコインジョインの準備ができている場合、そのうちの1つだけがミックスされます。UTXOをミックスした後、Samourai Walletは利用可能な新しいUTXOをランダムに選択して、各コインのリミックスを多様化しバランスを取ります。

![samourai](assets/en/36.webp)

UTXOsをリミックスのために継続的に利用可能に保つためには、Samouraiアプリケーションをバックグラウンドでアクティブに保つ必要があります。Whirlpoolが実行中であることを確認する通知が電話に表示されるはずです。アプリケーションを閉じるか、電話をオフにすると、コインジョインが一時停止します。

### コインジョインの完了
ミックスされたビットコインを使うには、Whirlpoolメニュータブで`Remixing`と記載された**Postmix**アカウントに移動します。

![samourai](assets/en/37.webp)

右下にある青いWhirlpoolロゴをクリックします。

![samourai](assets/en/38.webp)

次に、`Spend Mixed UTXOs`をクリックします。

![samourai](assets/en/39.webp)

Samourai Walletで行う他のトランザクションと同じ方法で、受取人のアドレスと送金額を入力できます。青い背景は、資金がWhirlpoolアカウントからではなく、**預金**アカウントから使われていることを示します。

![samourai](assets/en/40.webp)

右上の3つの小さな点をクリックすると、特定のUTXOsを選択するオプションがあります。
![samourai](assets/en/41.webp)
ウィンドウの右上にある白い四角をクリックすると、カメラで受取人のアドレスのQRコードをスキャンできます。

![samourai](assets/en/42.webp)

支払いトランザクションに必要な情報を入力し、青い`VERIFY TRANSACTION`ボタンをクリックします。

![samourai](assets/en/43.webp)

次のステップでは、トランザクションに関連する手数料率を変更するオプションがあります。Stonewallオプションを有効にするには、該当するボックスにチェックを入れます。Stonewallオプションが選択できない場合、**Postmix**アカウントにはこの特定のトランザクション構造をサポートするのに十分なサイズのUTXOが含まれていないことを意味します。

[-> Stonewallトランザクションについてもっと学ぶ。](https://planb.network/tutorials/privacy/stonewall)

すべてが満足であれば、緑色の`SEND ... BTC`ボタンをクリックします。

![samourai](assets/en/44.webp)

Samouraiは次に、トランザクションを署名してネットワークにブロードキャストします。マイナーによってブロックに追加されるのを待つだけです。
### SCODEの使用
時々、Samourai Walletチームは「SCODE」と呼ばれるプロモーションコードを提供します。SCODEは、プールのサービス料金に割引を提供するプロモーションコードです。Samourai Walletは特別なイベント中にそのようなコードをユーザーに時々提供します。将来のSCODEを見逃さないように、[Samourai Walletをソーシャルメディアでフォローする](https://twitter.com/SamouraiWallet)ことをお勧めします。

SamouraiでSCODEを適用するには、新しいコインジョインサイクルを開始する前に、Whirlpoolメニューに移動し、画面右上にある3つの小さなドットを選択します。

`SCODE (プロモーションコード) Whirlpool`をクリックします。

開いたウィンドウにSCODEを入力し、`OK`をクリックして確認します。

Whirlpoolは自動的に閉じます。Samouraiのローディングが終了するのを待ち、再度Whirlpoolメニューを開きます。

もう一度3つの小さなドットをクリックし、`SCODE (プロモーションコード) Whirlpool`を選択して、SCODEが正しく登録されたことを確認します。すべてが順序どおりであれば、サービス料金が割引された新しいWhirlpoolサイクルを開始する準備が整います。これらのSCODEは一時的なものであることに注意してください：数日間有効であり、その後は無効になります。

## コインジョインサイクルの品質をどのように知るか？
コインジョインが真に効果的であるためには、入力と出力の金額の間に良好な一様性が示されることが不可欠です。この一様性は、外部の観察者の目における可能な解釈の数を増幅させ、取引を取り巻く不確実性を高めます。コインジョインによって生成されるこの不確実性を定量化するためには、取引のエントロピーを計算することができます。これらの指標の詳細な探求については、チュートリアル：[BOLTZMANN CALCULATOR](https://planb.network/en/tutorials/privacy/boltzmann-entropy)を参照してください。Whirlpoolモデルは、コインジョインに最も均一性をもたらすと認識されています。

次に、いくつかのコインジョインサイクルのパフォーマンスは、コインが隠されるグループの範囲に基づいて評価されます。これらのグループのサイズは、anonsetsと呼ばれるものを定義します。anonsetsには2つのタイプがあります：一つ目は、過去から現在への逆行分析に対して得られたプライバシーを評価し、二つ目は、過去から現在への前向き分析に対して評価します。これら2つの指標の詳細な説明については、チュートリアル：[WHIRLPOOL STATS TOOLS - ANONSETS](https://planb.network/tutorials/privacy/wst-anonsets)

## ポストミックスの管理方法は？
コインジョインサイクルを実行した後、最良の戦略は、将来の使用を待っている間、UTXOを**ポストミックス**アカウントに保持することです。それらを使う必要があるまで無期限にリミックスさせることさえ推奨されます。

一部のユーザーは、混合されたビットコインをハードウェアウォレットによって保護されたウォレットに転送することを検討するかもしれません。これは可能ですが、獲得した機密性を損なわないようにSamourai Walletの推奨事項に厳密に従うことが重要です。
UTXOの統合は、最も頻繁に発生する間違いです。CIOH（*Common-Input-Ownership-Heuristic*）を避けるためには、混合されたUTXOと未混合のUTXOを同じトランザクションで組み合わせないようにする必要があります。これには、特にラベリングの面で、ウォレット内のUTXOを慎重に管理することが求められます。コインジョインを超えて、UTXOを統合することは一般的に悪い習慣であり、適切に管理されない場合、しばしば機密性の損失につながります。混合されたUTXO同士の統合についても注意が必要です。混合されたUTXOが十分な匿名セットを持っている場合、適度な統合は可能ですが、これは必然的にコインのプライバシーを減少させます。統合は大きすぎず、また不十分な数のリミックスの後に行われないようにしてください。これは、コインジョインサイクルの前後でUTXO間に推測可能なリンクを確立するリスクがあります。これらの操作について疑問がある場合、ベストプラクティスは、ポストミックスUTXOを統合せず、それらをハードウェアウォレットに一つずつ転送し、毎回新しい空白のアドレスを生成することです。再度、受け取った各UTXOを適切にラベル付けすることを忘れないでください。

また、一般的でないスクリプトを使用するウォレットにポストミックスUTXOを転送することもお勧めしません。例えば、`P2WSH`スクリプトを使用するマルチシグウォレットからWhirlpoolに入る場合、元々そのタイプのウォレットを持っている他のユーザーと混合される可能性はほとんどありません。このマルチシグウォレットにポストミックスを出口すると、混合されたビットコインのプライバシーレベルは大幅に低下します。スクリプトを超えて、あなたを騙す可能性のある多くの他のウォレットの指紋があります。

ビットコイントランザクションにおいても、受信アドレスを再利用しないことが適切です。新しいトランザクションは、新しい空白のアドレスで受け取る必要があります。

最も簡単で安全な解決策は、混合されたUTXOをその**ポストミックス**アカウントに残し、リミックスを繰り返し、使用する際にのみ触れることです。SamouraiとSparrowウォレットは、チェーン分析に関連するこれらのリスクに対する追加の保護を提供します。これらの保護は、間違いを避けるのに役立ちます。

## ドクシックチェンジをどのように管理するか？
次に、コインジョインプールに入れなかった変更であるドクシックチェンジを慎重に管理する必要があります。Whirlpoolの使用から生じるこれらの有害なUTXOは、コインジョインの使用とあなたとのリンクを確立するため、プライバシーに対するリスクをもたらします。したがって、それらを慎重に扱い、特に混合されたUTXOと組み合わせないことが不可欠です。その使用に関して検討すべき異なる戦略は次のとおりです：
- **より小さいプールで混ぜる：** 有害なUTXOが自身で小さいプールに入るのに十分な大きさである場合、混ぜることを検討してください。これはしばしば最良の選択です。しかし、異なるエントリをリンクする可能性があるため、複数の有害なUTXOを統合してプールにアクセスすることは極めて重要です。
- **「非支出可能」としてマークする：** 別のアプローチは、それらを使用しないようにし、専用のアカウントで「非支出可能」としてマークし、ただHodlすることです。これにより、誤ってそれらを使用することがないようにします。ビットコインの価値が上がると、有害なUTXOに適した新しいプールが出現する可能性があります。
- **寄付を行う：** Bitcoinおよび関連ソフトウェアの開発者に、たとえ控えめなものであっても、寄付を検討してください。BTCを受け入れる組織に寄付することもできます。有害なUTXOの管理が複雑すぎると感じる場合は、寄付を行うことでそれらを単純に処分することができます。
- **ギフトカードを購入する：** [Bitrefill](https://www.bitrefill.com/)のようなプラットフォームを利用して、ビットコインを様々な商店で使用できるギフトカードと交換することができます。これは、関連する価値を失うことなく有害なUTXOを処分する方法となるかもしれません。
- **Moneroに統合する：** Samourai Walletは現在、BTCとXMR間のアトミックスワップサービスを提供しています。これは、KYCを介さずにプライバシーを損なうことなく、Monero上で有害なUTXOを統合するのに理想的です。ただし、このオプションはマイニング手数料と流動性制約によるプレミアムのため、コストがかかる可能性があります。
- **Lightning Networkに送る：** これらのUTXOをLightning Networkに転送して、取引手数料を削減することは興味深いオプションです。しかし、この方法はLightningの使用によって特定の情報を明らかにする可能性があるため、注意して実践する必要があります。

これらの異なる技術を実装するための詳細なチュートリアルが、間もなくPlanB Networkで提供される予定です。

**追加リソース：**
[Samourai Walletビデオチュートリアル](https://planb.network/tutorials/wallet/samourai)
- [Samourai Walletドキュメント - Whirlpool](https://docs.samourai.io/whirlpool/basic-concepts);
- [coinjoinsに関するTwitterスレッド](https://twitter.com/SamouraiWallet/status/1489220847336308739);
- [coinjoinsに関するブログポスト](https://www.pandul.fr/post/comprendre-et-utiliser-le-coinjoin-sur-bitcoin).