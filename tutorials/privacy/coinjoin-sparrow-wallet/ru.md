---
name: Coinjoin - Sparrow Wallet
description: Как выполнить coinjoin в Sparrow Wallet?
---
![cover](assets/cover.webp)

***ВНИМАНИЕ:** После ареста основателей Samourai Wallet и изъятия их серверов 24 апреля, инструмент Whirlpool больше не функционирует, даже для пользователей, которые имеют свой собственный Dojo или используют Sparrow Wallet. Тем не менее, существует возможность, что этот инструмент может быть восстановлен в ближайшие недели или перезапущен иным способом. Кроме того, теоретическая часть этой статьи остается актуальной для понимания принципов и целей coinjoin в целом (не только Whirlpool), а также для понимания эффективности модели Whirlpool.*

_Мы тщательно следим за развитием этого дела, а также за развитием связанных с ним инструментов. Уверяем вас, что мы обновим этот учебник, как только появится новая информация._

_Этот учебник предоставляется только в образовательных и информационных целях. Мы не поддерживаем и не поощряем использование этих инструментов в преступных целях. Каждый пользователь несет ответственность за соблюдение законов в своей юрисдикции._

---

В этом учебнике вы узнаете, что такое coinjoin и как выполнить его с помощью программного обеспечения Sparrow Wallet и реализации Whirlpool.

## Что такое coinjoin в Bitcoin?
**Coinjoin — это техника, которая нарушает прослеживаемость биткойнов в блокчейне**. Она основана на совместной транзакции с определенной структурой одноименного названия: транзакция coinjoin.

Coinjoin повышает конфиденциальность пользователей Bitcoin, усложняя анализ цепочек для внешних наблюдателей. Их структура позволяет объединять множество монет от разных пользователей в одну транзакцию, тем самым затрудняя отслеживание связей между входными и выходными адресами.

Принцип coinjoin основан на совместном подходе: несколько пользователей, желающих смешать свои биткойны, вносят одинаковые суммы в качестве входов одной и той же транзакции. Затем эти суммы распределяются как выходы равной стоимости каждому пользователю. В конце транзакции становится невозможным связать конкретный выход с известным пользователем на входе. Между входами и выходами не существует прямой связи, что нарушает ассоциацию между пользователями и их UTXO, а также историю каждой монеты.
![coinjoin](assets/notext/1.webp)

Пример транзакции coinjoin (не моя): [323df21f0b0756f98336437aa3d2fb87e02b59f1946b714a7b09df04d429dec2](https://mempool.space/en/tx/323df21f0b0756f98336437aa3d2fb87e02b59f1946b714a7b09df04d429dec2)

Для выполнения coinjoin, при этом гарантируя, что каждый пользователь в любой момент времени сохраняет контроль над своими средствами, процесс начинается с создания транзакции координатором, который затем передает ее каждому участнику. Каждый пользователь затем подписывает транзакцию после проверки, что она им подходит. Все собранные подписи наконец интегрируются в транзакцию. Если пользователь или координатор попытаются перенаправить средства, изменив выходы транзакции coinjoin, подписи окажутся недействительными, что приведет к отклонению транзакции узлами.

Существует несколько реализаций coinjoin, таких как Whirlpool, JoinMarket или Wabisabi, каждая из которых направлена на управление координацией между участниками и повышение эффективности транзакций coinjoin.
В этом учебнике мы сосредоточимся на реализации **Whirlpool**, которую я считаю наиболее эффективным решением для выполнения coinjoin на Bitcoin. Хотя она доступна в нескольких кошельках, этот учебник исключительно исследует ее использование с программным обеспечением Sparrow Wallet для настольных компьютеров.

## Почему стоит выполнять CoinJoins на Bitcoin?

Одна из первоначальных проблем любой системы пиринговых платежей - это двойная траты: как предотвратить возможность злоумышленникам тратить одни и те же денежные единицы несколько раз без обращения к центральному органу для арбитража?

Сатоши Накамото предложил решение этой дилеммы через протокол Bitcoin, пиринговую электронную платежную систему, которая работает независимо от любого центрального органа. В своем белом документе он подчеркивает, что единственный способ гарантировать отсутствие двойной траты - это обеспечить видимость всех транзакций внутри платежной системы.

Чтобы каждый участник был осведомлен о транзакциях, они должны быть публично раскрыты. Таким образом, работа Bitcoin основана на прозрачной и распределенной инфраструктуре, позволяющей любому оператору узла проверять всю цепочку электронных подписей и историю каждой монеты, начиная с ее создания майнером.

Прозрачная и распределенная природа блокчейна Bitcoin означает, что любой пользователь сети может следить и анализировать транзакции всех других участников. Следовательно, анонимность на уровне транзакций невозможна. Однако анонимность сохраняется на уровне индивидуальной идентификации. В отличие от традиционной банковской системы, где каждый счет связан с личной идентичностью, в Bitcoin средства ассоциируются с парами криптографических ключей, таким образом предлагая пользователям форму псевдонимности за криптографическими идентификаторами.

Таким образом, конфиденциальность на Bitcoin нарушается, когда внешние наблюдатели умудряются ассоциировать конкретные UTXO с идентифицированными пользователями. Как только эта ассоциация установлена, становится возможным отслеживать их транзакции и анализировать историю их биткоинов. Coinjoin - это именно техника, разработанная для разрыва следимости UTXO, таким образом предлагая определенный уровень конфиденциальности пользователям Bitcoin на уровне транзакций.

## Как работает Whirlpool?

Whirlpool выделяется среди других методов coinjoin использованием транзакций "_ZeroLink_", которые гарантируют, что технически невозможно установить связь между всеми входами и всеми выходами. Это идеальное смешивание достигается за счет структуры, в которой каждый участник вносит одинаковую сумму на входе (за исключением комиссий за майнинг), таким образом генерируя выходы совершенно равных сумм.

Этот ограничительный подход к входам придает транзакциям coinjoin Whirlpool уникальную характеристику: полное отсутствие детерминированных связей между входами и выходами. Другими словами, каждый выход имеет равную вероятность быть приписанным любому участнику по сравнению со всеми другими выходами транзакции.
Изначально количество участников в каждом coinjoin Whirlpool было ограничено 5, с 2 новыми участниками и 3 ремиксерами (мы объясним эти понятия далее). Однако увеличение комиссий за транзакции в блокчейне, наблюдаемое в 2023 году, побудило команды Samourai пересмотреть свою модель для улучшения конфиденциальности при снижении затрат. Таким образом, учитывая рыночную ситуацию с комиссиями и количество участников, координатор теперь может организовывать coinjoins, включая 6, 7 или 8 участников. Эти улучшенные сессии называются "_Surge Cycles_". Важно отметить, что, независимо от настройки, в coinjoins Whirlpool всегда есть только 2 новых участника.

Таким образом, транзакции Whirlpool характеризуются одинаковым количеством входов и выходов, которые могут быть:
- 5 входов и 5 выходов;
![coinjoin](assets/notext/2.webp)
- 6 входов и 6 выходов;
![coinjoin](assets/notext/3.webp)
- 7 входов и 7 выходов;
![coinjoin](assets/notext/4.webp)
- 8 входов и 8 выходов. ![coinjoin](assets/notext/5.webp)
Предложенная модель Whirlpool основана на малых транзакциях coinjoin. В отличие от Wasabi и JoinMarket, где надежность анонимных наборов зависит от объема участников в одном цикле, Whirlpool делает ставку на цепочку нескольких малых циклов.

В этой модели пользователь несет расходы только при своем первоначальном входе в пул, что позволяет ему участвовать в множестве ремиксов без дополнительных сборов. Новые участники оплачивают комиссию за майнинг для ремиксеров.

С каждым дополнительным coinjoin, в котором участвует монета вместе с ее прошлыми партнерами, анонимные наборы будут расти экспоненциально. Таким образом, цель состоит в том, чтобы воспользоваться этими бесплатными ремиксами, которые с каждым разом способствуют увеличению плотности анонимных наборов, ассоциированных с каждой смешанной монетой.

Whirlpool был разработан с учетом двух важных требований:
- Возможность реализации на мобильных устройствах, учитывая, что Samourai Wallet в первую очередь является приложением для смартфонов;
- Скорость циклов ремикса для значительного увеличения анонимных наборов.

Эти императивы направляли выборы разработчиков Samourai Wallet при проектировании Whirlpool, заставляя их ограничить количество участников на цикл. Слишком малое количество участников могло бы подорвать эффективность coinjoin, резко сократив создаваемые анонимные наборы с каждым циклом, в то время как слишком большое количество участников могло бы вызвать проблемы управления на мобильных приложениях и затруднить поток циклов.

**В конечном итоге, нет необходимости иметь большое количество участников на каждый coinjoin в Whirlpool, поскольку анонимные наборы формируются за счет накопления нескольких циклов coinjoin.**
[-> Узнать больше о анонимных наборах Whirlpool.](https://planb.network/tutorials/privacy/wst-anonsets)
### Пулы Coinjoin и сборы
Чтобы обеспечить эффективное увеличение анонимных наборов смешанных монет за счет нескольких циклов, необходимо установить определенный фреймворк для ограничения количества используемых UTXO. Для этой цели Whirlpool определяет различные пулы.

Пул представляет собой группу пользователей, желающих смешаться вместе, которые договариваются о количестве UTXO для оптимизации процесса coinjoin. Каждый пул указывает фиксированное количество для UTXO, к которому пользователь должен придерживаться, чтобы участвовать. Таким образом, для выполнения coinjoins с Whirlpool, вам нужно выбрать пул. В настоящее время доступны следующие пулы:
- 0.5 биткоина;
- 0.05 биткоина;
- 0.01 биткоина;
- 0.001 биткоина (= 100,000 сатоши).

Присоединяясь к пулу со своими биткоинами, они будут разделены для генерации UTXO, которые будут идеально однородны с теми, что у других участников пула. Каждый пул имеет максимальный лимит; таким образом, для сумм, превышающих этот лимит, вам будет необходимо либо сделать два отдельных входа в один и тот же пул, либо перейти в другой пул с большей суммой:

| Пул (биткоин) | Максимальная сумма за вход (биткоин) |
|----------------|------------------------------------|
| 0.5            | 35                                 |
| 0.05           | 3.5                                |
| 0.01           | 0.7                                |
| 0.001          | 0.025                              |
Как было упомянуто ранее, UTXO считается принадлежащим к пулу, когда оно готово к интеграции в coinjoin. Однако это не означает, что пользователь теряет владение им. **На протяжении различных циклов смешивания вы сохраняете полный контроль над своими ключами и, следовательно, над своими биткоинами.** Вот что отличает технику coinjoin от других централизованных методов смешивания.

Для входа в пул coinjoin необходимо оплатить как сервисные сборы, так и комиссии за майнинг. Сервисные сборы фиксированы для каждого пула и предназначены для компенсации командам, ответственным за разработку и поддержку Whirlpool. Для пользователей Sparrow Wallet эти сборы перечисляются командами Samourai разработчикам Sparrow.

Сервисные сборы за использование Whirlpool оплачиваются один раз при входе в пул. После выполнения этого шага у вас есть возможность участвовать в неограниченном количестве ремиксов без дополнительных сборов. Вот текущие фиксированные сборы для каждого пула:

| Пул (биткоин) | Вступительный сбор (биткоин) |
|---------------|-----------------------------|
| 0.5           | 0.0175                      |
| 0.05          | 0.00175                     |
| 0.01          | 0.0005 (50,000 сатоши)      |
| 0.001         | 0.00005 (5,000 сатоши)      |


Эти сборы по сути действуют как входной билет в выбранный пул, независимо от суммы, которую вы вносите в coinjoin. Таким образом, независимо от того, присоединяетесь ли вы к пулу 0.01 с ровно 0.01 BTC или входите с 0.5 BTC, сборы останутся теми же в абсолютном значении.

Перед началом участия в coinjoins пользователь, таким образом, имеет выбор между 2 стратегиями:
- Выбрать меньший пул, чтобы минимизировать сервисные сборы, зная, что в ответ они получат несколько маленьких UTXO;
- Или предпочесть больший пул, согласившись платить более высокие сборы, чтобы в итоге получить меньшее количество UTXO большего номинала.

Обычно не рекомендуется объединять несколько смешанных UTXO после циклов coinjoin, так как это может нарушить достигнутую конфиденциальность, особенно из-за эвристики общего владения входом (CIOH). Поэтому может быть разумным выбрать больший пул, даже если это означает уплату большей суммы, чтобы избежать получения слишком многих UTXO малого номинала на выходе. Пользователю необходимо взвесить эти компромиссы, чтобы выбрать предпочтительный пул.

Помимо сервисных сборов, также необходимо учитывать комиссии за майнинг, присущие любой транзакции биткоина. Как пользователь Whirlpool, вам будет необходимо оплатить комиссии за майнинг за транзакцию подготовки (`Tx0`), а также за первый coinjoin. Все последующие ремиксы будут бесплатными благодаря модели Whirlpool, которая основана на оплате новыми участниками.

Действительно, в каждом coinjoin Whirlpool два участника среди входов являются новыми участниками. Остальные входы приходят от ремиксеров. В результате комиссии за майнинг для всех участников транзакции покрываются этими двумя новыми участниками, которые затем также будут иметь право на бесплатные ремиксы:
![coinjoin](assets/en/6.webp)
Благодаря этой системе сборов Whirlpool действительно отличается от других сервисов coinjoin, поскольку анонимные наборы UTXO не пропорциональны цене, уплаченной пользователем. Таким образом, можно достичь значительно высоких уровней анонимности, заплатив только вступительные сборы пула и комиссии за майнинг за две транзакции (за `Tx0` и начальное смешивание).
Важно отметить, что пользователю также придется покрыть комиссии за майнинг, чтобы вывести свои UTXO из пула после завершения нескольких coinjoin, если только он не выбрал опцию `mix to`, о которой мы поговорим в следующем учебном пособии.

### Аккаунты HD-кошелька, используемые Whirlpool
Для выполнения coinjoin через Whirlpool кошелек должен генерировать несколько отдельных аккаунтов. Аккаунт, в контексте HD (иерархически детерминированного) кошелька, представляет собой секцию, полностью изолированную от других, этот раздел происходит на третьем уровне иерархии кошелька, то есть на уровне `xpub`.
Теоретически HD-кошелек может производить до `2^(32/2)` различных аккаунтов. Исходный аккаунт, используемый по умолчанию во всех кошельках Bitcoin, соответствует индексу `0'`.

Для кошельков, адаптированных к Whirlpool, таких как Samourai или Sparrow, используются 4 аккаунта для удовлетворения потребностей процесса coinjoin:
- Аккаунт **депозита**, идентифицируемый индексом `0'`;
- Аккаунт **bad bank** (или "doxxic change"), идентифицируемый индексом `2 147 483 644'`;
- Аккаунт **premix**, идентифицируемый индексом `2 147 483 645'`;
- Аккаунт **postmix**, идентифицируемый индексом `2 147 483 646'`.

Каждый из этих аккаунтов выполняет определенную функцию в рамках coinjoin.

Все эти аккаунты связаны с одним seed, что позволяет пользователю восстановить доступ ко всем своим биткоинам, используя свою фразу восстановления и, при необходимости, свой пароль. Однако, во время этой операции восстановления, необходимо указать различные индексы аккаунтов, которые использовались.

Теперь давайте рассмотрим различные этапы coinjoin в Whirlpool в рамках этих аккаунтов.

### Различные этапы coinjoin на Whirlpool
**Этап 1: Tx0**
Исходной точкой любого coinjoin в Whirlpool является аккаунт **депозита**. Этот аккаунт автоматически используется, когда вы создаете новый кошелек Bitcoin. На этот аккаунт должны быть зачислены биткоины, которые вы хотите смешать.

`Tx0` представляет собой первый этап процесса смешивания Whirlpool. Его цель - подготовить и уравнять UTXO для coinjoin, разделив их на единицы, соответствующие сумме выбранного пула, чтобы обеспечить однородность смешивания. Уравненные UTXO затем отправляются на аккаунт **premix**. Что касается разницы, которая не может войти в пул, она отделяется на специфический аккаунт: **bad bank** (или "doxxic change").

Эта исходная транзакция `Tx0` также служит для урегулирования сервисных сборов, причитающихся координатору смешивания. В отличие от последующих этапов, эта транзакция не является совместной; пользователь, следовательно, должен взять на себя полные комиссии за майнинг:
![coinjoin](assets/en/7.webp)
В этом примере транзакции `Tx0` вход в размере `372,000 сатоши` с нашего аккаунта **депозита** делится на несколько исходящих UTXO, которые распределяются следующим образом:
- Сумма в `5,000 сатоши`, предназначенная для координатора за сервисные сборы, соответствующая входу в пул `100,000 сатоши`;
- Три UTXO, подготовленные для смешивания, перенаправленные на наш аккаунт **premix** и зарегистрированные у координатора. Эти UTXO уравнены по `108,000 сатоши` каждый, чтобы покрыть комиссии за майнинг их будущего первоначального смешивания;
- Избыток, который не может попасть в пул, поскольку он слишком мал, считается токсичной сдачей. Он отправляется на его специфический счет. Здесь эта сдача составляет `40 000 сатоши`;
- Наконец, есть `3 000 сатоши`, которые не являются выходом, но являются необходимыми комиссиями за майнинг для подтверждения `Tx0`.

Например, вот реальный Tx0 Whirlpool (который не принадлежит мне): [edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46](https://mempool.space/en/tx/edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46)

**Шаг 2: Токсичная Сдача**
Избыток, не сумевший интегрироваться в пул, здесь эквивалентный `40 000 сатоши`, перенаправляется на счет **плохого банка**, также называемый "токсичной сдачей", чтобы обеспечить строгое разделение от других UTXO в кошельке.

Этот UTXO опасен для конфиденциальности пользователя, потому что не только всегда связан со своим прошлым, и, следовательно, возможно, с идентичностью его владельца, но к тому же отмечен как принадлежащий пользователю, который выполнил coinjoin.

Если этот UTXO будет объединен с перемешанными выходами, последние потеряют всю конфиденциальность, полученную во время циклов coinjoin, в частности, из-за CIOH (*Common-Input-Ownership-Heuristic*). Если он будет объединен с другими токсичными сдачами, пользователь рискует потерять конфиденциальность, поскольку это свяжет различные записи циклов coinjoin. Следовательно, с ним нужно обращаться осторожно. Способы управления этим токсичным UTXO будут подробно описаны в последней части этой статьи, а будущие учебные пособия более глубоко изучат эти методы в сети PlanB.

**Шаг 3: Первоначальное Смешивание**
После завершения `Tx0`, уравненные UTXO отправляются на счет **премикса** нашего кошелька, готовые к введению в их первый цикл coinjoin, также называемый "первоначальное смешивание". Если, как в нашем примере, `Tx0` генерирует несколько UTXO, предназначенных для смешивания, каждый из них будет интегрирован в отдельный первоначальный coinjoin.
По окончании этих первоначальных смешиваний счет **премикса** будет пуст, в то время как наши монеты, заплатившие комиссии за майнинг за этот первый coinjoin, будут точно скорректированы до суммы, определенной выбранным пулом. В нашем примере, наши первоначальные UTXO в `108 000 сатоши` будут уменьшены ровно до `100 000 сатоши`.
![coinjoin](assets/en/8.webp)
**Шаг 4: Перемиксы**
После первоначального смешивания UTXO переводятся на счет **постмикса**. Этот счет собирает уже перемешанные UTXO и те, которые ожидают перемикса. Когда клиент Whirlpool активен, UTXO, расположенные на счете **постмикса**, автоматически доступны для перемикса и будут случайным образом выбраны для участия в этих новых циклах.

Напомним, перемиксы затем проходят абсолютно бесплатно: не требуются никакие дополнительные сервисные сборы или комиссии за майнинг. Сохранение UTXO на счете **постмикса** таким образом сохраняет их ценность неизменной и одновременно улучшает их анонимные наборы. Вот почему важно позволить этим монетам участвовать в нескольких циклах coinjoin. Это ничего вас не стоит, и это увеличивает их уровни анонимности.
Когда вы решаете потратить смешанные UTXO, вы можете сделать это напрямую из этого **постмикс** аккаунта. Рекомендуется держать смешанные UTXO в этом аккаунте, чтобы воспользоваться бесплатными ремиксами и предотвратить их выход из цепочки Whirlpool, что могло бы снизить их конфиденциальность.
Как мы увидим в следующем учебнике, существует также опция `mix to`, которая предлагает возможность автоматически отправлять ваши смешанные монеты в другой кошелек, например, в холодный кошелек, после определенного количества coinjoin.

После обсуждения теории, давайте перейдем к практике с учебником по использованию Whirlpool через настольное программное обеспечение Sparrow Wallet!

## Учебник: Coinjoin Whirlpool в Sparrow Wallet
Существует множество вариантов использования Whirlpool. Первым, который я хочу вам представить, является вариант Sparrow Wallet, программное обеспечение для управления биткойн-кошельком с открытым исходным кодом для ПК.
Использование Sparrow имеет преимущество в том, что начать работать с ним довольно легко, настройка происходит быстро, и для работы требуется только компьютер и подключение к интернету. Однако есть заметный недостаток: coinjoin будут происходить только тогда, когда Sparrow запущен и подключен. Это означает, что если вы хотите смешивать и ремикшировать свои биткойны 24/7, вам нужно будет постоянно держать ваш компьютер включенным.

### Установка Sparrow Wallet
Для начала, вам, очевидно, понадобится программное обеспечение Sparrow Wallet. Вы можете скачать его напрямую с [официального сайта](https://sparrowwallet.com/download/) или на [их GitHub](https://github.com/sparrowwallet/sparrow/releases).

Перед установкой программного обеспечения будет важно проверить подпись и целостность скачанного исполняемого файла. Если вы хотите узнать больше о процессе установки и проверке программного обеспечения Sparrow, я советую вам прочитать этот другой учебник: *[Руководства по Sparrow Wallet](https://planb.network/tutorials/wallet/sparrow)*

### Создание программного кошелька
После установки программного обеспечения вам нужно будет приступить к созданию биткойн-кошелька. Важно отметить, что для участия в coinjoin использование программного кошелька (также называемого "горячим кошельком") является обязательным. Следовательно, **выполнение coinjoin с кошельком, защищенным аппаратным кошельком, будет невозможно**.

Хотя это и не обязательно, в случае если вы планируете смешивать значительные суммы, настоятельно рекомендуется использовать сильную фразу-пароль BIP39 для этого кошелька.

Чтобы создать новый кошелек, откройте Sparrow, затем нажмите на вкладку `File` и `New Wallet`.

![sparrow](assets/notext/9.webp)

Выберите имя для этого кошелька, например: "Coinjoin Wallet". Нажмите на кнопку `Create Wallet`.

![sparrow](assets/notext/10.webp)

Оставьте настройки по умолчанию, затем нажмите на кнопку `New or Imported Software Wallet`.

![sparrow](assets/notext/11.webp)

Когда вы попадете в окно создания кошелька, я рекомендую выбрать последовательность из 12 слов, так как это вполне достаточно. Выберите `Generate New`, чтобы сгенерировать новую фразу восстановления, и нажмите на `Use Passphrase`, если вы хотите добавить фразу-пароль BIP39. Важно сделать физическую копию вашей информации для восстановления, будь то на бумаге или на металлической подложке, чтобы обеспечить безопасность ваших биткойнов.

![sparrow](assets/notext/12.webp)
Убедитесь в правильности вашей резервной копии фразы восстановления перед тем, как нажать на `Confirm Backup...`. Sparrow затем попросит вас снова ввести вашу фразу, чтобы проверить, что вы ее записали. После завершения этого шага продолжайте, нажав на `Create Keystore`.
![sparrow](assets/notext/13.webp)
Оставьте предложенный путь производного ключа по умолчанию и нажмите `Import Keystore`. В моем примере путь производного ключа немного отличается, так как я использую Testnet для этого учебника. Путь производного ключа, который должен появиться у вас, следующий:
```plaintext
m/84'/0'/0'
```

![sparrow](assets/notext/14.webp)

После этого Sparrow отобразит детали производного ключа вашего нового кошелька. В случае, если вы установили парольную фразу, настоятельно рекомендуется записать ваш `Master fingerprint`. Хотя этот отпечаток главного ключа не является чувствительными данными, он будет полезен вам для последующей проверки того, что вы действительно получаете доступ к правильному кошельку и для подтверждения отсутствия ошибок при вводе вашей парольной фразы.

Нажмите кнопку `Apply`.

![sparrow](assets/notext/15.webp)

Sparrow предлагает вам создать пароль для вашего кошелька. Этот пароль будет необходим для доступа к нему через программное обеспечение Sparrow Wallet. Выберите надежный пароль, сделайте его резервную копию, а затем нажмите `Set Password`.

![sparrow](assets/notext/16.webp)

### Получение биткойнов
После создания вашего кошелька у вас изначально будет один счет с индексом `0'`. Это счет **депозита**, о котором мы говорили в предыдущих частях. Это счет, на который вам нужно будет отправить биткойны для смешивания.

Для этого выберите вкладку `Receive` на левой стороне окна. Sparrow автоматически сгенерирует новый пустой адрес для получения биткойнов.

![sparrow](assets/notext/17.webp)

Вы можете ввести метку для этого адреса, а затем отправить на него биткойны для смешивания.

![sparrow](assets/notext/18.webp)

### Создание Tx0
Как только ваша транзакция будет подтверждена, вы можете перейти на вкладку `UTXOs`.

![sparrow](assets/notext/19.webp)

Далее выберите UTXO(s), которые вы хотите отправить в циклы coinjoin. Чтобы выбрать несколько UTXO одновременно, удерживайте клавишу `Ctrl` при клике на выбранные UTXO.

![sparrow](assets/notext/20.webp)

Затем нажмите на кнопку `Mix Selected` в нижней части окна. Если эта кнопка не отображается в вашем интерфейсе, это потому, что вы используете кошелек, защищенный аппаратным кошельком. Вам нужно использовать программный кошелек для выполнения coinjoins с Sparrow.
![sparrow](assets/notext/21.webp)
Открывается окно, которое объясняет, как работает Whirlpool. Это упрощение того, что я объяснял в предыдущих частях. Нажмите `Next`, чтобы продолжить.

![sparrow](assets/notext/22.webp)

На следующей странице вы можете ввести "SCODE", если у вас есть таковой. SCODE - это промокод, предлагающий скидку на сервисные сборы пула. Samourai Wallet время от времени предоставляет такие коды своим пользователям во время специальных мероприятий. Я советую вам [следить за Samourai Wallet](https://twitter.com/SamouraiWallet) в социальных сетях, чтобы не пропустить будущие SCODES.
На той же странице вам также потребуется установить ставку комиссии для `Tx0` и вашего первого микса. Этот выбор повлияет на скорость подтверждения вашей подготовительной транзакции и вашего первого совместного использования монет. Помните, что вы несете ответственность за комиссии за майнинг для `Tx0` и первого микса, но не будете должны платить комиссии за майнинг за последующие повторные миксы. Отрегулируйте ползунок `Premix Priority` в соответствии с вашими предпочтениями, затем нажмите на `Next`.
![sparrow](assets/notext/23.webp)

В новом окне у вас будет возможность выбрать пул, в который вы хотите войти, используя выпадающий список. В моем случае, после первоначального выбора UTXO в `456 214 sats`, мой единственно возможный выбор - пул на `100 000 sats`. Этот интерфейс также информирует вас о сервисных сборах, которые необходимо оплатить, а также о количестве UTXO, которые будут интегрированы в пул. Если условия кажутся вам удовлетворительными, продолжайте, нажав на `Preview Premix`.

![sparrow](assets/notext/24.webp)

После этого шага Sparrow попросит вас ввести пароль для вашего кошелька, который вы установили при его создании в программе. После ввода пароля вы получите предварительный просмотр вашего `Tx0`. В левой части окна вы увидите, что Sparrow сгенерировал различные счета, необходимые для использования Whirlpool (`Deposit`, `Premix`, `Postmix` и `Badbank`). У вас также будет возможность просмотреть структуру вашего `Tx0`, с различными выходами:
- Сервисные сборы;
- Уравненные UTXO, предназначенные для входа в пул;
- Токсичная сдача (Doxxic Change).

![sparrow](assets/notext/25.webp)

Если транзакция вам нравится, нажмите на `Broadcast Transaction`, чтобы транслировать ваш `Tx0`. В противном случае у вас есть возможность скорректировать параметры этого `Tx0`, выбрав `Clear`, чтобы стереть введенные данные и начать процесс создания сначала.

### Выполнение Coinjoins
Как только Tx0 будет транслирован, вы найдете ваши UTXO, готовые к смешиванию, в счете `Premix`.
![sparrow](assets/notext/26.webp)

Как только `Tx0` будет подтвержден, ваши UTXO будут зарегистрированы у координатора, и первоначальные миксы начнутся автоматически один за другим.

![sparrow](assets/notext/27.webp)

Проверив счет `Postmix`, вы увидите UTXO, полученные в результате первоначальных миксов. Эти монеты будут готовы к последующему повторному миксованию, которое не будет влечь за собой дополнительных сборов.

![sparrow](assets/notext/28.webp)

В колонке `Mixes` можно увидеть количество coinjoins, выполненных каждой из ваших монет. Как мы увидим в следующих разделах, на самом деле важно не столько количество повторных миксов, сколько связанные с ними анонимные наборы, хотя эти два показателя частично связаны.

![sparrow](assets/notext/29.webp)

Чтобы временно остановить смешивание монет, просто нажмите на `Stop Mixing`. У вас будет возможность возобновить операции в любое время, выбрав `Start Mixing`.

![sparrow](assets/notext/30.webp)
Чтобы обеспечить непрерывную доступность ваших UTXO для повторного микширования, необходимо поддерживать активность программного обеспечения Sparrow. Закрытие программы или выключение компьютера приостановит процесс coinjoin. Решением этой проблемы может стать отключение функций сна через настройки операционной системы. Кроме того, Sparrow предлагает опцию, предотвращающую автоматический переход компьютера в режим сна, которую можно найти во вкладке `Инструменты` под названием `Prevent Computer Sleep`.
![sparrow](assets/notext/31.webp)

### Завершение процессов coinjoin
Чтобы потратить ваши перемешанные биткоины, у вас есть несколько вариантов. Самый прямой метод - это перейти в учетную запись `Postmix` и выбрать вкладку `Отправить`.

![sparrow](assets/notext/32.webp)

В этом разделе у вас будет возможность ввести адрес назначения, сумму для отправки и комиссию за транзакцию так же, как и для любой другой транзакции, совершаемой с помощью Sparrow Wallet. Если хотите, вы также можете воспользоваться дополнительными функциями конфиденциальности, такими как Stonewall, нажав на кнопку `Конфиденциальность`.

![sparrow](assets/notext/33.webp)

[-> Узнать больше о транзакциях Stonewall.](https://planb.network/tutorials/privacy/stonewall)

Если вы хотите сделать более точный выбор монет для расходования, перейдите на вкладку `UTXO`. Выберите UTXO, которые вы хотите использовать, затем нажмите кнопку `Отправить выбранные`, чтобы инициировать транзакцию.

![sparrow](assets/notext/34.webp)
Наконец, опция `Mix to...`, доступная в Sparrow, позволяет автоматически удалять выбранный UTXO из циклов coinjoin без дополнительных комиссий. Эта функция позволяет определить количество повторных микширований, после которых UTXO не будет вновь интегрировано в ваш счет `Postmix`, а будет напрямую переведено в другой кошелек. Эта опция часто используется для автоматической отправки перемешанных биткоинов в холодный кошелек.
Чтобы использовать эту опцию, сначала откройте кошелек получателя наряду с вашим кошельком coinjoin в программном обеспечении Sparrow.

![sparrow](assets/notext/35.webp)

Затем перейдите на вкладку `UTXO` и выберите монеты, которые вас интересуют, затем нажмите на кнопку `Mix to...` в нижней части окна.

![sparrow](assets/notext/36.webp)

Откроется окно, начните с выбора кошелька назначения из выпадающего списка.

![sparrow](assets/notext/37.webp)

Выберите порог coinjoin, после которого вывод будет осуществляться автоматически. Я не могу дать вам точное количество повторных микширований, так как это зависит от вашей личной ситуации и целей конфиденциальности, но избегайте выбора слишком низкого порога. Я рекомендую проконсультироваться с этой другой статьей, чтобы узнать больше о процессе ремикширования: [REMIX - WHIRLPOOL](https://planb.network/tutorials/privacy/remix-whirlpool)

Вы можете оставить опцию `Диапазон индексов` на ее значении по умолчанию, `Полный`. Эта функция позволяет одновременно микшировать с разных клиентов, но это не то, что мы хотим делать в этом учебнике. Чтобы завершить и активировать опцию `Mix to...`, нажмите `Перезапустить Whirlpool`.

![sparrow](assets/notext/38.webp)

Однако будьте осторожны при использовании опции `Mix to`, так как удаление перемешанных монет из вашего счета `Postmix` может значительно увеличить риск компрометации вашей конфиденциальности. Причины этого потенциала подробно описаны в следующих разделах.

## Как узнать качество наших циклов coinjoin?
Для того чтобы coinjoin был действительно эффективным, крайне важно, чтобы он обеспечивал хорошую однородность между суммами входов и выходов. Эта униформность увеличивает количество возможных трактовок для внешнего наблюдателя, тем самым повышая неопределенность вокруг транзакции. Чтобы количественно оценить эту неопределенность, создаваемую coinjoin, можно прибегнуть к расчету энтропии транзакции. Для глубокого изучения этих показателей, я рекомендую вам обратиться к учебному пособию: [BOLTZMANN CALCULATOR](https://planb.network/en/tutorials/privacy/boltzmann-entropy). Модель Whirlpool признана той, которая обеспечивает наибольшую однородность в coinjoins. Далее, производительность нескольких циклов coinjoin оценивается на основе размера групп, в которых скрывается монета. Размер этих групп определяет то, что называется anonsets. Существует два типа anonsets: первый оценивает прирост конфиденциальности против ретроспективного анализа (от настоящего к прошлому) и второй, против перспективного анализа (от прошлого к настоящему). Для подробного объяснения этих двух показателей, я приглашаю вас ознакомиться с учебным пособием: [WHIRLPOOL STATS TOOLS - ANONSETS](https://planb.network/tutorials/privacy/wst-anonsets)

## Как управлять postmix?
После выполнения циклов coinjoin лучшая стратегия - это сохранять ваши UTXO на счету **postmix**, ожидая их будущего использования. Даже рекомендуется дать им перемешиваться бесконечно, пока вам не потребуется их потратить.

Некоторые пользователи могут рассмотреть возможность перевода своих перемешанных биткоинов на кошелек, защищенный аппаратным кошельком. Это возможно, но важно строго следовать рекомендациям Samourai Wallet, чтобы не нарушить достигнутую конфиденциальность.

Слияние UTXO является наиболее часто встречающейся ошибкой. Необходимо избегать объединения перемешанных UTXO с неперемешанными UTXO в одной транзакции, чтобы избежать CIOH (*Common-Input-Ownership-Heuristic*). Это требует тщательного управления вашими UTXO внутри вашего кошелька, особенно с точки зрения маркировки. Помимо coinjoin, слияние UTXO в целом является плохой практикой, которая часто приводит к потере конфиденциальности, если ее не управлять должным образом.

Также важно быть осторожным при консолидации перемешанных UTXO друг с другом. Умеренные консолидации допустимы, если ваши перемешанные UTXO имеют значительные anonsets, но это неизбежно уменьшит конфиденциальность ваших монет. Убедитесь, что консолидации не слишком велики и не проводятся после недостаточного количества перемешиваний, так как это рискует установить выведенные связи между вашими UTXO до и после циклов coinjoin. В случае сомнений относительно этих манипуляций, лучшая практика - не консолидировать postmix UTXO и переводить их по одному в ваш аппаратный кошелек, генерируя новый пустой адрес каждый раз. Опять же, не забывайте правильно маркировать каждый полученный UTXO.
Также не рекомендуется переводить ваши postmix UTXO на кошелек, использующий необычные скрипты. Например, если вы входите в Whirlpool с мультисиг-кошелька, использующего скрипты `P2WSH`, маловероятно, что вы будете перемешаны с другими пользователями, у которых изначально такой же тип кошелька. Если вы выведете свои postmix на этот же мультисиг-кошелек, уровень конфиденциальности ваших перемешанных биткоинов значительно уменьшится. Помимо скриптов, существует множество других отпечатков кошельков, которые могут вас запутать.
Как и в случае любой биткоин-транзакции, также важно не повторно использовать адреса получения. Каждая новая транзакция должна быть получена на новом, пустом адресе.
Самым простым и безопасным решением будет оставить ваши смешанные UTXO на их **постмикс** счете, позволяя им пересмешиваться и трогать их только для траты. Кошельки Samourai и Sparrow имеют дополнительные защиты от всех этих рисков, связанных с анализом блокчейна. Эти защиты помогают избежать ошибок.
## Как управлять доксическим изменением?
Далее, вам нужно быть осторожными в управлении доксическим изменением, изменением, которое не может войти в пул coinjoin. Эти токсичные UTXO, возникающие в результате использования Whirlpool, представляют риск для вашей конфиденциальности, поскольку они устанавливают связь между вами и использованием coinjoin. Поэтому крайне важно обращаться с ними осторожно и не объединять их с другими UTXO, особенно смешанными UTXO. Вот различные стратегии, которые стоит рассмотреть для их использования:
- **Смешайте их в меньших пулах:** Если ваш токсичный UTXO достаточно значителен, чтобы войти в меньший пул самостоятельно, рассмотрите возможность его смешивания. Это часто является лучшим вариантом. Однако крайне важно не объединять несколько токсичных UTXO для доступа в пул, так как это может связать ваши разные записи;
- **Пометьте их как "нерасходуемые":** Другой подход заключается в том, чтобы больше не использовать их, пометить их как "нерасходуемые" на их специализированном счете и просто Hodl. Это гарантирует, что вы случайно не потратите их. Если стоимость биткойна увеличится, могут появиться новые пулы, более подходящие для ваших токсичных UTXO;
- **Сделайте пожертвования:** Рассмотрите возможность сделать пожертвования, даже скромные, разработчикам, работающим над Bitcoin и его сопутствующим программным обеспечением. Вы также можете пожертвовать организациям, принимающим BTC. Если управление вашими токсичными UTXO кажется слишком сложным, вы можете просто избавиться от них, сделав пожертвование;
- **Купите подарочные карты:** Платформы, такие как [Bitrefill](https://www.bitrefill.com/), позволяют обменивать биткойны на подарочные карты, которые можно использовать у различных продавцов. Это может быть способом избавиться от ваших токсичных UTXO без потери связанной с ними стоимости.
- **Консолидируйте их на Monero:** Кошелек Samourai теперь предлагает сервис атомарного свопа между BTC и XMR. Это идеально подходит для управления токсичными UTXO, консолидируя их на Monero, без ущерба для вашей конфиденциальности через CIOH, перед отправкой их обратно в Bitcoin. Однако этот вариант может быть дорогостоящим с точки зрения комиссий за майнинг и премии из-за ограничений ликвидности.
- **Отправьте их в сеть Lightning:** Перевод этих UTXO в сеть Lightning для получения преимущества сниженных комиссий за транзакции является вариантом, который может быть интересным. Однако этот метод может раскрыть определенную информацию в зависимости от вашего использования Lightning и поэтому должен практиковаться с осторожностью.

Подробные учебные пособия по реализации этих различных техник будут предложены в ближайшее время на PlanB Network.

**Дополнительные ресурсы:**
[Видеоурок Sparrow Wallet](https://planb.network/tutorials/wallet/sparrow)
[Видеоурок Samourai Wallet](https://planb.network/tutorials/wallet/samourai)
- [Документация Samourai Wallet - Whirlpool](https://docs.samourai.io/whirlpool/basic-concepts);
- [Твиттер-тред о CoinJoins](https://twitter.com/SamouraiWallet/status/1489220847336308739);
- [Блог-пост о CoinJoins](https://www.pandul.fr/post/comprendre-et-utiliser-le-coinjoin-sur-bitcoin).