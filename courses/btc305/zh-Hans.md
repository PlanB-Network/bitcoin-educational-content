---
name: 比特币与BTC支付服务器（BTCPay Server）
goal: 为您的企业安装BTC支付服务器
objectives:
  - 理解BTCPay Server。
  - 自己运行并配置BTC支付服务器。
  - 在您的日常业务中使用BTCPay Server。
---

# 比特币与BTCPay服务器

这是由Alekos和Bas编写的关于BTCPay服务器操作器的入门课程，由melontwist和asi0按照PlanB课程格式进行改编。

一个未结束的故事

“这是谎言，我对你的信任已破碎，我将让你变得陈旧”。

由BTCPay服务器基金会制作

+++

# 引言

<partId>59e43fe3-b494-5da6-b4b4-9df5bdf08916</partId>

## 对作者的比特币和BTCPay服务器的好评

<chapterId>e1fe6294-3c82-5203-9537-779f9087c35a</chapterId>

BTCPay服务器是什么？它来源于什么？我们从这两个问题开始。我们非常重视透明度和一些标准，以在比特币领域中构建信任。
一个项目违背了这些价值。BTCPay服务器的主要开发者Nicolas Dorier将此事视为个人攻击，并承诺淘汰他们。多年后，我们今天正在朝着这个未来努力，每天都在全力将其变得开源。

> 这是谎言，我对你的信任已破碎，我将让你变得陈旧
> Nicolas Dorier

在Nicolas发表这番话之后，建设就开始了。我们现在已经为BTCPay服务器的项目投入了大量的努力，而且越来越多的人想要帮助推动这一进程。最为人所熟知的为r0ckstardev、MrKukks、Pavlenex，以及第一个使用该软件的商家astupidmoose。

开源是什么意思？为这个项目需要投入什么？

FOSS是自由和开源软件的简称（Free & Open-Source Software）。前者指的是允许任何人复制、修改甚至分发软件版本（甚至可为盈利使用）的条款。后者指的是公开分享源代码，鼓励公众改进它并为它贡献。
这让充满激情且经验丰富的用户为他们已使用并从很有价值的软件做出贡献。随着时间的推移，这个开源软件在采用方面上往往优于专有软件。这与比特币的理念“信息渴望自由”是一致的。它汇集了充满激情的人们，形成了一个社区，而且将其变得更加有趣。就像比特币，FOSS是不可避免的。

### 开始前说明

本课程由多个部分组成。课堂老师负责其中许多部分的教学。此外，您将获得访问权限的演示环境，一个为您自己托管的服务器，而且可能还有一个域名。如果您独立完成此课程，请注意您将无法使用标记为DEMO的环境。
注意：如果您通过课堂学习本课程，服务器名称可能会因您的课堂设置而有所不同。由于这个原因，服务器名称中的变量可能会有所不同。

### 课程结构

每个章节都有各自的目标和知识评估。在本课程中，我们将探索每个目标，并在每个课程块（即章节）的结尾总结其关键特点。我们为您提供了一些插图，为了巩固对相关内容的理解。每个课程块中都有已被设定的目标。这些目标不仅仅是一个清单。它们为您提供了进入新技能集的指南。知识评估的难度将逐渐增加，以帮助您更好地设置您的BTCPay服务器。

### 学生在课程中会获得什么？
通过BTCPay Server课程，学生可以理解比特币的技术性和非技术性的基本原理。通过BTCPay Server的全面培训项目，学生将能够操作自己的比特币基础设施。

### 重要的网址或联系机会

BTCPay Server基金会位于日本东京，他们已允许Alekos和Bas编写此课程的内容。您可以通过下列网站联系BTCPay Server基金会：

- https://foundation.btcpayserver.org
- 加入官方聊天频道：https://chat.btcpayserver.org

## 比特币简介

<chapterId>5c0bc234-c188-5b4a-94d5-adee87a120e2</chapterId>

### 通过课堂练习理解比特币

这是一个课堂练习，所以如果您独立参加这个课程，您不能进行练习，但您仍然可以阅读练习内容。完成这项任务的最少人数为9至11位人之间。

练习将在您观看BBC的介绍“比特币和区块链是如何运作的”之后开始。

![比特币和区块链是如何运作的](https://youtu.be/mhE_vvwAiRc)

这个练习的参加者人数要求为至少9位。这个练习旨在通过实际体验理解比特币的运作原理。通过在网络中充当多种角色，您将可以以互动和有趣的方式学习。此练习不涉及闪电网络。

### 示例；需要9至11位人

角色如下：

- 1位顾客
- 1位商家
- 7到9位比特币节点

**设置如下：**

顾客使用比特币从商店购买产品。

**第一情况 - 传统银行体系**

- 设置方式：
  - 请参见附加的 Figjam - 活动示意图中的图表/说明 - [活动示意图](https://www.figma.com/file/ckmvMq02Jm2MegSsVCDFhc/Day-1-Classroom-Activity?type=whiteboard&node-id=0-1&t=KR31ofMaJX6S95UL-0)。
  - 三名学生将分别充当顾客（Alice）、商家（Bob）和银行角色。
- 按顺序演示以下列出的场景：
  - 顾客- 在线浏览商店并找到一件他/她想要的、价值为25美元的商品，并告知商家他们想要购买
  - 商家- 请求付款。
  - 顾客- 将卡信息发送给商家
  - 商家- 将信息转发给银行（为了识别出他们自己和身份/信息），请求支付
  - 银行将收集顾客和商家（Alice和Bob）的相关信息，并检查顾客的余额是否充足。
  - 银行将从Alice的账户扣除25美元，向Bob的账户添加24美元，并收取1美元的服务费
  - 商家从银行已获得验证，然后将商品寄给顾客。
- 评论：
  - Bob和Alice必须与银行有关系。
  - 银行收集Bob和Alice的相关信息。
  - 银行收取费用。
  - 用户必须信任银行来保管每个参与者的资金。

**第二情况 - 比特币系统**

- 设置：
  -  请参见附加的 Figjam - 活动示意图中的图表/说明 - [活动示意图](https://www.figma.com/file/ckmvMq02Jm2MegSsVCDFhc/Day-1-Classroom-Activity?type=whiteboard&node-id=0-1&t=KR31ofMaJX6S95UL-0)。
- 让九名学生代替银行角色，他们将扮演网络中的计算机（比特币节点/矿工）的角色，以取代银行。
- 每一台计算机都拥有所有过去交易的完整历史记录（因此，账户余额是准确而无伪造的），以及一套规则：
  - 验证交易的签名是否符合要求（钥匙要和锁匹配）
  - 向网络中的参与者传播交易信息，在此接收有效并丢弃无效的交易（包括任何尝试双重支付的交易）
- 定期将从“随机”计算机收到的新交易用来更新/添加记录，同时验证所有内容的有效性（注意：现在，为了方便，我们将忽略所有工作量证明元素），否则拒绝这些交易并继续运作，直到下一个“随机”计算机发送更新
  - 如果内容有效，计算机将获得金额的奖励。
- 按顺序演示以下列出的场景：
  - 顾客- 在线浏览商店并找到一件他/她想要的、价值为25美元的商品，并告知商家他们想要购买
  - 商家- 请求顾客发送钱包的一个发票或地址来进行付款。
  - 顾客- 进行一笔交易（将价值为25美元的BTC发送至商家提供的地址）并将其传播到比特币网络中。
- 计算机- 接收交易并验证：
  - 发送地址中至少有25美元的BTC
  - 交易已被适当签名（由顾客“解锁”）
  - 如果不符合这些条件，交易不会在网络中传播，而如果已满足要求，它则会广播并处于待处理状态。
  - 商家可以查看交易状态是否正在等待中。
- 一台计算机被“随机”选出来提出最终确认交易，其通过广播一个“区块”来完成；如果检查无误，他们将获得BTC作为奖励。
  - 可选/高级 - 您可以通过让每一台计算机掷骰子直到其中一台预定掷到特定的结果来模拟挖矿的过程（例如，第一台掷出双六的计算机将被选出）
  - 两台计算机可能几乎同时掷出满足条件的结果，这会导致“链分裂”（Chain Split）的情况。
  - 计算机将验证交易的有效性，而且如果满足规则的条件，他们会进行账本更新或将交易记录添加到他们的账本中，并将区块广播给其他节点。
  - 被随机选出的计算机因提出有效区块而将获得奖励。
  - 商家检查这笔交易是否已完成；如果已完成，那么商家已收到资金，然后商家将商品发送给顾客。
- 评论：
  - 注意，不需要预先存在的银行关系。
  - 无需第三方协助；由代码/激励措施替代。
  - 除了直接交换所需的必要信息外，没有人收集数据（例如，收货地址）。
  - 人们之间不需要信任（除了商家发送商品），在很多方面就像现金购买。
  - 钱直接由个人拥有。
  - 为了简化，比特币账本以美元显示，但实际上的单位为BTC。
  - 我们模拟了一次交易的广播，但实际上，网络中有多个交易正在等待，区块一次包含成千上万的交易。节点还检查网络中是否有双重支付交易待处理（如果是这种情况，我会丢弃除一个之外的所有交易）。
- 作弊情景：
  - 如果顾客没有价值为25美元的BTC怎么办？
    - 他们将无法创建交易，因为“解锁”和“所有权”是同一回事，计算机检查交易是否已被适当签名；否则，他们会拒绝它。
- 如果被随机选中的计算机试图“更改账本”会怎样？ - 该区块会被拒绝，因为其他每一台计算机都有完整的交易历史记录，并会意识到更改，这违反了它们的规则之一。
    - 这台被随机选出的计算机将不会获得奖励，而其区块中的任何交易都不会被确认。

## 知识评估

<chapterId>1461f064-933d-50ea-8935-324b68ec5d5f</chapterId>

### 知识评估：课堂讨论

讨论在第二情况下课堂练习中所做的一些过度简化方面，并更详细地描述比特币体系其实是如何运作的。

### 知识评估：词汇复习

定义上一部分所示的关键术语：

- 节点
- 内存池
- 难度目标
- 区块

**共同讨论一些额外的术语含义：**

区块链、交易、双重支付、拜占庭将军问题、挖矿、工作量证明（PoW）、哈希函数、区块奖励、区块链、最长链、51%攻击、输出、输出锁定、找零、聪、公钥/私钥、地址、公钥密码学、数字签名、钱包

# BTCPay服务器介绍

<partId>9c8a2d0c-9ba1-5c39-874c-f9eaf1bba663</partId>

## 理解BTCPay服务器的登录界面

<chapterId>14aad54c-9bd8-54f2-9455-178b8ae63408</chapterId>

### 使用BTCPay服务器

本课程块的目标是对BTCPay服务器软件建立一个总体的理解。在共享的学习环境中，我们建议您关注讲师的演示，并阅读BTCPay服务器课程手册（BTCPay Server Coursebook），与老师一起学习。您将学习通过多种方法创建钱包。示例包括热钱包设置和通过BTCPay服务器保险库连接的硬件钱包。演示环境中的目标将由课程讲师管理和展示。

如果您独立参加此课程，您可以在https://directory.btcpayserver.org/filter/hosts找到第三方主机的列表，用于演示目的。我们强烈建议不要将这些第三方选项用作运营平台，其仅可适用于介绍使用比特币和BTCPay服务器的目标。

作为BTCPay服务器的高级培训生，您可能之前有设置比特币节点的经验。本课程将专门讨论BTCPay服务器软件的技术栈。

BTCPay服务器中的许多选项在其他与比特币钱包相关的软件中以某种形式存在。

### BTCPay服务器登录页面

当演示平台欢迎您进入时，您会被要求‘登录’或‘创建您的账户’。出于安全原因，服务器管理员可能会关闭创建新账户的功能。BTCPay服务器的标志和按钮颜色可以更改，因为BTCPay服务器是开源的软件。第三方主机可以对这个软件添加白标签并更改其整个页面的外观。

![image](assets/en/0.webp)

### 创建账户窗口

在BTCPay服务器上创建账户需要有效的电子邮件地址字符串；例如，example@email.com是电子邮件的有效字符串。

密码需要至少8个字符，包括字母、数字和字符。设置密码后，您将必须验证输入的密码，以确保它与第一个密码字段中输入的密码正确无误。
如果您已填写电子邮件和密码的部分，您可以点击“创建账户”按钮。这将把电子邮件和密码保存到讲师的BTCPay Server运行环境中。
![image](assets/en/1.webp)

**！注意！**

如果您独立参加本课程，您可能需要创建在第三方主机上的账户；因此，我们再次提醒，千万不要将这些用作运营环境，而只用于培训目标。

### 由BTCPay服务器管理员创建账户

BTCPay服务器实例的管理员也可以为BTCPay服务器创建账户。BTCPay服务器实例的管理员可以点击“服务器设置”（1），点击“用户”标签（2），然后在用户标签的右上角点击“+添加用户”按钮（3）。在目标（4.3）中，您将了解更多关于账户管理员控制的信息。

![image](assets/en/2.webp)

作为管理员，您需要用户的电子邮件地址并设置密码。我们建议管理员通知用户在使用账户前应更改此密码以确保安全。如果管理员未设置密码，并且服务器上设置了简单邮件传输协议（SMTP），用户将收到一封电子邮件，其中包含一个创建账户并自行设置密码的邀请链接。

### 例子

按照讲师的课程进行时，请访问讲师提供的链接，在提供的演示环境中创建您的账户。请确保您的电子邮件地址和密码已被安全保存；在整个课程演示中，您将需要这些登录信息。

您的讲师可能已提前收集电子邮件的地址，并在此练习之前发送了邀请链接。如果有指示，请检查您的电子邮箱。

如果您在无讲师的情况下参加课程，请使用BTCPay服务器演示环境创建您的账户并访问

https://mainnet.demo.btcpayserver.org/login。

这个账户只应该用于演示/培训目的，绝不用于业务。

### 技能总结

在本节中，你学到了以下内容：

- 如何通过界面在托管服务器上创建账户。
- 服务器管理员如何在服务器设置中手动添加用户。

### 知识评估

#### 知识评估：概念回顾

为何将演示服务器用于运营目标是一种不好的主意？请您提出这个问题的理由

## 管理用户的账户

<chapterId>b58ca6ee-b7fc-5e81-a6aa-c8ff212b4c55</chapterId>

### 在BTCPay服务器上的账户管理

商店主创建账户后，他们可以在BTCPay服务器用户界面（UI）中的左下角管理它。在账户按钮下面，有一些高级设置方面。

- 夜间/白天模式。
- 隐藏敏感信息开关。
- 管理账户。

![image](assets/en/3.webp)

### 夜间/白天模式

BTCPay服务器的用户可以选择使用夜间模式或白天模式的UI版。面向用户的页面不会改变。夜间/白天模式的设置仅取决于用户的偏好。

### 隐藏敏感信息开关

隐藏敏感信息按钮功能可快速简单地加强安全。每当您需要操作您的BTCPay服务器，但可能有人在公共场所尝试向您的BTCPay服务器UI窥视，您可以开启隐藏敏感信息的功能，让BTCPay服务器隐瞒所有的数值信息。现在，虽然他们还能够偷看，但不再能看到您正在处理的数值。

### 管理账户

一旦用户的账户被创建，您可以开始管理密码、双因素认证或API密钥。
### 管理账户 - 账户
您可以选择使用不同的电子邮件地址更新您的账户。为了确保您的电子邮件地址的正确性，BTCPay Server将发送验证电子邮件。如果用户设置了新的电子邮件地址并确认验证有效，请点击保存。用户名将保持与之前的电子邮件相同。

用户可能决定删除他们的整个账户。这可以通过点击账户标签上的删除按钮来完成。

![image](assets/en/4.webp)

**！注意！**

更改电子邮件信息后，账户的用户名不会改变。之前提供的电子邮件地址仍然是您登录名。

### 管理账户 - 密码

学生可能想要更改密码。他/她可以通过前往密码标签来做到这一点。在这里，他需要输入他的旧密码，并可以将其更改为新密码。

![image](assets/en/5.webp)

### 双因素认证 (2fa)

为了减轻密码被盗的恶果，您可以使用双因素认证（2fa），这是一种相对新的安全方法。您可以通过管理账户和双因素认证标签启动双因素认证功能。在加入用户名和密码登录后，您必须完成第二步骤。

BTCPay Server可让您通过两种方式启用2FA，其可以通过一些2FA应用（Authy、Google、Microsoft认证器）或通过安全设备（FIDO2或LN网址 Auth）完成。

### 双因素认证 - 应用

根据您的手机操作系统（Android或iOS），用户可以选择以下应用之一；

1. 下载双因素认证器；
   - Authy的[Android版](https://play.google.com/store/apps/details?id=com.authy.authy)或[iOS版](https://apps.apple.com/us/app/authy/id494168017)
   - Microsoft Authenticator的[Android版](https://play.google.com/store/apps/details?id=com.azure.authenticator)或[iOS版](https://apps.apple.com/us/app/microsoft-authenticator/id983156458)
   - Google Authenticator的[Android版](https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=e%C2%80)或[iOS版](https://apps.apple.com/us/app/google-authenticator/id388497605)
2. 下载并安装认证器应用后。
   - 扫描BTCPay Server提供的二维码
   - 或将BTCPay Server生成的密钥输入到您的认证器应用。
3. 认证器应用将为您提供一个独特的代码。请在BTCPay Server上输入这个代码以验证设置，然后点击验证以完成。

![image](assets/en/6.webp)

### 技能总结

在本节中，您学到了以下内容：

- 账户管理选项以及在BTCPay Server实例上管理账户的各种方式。
- 如何设置基于应用的2FA。

### 知识评估

#### 知识评估：概念回顾

描述基于应用的2FA如何帮助保护您的账户

## 创建新商店

<chapterId>463b3634-b49f-5512-a711-3b2e096fc2e0</chapterId>

### 创建您的商店向导
当新用户登录到BTCPay Server时，环境是空的，需要创建第一家商店。BTCPay Server的引导向导将给用户一个“创建您的商店”（1）的选项。商店可作为比特币需求的“家园”。一个新的BTCPay Server节点将从与比特币区块链进行同步（2）开始。根据您运行BTCPay Server的基础设施，这一过程可能需要几小时到几天的时间。BTCPay Server UI的右下角显示着实例的当前版本。它可以在进行故障排除时用作有助的参考。
![image](assets/en/7.webp)

### 创建您的商店向导

继续本课程时，您将看到与上一页略有不同的界面。因为您的讲师已经准备了演示环境，比特币区块链已被提前同步，因此您将看不到节点的同步状态。

用户可能可以删除他们的整个账户。这可以通过点击账户标签上的删除按钮来完成。

![image](assets/en/8.webp)

**！注意！**

BTCPay Server账户可以创建无限数量的商店。每个商店都是一个钱包或“家”。

### 示例

首先点击“创建您的商店”。

![image](assets/en/9.webp)

这将为您使用BTCPay服务器创建您的第一个家和仪表板。

(1) 点击“创建您的商店”后，BTCPay Server将要求您命名商店，您可以使用适合您的要求的名称。

![image](assets/en/10.webp)

(2) 接下来，您必须设置一个默认商店货币，可以设置法定货币或以比特币/聪为单位。对于演示环境，我们将其设置为美元（USD）。

![image](assets/en/11.webp)

(3) 对于商店设置的最后一个参数，BTCPay Server要求您设置一个“首选价格来源”，以便将比特币的价格与当前法定价格进行比较，从而使您的商店显示比特币与商店设置的法定货币之间的正确汇率。我们将在演示示例中坚持使用默认设置，并将其设置为Kraken交易所。BTCPay Server使用Kraken API来检查汇率。

![image](assets/en/12.webp)

(4) 现在这些商店参数已经设置好，点击创建按钮以让BTCPay Server创建您的第一个商店的仪表板，向导将在此继续。

![image](assets/en/13.webp)

恭喜您，您已经创建了您的第一个商店，这是该练习部分的终点。

![image](assets/en/14.webp)

### 技能总结

在本节中，您学到了：

- 商店创建和配置默认货币，结合价格来源偏好。
- 每家“商店”都是BTCPay Server中的新单独的“家园”。

# 比特币密钥保护的介绍

<partId>25da22d8-fd37-51c5-af2a-58b9f3b046b2</partId>

## 理解比特币密钥的生成

<chapterId>d162735b-847b-578e-83b8-a044ab703ec5</chapterId>

### 生成比特币密钥将涉及到什么？

创建比特币钱包时，您会获得所谓的“种子”。在最后一个目标中，您创建了一个“种子”，之前生成的一系列词也被称为助记词。种子可用来生成单个比特币密钥，并用于发送或接收比特币。您绝不应与第三方或不可信任的人们共享种子短语。
种子生成遵循业界标准，称为“分层确定性”（HD）框架。
![image](assets/en/15.webp)

### 地址

BTCPay Server是为生成新地址而构建的。这减缓公钥或地址重用的问题。使用相同的公钥使得您的整个支付历史变得非常易于追踪。您可以将密钥看作为一次性使用的票券，这个思维方式将改善您的隐私。我们也使用比特币地址（别将其与公钥混淆）。

地址是通过“哈希算法”从公钥生成而来的。然而，大多数钱包和交易将显示地址而不展示那些公钥。一般来说，地址比公钥短，通常以`1`、`3`或`bc1`为开头，而公钥以`02`、`03`或`04`为开头。

- 以`1.....`为开头的地址仍然非常常见。如创建新商店章节所述，这是一种传统的地址。该地址类型用于付款至公钥哈希(P2PKH)交易。P2PKH使用Base58编码，这使得地址区分大小写。其结构基于公钥，并附加一个作为标识符的数字。

- 以`bc1...`为开头的地址正逐渐变得非常常见。这些被称为（原生的）隔离见证（Segwit）地址。这些地址提供比其他提到的地址更好的费用结构。原生SegWit地址使用Bech32编码，并且只允许使用小写字母。

- 以`3...`为开头的地址通常仍然用作交易所的存款地址。这些地址已在创建新商店章节中被提到，包装或嵌套的SegWit地址。然而，它们也可以作为“多签名地址”。当用作SegWit地址时，您就会节省交易费用，但节省的金额比原生SegWit要少。脚本哈希支付(P2SH)地址使用Base58编码。这使得它像传统地址一样区分大小写。

- 以`2...`为开头的地址是测试网（Testnet）地址。它们用于接收测试网比特币（tBTC）。您绝对不应该混淆这一点，也别将比特币发送到这些地址。出于开发目的，您可以生成一个测试网钱包。在线上有多个可以获取测试网比特币的水龙头。千万不要购买测试网比特币。测试网比特币是通过挖矿获得的。这可能是开发者使用回归测试（Regtest）的一个原因。这是一个为开发者准备的"游乐场环境"，其还缺少一些网络元素。然而，比特币对于开发目的来说非常有用。

### 公钥

在实践方面中，公钥的使用越来越少。随着时间的推移，比特币用户已经开始用地址来代替它。公钥确实仍然存在并偶尔被使用。一般来说，公钥比地址的字符串要长得多。就像地址一样，它们以特定的标识符为开头。

- 首先，`02...`和`03...`是非常标准的公钥标识符，以SEC格式编码。这些可以被处理并转换为接收地址，用于创建多签名地址，或用于验证签名。早期的比特币交易使用公钥作为向公钥支付(P2PK)交易的一部分。

- HD钱包则使用不同的结构。`xpub...`、`ypub...`或`zpub...`被称为扩展的公钥，而xpubs不是常用的名称。这些密钥的用途为许多公钥的生成，因为它是HD钱包的一部分。由于您的xpub包含您的整个历史记录，其包括过去和未来的交易，您千万不要与不可信任方分享。

### 技能总结

在本节中，您已学到以下内容：
- 地址与公钥数据类型之间的差异以及使用地址而不用公钥的好处。
### 知识评估

相比于地址重用和公钥方法，请描述每笔交易使用新地址的好处。

## 使用硬件钱包保护密钥

<chapterId>c54a6d61-5a43-5fdb-93ae-c6750de9c612</chapterId>

### 存储比特币密钥

在生成种子短语后，被生成的12 - 24个单词列表需要适当的备份和安全措施，因为这些单词是恢复钱包的唯一方式。HD钱包的结构以及它如何使用那一个种子确定性地生成地址，而这些您创建的所有地址都将使用这一串代表您的种子或恢复短语的助记词列表进行备份。

您应该保护好这个恢复短语。如果被人找到，特别是拥有恶意的人，他们可以转移您的资金。您必须保持种子的安全和记住它是相互的。存储比特币私钥有几种方法，每种方法都有各自的优缺点，无论是在安全性、隐私性、便利性还是物理手段上。由于私钥的重要性，比特币用户倾向于“自我保管”存储和安全保管这些密钥，而不是使用银行等“托管”服务。根据用户的情况，他们必须选择使用冷钱包或热钱包来保护比特币。

### 比特币密钥的热钱包和冷钱包存储

一般而言，比特币钱包被保存在热钱包或冷钱包内，这取决于便利性、易用性和安全风险。托管服务机构也提供这些办法的选项。然而，这个部分主要基于安全和隐私问题，并超越本课程的范围。

### 热钱包

热钱包是通过移动设备、网络或桌面软件来利用比特币的最便捷方式。钱包始终连接到互联网，让用户能够发送或接收比特币。然而，这也是它的弱点，因为它总是连接到互联网，热钱包更容易受到黑客或恶意软件的攻击。在BTCPay Server中，热钱包将私钥存储在实例上。如果有恶意的人访问您的BTCPay Server商店，他们可以从这个地址窃取资金。当BTCPay Server在托管环境中运行时，您应始终在您的安全配置方面考虑这一点，并且最好不要在这种情况下使用热钱包。当BTCPay服务器已被安装在您拥有的硬件上时，并由您保护和信任，风险就会降低，但它从未消失！

### 冷钱包

人们之所以将他们的比特币转移到冷钱包是因为它未连接到互联网，从而私钥不会暴露到网络的风险。关闭与互联网的连接将降低恶意软件、间谍软件和SIM卡交换的风险。只要采取适当的预防措施以避免丢失比特币私钥，冷钱包存储被认为在安全性和自主性方面优于热钱包的存储。冷存储最适合大量的比特币存储，而且由于冷钱包设置的复杂性，该钱包内的比特币不便于经常使用。

您可以通过各种方法将比特币存储在冷钱包内，如使用纸质钱包、脑钱包、硬件钱包，或者从一开始就使用一个钱包文件。大多数钱包使用BIP 39来生成种子短语。然而，在比特币核心软件中（Bitcoin Core），对于BIP39的使用，尚未达成共识。比特币核心软件会生成一个Wallet.dat文件，而且您需要将其存储在安全的未连接到互联网的位置。

### 技能总结

在本节中，您已经学到了：

- 热钱包和冷钱包在功能性和它们在一些方面的差异。

### 知识评估：概念回顾
- 什么是钱包？
- 热钱包和冷钱包有什么区别？

- 描述一下“生成钱包”是什么意思？

## 使用您的比特币密钥

<chapterId>bff488de-5052-56e6-b696-97e896f762ae</chapterId>

### BTCPay服务器钱包

BTCPay服务器包含以下标准钱包功能：

- 交易
- 发送
- 接收
- 重新扫描
- 拉支付
- 支付
- 部分签名的比特币交易（PSBT）
- 常规设置

### 交易

管理员可以在交易页面中查看连接到这个特定商店的链上钱包进出交易。每种交易类型的接收和发送有所不同。收到的交易以绿色为标注，而发出的交易将以红色显示。在BTCPay服务器的交易页面上，管理员还能看到一组标准标签。

| 交易类型         | 描述                                                  |
| -------------- | ---------------------------------------------------- |
| App            | 通过应用创建的发票收到的付款                            |
| invoice        | 通过发票收到的付款                                      |
| payjoin        | 未支付，发票有效时间尚未到期                              |
| payjoin-exposed| 其UTXO通过发票payjoin提案而暴露                          |
| payment-request| 通过支付请求收到的付款                                  |
| payout         | 通过支付或退款发送的付款                                |

### 如何发送

BTCPay服务器的发送功能将从您的BTCPay服务器链上钱包发送交易。BTCPay服务器提供多种交易签署方式以支出资金。交易可以通过以下方式签名：

- 硬件钱包
- 支持PSBT的钱包
- HD私钥或恢复种子短语。
- 热钱包

#### 硬件钱包

BTCPay服务器内置存在硬件钱包支持，让您能够在不向第三方应用或服务器泄露信息的情况下，同时使用您的硬件钱包和BTCPay保险库（BTCPay Vault）。BTCPay服务器内的硬件钱包整合使您能够导入硬件钱包，并通过您的设备上的简单确认来支出收到的资金。私钥将离不开您的设备，所有资金都将针对您的完整节点进行验证，因此不会有数据泄露。

#### 使用支持PSBT的钱包签名

PSBT（部分签名比特币交易）是一种交换格式，用于还需要全面签名的比特币交易。PSBT由BTCPay服务器支持，并且可以用兼容的硬件和软件钱包签名。

构建一个完全签名的比特币交易通过以下步骤进行：

- 构建一个具有特定输入和输出但没未签名的PSBT
- 导出的PSBT可以被支持此格式的钱包导入
- 可以使用钱包检查并签名交易数据
- 从钱包导出已签名的PSBT文件，并由BTCPay服务器导入
- BTCPay服务器生成最终的比特币交易
- 您将进行验证并将其广播到网络中

#### 使用HD私钥或助记词种子签名

如果您之前已使用BTCPay服务器来创建一个钱包，您可以通过将您的私钥输入到特定的字段来支出资金。点击钱包>设置，然后设置适当的“AccountKeyPath”；否则，您无法进行支出。

#### 使用热钱包签名

如果您在设置商店时创建了一个新钱包并将其启用为热钱包，它将自动使用存储在服务器上的种子签名。

### RBF（手续费替换）
手续费替换 (RBF) 是比特币协议的一个特性，它使您能够替换之前已广播但尚未确认的交易。这使得您可以随机化您的钱包交易指纹，或者通过提高手续费率来替换它，因而矿工将优先处理这笔交易。这将有效地替换原始交易，因为更高的手续费率将被优先处理，一旦确认，将使原始交易变得无效（不会发生双重支付）。
点击“高级设置”按钮以查看RBF设置；

![image](assets/en/16.webp)

- 为更高的隐私随机化，这个功能可以让交易自动被替换以实现交易指纹随机化
- 是，标记交易为RBF并会明确地替换（替换不会自动替换，而要通过一些操作来替换）
- 否，不允许交易被替换。

### 币选择

币选择是一个高级隐私增强功能，它使您能够在进行交易时选择您想要花费的硬币。例如，使用刚从混币操作中得到的新硬币进行支付。

币选择与钱包标签功能原生协作。这让您可以为进账资金贴上标签，以便更顺畅地管理和花费UTXO。

BTCPay Server还支持BIP-329进行标签管理。BIP-329可让您设置标签；如果您从支持这一特定BIP的钱包转账并设置了标签，BTCPay Server将识别这些标签并导入它们。迁移服务器时，这些信息也可以被导出并导入到新环境中。

### 如何接收

当您在BTCPay服务器上点击接收按钮时，它会生成一个未使用的地址，可用于接收支付。管理员也可以通过生成新的“发票”来生成新地址。

BTCPay服务器总是要求生成下一个可用地址以避免地址重用。点击“生成下一个可用的BTC地址”后，BTCPay服务器将生成一个新地址和二维码。它还让您能够直接为地址设置标签，以便更好地管理您的地址。

![image](assets/en/17.webp)

![image](assets/en/18.webp)

#### 重新扫描

重新扫描功能依赖于Bitcoin Core 0.17.0的“Scantxoutset”来扫描区块链当前状态（称为UTXO集），以便找出属于特定地址生成规则的比特币。钱包重新扫描已解决BTCPay Server用户遇到的两个问题。

1. 间隙限制问题 - 大多数第三方钱包是轻钱包，它们在许多用户之间共享一个节点。依赖轻节点和全节点的钱包限制了它们在区块链上跟踪的无余额地址的数量（通常为20），以防止性能问题。BTCPay服务器为每个发票生成一个新地址。考虑到上述情况，在BTCPay服务器连续生成20个未支付的发票后，外部钱包将停止获取交易，假设没有新的交易发生。进行第21个、第22个等支付后，您的外部钱包将不会显示支付的发票。另一方面，BTCPay Server钱包内部将跟踪它生成的任何地址，并具有更大的间隙限制。它不依赖于第三方，总是可以显示正确的余额。
2. 间隙限制解决方案 - 如果您的[外部/现有钱包](https://docs.btcpayserver.org/WalletSetup/#use-an-existing-wallet)允许配置间隙限制，您可以通过简单地增加该限制来解决。然而，大多数钱包不允许其配置。我们所知道允许配置间隙限制的一些钱包是Electrum、Wasabi和Sparrow Wallet。不幸的是，您可能会在许多其他钱包中遇到问题。为了获得最佳的用户体验和隐私，您可以考虑停止使用外部钱包，而要使用BTCPay服务器内部钱包。
#### BTCPay服务器使用 “mempoolfullrbf=1”

BTCPay服务器使用 “mempoolfullrbf=1”；我们已将其作为默认设置添加到您的BTCPay Server设置中。然而，我们还提供了一个您可以自行禁用的部分。没有 “mempoolfullrbf=1”，如果客户使用未标记为RBF的交易双重支付，商家只能在确认后才发觉到。

管理员可能想要选择退出此设置。通过以下字符串，您可以更改默认设置。

```
BTCPAYGEN_EXCLUDE_FRAGMENTS="$BTCPAYGEN_EXCLUDE_FRAGMENTS;opt-mempoolfullrbf"
. btcpay-setup.sh -i**
```

### BTCPay服务器钱包设置

BTCPay服务器内的钱包设置提供了对钱包一般设置的清晰快速概览。如果钱包是通过BTCPay服务器创建的，相关设置会自动配置好。

![image](assets/en/19.webp)

BTCPay服务器的钱包设置可以从配置您的钱包状态开始。它是只为了观察的钱包还是热钱包？根据钱包类型，操作也可能有所不同，从重新扫描钱包以查找丢失的交易，修剪历史的旧交易，为支付链接注册钱包或者替换和删除商店的当前钱包。在BTCPay服务器的钱包设置中，管理员可以为钱包设置标签，以便更好地管理钱包。管理员还可以在此看到派生方案、账户密钥（xpub）、指纹和密钥路径。钱包设置中的支付只有两个主要设置。如果交易在发票过期后（设置分钟数）内未确认，支付将被视为无效。当支付交易获得X次确认时，发票将被认为已确认。管理员还可以设置一个开关，在支付时显示推荐费用或设置手动确认目标的区块数量。

![image](assets/en/20.webp)

**！注意！**

如果您独立参加本课程，您可能需要创建在第三方主机上的账户；因此，我们再次提醒，千万不要将这些用作运营环境，而只用于培训目标。

### 示例

#### 在BTCPay服务器上设置比特币钱包

BTCPay服务器可通过两种方式来设置钱包。一种方式是导入已存在的比特币钱包。导入可以通过连接硬件钱包、导入钱包文件、输入扩展公钥、扫描钱包的二维码，或者手动输入之前创建的钱包恢复种子（这是最不理想的方式）来完成。在BTCPay服务器上，您也可以创建新钱包。有两个方式可以让您配置BTCPay服务器生成新钱包。
BTCPay服务器上的热钱包选项允许使用'Payjoin'或'Liquid'等的功能。然而，其存在一个缺点：为这个钱包生成的恢复种子将被存储在服务器上，而且任何拥有管理员控制权的人都可以获取这个恢复种子。由于您的私钥是由您的恢复种子生成的，恶意行为者可能会获得您当前和未来资金的控制权！
为了在BTCPay服务器中减轻这些风险，管理员可以在服务器设置 > 策略 > 设置“允许非管理员为他们的商店创建热钱包”为否（这是默认设置）。为了增强这些热钱包的安全性，服务器管理员应该在被允许拥有热钱包的账户上启用2FA进行验证。在公共服务器上存储私钥是危险并存在风险。有些风险类似于闪电网络风险（见下一章节了解闪电网络风险）。

BTCPay服务器提供的第二个选项是通过创建一个仅用于观察的钱包来生成一个新钱包。BTCPay服务器将一次性生成您的私钥。在用户确认已记录他们的种子短语后，BTCPay服务器将从服务器上擦除私钥。结果，您的商店现在只有一个仅用来观察的钱包。如果您要花费您在仅观察钱包上收到的资金，请参见如何发送的章节，可以通过使用BTCPay服务器保险库、PSBT（部分签名的比特币交易）或者手动提供您的种子短语（我们最不推荐这个做法）。

在上一部分中，您创建了一个新的“商店”。安装向导将继续询问要“设置一个钱包”还是“设置一个闪电网络节点”。在这个示例中，您将了解“设置一个钱包”的向导过程（1）。

![image](assets/en/21.webp)

点击“设置一个钱包”后，向导将继续请求您选择想要如何继续；BTCPay服务器会提供将现有比特币钱包连接到您的新商店的选项。如果您没有钱包，BTCPay服务器将建议创建一个新的。这个示例将遵循“创建一个新钱包”的步骤（2）。按照步骤学习如何“连接一个现有的钱包”（1）。

![image](assets/en/22.webp)

**！注意！**

如果您在教室中参加这个课程，当前示例和我们生成的种子仅用于教育目的。进行练习时，请在这些地址上只使用所需的金额。

(1) 通过点击“创建一个新钱包”按钮，继续“新钱包”向导。

![image](assets/en/23.webp)

(2) 点击“创建一个新钱包”后，向导的下一个窗口将提供“热钱包”和“仅观察钱包”的选项。如果您在讲师的指导下进行练习，您的环境是一个共享的演示环境，您只能创建一个仅观察钱包。请注意下面两幅图之间的区别。您在演示环境中由讲师指导时，您需要创建一个“仅观察钱包”并继续使用“新钱包”向导。

![image](assets/en/24.webp)

![image](assets/en/25.webp)

(3) 继续新钱包向导，您现在处于创建BTC仅观察钱包部分。在此，我们可以设置钱包的“地址类型”，BTCPay服务器让您选择首选的地址类型；截至本课程编写之时，我们仍然推荐使用bech32地址。您可以在本部分的第一章中详细了解这些地址。

- Segwit (bech32)
- 原生SegWit地址以`bc1q`为开头。
  - 例子：`bc1qXXXXXXXXXXXXXXXXXXXXXX`
- 传统地址（Legacy)
  - 传统地址以数字`1`为开头。
  - 例子：`15e15hXXXXXXXXXXXXXXXXXXXX`
- Taproot（为高级用户的地址）
  - Taproot地址以`bc1p`为开头。
  - 例子：`bc1pXXXXXXXXXXXXXXXXXXXXXXXX`
- Segwit封装（Segwit wrapped）
  - Segwit封装地址以`3`为开头。
  - 例子：`37BBXXXXXXXXXXXXXXX`

我们推荐您选择segwit作为首选的钱包地址类型。

![image](assets/en/26.webp)

(4) 在设置钱包参数时，BTCPay Server允许用户通过BIP39设置一个密码短语（可选的），请保证您已确认密码。

![image](assets/en/27.webp)

(5) 设置完钱包的地址类型和一些高级设置后，请点击创建，让BTCPay服务器将生成您的新钱包。请注意，这是在生成您的种子短语之前的最后步骤。进行此操作时，请确保在一个安全的地方进行，以防止他人通过观察您的屏幕而偷取种子短语。

![image](assets/en/28.webp)

(6) 在向导的下一个屏幕中，BTCPay服务器会显示您生成的新钱包的恢复种子短语；这是恢复您的钱包和签署交易的钥匙。BTCPay Server生成一个由12个单词组成的种子短语。经过设置屏幕后，服务器将删掉这些单词。这个钱包是一个仅用来观察的钱包。我们建议不要以数字或照片形式存储这个种子短语。我们建议，用户只要在确认他们已记下他们的种子短语后才能在向导中进一步操作。

![image](assets/en/29.webp)

(7) 点击“完成”并保护新生成的比特币种子短语后，BTCPay服务器将更新您的商店并附上新钱包，而且钱包已经可以接收支付。在用户界面的左侧导航选单中，您可以注意到比特币现在已被突出显示并已激活。

![image](assets/en/30.webp)

### 示例：记录种子短语

现在是安全使用比特币的关键时刻。如前所述，除了您，任何人都不应该知道您的种子短语。如您在教师进行课堂时所关注，生成的种子应该只在本课程中被使用。您的同学可能向这个种子短语窥视、而且该系统存在不安全性。除此之外，还有许多其他因素使此种子短语只适合教育目的。然而，您应该将生成的密钥仍应为课程示例而存储。

我们将在当前情况下使用的第一种方法（即最不安全的方法），该方法是按正确顺序写下种子短语。课程材料中已包含着种子短语卡片，您也可以在BTCPay服务器的GitHub上找到此资料。我们将使用这张卡片记录上一步生成的单词。您必须按正确的顺序记录下来。记录后，您应该检查您写下和软件提供的单词列表，以确保它们的顺序已正确。写完后，点击复选框，其声明您已正确记录下您的种子短语。

### 示例：在硬件钱包上存储种子短语

在本课程中，我们将了解如何在硬件钱包上存储种子短语。教师在进行课程时不一定会使用这个设备。课程指南材料中显示着一份适合此练习的硬件钱包列表。
我们将在这个示例中使用BTCPay服务器保险库和Blockstream Jade硬件钱包。
您也可以通过视频跟随学习如何连接硬件钱包。
![BTCPay服务器 - 如何将您的硬件钱包与BTCPay保险库连接。](https://youtu.be/s4qbGxef43A)

下载BTCPay服务器保险库：https://github.com/btcpayserver/BTCPayServer.Vault/releases

确保您下载了适合您系统的正确文件。Windows用户应下载[BTCPayServerVault-2.0.5-setup.exe](https://github.com/btcpayserver/BTCPayServer.Vault/releases/download/Vault%2Fv2.0.5/BTCPayServerVault-2.0.5-setup.exe)包，Mac用户应下载[BTCPayServerVault-osx-x64-2.0.5.dmg](https://github.com/btcpayserver/BTCPayServer.Vault/releases/download/Vault%2Fv2.0.5/BTCPayServerVault-osx-x64-2.0.5.dmg)，Linux用户应下载[BTCPayServerVault-Linux-2.0.5.tar.gz](https://github.com/btcpayserver/BTCPayServer.Vault/releases/download/Vault%2Fv2.0.5/BTCPayServerVault-Linux-2.0.5.tar.gz)

安装BTCPay服务器保险库后，您可以通过点击桌面上的图标启动软件。当BTCPay服务器保险库正确安装并首次启动时，它会请求权限以用于Web应用程序。它会请求授权给您工作的特定BTCPay服务器。接受这些条件。BTCPay服务器保险库现在将搜索硬件设备。一旦找到设备，BTCPay服务器将识别出保险库正在运行并已检测到您的设备。

**！注意！**

使用热钱包时，除了管理员外不要将您的SSH密钥或服务器管理员账户交给任何其他人。每个能访问这些账户的人都将能够访问热钱包中的资金。

### 技能总结

在本节中，您学到了以下内容：

- 比特币钱包的交易视图及其各种分类。
- 通过一些方法将比特币钱包中的资金发送过去，如硬件和热钱包。
- 使用大多数钱包时面临的间隙限制问题，以及如何解决这个问题。
- 如何在BTCPay服务器内生成一个新的比特币钱包，包括将密钥存储在硬件钱包中并备份恢复短语。

在这个部分，您已经学会了如何在BTCPay服务器内生成一个新的比特币钱包。我们还没有深入探讨如何保护或使用这些密钥。在这个部分的概述中，您已经学会了如何设置第一个商店。您已经学会了如何生成比特币恢复种子短语。

### 知识评估：实践复习

描述一种生成密钥的方法和一种保护它们的方案，以及其安全方案的权衡和风险。

## BTCPay服务器的闪电钱包

<chapterId>1bbece7e-0197-57e6-a93a-561cf384d946</chapterId>

当服务器管理员配置新的BTCPay服务器实例时，他可以设置一个闪电网络设施，LND、Core Lightning或Eclair；对于相关更详细的安装说明，请参见配置BTCPay服务器的部分。
如果您在课堂上参加该课程，您可以通过自定义节点将闪电网络节点连接到您的BTCPay服务器。按照默认设置，BTCPay服务器上的非服务器管理员的用户无法使用内部闪电网络节点。这是为了保护服务器主免于损失其资金。服务器管理员可以安装插件，其通过LNBank访问他们的闪电节点；本书的范围未内涵这个主题；您可以在官方插件页面上阅读更多关于LNBank的信息。

### 连接内部节点（服务器管理员）

服务器管理员可以使用BTCPay服务器的内部闪电网络节点。无论闪电网络的实施如何，连接到内部闪电网络节点的方式都是相同的。

前往之前设置的商店，并在左侧选单中点击“闪电”钱包。BTCPay服务器提供两种设置选项：使用内部节点（默认情况下仅限服务器管理员）或自定义节点（外部连接）。服务器管理员可以点击“使用内部节点”选项，无需进一步的配置。点击“保存”按钮并注意到通知，显示“BTC闪电节点已更新”。商店现在已成功拥有闪电网络功能。

### 连接外部节点（服务器用户/商店主）

按照默认设置，由于商店主不允许使用服务器管理员的闪电网络节点。需要连接到一个外部节点，无论是商店主在BTCPay服务器设置之前拥有的节点，如果服务器管理员提供了LNBank插件，或者是像Alby这样的托管解决方案。

前往之前设置的商店，并在左侧菜单下的钱包中点击“闪电”。由于商店主默认不允许使用内部节点，这个选择对店主来说是不可用的。使用自定义节点是商店主默认可用的唯一选项。

BTCPay服务器需要连接信息；之前制作的系统（或托管服务）将提供特定于闪电网络实施的信息。在BTCPay服务器中，商店主可以使用以下连接；

- 通过TCP或Unix域套接字连接的C-lightning。
- 通过HTTPS的Lightning Charge
- 通过HTTPS的Eclair
- 通过REST代理的LND
- 通过REST API的LNDhub

![image](assets/en/31.webp)

点击“测试连接”以确保您已正确输入连接细节。连接确认无误后，点击保存，然后BTCPay服务器将显示商店已更新，其添加了闪电网络节点。

### 管理内部闪电网络节点LND（服务器管理员）

连接到内部闪电网络节点后，服务器管理员将在仪表板上看到专门用于闪电网络信息的新面板。

- 闪电网络余额
- 通道中的BTC
  - 开启的BTC通道
  - 本地节点中的BTC余额
  - 远程节点中的BTC余额
  - 关闭的BTC通道
- BTC链上
  - 已确认的BTC
  - 未确认的BTC
  - 保留的BTC
- 闪电网络服务
  - Ride The Lightning（RTL）。

通过在“闪电网络服务”面板中点击RTL标志或在左侧选单下的钱包中点击“闪电”，服务器管理员可以进入RTL进行闪电网络节点管理。

**注意！**

如果内部闪电网络节点连接失败，请确认：

1. 比特币链上节点已完全同步
2. 前往“闪电”>“设置”>“BTC闪电设置”，保证内部闪电节点已被“启用”
如果您无法连接到您的闪电节点，请尝试重启您的服务器，或查看BTCPay服务器官方文档以了解更多详情；https://docs.btcpayserver.org/Troubleshooting/ 。只要您的闪电节点已显示为“在线”，您才能够在您的商店接收闪电支付。您可以尝试通过点击“公共节点信息”链接来测试您的闪电连接。

### 闪电钱包

在左侧选单栏的闪电钱包设置中，服务器管理员将找到RTL容易访问渠道、他们的公共节点信息和与他们的BTCPay服务器商店相关的闪电设置。

#### 内部节点信息

服务器管理员可以点击内部节点信息，并查看他们的服务器状态（在线/离线）和Clearnet或Tor的连接字符串。

![image](assets/en/32.webp)

#### 更改连接

如果商店主决定在“闪电设置” > “更改连接”中更改连接选项，那么店主可以在“商店公共节点信息”的旁边找到这个选项。它将恢复外部闪电节点连接的初始设置。您可以填写新的闪电节点信息，点击保存，并使用新的节点信息更新商店。

![image](assets/en/33.webp)

#### 服务

如果服务器管理员决定为闪电实施安装多个服务，它们将在此列出。对于标准的LND实行，管理员将拥有Ride The Lightning (RTL)作为节点管理的标准工具。

#### BTC闪电钱包的设置

闪电节点已被添加到商店之后（已在之前的步骤完成），在闪电钱包的设置中，商店主可以随时通过使用闪电设置上部的切换按钮停用闪电节点。

![image](assets/en/34.webp)

#### 闪电支付选项

商店主可以设置以下参数，以改善他们的客户的闪电体验。

- 以聪显示闪电支付金额。
- 在闪电发票中添加私有通道的HOP提示。
- 将链上支付和闪电支付的链接或二维码合并为一个。
- 为闪电发票设置描述模板。

#### LN网址

商店主可以选择是否使用LN网址。闪电网络网址，或LN网址，是一种提议的标准，用于闪电付款方和收款方之间的互动。简而言之，LN网址是一个以ln网址为前缀的bech32编码网址。闪电钱包可对网址进行解码，联系网址，并等待一个包含进一步指令的JSON对象，最值得注意的是定义kn网址操作方式的标签。

- 启用LN网址
- LN网址经典模式
  - 为了钱包兼容性，比特币地址的编码格式有两种：Bech32 编码（经典）与明文 网址（即将推出）。
- 允许收款方传递评论。

### 示例 1

#### 通过内部节点连接到闪电网络（管理员）

如果您是管理员，或者管理员已更改默认设置以允许用户使用内部闪电节点，您可以通过该方式连接到闪电网络。

作为管理员，请在左侧选班栏点击闪电钱包。BTCPay服务器将要求使用两个选项之一以连接到闪电节点：通过内部节点或自定义的外部节点。请点击“使用内部节点”并点击“保存”。

#### 管理您的闪电节点（RTL）

连接到内部闪电节点后，BTCPay服务器将更新并显示“BTC 闪电节点已更新”的通知，确认您的商店现在已连接到闪电网络。

管理闪电节点是服务器管理员的任务。这涉及到：

- 管理交易
- 管理流动性
  - 入站流动性
  - 出站流动性
- 管理同伴和通道
  - 已连接的同伴
  - 通道费用
  - 通道状态
- 频繁备份通道状态。
- 检查路由报告。
- 或者，使用Loop等服务。

所有闪电网络节点的管理标准操作都是通过RTL完成的（假设您运行LND实施）。管理员可以在BTCPay服务器中点击他们的闪电钱包，并找到一个按钮来打开RTL。BTCPay服务器的主仪表板现已更新，已拥有闪电网络面板，包括快速访问RTL的入口。

### 示例 2

#### 通过Alby连接到闪电网络

当通过Alby等托管服务连接时，店主首先应该创建一个账户，请访问：https://getalby.com/

![image](assets/en/35.webp)

创建Alby账户后，前往您的BTCPay Server商店。

第一步骤：在仪表板上点击“设置一个闪电节点”或在钱包下面点击“闪电”。

![image](assets/en/36.webp)

第二步骤：插入Alby提供的钱包连接凭证。在Alby的仪表板上，点击“钱包”。这里您将找到“钱包连接凭证”。复制这些凭证。将Alby的凭证粘贴到BTCPay服务器上的连接配置字段中。

![image](assets/en/37.webp)

第三步骤：为BTCPay服务器提供连接详情后，点击“测试连接”按钮以确保连接正常运作。注意屏幕上部的“成功连接到闪电节点”的消息。这个通知确认一切都在正常运作。

![image](assets/en/38.webp)

第四步骤：点击“保存”，您的商店现在已通过Alby连接到一个闪电节点。

![image](assets/en/39.webp)

**！注意！**

在使用托管式闪电网络服务时，千万不要将超过您能接受损失的金额托付给它们。

### 技能总结

在本节中，您学到了：

- 如何连接到内部或外部闪电节点
- 仪表板中各种与闪电相关的面板的内容和功能
- 如何使用Voltage Surge或Alby配置闪电钱包

### 知识评估：实践复习

描述将商店连接到闪电钱包的各种方法。

# BTCPay服务器界面

<partId>25e88b81-e1ab-515f-a035-09f2a3075556</partId>

## 仪表板概述

<chapterId>410ff28b-a272-5c91-93e0-48d5b28c53ab</chapterId>

BTCPay服务器是一个模块化软件包。然而，每个BTCPay服务器都有标准，并且管理员/用户将与其交互。从仪表板开始，其是每个BTCPay服务器登录后的主要入口点。仪表板提供了您的商店的表现、钱包当前余额以及过去7天内的最后交易的概况。由于它是一个模块化视图，插件可以利用这个视图来扩展其功能并在仪表板上创建他们的面板。对于本课程书，我们将只讨论标准插件/应用程序及其在BTCPay服务器上的相应视图。

### 仪表板面板

在BTCPay服务器仪表板的主视图中，有几个标准面板可用。这些面板旨在让店主或管理员快速一览地管理他的商店。

- 钱包余额
- 交易活动
- 闪电余额（如果商店启用了闪电网络）
- 闪电服务（如果商店启用了闪电网络）
- 最近的交易。
- 最近的发票
- 当前活跃的众筹
- 商店表现/畅销商品。
钱包余额面板可快速显示您的钱包资金和表现概况。它可以以BTC或法定货币的形式显示，而且面板还让您选择不同的时间范围（如一周、一个月或一年）来查看时间跨度的图表。
![image](assets/en/40.webp)

### 交易活动

在钱包余额面板旁边，BTCPay服务器展示了待处理支付信息、过去7天内的交易数量，以及您的商店是否已经发出任何退款的快速概况。点击“管理按钮”以进入待处理支付的管理界面（在BTCPay服务器 - 支付章节了解更多关于支付的信息）。

![image](assets/en/41.webp)

### 闪电网络余额

启用闪电网络功能后才可见。

当管理员已激活闪电网络功能时，BTCPay服务器仪表板会显示新的面板，其展示您的闪电节点信息，其包括通道中的BTC总量、本地或远程的余额平衡情况（入站或出站流动性）、通道正在关闭或开启，以及闪电节点上链上持有多少比特币。

![image](assets/en/42.webp)

### 闪电服务

启用闪电网络功能后才可见。

在BTCPay服务器仪表板上的闪电网络余额面板旁边，管理员还将看到闪电服务的面板。在此，管理员可以找到他们用来管理闪电节点的工具的快速按钮；例如，Ride the Lightning是BTCPay服务器用于闪电节点管理的标准工具之一。

![image](assets/en/43.webp)

### 最近的交易

最近交易面板将显示您商店的最新交易。通过一次点击，BTCPay服务器实例的管理员即可看到最新的交易，并判断是否需要关注。

![image](assets/en/44.webp)

### 最近的发票

最近的发票面板显示了您的BTCPay服务器生成的最新6张发票，包括其状态和发票金额。面板还包括一个“查看全部”按钮，让您容易访问完整的发票概况。

![image](assets/en/45.webp)

### 销售点与众筹

作为BTCPay服务器提供的一套标准插件或应用程序，销售点和众筹是BTCPay服务器的两个主要插件。BTCPay服务器用户可以根据需要为每个商店和钱包设置销售点或众筹的生成。这将创建一个新的仪表板面板，其显示插件的表现。

![image](assets/en/46.webp)

请注意销售点和众筹面板之间的细微差别。管理员在销售点面板上可看到畅销商品。在众筹面板上，这变成了“顶级福利”。这两个面板都有快速按钮，用于管理相应的应用程序，并查看畅销商品或顶级福利的相关最近发票。

![image](assets/en/47.webp)

**!?注意!?**

余额图表和最近的交易仅适用于链上支付方式。关于闪电网络余额和交易的信息尚在开发中。截至BTCPay服务器1.6.0版本，基本的闪电网络余额已可用。

### 技能总结

在本节中，您学到了以下内容：

- 主要页面上的面板布局，其被称为仪表板。
- 对每个面板内容的基本了解。

### 知识评估回顾

请列出尽可能多的仪表板上的面板。

## BTCPay服务器 - 商店设置

<chapterId>e8faef7b-278d-550e-a511-bc3a442daf64</chapterId>
在BTCPay服务器软件中，我们知道有两种类型的设置。BTCPay服务器商店的特定设置，其设置按钮可在仪表板下方的左侧选单栏找到，而服务器设置位于“账户”上方的选单栏的下部。只有服务器管理员才能查看BTCPay服务器特定于服务器的设置。
商店设置由许多标签页组成，以对每组设置进行分类。

- 一般
- 汇率
- 结账外观
- 访问令牌
- 用户
- 角色
- Webhooks
- 支付处理器
- 电子邮件
- 表单

### 一般

在一般设置标签页中，商店主可以设置他们的品牌和支付默认设置。在商店的初始设置时，系统将提供商店名称；这将在商店名称下方的一般设置中显示出来。在此，商店主还可以设置他们的网站以匹配品牌，并为管理员能在数据库中识别出其而设置一个商店ID。

#### 品牌

由于BTCPay服务器是一种免费和开源的项目，商店主可以进行自定义品牌以匹配他们的商店。设置品牌颜色，存储品牌的标志，并为面向公众/客户的页面（发票、支付请求、拉取支付）添加自定义的层叠样式表（CSS）。

#### 支付

在支付设置中，商店主可以设置他们商店的默认货币（可以设置为比特币或者任何法定货币）。

#### 允许任何人创建发票

此设置是为在BTCPay服务器的开发者或构建者而准备的。如果您为您的商店开启此设置，它将允许外部用户在您的BTCPay服务器实例上创建发票。

#### 在发票中添加额外费用（网络费）

这是BTCPay内的一个功能，用于保护商家免受“灰尘攻击”，而且防止其他客户通过发送大量的小额交易（即小额攻击）导致的影响，其可以导致手续费变得高昂。例如，客户创建了一个20美元的发票，并分20次支付1美元，直到发票完全支付。这会让商家的交易大小变大，而且如果商家之后想要移动这些资金，挖矿费用也会提高。在默认情况下，当发票通过多笔交易支付时，BTCPay会在总发票金额中添加额外的网络成本，以覆盖商家的这笔费用。BTCPay提供了几个选项来自定义这个保护功能。您可以在这些情况应用网络手续费：

- 仅在客户分多次支付发票金额应用网络手续费（在上述的例子中，如果客户创建了一个20美元的发票并支付了1美元，现在总发票应付金额为19美元以及其网络费。网络费在第一次支付之后才会被添加）
- 在每次支付时应用网络手续费（其包括第一次支付，在我们的例子中，总额为20美元，再加上网络费）
- 从不添加网络费（完全禁用网络费）

虽然它可以让您免受灰尘交易的影响，但如果没有适当的沟通，也可能对企业产生负面影响。顾客可能会面临其他问题，并认为您收取过多的费用。

#### 如果全额未支付，发票会过期吗？

发票计时器默认设置为15分钟。此计时器是一种针对波动性的保护机制，因为它根据比特币对法定货币的汇率锁定了比特币金额。如果客户在规定时间内未支付，发票将被视为过期。一旦交易可见于区块链上（0确认），发票就会被视为“已支付”，但交易仅在达到商家设定的确认次数后，才会被视为"已完成"（通常是1到6次）。计时器可以按分钟自定义。

#### 即使支付金额少X%，发票也会被视为已支付吗？
当客户使用交易所钱包直接进行发票支付时，交易所会收取少量费用。这意味着这样的发票不会被视为完全完成。发票的状态变为“已部分支付”。如果商家想接收未完全支付的发票，您可以在这里设置发票总金额的百分比。

### 汇率

在BTCPay服务器中，当生成发票时，它总是需要最新和最准确的比特币对法币的价格汇率。在BTCPay服务器中创建新商店时，管理员会被要求设置他们的首选价格参考；商店设置完成后，商店主可以随时在此标签页更改他们的价格参考。

#### 高级汇率规则脚本

这个功能主要由高级用户使用。如果您开启此功能，店主可以为价格因素和客户的收费方式制作脚本。

#### 测试

在此，您可以查看两个货币之间的汇率并对此进行测试。这还包括通过REST查询检查默认货币对的功能。

### 结账外观

结账外观标签页从特定于发票的设置和默认支付方式开始，并在满足特定要求时启用特定支付方式。

#### 发票设置

BTCPay服务器在标准配置中有三个选项。

- BTC（链上）
- BTC（LN网址-pay，即闪电网络网址支付）
- BTC（链下 & 闪电网络）

我们可以为商店设置参数，使得当交易金额低于某个阈值（X）时，客户将只能使用闪电网络进行支付；而当交易金额高于某个阈值（Y）时，顾客可以使用所提供的链上支付选项。

![image](assets/en/48.webp)

#### 结账

截至BTCPay服务器1.7版本的发布，它引入了新的结账界面，被称为Checkout V2。自1.9版本标准化以来，管理员和商店主仍然可以将结账设置为之前的版本的设置。通过使用“使用经典结账”切换，商店主可以将商店恢复到之前的结账体验。BTCPay服务器还为在线商务或店内体验提供了一组预置选择。

![image](assets/en/49.webp)

当客户与商店互动并生成发票时，此发票有过期时间。BTCPay服务器的默认设置将其设定为5分钟，而且管理员可以根据需要设置。通过检查以下参数，您可以进一步自定义结账页面：

- 通过显示五彩纸屑“庆祝支付”
- 显示商店头部（商店名称和标识）
- 显示“在钱包中支付”按钮
- 结合链上和链下支付的网址/二维码
- 以聪为单位显示闪电网络支付金额
- 结账的自动语言检测

![image](assets/en/50.webp)

当您未设置自动检测语言时，BTCPay服务器的默认设置会显示其为英语。商店主可以将此默认设置更改为他们首选的语言。

![image](assets/en/51.webp)

通过点击下拉选单，商店主可以设置一个自定义的HTML标题，而且结账页面将显示此标题。

![image](assets/en/52.webp)

为了确保客户知道他的支付方式，商店主可以明确设置他的结账总是要求用户选择他们的支付方式。进行发票支付后，BTCPay服务器将允许客户返回到网上商店。商店主可以设置客户支付后的自动重定向。

![image](assets/en/53.webp)

#### 公开收据

在公开收据设置中，商店主可以将收据页面设置为公开，并在收据页面上显示支付列表和收据的二维码，以便客户可以容易访问。
### 访问令牌

访问令牌用于与特定的电子商务集成或自定义构建集成的配对。

### 用户

在商店用户设置中，商店主可以管理其商店人员、他们的账户以及访问商店的权限。员工人员创建账户后，商店主可以将特定用户添加到商店中，作为访客用户或店主。如果您想要进一步设定人员的角色，请参阅下一节“BTCPay服务器商店设置 - 角色”。

### 角色

如果没有合适商店人员角色的选择，店主可以在自定义角色设置中为其业务中的每个角色格式化角色。

(1) 如果您想要创建新角色，请点击“+ 添加角色”按钮。

(2) 输入角色名称，例如，“收银员”。

(3) 配置角色的权限。

- 修改您的商店。
- 管理与您的商店关联的交易账户。
  - 查看与您的商店关联的交易账户。
- 管理您的拉取支付。
- 创建拉取支付。
  - 创建未批准的拉取支付。
- 修改发票。
  - 查看发票。
  - 创建发票。
  - 通过与您的商店关联的闪电节点创建发票。
- 查看您的商店。
  - 查看发票。
  - 查看您的支付请求。
  - 修改商店的网络钩子（Webhook）。
- 修改您的支付请求。
  - 查看您的支付请求。
- 使用与您的商店关联的闪电节点。
  - 查看与您的商店关联的闪电发票。
  - 通过与您的商店关联的闪电节点创建发票。
- 将资金存入与您的商店关联的交易账户。
- 从交易账户提取资金到您的商店。
- 在您商店的交易账户上交易资金。

当角色被创建时，名称是固定的，之后在编辑模式中不能更改。

### 网络钩子（Webhook）

在BTCPay服务器上，您可以简单地创建一个新的网络钩子。在BTCPay服务器商店设置 - 网络钩子标签中，商店主可以通过点击“+ 创建网络钩子”简单创建一个新的网络钩子。网络钩子将允许BTCPay服务器把与您的商店相关的HTTP事件发送到其他服务器或集成的电子商务平台。

现在的页面显示创建网络钩子的配置。确保您知道您的Payload网址并将其粘贴到您的BTCPay服务器中。当您粘贴了Payload网址时，下面部分将显示网络钩子密钥。您可以复制网络钩子密钥并在端点上粘贴它。完成设置后，您可以在BTCPay服务器上开启或关闭自动重新发送功能。我们将尝试在10秒后和1分钟后对发送失败的信息进行重新传送，以及在10分钟后可以最多6次重新发送。您可以在每个情况切换此设置。确保您已启用网络钩子并点击“添加网络钩子”以保存它。

网络钩子与Bitpay API不兼容。在BTCPay服务器上，有两个独立的IPNs（即BitPay术语：意思是“即时支付通知”）。

- 网络钩子
- 通知

您应该只在通过Bitpay api创建发票的情况下使用通知的网址。

### 支付处理器
支付处理器与BTCPay服务器中的支付功能协同运作。支付聚合器可以批量处理多笔交易并一次性发送。通过支付处理器，店主可以自动化批量支付。BTCPay服务器提供了两种自动化支付方法，链上(On-chain)和链下(Off-chain，即LN)。
店主可以分别点击配置两种支付处理器。店主可能只需要每X小时运行一次链上处理器，而链下处理器可能需要每几分钟运行一次。对于链上支付，您还可以设置目标区块，以便包含该交易。默认设置将其设定为1（或下一个可用区块）。请注意，设置链下支付处理器只有间隔计时器，而没有目标区块。闪电网络支付是即时的。

![image](assets/en/62.webp)
![image](assets/en/63.webp)

唯有商店已连接到处理器，店主才能够配置链上处理器。

![image](assets/en/64.webp)

设置支付处理器后，您可以通过返回到BTCPay服务器商店设置中的支付处理器标签页来移除或更改。

**!?注意!?**

链上支付处理器 - 链上支付处理器只能在已连接热钱包的商店上运行。如果没有连接到热钱包，BTCPay服务器未持有钱包的密钥，因此它无法自动处理支付。

### 电子邮件

BTCPay服务器可以使用电子邮件进行通知，或者，如果您已适当设置，可以用来恢复在该实例上创建的账户，因为标准的BTCPay服务器在密码丢失时不会发送电子邮件。

![image](assets/en/65.webp)

店主必须设置一些基本的电子邮件设置才可以配置电子邮件通知，使系统在特定事件发生时将自动发送电子邮件通知。设定完成后，BTCPay服务器才能发送商店的相关活动信息或密码重置电子邮件。

BTCPay服务器通过提供“快速填充”功能使填写这些信息变得更加简单：

- Gmail.com
- Yahoo.com
- Mailgun
- Office365
- SendGrid

使用快速填充功能后，BTCPay服务器将为简单邮件传输协议（SMTP）服务器和端口预填充字段；现在，店主只需要填写他的电子邮件地址、登录名（通常与您的电子邮件地址相同）和密码。在电子邮件设置中，BTCPay服务器还提供高级设置选项，即禁用TLS证书安全检查；默认设置将其设定为启用。

![image](assets/en/66.webp)

通过规定一些电子邮件设置条件，当特定的事件发生时，系统将发送相关的电子邮件至特定的邮件地址。

- 发票已创建
- 发票已收到付款
- 发票正在处理中
- 发票已过期
- 发票已结算
- 发票无效
- 发票付款已结算

如果客户已提供电子邮件地址，这些触发条件可以将信息发送给客户。店主可以预填主题行，以明确说明他们收到电子邮件的原因。

![image](assets/en/67.webp)

### 表单

由于BTCPay服务器不收集任何数据，店主可需要在结账设置添加自定义的表单；这样，店主可以收集顾客的额外信息。BTCPay服务器表单构建器由两个部分组成：一个视觉化的部分以及更高级的代码视图。
创建新表单时，BTCPay服务器会打开一个新窗口并要求您输入新表单的基本信息，以确定客户在表单上需要提供哪些信息。首先，店主需要为他们的新表单给出一个清楚的名称。设置后，店主无法改变表单的名称。
![image](assets/en/68.webp)

店主填写表单名称后，他们还可以将“允许表单公开使用”的开关切换为开启，它会变成绿色，为了让表单可以在面向顾客的页面使用。例如，如果店主不通过他的销售点来创建单独发票，他可能仍然想要收集顾客的信息；开启后，它就允许收集顾客的信息。

![image](assets/en/69.webp)

每个表单都以至少1个新表单字段为起点。店主可以选择字段的类型；

- 文本
- 数字
- 密码
- 电子邮件
- 网址
- 电话号码
- 日期
- 隐藏字段
- 字段集
- 开放评论的文本区域。
- 选项选择器

对于每种类型的字段，顾客必须填写相应的参数。店主可以自定义其设置。在第一个创建的字段下面，店主可以继续添加新的字段。

![image](assets/en/70.webp)

#### 高级自定义表单

BTCPay服务器还允许您用代码创建表单，特别是JSON。无需查看编辑器，店主可以点击其旁边的CODE按钮，前往他们的表单代码。在字段定义中，只能设置以下字段；字段的内容将被存储在发票的元数据中：

| 字段                  | 描述                                                                                                                                                                                                                                                                                                                                                                                                       |
| --------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| .fields.constant      | 如果设置为true，则必须在表单定义中设置.value，用户将无法更改字段的值。（例如：表单的定义版本）                                                                                                                                                                                                                                                                                                               |
| .fields.type          | HTML输入类型：文本、单选按钮、复选框、密码、隐藏、按钮、颜色、日期、本地日期时间、月份、周、时间、电子邮件、数字、范围、搜索、网址、下拉选择框、电话                                                                                                                                                                                                                                                                     |
| .fields.options       | 如果.fields.type为下拉选择框，其为可选择的值列表                                                                                                                                                                                                                                                                                                                                                                  |
| .fields.options.text  | 此选项显示的文本                                                                                                                                                                                                                                                                                                                                                                                           |
| .fields.options.value | 字段的值（如果选择了此选项）                                                                                                                                                                                                                                                                                                                                                                               |
| .fields.type=fieldset | 将在.fields.fields的子元素创建HTML字段集（见下文）                                                                                                                                                                                                                                                                                                                                                            |
| .fields.name          | 字段的JSON属性名称，如它将出现在发票的元数据中                                                                                                                                                                                                                                                                                                                                                            |
| .fields.value         | 字段的默认值                                                                                                                                                                                                                                                                                                                                                                                               |
| .fields.required      | 如果设置为true，字段是必填的                                                                                                                                                                                                                                                                                                                                                                                |
| .fields.label         | 字段的标签                                                                                                                                                                                                                                                                                                                                                                                                 |
| .fields.helpText      | 提供字段的附加文本信息                                                                                                                                                                                                                                                                                                                                                                                     |
| .fields.fields        | 您可以将字段按层级组织，让子字段可以被嵌套在发票的元数据中。该结构可以帮助您更好地组织和管理已收集的信息，使其更易于理解和解析。例如，如果您有一个收集客户信息的表单，您可以将字段分组到一个名为customer的父字段下。在这个父字段内可能有name、Email和address的子字段。 |
字段名称是用来存储用户提供的信息的JSON属性名，其在发票元数据中保存。一些众所周知的名称可以被辨别，并您可以修改相关的发票设置。

| 字段名称             | 描述                  |
| ------------------ | ---------------------|
| invoice_amount     | 发票的金额            |
| invoice_currency   | 发票的货币            |

您可以通过向表单的网址添加查询字符串来自动填写发票的字段，例如"?your_field=value"。

以下是此功能的一些用例：

- 协助用户输入：使用已知的客户信息预填字段，使他们更快完成表单。例如，如果您已经知道客户的电子邮件地址，您可以预填电子邮件字段以节省他们的时间。
- 个性化：根据客户偏好或细分定制表单。例如，如果您有不同的客户等级，您可以使用相关数据预填表单，如他们的会员等级或特定优惠。
- 跟踪：使用隐藏字段和预填值跟踪客户地访问平台。例如，您可以为每个营销渠道（例如，推特、脸书、电子邮件）创建已预填utm_media值的链接。这有助于分析营销的有效性。
- A/B测试：使用不同的值预填字段以测试不同的表单版本，使您能够优化用户体验和转化率。

### 技能总结

在本节中，您学到了以下内容：

- 商店设置中标签的布局和功能
- 基础汇率（Underlying exchange rate）处理、部分支付、轻微欠款等的多种处理方法。
- 自定义结账外观，包括根据价格启用主链和启用闪电网路的发票。
- 管理角色的商店访问级别和权限。
- 配置自动电子邮件及其发送条件
- 创建自定义表单以在结账时收集客户的额外信息。

### 知识评估

#### 知识评估：复习

商店设置和服务器设置之间有什么区别？

#### 知识评估：假设情况

描述您可能在结账外观>发票设置中选出的一些选项。为何您做出这些选择呢？

## BTCPay服务器 - 服务器设置

<chapterId>1dd858a2-49ea-586b-9bc1-75a65f508df6</chapterId>

BTCPay服务器有两个不同的设置视图：一个专用于商店设置，而另一个用于服务器设置。后者仅在您是服务器管理员的情况下可用，不适用于商店主。服务器管理员可以添加用户，创建自定义角色，配置电子邮件服务器，设定策略，运行维护任务，检查附加到BTCPay服务器的所有服务，上传文件到服务器或检查日志。

### 用户

如上一部分所述，服务器管理员可以邀请用户加入他们的服务器，其通过将他们添加到用户标签中完成。

### 服务器范围的自定义角色

BTCPay服务器中有着两种自定义角色：商店特定的自定义角色和适用于整个服务器的自定义角色。两者都持有类似的权限；然而，如果通过BTCpay服务器设置 - 角色标签中设定，应用的角色将为适用于整个服务器的自定义角色，这会被应用于多家商店。请注意服务器设置中自定义角色的“服务器范围”标签。
### 服务器范围内的自定义角色

服务器范围内的自定义角色权限包括：

- 修改您的商店。
- 管理与您的商店相连接的交易账户。
  - 查看与您的商店相连接的交易账户。
- 管理您的拉取支付。
- 创建拉取支付。
  - 创建未验证的拉取支付。
- 修改发票。
  - 查看发票。
  - 创建发票。
  - 通过与您的商店关联的闪电网络节点创建发票。
- 查看您的商店。
  - 查看发票。
  - 查看您的支付请求。
  - 修改商店的网络钩子。
- 修改您的支付请求。
  - 查看您的支付请求。
- 使用与您的商店关联的闪电网络节点。
  - 查看与您的商店关联的闪电网络发票。
  - 通过与您的商店关联的闪电网络节点创建发票。
- 在与您的商店相连接的交易账户存款。
- 从与您的商店相连接的交易账户中提取到您的商店。
- 在您商店的交易账户上进行交易。

**!?注意!?**

创建角色时，名称是固定的，其在编辑模式下无法更改。

### 电子邮件

服务器范围内的电子邮件设置与商店的电子邮件设置显得相似。然而，这种设置不仅处理商店或管理员日志的操作。该电子邮件设置还在BTCPay服务器的登录页面上提供了密码恢复功能。它的工作方式类似特定于商店的设置；管理员可以快速填写他们的电子邮件参数并输入他们的电子邮件凭据，服务器现在可以发送电子邮件。

### 政策

BTCPay服务器的政策管理员可以在诸如现有用户设置、新用户设置、通知设置和维护设置等方面设定相关的设置。这些设置旨在将新用户注册为管理员或普通用户，甚至通过添加到服务器头部来隐藏BTCPay服务器，使其不被搜索引擎发现。

#### 现有用户设置

这里可用的设置与自定义角色分开。这些额外的权限可能会使商店或商店主容易受到攻击。以下是一些可以添加给现有用户的政策：

- 允许非管理员在他们的商店中使用内部闪电网络节点。
  - 这将允许商店主使用服务器管理员的闪电网络节点，因此，使用他的资金！注意，这不是提供闪电网络访问的解决方案。
- 允许非管理员为他们的商店创建热钱包。
  - 这将允许在您的BTCPay服务器实例上拥有账户的任何人创建热钱包，并在管理员的服务器上存储他们的恢复种子。这可能会使管理员因持有第三方资金而承担责任！
- 允许非管理员为他们的商店导入热钱包。
  - 类似于创建热钱包的前一个话题，这个政策允许您导入热钱包，但这也会带来创建热钱包部分提到的相同危险。

#### 新用户设置

我们可以设定一些重要的设置来管理来到服务器的新用户。我们可以为新注册设置确认电子邮件，通过登录屏幕禁用新用户创建，并限制非管理员通过API创建用户的访问权限。

- 要求注册时确认电子邮件。
  - 服务器管理员必须完成电子邮件服务器的设置！
- 在服务器上禁用新用户注册
- 禁用非管理员访问用户创建API端点的权限。

在默认设置的情况下，BTCPay服务器已启用禁用新用户注册并关闭了非管理员访问用户创建API端点的权限。这是出于安全考虑，该系统设计避免了任何可能偶然发现您服务器上BTCPay登录页面的陌生人随意创建账户的情况。
#### 通知设置
![image](assets/en/76.webp)

#### 维护设置

BTCPay服务器是一个托管在GitHub上的开源项目。每当BTCPay服务器发布软件的新版本时，管理员可以收到新版本可用的通知。管理员可能需要阻止搜索引擎（如谷歌、雅虎或duckduckgo）将BTCPay服务器的网页收录在搜索结果中。由于BTCPay服务器是一种FOSS（自由开源软件），全球的开发者可能想要创建新功能；BTCPay服务器拥有一个实验性功能，当开启时，管理员可以尝试创造新功能，而且这是仅用于测试目的。

- 检查GitHub上的发布并在新版本的BTCPay服务器可用时发出通知。
- 阻止搜索引擎对该网站进行索引
- 启用实验性功能。

![image](assets/en/77.webp)

#### 插件

BTCPay服务器可以添加插件并扩展其功能集。在默认设置的情况下，BTCPay服务器插件构建器仓库会加载这些插件。然而，管理员可能选择查看处于预发布状态的插件，如果插件开发者允许，服务器管理员就可以安装插件的测试版本。

![image](assets/en/78.webp)

##### 自定义设置

BTCPay服务器的标准发布将通过在安装时的域名设置来访问。然而，服务器管理员可以重新映射根域名，并从特定商店显示创建的应用之一。服务器管理员还可以将特定域名映射到特定应用。

- 在网站的根目录显示应用
  - 这将显示可能在根域名上显示的应用列表。

![image](assets/en/79.webp)

- 将特定域名映射到特定应用。
  - 当您点击设置特定域名为特定应用时，管理员可以根据需要为特定应用指向多个域名。

![image](assets/en/80.webp)

#### 区块浏览器

BTCPay服务器标准配置包括mempool.space作为其交易的区块浏览器。当BTCPay服务器生成新的发票，并且有一笔与之相关的交易时，店主可以点击打开交易；BTCPay服务器默认会将mempool.space设置为区块浏览器；服务器管理员可以根据自己的需要更改该设置。

![image](assets/en/81.webp)

### 服务

BTCPay服务器设置：服务标签是您的BTCPay服务器使用的组件概览。您的BTCPay服务器暴露的服务可能会因部署方法而有所不同。

BTCPay服务器管理员可以点击每项服务后的“查看信息”以打开它并管理特定的设置。

![image](assets/en/82.webp)

#### LND (gRPC)

BTCPay将LND的g-远程过程调用服务（g-RPC）对外公开；您将在这个特定设置选单中找到连接信息；它还列出了兼容的钱包。BTCPay服务器还提供一个二维码，用于扫描并在移动钱包中应用连接。

服务器管理员可以打开更多详情查看；

- 主机详情
- 使用 SSL
- Macaroon
- AdminMacaroon
- InvoiceMacaroon
- ReadonlyMacaroon
- GRPC SSL 密码套件 (GRPC_SSL_CIPHER_SUITES)

#### LND (表现层状态转换，也称REST)

BTCPay会将LND的REST服务对外开放；您将在这里找到连接信息；这里列出了兼容的钱包，其中一些包括Joule、Alby和ZeusLN。BTCPay服务器还提供了一个用来连接的二维码。您可以扫描并在兼容的钱包中应用。

- REST Uri
- Macaroon
- AdminMacaroon
- InvoiceMacaroon
- ReadonlyMacaroon

#### LND 种子备份

在服务器损坏的情况下，LND种子备份对于从您的LND钱包中恢复资金非常有用。由于闪电网络节点是一个热钱包，您可以在此页面上找到机密种子信息。

LND已记录恢复过程。请参阅 https://github.com/lightningnetwork/lnd/blob/master/docs/recovery.md 以获取文档。

#### Ride The Lightning

Ride the Lightning是一个闪电网络节点的开源管理工具。BTCPay服务器在其堆栈中使用RTL作为闪电网络节点管理元素。BTCPay服务器管理员可以通过服务器设置 - 服务标签页或点击闪电钱包来访问 RTL。

#### 点对点网络的全节点（Full node P2P）

服务器管理员可能想要将他们的比特币节点连接到移动钱包。此页面公开了通过 P2P 协议远程连接到您的全节点的信息。在编写本书时，BTCPay Server 列出了 Blockstream Green 和 Wasabi 钱包作为兼容钱包。BTCPay Server 提供了一个用于连接的 QR 码，扫描并应用于兼容钱包。

#### 远程过程调用全节点（Full node RPC)

此页面公开了通过 RPC 协议远程连接到您的全节点的信息。

#### 安全外壳协议（SSH Protocol）

SSH协议用于维护目的。BTCPay服务器显示了连接到您的服务器的初始连接命令和已授权连接到您的服务器的SSH公钥。服务器管理员可以通过BTCPay服务器的用户页面关闭SSH。

#### 动态域名系统（Dynamic DNS）

动态DNS使您拥有一个稳定的DNS名称，使该名称IP地址经常发生变化的情况下也仍然指向您的服务器。如果您在家里托管BTCPay服务器并想要拥有一个清晰的域名来访问您的服务器，那么我们推荐您进行这个做法。

请注意，您需要正确配置您的网络地址转换（NAT）和BTCPay服务器安装以获得HTTPS证书。

### 模式

BTCPay服务器提供两种标准模式：夜间和白天模式。您可以通过点击左下角的账户，然后对这个功能进行切换。BTCPay服务器管理员可以通过提供自定义CSS模式来添加他们的模式。

管理员可以添加自己的自定义CSS模式或设置他们的自定义模式。

![image](assets/en/83.webp)

#### 服务器品牌创建

服务器管理员可以通过设置您公司的服务器范围品牌来更改BTCPay服务器的品牌。由于BTCPay服务器是一种FOSS，服务器管理员可以给软件白色标签并更改外观，使其适合他们的商业。

![image](assets/en/84.webp)

### 维护

作为服务器管理员，您的用户希望您妥善管理服务器。在BTCPay服务器的维护标签页中，管理员可以进行一些基本维护。设置BTCPay服务器实例的域名，重启或清理服务器，以及最重要的是运行更新。

BTCPay服务器是一个开源项目，频繁更新。每个新版本信息都将通过您的BTCPay服务器或其官方渠道通信来宣布。

![image](assets/en/85.webp)

#### 域名

设置BTCPay服务器之后，管理员可能需要改变他原来的域名。在维护标签页中，管理员可以更改域名。点击确认并在域名上设置适当的DNS记录后，BTCPay服务器将更新并重启以返回到新域名。

![image](assets/en/86.webp)

#### 重启

重启BTCPay服务器及相关服务。

![image](assets/en/87.webp)

#### 清理
BTCPay服务器为其运行而使用Docker组件；每次进行更新，此过程可能会留下Docker镜像、临时文件等残余文件。服务器管理员可以通过运行清理脚本来清理这些多余文件，以释放存储空间。
![image](assets/en/88.webp)

#### 更新

这个功能可能是维护标签页中的最重要部分。BTCPay服务器由社区构建，因此，其更新周期比大多数软件产品更频繁。当BTCPay服务器有新版本发布时，管理员将在他们的通知中心收到通知。通过点击更新按钮，BTCPay服务器将检查GitHub上的最新版本，更新服务器并重启。在更新之前，我们建议服务器管理员要总是阅读通过BTCPay服务器官方渠道分发的发布说明。

![image](assets/en/89.webp)

### 日志

面对问题时，您绝不会感到轻松或愉快。本文档讲述了最常见的工作流程和步骤，以高效地识别您的问题并自己解决或在社区的帮助下解决。

问题识别至关重要。

#### 问题重现

首先，重要的是要尝试识别问题发生的时机。尝试更新并重启您的服务器，以验证您是否可以使同样的问题重现。您也可以截图以更好地分析并解决问题。

##### 更新服务器

如果您的BTCPay服务器版本比BTCPay服务器的[最新版本](https://github.com/btcpayserver/btcpayserver/releases)旧得多，服务器更新可能会解决问题。

##### 重启服务器

重启服务器是解决许多最常见的BTCPay服务器问题的简单方法。您可能需要通过SSH连接到您的服务器以进行重启。

##### 重启服务

对于一些问题，您可能只需要重启BTCPay服务器中的特定服务。例如，重启 lets encrypt 容器以更新SSL证书。

```bash
sudo su -
cd btcpayserver-docker
docker restart letsencrypt-nginx-proxy-companion
```

您可以使用docker ps来找到您想要重启的服务名称。

#### 查看日志

日志可以提供一条关键的信息。在接下来的段落中，我们将描述如何获取 BTCPay各个部分的日志信息。

##### BTCPay 日志

自v1.0.3.8版本发布以来，您可简单地从前端访问BTCPay服务器日志。如果您是服务器管理员，请转到服务器设置 > 日志并打开日志文件。如果您未知日志中的特定错误的意思，请在故障排除时提及它。

如果您想要更详细的日志，并且正在使用Docker，您可以使用命令行查看特定 Docker 容器的日志。请参阅这些[SSH相关的指导](https://docs.btcpayserver.org/FAQ/ServerSettings/#how-to-ssh-into-my-btcpay-running-on-vp%C2%80)（关于运行在VPS上的BTCPay实例）

下一页将提供BTCPay服务器使用的容器名称的通用列表。

运行下面的命令以按容器名称输出日志。替换容器名称以查看其他容器的日志。

```bash
sudo su -
cd btcpayserver-docker
docker ps
docker logs --tail 100 generated_btcpayserver_1
```

| 日志对应     | 容器名称                          |
| ------------ | --------------------------------- |
| BTCPayServer | generated_btcpayserver_1          |
| NBXplorer    | generated_nbxplorer_1             |
| Bitcoind     | btcpayserver_bitcoind             |
| Postgres     | generated_postgres_1              |
| 代理        | letsencrypt-nginx-proxy-companion |
| Nginx        | nginx-gen                         |
| Nginx        | nginx                             |
| c-lightning  | btcpayserver_clightning_bitcoin   |
| LND          | btcpayserver_lnd_bitcoin          |
| RTL          | generated_lnd_bitcoin_rtl_1       |
| Thunderhub   | generated_bitcoin_thub_1          |
| LibrePatron  | librepatron                       |
| Tor          | tor-gen                           |
| Tor          | tor                               |

###### 闪电网络LND-Docker

使用Docker时，您可以通过几种方法来访问LND日志。首先，您可以以root用户身份登录：

```bash
sudo su -
# 导航到正确的目录：
cd btcpayserver-docker
# 查找容器名称：
<partId>6f124f36-b51c-5e53-a734-08fb1f20db25</partId>
docker ps
# 按照容器名称输出日志：
docker logs --tail 100 btcpayserver_lnd_bitcoin
```

或者，您可以使用容器ID来快速输出日志（您只需要输入ID的独特字符，如ID的前两个字符）：

```bash
docker logs '添加您的容器 ID'
```

如果您需要更多日志

```bash
sudo su -
cd /var/lib/docker/volumes/generated_lnd_bitcoin_datadir/_data/logs/bitcoin/mainnet/
ls
```

您将看到与下述相似的结果

```bash
lnd.log lnd.log.13 lnd.log.15 lnd.log.16.gz lnd.log.17.gz
```

如果您想要访问这些日志的未压缩日志，请执行 `cat lnd.log` 或如果您想要另一个方法，您也可以使用 `cat lnd.log.15`。

如果您想要访问 `.gzip` 中的压缩日志，请使用 `gzip -d lnd.log.16.gz`（这是为了访问 `lnd.log.16.gz`）。这应该将为您提供一个新文件，您可以运行 `cat lnd.log.16`。如果上述操作不起作用，您可能需要先使用 `sudo apt-get install gzip` 来安装 gzip。

###### 闪电网络 c-lightning - Docker

```bash
sudo su -
docker ps
# 查找 c-lightning 容器 ID。
<partId>8f12e767-13df-5bc4-85e4-00e227091300</partId>
docker logs '在这里添加您的容器 ID'
```

或者，使用：

```bash
docker logs --tail 100 btcpayserver_clightning_bitcoin
```

您也可以使用 c-lightning cli 命令获取日志信息。

```bash
bitcoin-lightning-cli.sh getlog
```

#### 比特币节点日志

除了[查看日志](https://docs.btcpayserver.org/Troubleshooting/#2-looking-through-the-logs)您的Bitcoin容器外，您还可以使用任何[bitcoin-cli命令](https://developer.bitcoin.org/reference/rpc/index.html)

[(打开新窗口)](https://developer.bitcoin.org/reference/rpc/index.html)以获取来自您的比特币节点的信息。BTCPay包含一个脚本，使您能够与您的比特币节点进行通信。

在btcpayserver-docker文件夹内，您可以使用您的节点来获取区块链信息：

```bash
bitcoin-cli.sh getblockchaininfo
```
BTCPay Server具有本地文件系统，并直接将商店（产品）资产、标志和品牌上传到服务器上。服务器的文件系统只能由服务器管理员访问；商店主可以在商店设置范围内上传他们的标志/品牌。
在文件存储的页面时，您可以直接将其中的文件上传到您的服务器或更改文件存储提供商为本地文件系统或Azure Blob存储。

![image](assets/en/90.webp)

![image](assets/en/91.webp)

### 技能总结

在本节中，您已学到以下内容：

- 商店和服务器设置之间的区别，特别是它们与用户、角色和电子邮件的关系
- 为闪电网络或比特币热钱包的使用和创建、新用户注册和电子邮件通知设置服务器范围的策略。
- 如何添加自定义模式（而不仅提供的简单明暗选项）以及创建自定义标志
- 通过提供的GUI执行简单的服务器维护任务
- 解决问题，包括获取Docker容器或您的节点的任何详细信息
- 管理文件存储

### 知识评估

#### 知识评估：概念复习

通过服务器与商店设置分配的角色有何不同？这些角色分别适合适用于什么样的情况？

#### 知识评估：实践复习

描述在“策略”标签中启用的一些可能的用例。

#### 知识评估：实践复习

描述管理员在“维护”标签中可能定期进行的一些操作。

## BTCPay服务器 - 支付

<chapterId>e2b71ff9-3f4f-5e71-9771-8e03fbbef00f</chapterId>

发票是卖方发给买方以收取付款的文件。

在BTCPay服务器中，发票代表一个必须在特定的一段时间内以固定汇率支付的文件。发票有过期时间，因为它们在指定的时间框架内锁定汇率，以保护接收方免受价格波动的影响。

BTCPay服务器的核心是它可以作为比特币发票管理系统的能力。发票是跟踪和管理收到的付款的重要工具。

除非您使用内置的[钱包](https://docs.btcpayserver.org/Wallet/)手动接收付款，商店内的所有付款都将显示在发票页面上。此页面按日期累积排序付款记录，是发票管理和付款故障排除的中心部分。

![image](assets/en/92.webp)

### 一般设置

#### 发票状态

下表列出着并描述着BTCPay中的标准发票状态和常用操作。操作只是一些建议。用户需要根据他们的用例和业务选择最佳的行动方案。

| 发票状态                   | 描述                                                                                   | 操作                                                                                      |
| -------------------------- | -------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- |
| 新建                        | 未支付，发票尚未过期                                                             | 无                                                                                      |
| 新建（部分支付）            | 未完全支付，发票尚未过期                                                 | 无                                                                                      |
| 过期                        | 未支付，发票尚未过期                                                               | 无                                                                                      |
| 过期（部分支付） \*\*       | 未完全支付，发票已过期                                                         | 联系买家安排退款或要求他们支付欠款。可以将发票标记为已结算或无效                     |
| 过期（迟付）               | 在发票过期后完全支付                                                             | 联系买家安排退款或在可接受延迟确认的情况下处理订单。                                            |
| 已结算（多余付款） | 付款超过发票金额，已结算，收到足够数量的确认 | 联系买家安排退还多余金额，或等待买家联系您 ||
| 处理中 | 已全额支付，但未收到商店设置中指定的足够的确认次数 | 联系买家安排退还多余金额，或等待买家联系您 |
| 处理中（多余付款） | 付款超过发票金额，未收到足够数量的确认 | 等待结算然后联系买家安排退还多余金额，或选择等待买家联系您 |
| 已结算 | 已全额支付，并商店已收到足够的确认次数 | 履行订单 |
| 已结算（标记） | 状态从处理中或无效状态手动更改为已结算 | 商店管理员已将付款标记为已结算 |
| 无效\* | 已支付，但在商店设置中指定的时间内未收到足够的确认次数 | 在区块链浏览器上检查交易，如果已完成所有的确认，将其标记为已结算 |
| 无效（标记） | 状态从已结算或过期状态手动更改为无效 | 商店管理员已将付款标记为无效 |
| 无效（多余付款） | 付款超过发票金额，但在商店设置中指定的时间内未收到足够的确认次数 | 在区块链浏览器上检查交易，如果收到足够的确认次数，标记为已结算 |

#### 发票详情

发票详情页面包含与发票相关的所有信息。

发票信息将根据发票状态、汇率等自动被创建。如果发票是通过销售点应用程序创建的，包含产品信息，产品信息也会自动创建。

#### 发票筛选

可以通过位于搜索按钮旁边的快速筛选器或通过点击顶部的（帮助）链接切换的高级筛选器来筛选发票。用户可以按商店、订单ID、项目ID、状态或日期筛选发票。

#### 发票导出

BTCPay服务器发票可以以CSV或JSON的格式导出。有关发票导出和会计的更多信息，请参阅相关文档。

#### 退款发票

如果您想要发起退款，您可以简单地从发票视图创建退款。

#### 发票退款

由于BTCPay服务器的不重用地址功能，您可能会在商店的发票页面上看到许多过期的发票。如果您想要将它们从您的视图中隐藏起来，选择列表中的发票并将其标记为已归档。标记为已归档的发票不会被删除。对已归档发票的付款仍会被您的BTCPay服务器检测到（迟支付状态）。您可以随时通过从搜索过滤器下拉选单中选择已归档发票来查看商店的已归档发票。

#### 默认货币

商店默认货币，这是在商店创建向导时已被设置

#### 允许任何人创建发票

如果您想要允许外部方在您的商店中创建发票，您应该启用此选项。此选项仅在您使用支付按钮或通过API或第三方HTML网站发出发票时有用。销售点应用程序已预授权，无需为随机访客打开您的POS商店并创建发票启用此功能。

#### 向发票添加额外费用（网络费）

- 仅当客户为发票支付多次时
- 每次支付时
- 永不添加网络费
#### 发票在 .. 分钟后未全额支付将过期。
发票计时器默认设置为15分钟。计时器是一种针对价格波动的保护机制，因为它根据加密货币对法币的汇率锁定了加密货币金额。如果客户在一定的时间内未支付发票，发票将被视为已过期。只要交易在区块链上可见（0次确认），发票就被视为“已支付”，但在达到商家制定的确认次数（通常为1-6次）时，发票才将被视为“完成”。计时器是可自定义的。

#### 即使支付金额比预期少 ..%，发票将被视为已支付。

在客户使用交易所钱包直接支付发票的情况下，交易所会收取少量费用。这意味着这样的发票并未完全完成。发票获得“部分支付”状态。如果商家想接收未付全款的发票，您可以在此处设置百分比率。

### 请求

支付请求是一项功能，让BTCPay商店主创建长期有效的发票。资金按支付时的汇率支付给支付请求。这将让用户可以在不与商店主协商或验证支付时的汇率的情况下，按照自己的便利进行支付。

用户可以多次进行请求部分支付。支付请求将保持有效，直到全额支付或商店主要求设置过期时间为止。地址从不重复使用。每次用户点击支付以为支付请求创建发票时，都会生成一个新地址。

商店主可以打印支付请求（或导出发票数据）以便记录和会计。BTCPay会自动在您商店的发票列表中将发票标记为支付请求。

#### 自定义您的支付请求

- 发票金额 - 设置请求的支付金额
- 计价单位 - 以法币或加密货币显示请求金额
- 支付数量 - 仅允许单次支付或部分支付
- 过期时间 - 允许支付直至某个日期或无过期限
- 描述 - 文本编辑器、数据表格、嵌入照片和视频
- 外观 - 使用CSS主题的颜色和样式

![image](assets/en/93.webp)

#### 创建支付请求

在左侧选单中，转到支付请求并点击“创建支付请求”。

![image](assets/en/94.webp)

提供请求名称、金额、显示计价单位、关联商店、过期时间和描述（可选）

如果您想要允许部分支付，请选择允许收款人以其计价单位创建发票的选项。

点击保存并查看以审查您的支付请求。

BTCPay为支付请求创建一个网址。分享此网址以查看您的支付请求。您需要多个相同的请求吗？您可以使用主选单中的克隆选项复制支付请求。

![image](assets/en/95.webp)

**警告**

支付请求依赖于商店，其意味着每个支付请求在创建时都与一家商店相关联。请确保您的商店连接到了属于该支付请求的钱包。

#### 已支付请求

付款人和请求者在发送支付后可以查看支付请求的状态。如果已全额收到付款，状态将显示为已结算。如果只进行了部分支付，应付金额将显示尚欠余额。

![image](assets/en/96.webp)

#### 自定义支付请求

您可以使用支付请求的文本编辑器来编辑描述内容。如果您想要使用额外的颜色主题或自定义CSS样式，这两个选项都可用。
非技术用户可以使用[bootstrap主题](https://docs.btcpayserver.org/Development/Theme/#2-bootstrap-themes)。通过提供额外的CSS代码，可以进一步进行自定义，如下所示。
```css
:root {
  --btcpay-font-family-base: "Source Sans Pro", -apple-system,
    BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  --btcpay-primary: #7d4698;
  --btcpay-primary-accent: #59316b;
  --btcpay-body-text: #333a41;
  --btcpay-body-bg: #fff;
  --btcpay-bg-tile: #f8f9fa;
}

#mainNav {
  color: white;
  background: linear-gradient(#59316b, #331840);
}

#mainNav .btn-link {
  color: white;
}
```

### 拉式支付

在常规的情况下，接收方将分享他们的比特币地址以进行比特币支付，发送方稍后向这个地址发送资金。这样的系统被称为推式支付，因为发送方在接收方可能无法发起支付，将支付推给接收方。

但是，如果角色颠倒呢？

如果不是发送方推送支付，而是发送方允许接收方在他们认为合适的时候拉取支付呢？这就是拉式支付的概念。这将为您提供几种新的应用，例如：

- 订阅服务（订阅者允许服务每隔一定时间拉取资金）
- 退款（商家允许客户在他们认为合适的时候将退款资金拉到他们的钱包）
- 面向自由职业者的基于时间的计费（雇主允许自由职业者根据报告的时间将资金拉到他们的钱包）
- 赞助（赞助者允许接收者每月拉取资金以继续支持他们的工作）
- 自动售卖（交易所的客户允许交易所每月自动从他们的钱包拉取资金进行售卖）
- 余额提取系统（高流量服务允许用户从他们的余额请求取款，服务可以简单地将支付通过多次部分支付来定期进行处理）

### 支付

支付功能与[拉式支付](https://docs.btcpayserver.org/PullPayments/)相关联。这个功能允许您在您的BTCPay中创建支付。这个功能让您能够处理拉式支付（退款、薪资支付或提取）。

#### 第一示例：退款

我们从退款示例开始。客户在您的商店购买了一件商品，但不幸的是他们必须退回商品。他们想要退款。在BTCPay中，您可以创建一个[退款](https://docs.btcpayserver.org/Refund/)并提供客户链接来领取他们的资金。一旦客户提供了他们的地址并领取了资金，它将显示在支付中。

它的第一个状态是等待批准。店员可以检查是否有待批准中的退款，选择后，您可以使用操作按钮。

操作按钮上的选项

- 批准已选取的支付
- 批准并发送已选取的支付
- 取消已选取的支付

下一步是批准并发送选定的支付，因为我们想退款给客户。检查客户的地址，显示金额，以及我们是否想要从退款中扣除费用。一旦您完成了检查，您仅需要进行交易签署。
客户现在可以在索赔页面上获得更新。他可以通过提供的链接跟踪交易，该链接指向区块浏览器和他的交易。一旦交易被确认，状态变更为已完成。

#### 第二示例：工资

现在我们将讨论工资支出，因为这是在商店内部进行的，而不是根据客户的请求进行的。其基础是相同的；它使用拉取支付。但是我们不在此创建退款，我们将创建一个[拉取支付](https://docs.btcpayserver.org/PullPayments/)。

请您转到您的BTCPay服务器上的拉取支付标签页。在右上角，点击创建拉取支付按钮。

现在我们进入到创建支付的界面，给它一个名称和所需金额的所需货币，填写描述，让员工能够了解其内容。下一部分类似于退款。员工填写目的地址和他想从这次支付中索取的金额。他可能决定将其分成两个不同的索赔，发送到不同的地址，或者甚至通过闪电网络部分索赔。

如果有多个等待中的支付，您可以对其进行批量处理并将这些支付发送出去。一旦签名，支付就会移动到进行中标签页并显示交易。网络接收后，支付将移动到已完成标签页中。已完成标签页是仅仅为历史记录目的而在的。它保存了已处理的支付和属于它的交易。

### 拉取支付

#### 概念

当发送者配置拉取支付时，他们可以配置多个属性：

- 拉取请求名称
- 限额
- 单位（如BTC, SAT, USD）
- 支付方式
  - BTC链上
  - BTC链下
- 描述
- 自定义CSS
- 结束日期（对于闪电网络BOLT11是可选的）

此后，发送者可以使用链接与接收者分享拉取支付，让接收者创建支付。接收者将选择他们的支付方式：

- 使用的支付方式
- 资金的发送地点

一旦支付被创建，它将计入当前期间拉取支付的限额。然后，发送者将通过设置支付的速率来批准支付并继续支出。

对于发送者，我们提供了一种易于使用的方式，通过[BTCPay内部钱包](https://docs.btcpayserver.org/Wallet/)批量支付几个支付。

#### Greenfield API

BTCPay服务器为发送者和接收者提供了完整的API，该API在您实例的`/docs`页面中有文档记录。（或在文档网站https://docs.btcpayserver.org上）

由于我们的API暴露了拉取支付的全部能力，发送者可以根据自己的需求自动化支付。

### 技能总结

在本节中，您学到了以下内容：

- 深入理解BTCPay服务器的发票状态以及可以对其进行的操作
- 自定义和管理被称为“请求”的长期有效发票机制。
- 开启BTCPay服务器上拉取支付的功能将为您提供额外的灵活支付可能性，特别是如何处理退款和工资支付。

### 知识评估

#### 知识评估：概念复习

发票和支付请求之间有什么不同？后者的好处是什么？

#### 知识评估：概念复习

拉取支付如何扩展可一般在链上使用的功能？描述它们启用的一些用例。

## BTCPay服务器默认插件
<chapterId>7d673dc4-bd5d-5411-819b-f135f1d86636</chapterId>
### 默认插件和应用程序

BTCPay服务器配备了一套标准的插件（应用程序），其可以将BTCPay服务器转变为电子商务支付网关。通过添加销售点、众筹平台和简便的支付按钮，BTCPay服务器已成为一种易于部署的解决方案。

### 销售点

BTCPay服务器的标准插件之一是销售点（PoS）。通过PoS插件，店主可以直接通过BTCPay服务器创建一个网上商店，店主无需第三方电子商务解决方案来运营一个网上商店。基于Web的PoS应用程序让拥有实体店的用户能够简便地接收比特币，在不需要费用或第三方的情况下将其直接进入他们的钱包。PoS可以简单地在支持网页浏览的平板电脑或其他设备上显示。用户可以容易地创建一个主屏幕快捷方式，以快速访问网站的应用程序。

#### 如何创建新的销售点

BTCPay服务器允许店主快速以多种布局创建销售点。BTCPay服务器可认识到到并非每个商店都是电子商务，也不是每个商店都是酒吧或餐厅，它为您的PoS提供了多种标准设置。

当店主在左侧菜单栏中点击“销售点”时，BTCPay服务器现在会要求输入一个名称；这个名称将在左侧选单栏中可见。点击创建以创建PoS。

![image](assets/en/97.webp)

#### 更新新创建的销售点

创建新的PoS后，接下来的屏幕将是更新您的销售点并为您的商店添加项目。

##### 应用名称

您在这里给您的销售点起的名字将在BTCPay服务器的主选单中可见。

##### 显示标题

公众访问您的商店时会看到公开标题或名称。BTCPay服务器标准地将您的商店命名为“茶店”。请将其替换为您商店的名称。

![image](assets/en/98.webp)

#### 选择销售点样式

BTCPay服务器能够以多种方式显示其销售点。

- 产品列表
  - 一种商店视图，每一次客户只能购买一个产品。
- 带购物车的产品列表。
  - 一种商店视图，客户可以在此一次购买多个产品，并在屏幕右侧获得购物车概览。
- 仅键盘，
  - 没有产品列表，只有直接开具发票的键盘。
- 打印显示（带二维码的可打印产品列表）
  - 如果您无法以数字方式显示您的产品列表，您需要产品的“线下”解决方案；BTCPay服务器有一个打印显示功能其，作为离线商店。

![image](assets/en/99.webp)

#### 销售点样式 - 产品列表

![image](assets/en/100.webp)

#### 销售点样式 - 产品列表 + 购物车

![image](assets/en/101.webp)

#### 销售点样式 - 仅键盘

![image](assets/en/102.webp)

#### 销售点样式 - 打印显示

![image](assets/en/103.webp)

#### 货币

店主可以为他的销售点设置与他默认设置制定的不同的货币。商店的默认货币将自动填充此字段。

#### 描述

向世界介绍您的商店；您售卖什么产品，价格是多少？您的商店的所有内容都可在这里设置。
#### 产品

当您创建了一个销售点时，标准的BTCPay服务器会为商店添加几个项目作为参考。点击标准项目上的编辑按钮，以更好地理解和调整该项目的不同设置。

在您的商店中创建新产品时，您将看到以下字段：

- 标题
- 价格（固定、最低或自定义）
- 图片网址
- 描述
- 库存
- ID
- 购买按钮文本
- 启用/停用

一旦店主填写了所有新产品字段，点击保存，您会注意到销售点的产品部分现在已被填充。您务必在屏幕右上角进行保存，以避免店主在添加产品时丢失进度。

店主也可以使用“原始编辑器”来配置他们的产品。原始编辑器需要对JSON结构拥有基本的理解。

#### 结账

BTCPay服务器允许对小型销售点特定的结账自定义。店主可以设置“以x价格购买”文本或通过添加表单来请求特定的客户数据。

#### 小费

并非所有商店都需要在销售中提供小费选项。店主可以根据他们的商店需要开启或关闭此功能。如果商店开启了小费功能，店主可以设置他们的小费字段文本。BTCPay服务器的小费是基于百分比的金额运作的。店主可以输入多个百分比值，并用逗号将它们分隔开

#### 折扣

作为店主，您可能想要在结账时给客户一个自定义折扣；在您的商店结账时，折扣切换变得可用。然而，我们不建议将其适用于自助结账系统。

#### 自定义支付

当自定义支付选项被开启时，客户可以输入他们设置的价格，其可能等于或高于商店生成的原始发票。

#### 额外选项

为您的销售点设置好一切后，还有一些额外的选项。店主可以通过Iframe简单地嵌入他们的销售点，或嵌入一个连接到特定商店项目的支付按钮。为了使刚创建的销售点商店风格化，店主可以在额外选项的底部添加自定义CSS。

#### 删除此应用

如果店主想要从他的BTCPay服务器完全删除销售点，可以在更新销售点的底部点击“删除此应用”按钮来完全删掉他们的销售点应用。点击“删除此应用”时，BTCPay服务器会通过请求您输入`DELETE`并点击删除按钮来请求确认。删除后，店主将返回到BTCPay服务器仪表板。

### BTCPay服务器 - 众筹

除了销售点插件，BTCPay服务器还提供创建众筹的选项。就像任何其他众筹平台一样，店主可以设定目标，为贡献创建福利，并根据他们的需求对其进行自定义。

#### 如何设置新的众筹

通过BTCPay服务器左侧的主选单点击众筹插件，其可见于在插件部分下方。BTCPay服务器现在将请求一个众筹的名称；这个名称也将显示在左侧选单栏中。

#### 更新新创建的销售点

一旦您已为应用起个名称，下一个页面是更新应用以添加内容。

#### 应用名称

您的众筹给定的名称将在BTCPay服务器的主选单中可见。

#### 显示标题
为公众提供的众筹活动标题。

#### 标语

给众筹活动一个简短的口号，让人一眼就能理解这次募捐的相关信息。

![image](assets/en/107.webp)

#### 特色图片网址

每个众筹活动都有一个主图，类似于您能直接识别的一个标志性横幅。如果您拥有管理权限，这张图片可以在您的服务器上存储，管理员可以在BTCPay服务器的设置 - 文件进行上传。如果您是商店拥有者，您必须通过第三方主机（例如 imgur）将图片上传到网上。

#### 使众筹活动公开

这个开关使您的众筹活动公开，因此外部方就会看到。出于测试目的或者想检查您的主题是否正确应用，您可能想要在构建众筹活动期间将其设置为关闭。

#### 描述

向世界介绍您的众筹活动，您为之筹款的项目是什么？解释您的众筹活动的所有内容都在这里。

![image](assets/en/108.webp)

#### 众筹目标

为资金筹集者的项目设定一个目标金额，以及目标货币的单位。如果您的目标设定了日期范围，您需要确保其已在众筹的目标下包括这些目标和结束日期。

![image](assets/en/109.webp)

#### 福利

福利在您的众筹活动中起着很大的作用。这是因为福利为人们您的活动提供了一种参与机会。它们既能激发自私的动机，也能激发慈善的心意。它们让您能够接触到支持者的消费能力，而不仅仅是他们的慈善钱包——您可以猜哪个更重要。

创建一个新的福利包括以下字段：

- 标题
- 价格（固定、最低或自定义）
- 图片网址
- 描述
- 库存
- ID
- 购买按钮文本
- 启用/停用

一旦商店拥有者填写了所有新建福利的字段，点击保存，您将会看到众筹的福利部分已填充了。

![image](assets/en/110.webp)

### BTCPay服务器- 销售点

#### 贡献

商店拥有者可以选择如何展示福利，如何排序，甚至如何与其他福利相比较。然而，一旦达到众筹目标，商店拥有者可能想停止向这个活动流入的捐款。因此，他可以开启“达到目标后不允许额外贡献”。这将停止众筹接收捐款。

##### 众筹行为

众筹的标准仅将通过众筹创建的发票计入目标。然而，可能在一些情况下，商店拥有者想要将这个商店中创建的所有发票计入众筹。

#### 额外的自定义选项

BTCpay服务器提供了一些额外的自定义选项，如添加声音、动画或甚至讨论线程到众筹中。商店拥有者也可以通过输入他们自己的自定义CSS来改变众筹的外观和气氛。

#### 删除此应用

如果商店拥有者想要从他的BTCPay服务器完全删除众筹活动，在更新众筹时，商店拥有者可以点击页面底部的“删除此应用”按钮来彻底删掉他们的众筹应用。点击“删除此应用”时，BTCPay服务器会要求您通过输入`DELETE`并点击删除按钮来确认。删除后，商店拥有者将返回到BTCPay服务器的仪表板。

### BTCPay服务器- 支付按钮
易于嵌入的HTML和高度可定制的支付按钮允许店主接收小费和捐赠。在BTCPay服务器的左侧选单栏中，店主可以点击“插件”部分下方的“Pay Button”，然后点击启用以创建支付按钮。

#### 一般设置

在支付按钮的一般设置中，店主可以设置

- 标准价格
- 默认货币
- 默认支付方式
  - 使用商店默认
  - BTC链上
  - BTC链下（闪电网络）
  - BTC链下（LNURL支付）
- 结账描述
- 订单ID

#### 显示选项

您可以配置BTCPay服务器的支付按钮为不同的风格。按钮可以有固定或自定义金额，显示方式可以是滑块或加减切换。

#### 使用模态框

创建支付按钮时，店主可以选择客户点击时的操作，并将其显示在模态框中或作为新页面。

**!?注意!?**

警告：支付按钮应仅用于小费和捐赠

使用支付按钮进行电子商务集成是不推荐的，因为用户可以修改订单的相关信息。对于电子商务，您应该使用我们的Greenfield API。如果此商店处理商业交易，我们建议您在使用支付按钮前创建一个单独的商店。

#### 自定义支付按钮文本

默认情况下，BTCPay服务器的支付按钮将显示“使用BTCPay支付”。店主可以根据自己的需要设置这段文本，并将BTCPay服务器的标识更换为自己的。通过使用“支付按钮文本”设置文本，并在“支付按钮图片网址”下粘贴图片网址。

##### 图片大小

按钮中的图片大小只能设置为三个默认值。

- 146x40px
- 168x46px
- 209x57px

#### 按钮类型

BTCPay服务器对支付按钮有三种状态。

- 固定金额
  - 在按钮的通用设置中预设的价格。
- 自定义金额
  - BTCPay服务器的支付按钮具有“+”和“-”切换按钮，用于设置自定义价格。
  - 使用自定义金额时，BTCPay服务器将请求最小值、最大值以及价格应如何逐渐增加。
  - 按钮可以被设置为“使用简单输入样式”，这将取代“+”/“-”的切换按钮。
  - 按钮和切换内联显示。
- 滑块
  - 类似于自定义金额，但外观有所不同，因为它显示的是滑块而不是“+”/“-”切换按钮。
  - 使用滑块时，BTCPay服务器将请求最小值、最大值以及价格应如何逐渐增加。

**!?注意!?**

可以在顶部的警告描述中删除支付按钮。

#### 支付通知

服务器IPN（即时支付通知）用于处理网络钩子，其可以通过网址填写以发布购买数据。

#### 邮件通知

每当发生支付时，BTCPay服务器可以通知店主。

#### 浏览器重定向

客户完成购买后，如果店主设置了此链接，他将被重定向到这个链接。

#### 高级支付按钮选项

指定应在创建发票后附加到结账页面的额外查询字符串参数。例如，`lang=da-DK`将默认加载丹麦语的结账页面。

#### 使用应用作为端点

直接将支付按钮链接到之前的某个PoS或众筹应用中的一个项目。
商店拥有者可以点击下拉选单并选择他们想要的应用程序；一旦选择了应用程序，商店主就可以添加需要链接的项目。
#### 生成的代码

由于BTCPay服务器的支付按钮是易于嵌入的HTML，BTCPay服务器在配置支付按钮后会在底部显示要复制到网站的生成代码。

商店主可以将生成的代码复制到他们的网站上，BTCPay服务器的支付按钮将直接在他们的网站上启用。

#### 支付通知

服务器IPN（即时支付通知）用于处理网络钩子，可以通过网址填写以发布购买数据。

#### 邮件通知

每当发生支付时，BTCPay服务器可以通知商店主。

#### 浏览器重定向

当客户完成购买时，如果商店主设置了此链接，他将被重定向到这个链接。

#### 高级支付按钮选项

指定应在创建发票后附加到结账页面的额外查询字符串参数。例如，`lang=da-DK`将默认以丹麦语加载结账页面。

#### 将应用程序用作端点

直接将支付按钮链接到之前的某个PoS或众筹应用中的项目。商店主可以点击下拉选单并选择他们想要的应用程序，一旦选择了应用程序，商店主就可以添加需要链接的项目。

#### 生成的代码

由于BTCPay服务器的支付按钮是易于嵌入的HTML，BTCPay服务器在配置支付按钮后会在底部显示要复制到网站的生成代码。商店主可以将生成的代码复制到他们的网站上，BTCPay服务器的支付按钮将直接在他们的网站上启用。

### 技能总结

在本节中，您学到了：

- 如何使用BTCPay服务器集成的PoS插件简单地创建自定义商店
- 如何使用BTCPay服务器集成的众筹插件简单地创建自定义众筹应用
- 使用支付按钮插件生成自定义支付按钮的代码

### 知识评估

#### 知识评估：复习

BTCPay服务器标配的三个内置插件是什么？请简单地描述每个插件的用途。

# 配置BTCPay服务器

<partId>ff38596c-7de3-5e5c-ba50-9b9edbbbb5eb</partId>

## 在LunaNode环境中安装BTCPay服务器的基本了解

<chapterId>d0a28514-ffcf-529b-9156-29141f0b060a</chapterId>

### 在托管环境（LunaNode）上安装BTCPay服务器

这些步骤将提供在LunaNode上使用BTCPay服务器所需的所有信息。此外，在此还有许多部署软件的选项。
您可以在 https://docs.btcpayserver.org 找到BTCPay服务器的所有详细信息。

#### 我们从哪里开始？

在这部分中，您将熟悉LunaNode作为托管提供商，了解使用BTCPay服务器的第一步，并学习如何使用闪电网络。在我们完成所有步骤后，您可以运行一个接收比特币的网上商店或众筹平台！

这是部署BTCPay服务器的众多方式之一。阅读我们的文档以了解更多详情，

https://docs.btcpayserver.org.

### BTCPay Server - LunaNode部署

#### LunaNode部署
首先，访问LunaNode.com的网站，我们将在那里创建一个新账户。点击右上角的“注册”或使用他们主页上的“开始使用”向导。
![image](assets/en/111.webp)

创建新账户后，LunaNode会发送一封验证电子邮件。与Voltage相比，一旦您验证了账户，您会立即被引导去充值账户余额。这个余额是用来支付服务器空间和托管成本的。

![image](assets/en/112.webp)

#### 为您的LunaNode账户添加信用

点击“存入信用”后，您可以设置想要充值的金额以及其支付方式。LunaNode和BTCPay服务器的费用为在每月10美元到20美元之间。
与Voltage.cloud相比，您可以完全访问您的虚拟私人服务器（VPS），因此您拥有更多的控制权。

#### 如何部署新服务器？

在这个指南中，我们将通过创建一组API密钥并使用LunaNode制作的BTCPay服务器启动器来进行设置。

在你的LunaNode仪表板中，点击右上角的API。这将打开一个新页面。我们只需要为API密钥设置一个名称。其余的将由LunaNode处理，此指南未涵盖该范围。点击“创建API凭证”按钮。
创建API凭证后，您会得到一长串字母和字符。这是您的API密钥。

![image](assets/en/113.webp)

#### 如何部署新服务器？

这些凭证具有两个部分，API密钥和API ID；两者都是必要的。在我们进行下一步之前，让我们在浏览器中打开第二个标签页，请访问https://launchbtcpay.lunanode.com/

这里您将被要求提供您的API密钥和API ID。这是为了验证您是这个新服务器的配置者。API密钥应该还在您之前的标签页中打开；如果您在下面的表格中向下滚动，您会找到API ID。

通过启动器的返回到页面，然后使用您的API密钥和ID填写字段，然后点击继续。

![image](assets/en/114.webp)

在下一步骤，您可以提供一个域名。如果您已拥有一个域名并想用它来使用BTCPay服务器，请确保您也在您的域名上添加了DNS记录（被称为`A`记录）。如果您未拥有域名，您可以使用LunaNode提供的域名（您可以在BTCPay服务器设置中更改）并点击继续。

阅读更多关于为BTCPay服务器设置或更改DNS记录的信息；https://docs.btcpayserver.org/FAQ/Deployment/#how-to-change-your-btcpay-server-domain-name

#### 在LunaNode上启动BTCPay服务器

在完成之前的步骤后，我们可以为我们的新服务器设置所有选项。这里我们将选择比特币（BTC）作为我们支持的货币；我们可以设置一个电子邮件，使其获取关于加密证书续订的通知；但这不是强制性的。
本指南旨在建立一个Mainnet环境（现实世界的比特币）；然而，LunaNode还允许您将其设置为Testnet或Regtest以进行开发。在本指南中，我们不会讨论Mainnet选项。
选择您的Lightning实施。LunaNode提供两种不同的实现，LND和Core Lightning。对于本指南，我们将选择LND。这两种实施有一些小但真实的差异；关于此，我们推荐您阅读详尽的文档；https://docs.btcpayserver.org/LightningNetwork#getting-started-with-btcpay-server-and-core-lightning-cln

![image](assets/en/115.webp)

LunaNode提供多种虚拟机（VM）计划。这些计划在价格范围和服务器规格上有所不同。对于本指南，m2计划就足够了；然而，如果您选择的货币不仅仅是比特币，您可以考虑起码使用m4。

加速初始区块链同步；这是可选的，取决于您的需求。有一些高级选项，如设置闪电网路别名，指向特定的GitHub发布，或设置SSH密钥；但本指南中不会涵盖这些内容。

填写完表单后，您需要点击启动VM，LunaNode将开始创建您的新VM，其中包括已安装的BTCPay服务器。这个过程需要几分钟；一旦您的服务器已准备好，LunaNode会给您提供新BTCPay服务器链接。

创建过程之后，点击您的BTCPay服务器链接；在此，您将被要求创建一个管理员账户。

![image](assets/en/116.webp)

### 技能总结

在本节中，您学到了：

- 在LunaNode上创建和资助一个账户
- 使用BTCPay服务器启动器创建您自己的服务器

### 知识评估

#### 知识评估：概念回顾

描述在VPS上运行BTCPay服务器实例与在托管实例上创建账户之间的一些差异。

## 在Voltage环境上安装BTCPay服务器

<chapterId>11c7d284-b4d2-5542-872c-df9bd9c1491b</chapterId>

您将熟悉Voltage.cloud作为托管提供商，了解使用BTCPay Server的第一步，并学习如何使用闪电网络。完成所有步骤后，您可以运行一个接收比特币的网上商店或众筹平台！

这是部署BTCPay服务器的众多方法之一。阅读我们的文档了解更多详情，
https://docs.btcpayserver.org。

### BTCPay服务器 - Voltage.cloud部署

首先，访问Voltage.cloud网站并注册一个新账户。创建账户时，您可以注册7天免费试用。点击右上角的“注册”或点击其主页上的“尝试7天免费试用”。

![image](assets/en/117.webp)

创建账户后，点击仪表盘上的`NODES`按钮。一旦我们选择了“节点”并创建了一个新节点，我们就会看到Voltage提供的可能节点。本指南还会讨论闪电网络，在Voltage上，我们首先需要在创建BTCPay服务器之前选择我们的闪电网络实施。点击闪电网络节点。

![image](assets/en/118.webp)
在此，您需要选择您想要的闪电网络节点类型。Voltage为您的闪电网络设置提供了多种选项。这与使用LunaNode部署时有所不同。为了本指南的目的，一个轻节点就足够了。您可以在Voltage.cloud上阅读更多关于不同之处的内容。

![image](assets/en/119.webp)

给您的节点起个名称，设置密码，并保护好这个密码。如果这个密码丢失，您将失去对备份的访问权限，而Voltage无法恢复它。创建节点后，Voltage会显示其进度。Voltage已为您创建了闪电网络节点。我们现在可以创建BTCPay服务器实例，并直接访问闪电网络。

点击仪表盘左上角的“节点”。在这里，您可以设置BTCPay服务器实例的下一部分。进入节点概述后，您需要点击“创建新的”。您将看到一个与之前相似的页面。我们将选择BTCPay服务器，而不是闪电网络节点。

Voltage会显示您的BTCPay服务器的地理位置，Voltage的主机位于美国西部地区。在这里，您还将看到托管服务器的成本。点击创建并给您的BTCPay服务器其个名称。如果您启用闪电网络，Voltage会显示在上一步中创建的闪电网络节点。点击创建后，Voltage将创建一个BTCPay服务器实例。

![image](assets/en/120.webp)

点击创建后，Voltage会提供默认的用户名和密码。这些与您之前在Voltage设置的密码相似。点击登录账户按钮会将您重定向到您的BTCPay服务器。

欢迎来到您的新BTCPay服务器实例。由于我们已经在创建过程中设置了闪电网络，它会显示闪电网络已启用的信息！

### 技能总结

在本章中，您学到了：

- 在Voltage.cloud上创建账户
- 在账户上一起运行BTCPay服务器和闪电网络节点的步骤

### 知识评估

#### 知识评估：概念回顾

Voltage和LunaNode设置之间有哪些关键差异？

## 在Umbrel节点上安装BTCPay服务器

<chapterId>3298e292-6476-5fe0-836c-7fa021348799</chapterId>

完成这些步骤后，您可以在本地网络上的BTCPay商店接收闪电支付。如果您在餐厅或商业中运行一个umbrel节点，这个过程也会适用。如果您想将这个商店连接到公共网站，请按照高级练习将您的umbrel节点发布在公共平台上。

https://umbrel.com/

![image](assets/en/121.webp)

### BTCPay服务器 - Umbrel部署

在您的Umbrel节点与比特币区块链完全同步后，前往Umbrel应用商店，并在应用下搜索BTCPay服务器。

![image](assets/en/122.webp)

点击BTCPay服务器以查看应用详情。当BTCPay服务器的详情打开时，右下角将显示运行应用所需的要求。它显示需要比特币和闪电网络节点的信息。如果您未在Umbrel上安装闪电网络节点，请点击安装。这个过程可能需要几分钟。

![image](assets/en/123.webp)

安装您的闪电网络节点后：

1. 在应用详情中点击打开或在Umbrel的仪表盘上点击应用。
2. 点击设置一个新节点；您将看到24个单词，用于恢复您的闪电网络节点。
3. 将这些写下来。

![image](assets/en/124.webp)
Umbrel会要求验证刚刚记录下来的词语。在闪电节点设置完成后，返回到 Umbrel应用商店并寻找BTCPay服务求。点击安装按钮后，Umbrel会显示所需组件是否已安装，以及BTCPay服务器需要访问这些组件。安装完成后，点击应用详情右上角的打开按钮，或通过您的Umbrel仪表板打开BTCPay服务器。

![image](assets/en/125.webp)

**!?注意!?**

像之前学到的密钥存储一样，您必须确保将这些存储在适当的位置。

![image](assets/en/126.webp)

![image](assets/en/127.webp)

### 技能总结

在本节中，您学到了：

- 在Umbrel节点上安装具有闪电网络功能的BTCPay服务器的步骤

### 知识评估

#### 知识评估：概念复习

Umbrel上的设置与之前两个托管选项有何不同？

# 结论

<partId>d72e6fa5-0870-5f00-9143-9466ed22e2bd</partId>


## 评估课程
<chapterId>d90bb93d-b894-551e-9fd6-6855c739a904</chapterId>
<isCourseReview>true</isCourseReview>

## 课程总结

<chapterId>c07ac2a5-f97e-5c57-8a80-4955b48128d4</chapterId>

![image](assets/en/128.webp)

您还应该对比特币是什么、它如何运作以及如何通过如闪电网络等的第二层技术进行扩展具有总体的理解。在本课程中，我们已广泛地介绍如何使用BTCPay服务器，从初始安装到商店创建和复杂的发票管理，成为一个财务自主的个人或商家。

恭喜您完成本课程。希望您喜欢这些内容并继续使用和探索BTCPay服务器。我们也希望您和我们一样，对比特币的光明未来以及不断壮大的建设者和参与者社区充满期待

> **FOSS 是不可避免的。**

### 术语表

| 术语                                        | 定义                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 51% Attack（51% 攻击）                                  | 故意构建一个新的最长区块链以替换区块链中的区块的行为。这允许您替换已经被挖掘到区块链中的交易。当您拥有大部分的挖掘能力时，执行这种攻击最为容易，这就是为什么它被称为“多数攻击”或“51% 攻击”。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| AccountKey                                  | 用于重构基础内容的账户密钥                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| AccountKeyPath                              | 从根到账户密钥的路径，由主公钥指纹作为前缀。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Address（地址）| 比特币地址紧凑地编码了支付给接收者所需的信息。一个现代地址由一串字母和数字组成，以bc1为开头，比如bc1qw508d6qejxtdg4y5r3zarvary0c5xw7kv8f3t4。地址是接收者锁定脚本的简写，发送者可以使用它用来将资金签名转给接收者。大多数地址代表接收者的公钥或代表定义更复杂支出条件的某种形式的脚本。前面的例子是一个bech32地址，其编码了一个见证程序，将资金锁定到公钥的哈希上（参见支付到见证公钥哈希）。还有一些较旧的地址格式，以1或3为开头，其使用Base58Check地址编码来代表公钥哈希或脚本哈希。 |
| Address Type（地址类型） | 一个地址可以代表几种不同的脚本。地址经过编码并加上前缀以代表其脚本类型。传统（Legacy）地址使用Base58，当一个传统地址是公钥的哈希时，它被称为P2PKH地址，以‘1’为开头。在比较罕见情况下，传统地址是脚本的哈希，在这种情况下，它将以‘3’为开头。目前，所有SegWit地址都使用Bech32编码，并以前缀‘bc1’为开头。 |
| App（应用） | BTCPay服务器具有一些插件，它们可能会独立作为一个应用程序运行。 |
| BIP 329 | 导出/导入钱包标签 |
| BIP49 | 定义使用P2WPKH嵌套在P2SH（BIP 141）序列化格式的分层确定性（HD）钱包的推导方案，该格式用于隔离见证交易。 |
| Bitcoin Address（比特币地址）| 您发送比特币的含有字母和数字的字符串，因此它“现在居住”在那里作为一个标识符，由大约33个字母和数字组合的字符串组成。在当前协议版本中，地址以1、3或b为开头。拥有接收者的地址是启动比特币交易的必要部分。比特币地址从公钥生成，可以从一组公钥生成多个地址以提高隐私性。比特币地址就像电子邮件地址一样，如果您想要发送消息，您需要知道它的去向，比特币也是如此。在发送比特币交易之前，您需要确保接收者的地址是正确的，因为比特币交易是不可逆的，您可能会将比特币发送到不属于接收者的地址。 |
| bitcoin与Bitcoin | Bitcoin是货币网络，而bitcoin（小写）是Bitcoin网络上的货币单位。您使用比特币货币或代币在Bitcoin网络上进行交易。 |
| Block（区块） | 区块是比特币区块链中的一种数据结构，由一个头部和一系列比特币交易的主体组成。区块带有时间戳，并且指向特定的前一个区块（父区块）。如果您对区块进行哈希头处理，它将提供工作量证明，这使得区块链更加不可改变。区块必须遵守网络共识强制执行的规则以扩展区块链。当一个区块被添加到区块链时，其包含的交易被视为已获得第一次确认。 |
| Block Explorer（区块浏览器）| 一个在线工具，使您能够搜索区块链的实时和历史的相关信息，包括与区块、交易、地址等相关的数据。 |
| Block Hash（区块哈希）                                    | 区块哈希是区块数据的SHA-256哈希值，通常以十六进制格式表示。区块哈希可以被视为一个非常大的数字。为了满足工作量证明（Proof-of-Work）的要求，区块哈希必须低于某个特定的阈值。因此，所有区块哈希都以一系列的零（数字）为开头，后跟一个字母数字字符串。有些区块的前导零多达二十个，而早期的区块前导零少至八个。零的所需数量大致代表区块发布时挖矿的难度。                                                                                                                                                                                                                                                                                                                                                   |
| Block Height（区块高度）                                    | 每个区块按升序编号，从零开始。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Block Reward（区块奖励）                                    | 包括区块补贴（新创建的比特币）和区块中包含的所有交易费用之和。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Block Size（区块大小）                                    | 每个区块具有有限的数据容量。未能放入某个区块的数据，将被记录在下一个区块中。就比特币区块而言，它曾经的区块大小为1MB，然而在一次软分叉后，区块大小从技术上而言可以容纳高达4MB的数据。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Block Subsidy（区块补贴）                                    | 每个区块中新生成的比特币数量。每生产并添加到区块链上的区块，让该区块的创建者能够创造一定数量的新比特币。补贴起始于每个区块50 BTC，每210,000个区块或大约4年减半一次。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Blockchain（区块链）                                      | 所有比特币交易的分布式日志或数据库。交易被分组为称为区块的离散更新，最多限制到4百万权重单位。通过被称为挖矿的随机过程，大约每10分钟一个区块就会被生成。每个区块包括一个计算密集型的“工作量证明”。工作量证明要求用于调节区块间隔，并保护区块链免受重写历史的攻击：攻击者需要超越现有的工作量证明才能替换已发布的区块，使每个区块随着后续区块的堆叠而变得不可改变。                                                                                                                                                                                                                                                                                                                                                   |
| BTCPAY Server Vault（BTCPAY服务器保险库）                         | 为了在易用性、安全性和隐私性之间取得最佳平衡，建议使用BTCPay服务器钱包与硬件钱包配合使用。BTCPay保险库旨在作为硬件钱包与BTCPay服务器之间的桥梁。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Byzantine Generals' Problem（拜占庭将军问题）                              | 一个博弈论问题，其描述去中心化方在不依赖可信中心方的情况下达成共识的难度。其名称来源于几位将军围攻拜占庭的场景。他们包围了城市，但必须集体决定何时攻击。如果所有将军同时攻击，他们将获胜，但如果他们在不同时间攻击，他们将失败。将军们之间没有安全的通信渠道，因为他们发送或接收的任何消息可能已被拜占庭的防御者截获或欺骗性地发送。将军们如何组织同时攻击？                                                                                                                                                                                                                                                                                                                                 |
| Censorship（审查）                                        | 对可以传输给大众的信息进行控制。对比特币而言，审查是指第三方组织交易的能力。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Change（找零）                                        | UTXO返回给发送者钱包的部分，通常通过不同的地址进行。相当于输入总和减去花费金额和交易费用的总和。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Child Pays For Parent (CPFP)                | 一种费用提升的技术，用户通过在子交易中以高费率花费一个低费率未确认交易的输出，以此鼓励矿工将这两笔交易都包含在一个区块中。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Coinbase交易                      | 每个区块中的第一笔交易，它将区块奖励和交易费用分配给挖出该区块的人。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Coincidence of Wants（需求偶合）                        | 一种经济现象，其中两方各持有对方想要的物品，因此他们直接交换这些物品，无需任何货币媒介。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Cold Storage（冷存储）                                | 一种在不连接到互联网的情况下管理数据的方式。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Cold Wallet（冷钱包）                                 | 一种比特币钱包，可以安全地在不连接到互联网的方式下存储您的私钥，通常在一个物理设备上保存。其也被称为硬件钱包，它通过使用一个类似于U盘的设备（不连接互联网）来保护您的数字比特币免受在线黑客的攻击。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Command Line Interface，CLI（命令行接口)                | 与设备或计算机程序交互的过程，其通过来自客户或用户的命令或者设备或程序的反应以文本行形式来进行。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Commitment Transaction（承诺交易）                     | 承诺交易是一种比特币交易，由通道双方签名，编码了通道的最新余额。每次通过通道进行新的支付或转发时，通道余额将更新，并且双方将签署一笔新的承诺交易。重要的是，在Alice和Bob之间的通道中，Alice和Bob都保留自己版本的承诺交易，该交易也由另一方签名。在任何时候，Alice或Bob都可以通过将他们的承诺交易提交到比特币区块链来关闭通道。提交较旧（过时）的承诺交易在闪电网络中被视为作弊（即协议违规），并且另一方可以通过罚款交易对其进行惩罚，从而将通道中的所有资金归为己有。 |
| Confirmation（确认）                                | 一旦交易被包含在一个区块中，它就获得了一次确认。当另一个区块在区块链上被挖出时，该交易获得两次确认，以此类推。六次或更多次确认被认为是足够的证明，表明交易不能被逆转。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Crowdfund，CF（众筹)                              | BTCPay服务器的一个默认插件，让店主可以简单地创建一个典型的众筹网站。他们可以简单地设定目标，为贡献创建福利，并根据需要进行定制。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Cryptography（密码学）                             | 一种特殊的系统，通过改变原始消息，使得只有预定的接收者能够收到该消息。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Dashboard（仪表板）                                  | BTCPay服务器的中心页面。它提供了一个商店所有活动的概览，其通过多个面块来显示。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Demo（演示）                                       | 指软件演示发生在其中的虚拟环境。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Deployment（部署）                                | 软件部署是使软件系统可供使用的所有活动。一般的部署过程包括几个相互关联的活动，以及它们之间可能的转换。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Derivation Path（派生路径）| 一段数据，其指示分层确定性（HD）钱包如何在一棵密钥树中推导特定的密钥。派生路径用作比特币标准。它与HD钱包已被共同引入，两者作为HD钱包的一部分|
| Difficulty Adjustment（难度调整）| 每2016个区块（大约两周）对难度目标进行调整，以尝试确保平均每10分钟挖出一个区块。因此，它在区块之间创建了一致的时间间隔，并且在网络中一致地发行新的比特币（通过区块奖励）。 |
| Difficulty Target（难度目标）| 在挖矿领域中，它是一个数值，区块哈希值必须低于该门槛、以便将区块添加到区块链上。 |
| Digital Signature（数字签名）| 数字签名是一种用于验证数字消息或文件的真实性和完整性的数学方案。它可以被视为一种加密承诺，其中消息不被隐藏。 |
| Divisibility（可分割性）| 一种商品可以被分成较小的数量而不失去价值的属性。因为经济交易经常以不同的金额发生，货币必须具备可分割性，才能在经济方面上被广泛使用。 |
| Docker | 一种软件，将软件包装成被称为容器的标准化单元，这些容器包含运行软件所需的一切，包括库、系统工具、代码和运行时。 |
| Double Spend（双重支付）| 将同一笔钱用来进行多次支付的结果。比特币通过验证添加到区块链上的每笔交易遵守共识规则来防止双重支付的发生，从而确保同一笔资金不会被重复用于不同的交易 |
| Durable（耐用性）| 货币的属性，其中货币可以保持其原始状态随时间推移并承受重复使用。耐用的货币必须能够承受潜在的损害。 |
| Electrum | Electrum是最受欢迎的比特币钱包之一，创建于2011年。 |
| Extended public key（扩展公钥，即Xpub）| 扩展公钥，也被称为Xpub的扩展公钥，是一个作为HD钱包特性的父密钥，可以从xpub导出密钥。这个Xpub是在BIP 32中引入的标准。钱包在幕后使用它来导出公钥。不建议分享Xpub，您的资金不会直接面临被转移的风险，xpub不能导出私钥。分享xpub的好处可能是为了在BTCPay服务器中的众筹目的。xpub通过在线方式共享，而私钥保持在HWW上离线。 |
| F.U.D. | 恐惧（Fear）、不确定性（Uncertainty）和怀疑（Doubt）的缩写；通常是故意引发的，以便让竞争对手处于不利地位。 |
| Fee（费用）| 在闪电网络的上下文中，节点将为转发其他用户的支付而收取路由费用。个别节点可以设置自己的费用政策，这将计算为固定的基础费用和取决于支付金额的费率之和。在比特币的上下文中，交易的发送者将交易费用支付给矿工，为了将该交易包括在一个区块中。比特币交易费用不包括基础费用，并且线性地依赖于交易权重，而不是金额。 |
| Fiat（法定货币）| 由政府发行的货币，不由如黄金等商品支持。 |
| Finite（有限）| 指比特币的供应上限。 |
| Fork（分叉）| 对协议或代码片段的更改。分叉通常用于项目升级。在开源社区中，分叉的存在是因为许多个体选择在不同时间下载并运行相同的软件，并且不总是及时更新软件。如果两个用户下载并运行软件的第1版并只有其中一个在第2版发布时升级，那么更新的用户就运行着第1版的分叉版本。 |
| Funding Transaction（资金交易）| 用于打开支付通道的交易。资金交易的价值（以比特币计）正好是支付通道的容量。资金交易的输出是一个2-of-2多签名脚本（multisig），每个通道合作伙伴控制一个密钥。由于其多签名的特性，其只能通过通道合作伙伴之间的共同同意来花费。它最终将被其中一个承诺交易或关闭交易所花费。 |
| Fungible（可替代）| 指某物（如货币或商品）的性质，其中一部分或数量可以由另一等量的部分或数量替换，以偿还债务或结算账户。 |
| Gap limit（地址间隙限制）| 在区块链中，为了计算账户余额，一些公共地址将被检查，而受到检查的地址数量就是地址间隙限制。在地址间隙限制之外的地址上接收的交易不会被检测到。 |
| Genesis Block（创世区块）| 比特币区块链中的第一个区块。比特币的创造者中本聪于2009年1月3日挖出了创世区块，并包含了当天的《金融时报》头条：“财政大臣处于第二次援助银行的边缘。” |
| Github | 一个平台和基于云的服务，用于软件开发和使用Git的版本控制，其让开发者能够存储和管理他们的代码。 |
| Gossip Protocol（流言协议）| 闪电网络节点通过与其对等节点交换流言消息来发送和接收有关闪电网络拓扑的信息。流言协议主要在BOLT #7中定义，并定义了node_announcement、channel_announcement和channel_update消息的格式。为了防止垃圾邮件，只有当节点已经有一个通道时，节点公告消息才会被转发；只有当通道的资金交易被比特币网络确认时，通道公告消息才会被转发。一般而言，闪电节点会与他们的通道合作伙伴连接，但连接任何其他闪电节点来处理流言消息也是可以的。 |
| Gresham's Law（格雷欣法则）| 表明“劣币驱逐良币”。换句话说，在使用两种货币的经济中，人们会花费不断贬值的劣币，并持有保值的良币。因此，劣币将在日常交易中的流通和使用方面占主导地位，而良币将在储蓄和长期投资方面占主导地位。 |
| Halving（减半）| 一个事件，每210,000个区块（大约四年）将比特币的发行率减半。 |
| Hard Fork（硬分叉）                           | 一种不向后兼容的共识变更。向后不兼容发生在之前无效的行为被认定为有效时。为了在硬分叉后保持共识，所有节点都需要升级。否则，旧节点会根据旧规则拒绝交易或区块，认为它们无效，而升级后的节点会接受它们为有效。因此，在比特币协议中，系统尽一切努力避免硬分叉。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Hardware Wallet, HWW（硬件钱包）             | 一种特殊类型的比特币钱包，它将用户的私钥存储在一个安全的硬件设备中。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Hash Function（哈希函数）                     | 哈希函数是一种将任意大小的数据映射到固定大小的位字符串（哈希）的加密算法，并且设计为单向函数，即不可逆转的函数。从理想的加密哈希函数的输出重建输入数据的唯一方法是尝试尽力寻找可能的输入，直到找到一个与输出匹配的输入值。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Hash Rate（哈希率）                           | 在比特币网络上，矿工每秒产生的哈希数量的度量。单个哈希是为区块创建工作量证明的尝试。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Hot Wallet（热钱包）                         | 一种具有外部连接的设备，尤其是连接到互联网的。热钱包是一种连接互联网的比特币钱包。这些钱包对于日常消费更为方便，但由于它们与互联网交互，因此不如冷存储选项安全。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Initial Block Download, IBD（初始区块下载）| 从头开始构建完整比特币区块链的过程。当一个新节点已被设置并加入网络时，它会连接到其他节点并请求区块。新节点处理这些区块并构建区块链，直到它赶上并与网络同步。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Invoice（发票）                              | 由卖方向买方发出的商业文件，涉及销售交易并指示卖方提供给买方的产品、数量和商定价格。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Know Your Customer，KYC（了解您的客户）      | 旨在防止金融机构被用于非法资金转移的法律，要求所有金融账户能够识别到个人或组织。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Layer 2（第二层）                            | 构建在区块链之上的网络，例如，闪电网络（Lightning Network）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Legacy Address（传统地址）                   | 传统地址使用Base58编码，如果传统地址是公钥的哈希，即所谓的P2PKH地址，它以‘1’为开头。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Lightning Network，LN（闪电网络）                | 一种建立在比特币之上的协议。它创建了一个支付通道网络，通过使用HTLCs和洋葱路由，使得通过网络的支付可以无需信任地转发。闪电网络的其他组成部分包括流言协议、传输层和支付请求。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Liquidity（流动性）                          | 一个特定资产在给定市场内订单簿的几个特征的度量。流动性是一个指标，表明大订单对资产价格的市场影响程度。具有更高流动性的资产拥有更深的订单簿深度。这意味着它能够吸收更多的订单，而价格变动较小。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Longest Chain（最长链）| 构建起来耗费最多努力的区块链。之所以这样命名，是因为一个包含更多区块的区块链会比一个区块较少的链条耗费更多能量来构建，但更准确地说，它是指生产过程中需要更多工作的链条，所以更适合的名称可能是“最重链”。 |
| Main Chain（主链）| 在闪电网络的上下文中，这指的是比特币网络。 |
| Medium of Exchange（交换媒介）| 一种促进经济体系中的其他商品和服务交换的货物。历史上，贝壳、珠子和黄金等物品曾用作过交换媒介。 |
| Mempool（内存池）| “Memory Pool”的简称，它是一个临时存储已被节点接收的交易的地方。 |
| Miner（矿工）| 一个参与通过哈希过程添加新区块以构建区块链的节点。 |
| Mining（挖矿）| 从最近的比特币交易中构建一个区块，然后解决所需的工作证明计算问题的过程。它是通过该过程更新共享的比特币账本（即比特币区块链）和将新交易包含在账本中的过程。这也是发行新比特币的过程。每当创建一个新区块时，挖矿节点将接收该区块的coinbase交易中创建的新比特币。 |
| Multisingature，multisig（多重签名）| 需要多个签名来授权支出的脚本。支付通道总是被编码为需要来自支付通道每个合作伙伴的一个签名的多重签名地址。在两方支付通道的标准情况下，2-of-2多重签名地址将被使用。 |
| Node（节点）| 参与网络的计算机。特别是在比特币协议中或闪电网络上。 |
| Output（输出）| 在比特币交易中创建的比特币包。 |
| Output Lock（输出锁）| 放置在输出上的一组要求。满足这些要求后，才能在交易中使用输出。最常见的例子是拥有私钥的简单要求。 |
| P2SH地址 | P2SH地址是脚本的20字节哈希的Base58Check编码。P2SH地址以“3”为开头。P2SH地址将隐藏所有的复杂性，因此支付的发送者不会看到脚本。 |
| P2WPKH地址 | “原生SegWit v0”地址格式，P2WPKH地址是bech32编码的，以“bc1q”为开头。 |
| P2WSH地址 | “原生Segwit v0”脚本地址格式，P2WSH地址是bech32编码的，以“bc1q”为开头。 |
| Partially Signed Bitcoin Transaction，PSBT（部分签名比特币交易）| 一个促进未签名交易可传输性的比特币标准，其让多方能够容易地签署同一交易。当多方想要向同一交易添加输入时，这最为有用。PSBT由BIP 174引入，允许用户更容易地在冷存储设备上签署交易，然后从连接到互联网的设备上广播已签名的交易。 |
| Pathfinding（寻路）                                      | 在闪电网络中寻找从源头到目的地支付路径的过程。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Pay-to-Public-Key-Hash，P2PKH（付款到公钥哈希） | P2PKH是一种输出类型，将比特币锁定到公钥的哈希上。经过P2PKH脚本锁定的输出可以通过提供与哈希匹配的公钥和由相应私钥创建的数字签名来解锁（花费）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Pay-to-Script-Hash，P2SH（付款到脚本哈希）                | P2SH是一种多用途的输出类型，允许使用较复杂的比特币脚本。使用P2SH时，详细说明花费输出条件的复杂脚本（赎回脚本）不会出现在锁定脚本中，而价值被锁定到一个脚本的哈希上。如果想要花费该输出，用户必须提供并满足该脚本。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Pay-to-Taproot，P2TR（付款到Taproot）                 | Taproot在2021年11月开始运作，是一种新的输出类型，将比特币锁定到一棵花费条件树上，或一个单一的根条件上。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Pay-to-Witness-Public-Key-Hash（付款到隔离见证公钥的哈希）          | P2WPKH是P2PKH的SegWit等效事物，其使用隔离见证。花费P2WPKH输出的签名将被放置在见证树上，而不是在ScriptSig字段中。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Pay-to-Witness-Public-Key-Has，P2WSH（付款到隔离见证脚本的哈希）           | P2WSH是P2PKH的SegWit等效事物，其使用隔离见证。花费P2WSH输出的签名和脚本将被放置在见证树上，而不是在ScriptSig字段中。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Payjoin                                    | 一种特殊类型的比特币交易，其中发送者和接收者共同贡献输入，以打破“共同输入所有权启发式”规则，这是一种用来剥夺比特币用户隐私的假设。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Payment Channel（支付通道）                                    | 闪电网络上两个节点之间的财务关系，通过向多签名地址支付比特币交易创建。通道合作伙伴可以使用该通道在彼此之间来回发送比特币，而无需将所有交易提交到比特币区块链中。在典型的支付通道中，只有两笔交易，即资金注入交易和承诺交易，其被添加到区块链上。通过通道发送的支付不会被记录在区块链中，其“链下”发生。                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Payment Request（支付请求）                                    | 一项允许BTCPay商店主创建长期有效的发票地功能。支付给支付请求的资金使用支付时的汇率。这允许用户根据自己的便利进行支付，无需在支付时与商店主协商或验证汇率。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Payment（支付）                                       | 与拉取支付相关的功能。此功能允许您处理拉取支付（退款、工资支付或提款）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Plugin（插件）                                       | 安装在程序上的软件附加组件，增强其功能。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Point Of Sale，PoS（销售点）                               | BTCPay服务器的默认插件，允许商店主直接从BTCPay服务器创建网上商店。无需任何第三方电子商务解决方案，商店主即可运营网上商店。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Portable（可携带）                                   | 商品易于运输的特性。可携带性是健全货币的一个重要特性；为了使一种货币被广泛采用，因而可用，它必须能够相对容易地跨越边界、在个人之间传递，并且能够在长距离间移动。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Proof Of Work，PoW（工作量证明）                           | 需要大量计算力才能找到的数据，并且任何人都可以简单地验证以证明产生它所需的工作量。在比特币中，矿工必须找到一个数值解决方案来满足全网的目标，其被称为难度目标。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Pseudonym（匿名）                                      | 个人使用假名来保护他们的身份或建立与他们真实身份分开的声誉。公钥用于允许比特币用户在区块链中保持匿名，同时还可以接收比特币。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Public-Key Cryptography（公钥密码学）                                  | 涉及到一对被称为公钥和私钥的密钥，这对密钥与需要电子验证其身份或签名或加密数据的实体相关联。公钥已被公开发布，而相应的私钥保持保密。使用公钥加密的数据只能使用相应的私钥来解密。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Public/Private Key（公钥/私钥）                                   | 在公钥密码学中使用的密钥对。公钥在公开场合与他人共享，其可以被视为一个账号，而私钥需要严格保密，其可以被视为密码。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Pull Payment（拉取支付）                                      | 在传统的情况下，为了进行比特币支付，接收者将分享他们的比特币地址，然后发送者将向此地址发送资金。这样的系统被称为“推送支付”，因为发送者启动支付，而接收者无需参与支付的过程，其将支付推给接收者。与发送者“推送支付”的典型情况不同，发送者将允许接收者在适当的时间进行拉取支付。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Rabbit Hole（兔子洞）                                      | 引用《爱丽丝梦游仙境》中的通过进入一个兔子洞开始冒险的英雄。在比特币协议中，它指的是一旦人们开始了解比特币，就会探索到看似无穷无尽的主题和不断扩展且充满新见解的世界。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Receive（接收）                                        | 将比特币发送到提供的地址的过程。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Register（注册）                                        | 创建账户或注册服务的过程，通常通过输入用户名和密码完成。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Replace By Fee，RBF（手续费替换）                             | 比特币交易可以被指定为RBF，以允许发送者用另一个支付更高费用的类似交易替换此交易。该机制的存在是为了允许用户在网络变得拥堵和费用突然上涨的情况下进行调整。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Repository（代码库）                                      | 在版本控制系统中，代码库是存储一组文件或目录结构的元数据的数据结构。根据使用的版本控制系统是分布式的，如Git或Mercurial，还有集中式的，如Subversion、CVS或Perforce，代码库中的所有信息可能在每个用户的系统上被复制，或可能在单个服务器上维护。代码库包含的元数据包括代码库更改的历史记录、一组提交对象以及称为头的提交对象的一组引用（还有其他未列出的相关内容）。                                                                                                                                                                                                                                                                                                                                                   |
| Rescan（重新扫描） | 对当前UTXO集合状态进行扫描的过程，以寻找属于之前配置的派生方案的硬币 |
| Revocation Key（撤销密钥）| 每个可撤销的序列成熟合约（RSMC）包含两个撤销密钥。每个通道合作伙伴拥有一个撤销密钥。当一方知道对方的撤销密钥后，RSMC的输出可以在预定的时间锁内被花费。在协商新的通道状态时，旧的撤销密钥被共享，从而“撤销”了旧状态。撤销密钥用于阻止通道合作伙伴广播旧的通道状态。 |
| Routing（路由）| 使用闪电网络路径进行支付的过程。 |
| Routing Fees（路由费）| 在闪电网络中，转发其他用户支付的费用。个别节点可以设置自己的费用政策，这将计算为固定的基础费用和一个取决于支付金额的费率之和。 |
| Salability（可销售性）| 商品在市场上可以被持有者随时出售的便利性，且价格损失极为小。 |
| Satoshi，sat（聪）| 聪是比特币可以在区块链上记录的最小单位（面额）。一个聪是一个比特币的一亿分之一（0.00000001），以比特币的创造者Satoshi Nakamoto（中本聪）的名字命名。 |
| Satoshi Nakamoto（中本聪）| 设计比特币并创建其原始参考实现的个人或团体使用的名字。作为实施的一部分，他们还设计了第一个区块链数据库。在此过程中，他们是第一个解决数字货币双重支付问题的人们。他们的真实身份仍然未知。 |
| Satoshi Per Byte（聪/字节）| 用于衡量交易优先级的单位，通过将交易费（以聪为单位）除以交易的大小（以字节为单位）计算得出的。 |
| Satoshi Per Verabyte（聪/Vera字节） | 与“聪/字节”的概念相似，但其用于使用Segwit的新地址，其数值等于交易大小（以权重单位计算）除以4。权重单位是将交易的大小（不包括见证数据）乘以3，然后加上包括见证人的交易大小来计算得出的。 |
| Scarcity（稀缺性）| 商品不能无成本复制的特征。稀缺性不取决于商品现有的数量，而取决于生产更多商品的成本。 |
| Script（脚本）| 比特币使用一种被称为比特币脚本的交易脚本系统。它类似于Forth编程语言，简单、基于栈，并从左到右处理。它有意设计为图灵不完备，没有循环或递归。 |
| Seed Phrase（种子短语） | 存储恢复链上比特币资金所需的所有信息的单词列表。钱包软件通常会生成一个种子短语，并指示用户将其写在纸上。如果用户的计算机损坏或硬盘变得损坏，他们可以再次下载相同的钱包软件，并使用纸质备份取回他们的比特币。 |
| Segregated Witness，SegWit（隔离见证）| 隔离见证（SegWit）是于2017年被引入的比特币协议升级，为签名和其他交易授权证明添加了一个新的见证字段。这个新的见证字段不计入交易ID的计算中，解决了大多数第三方交易可变性问题。作为一个软分叉部署，隔离见证是使比特币的协议规则更加严格的变更。 |
| Self-Sovereignty（自主主权） | 一种管理数字身份的模型，个人或企业拥有对其账户和个人数据的控制权。 |
| Send（发送）| 将比特币移动到一个地址的过程。 |
| Sensitivity Mode（敏感模式）| 可通过商店设置中的开关启用，开启后，会在所有视图中隐藏数值信息（例如，比特币数量）。 |
| Server Settings（服务器设置） | 在BTCPay服务器中适用于全服务器的设置（与商店设置不同，因为商店设置的范围仅限于一家商店）。 |
| Secure Hashing Algorithm 256，SHA-256（安全哈希算法256）| 一种加密哈希函数，其属于被称为安全哈希算法（SHA）的函数之一|
| Shopify | 一家加拿大跨国电子商务公司，总部位于安大略省的渥太华。Shopify是其专有电子商务平台以及零售销售点系统的名称。 |
| Simple Mail Transfer Protocol，SMTP（简单邮件传输协议）| 简单邮件传输协议是一种用于电子邮件传输的互联网标准通信协议。 |
| Soft Fork（软分叉）| 一种协议升级，其向前和向后兼容，因此允许旧节点和新节点继续使用同一的链。 |
| Software Stack（软件栈）| 在计算领域中，解决方案栈或软件栈是创建一个完整的平台所需的一组软件子系统或组件，使应用程序无需额外的软件支持。|
| Store（商店）| BTCPay服务器中的商店可以被视为特定比特币钱包的“家”，扩展了BTCPay服务器的所有功能。 |
| Store Settings（商店设置）| BTCPay服务器中特定于商店的设置。 |
| Taproot | 比特币的升级，其引入几个新功能。该升级包括BIPs 340、341和342，还引入了Schnorr签名方案、Taproot和Tapscript。这些升级共同引进了传输比特币的新型、更高效、灵活和私密的方式。 |
| Thier法则 | 好钱会“驱逐”坏钱的法则。 |
| Third-Party Host第三方主机 | 个人或公司的网站由另一家企业拥有和管理的服务器运行的情况。另一种方案是在您自己的数据中心的服务器上托管您的网站。 |
| Timelock（时间锁）| 时间锁是一种限制措施，用于控制比特币的支出，直到达到指定的未来时间或区块高度。时间锁在许多比特币合约中占据重要地位，包括支付渠道和哈希时间锁合约（HTLC）。 |
| Topology（拓扑）                                       | 闪电网络的拓扑以数学图形式描述了闪电网络的形状。图中的节点是闪电节点（网络参与者/对等方）。图的边是支付通道。闪电网络的拓扑通过流言协议的帮助公开广播，但未公告的通道不包括在内。这意味着闪电网络的规模可能远大于公布的通道和节点数量。在支付的源基路由过程中，了解网络的拓扑结构非常关键。在这个过程中，发送方需要发现一条有效的路由。。                                                                                                                                                                                                                                                                                                                                                   |
| Transaction（交易）                                        | 交易是比特币用来将比特币从一个地址转移到另一个地址的数据结构。几千个交易被聚合在一个区块中，然后该区块被记录（挖掘）在区块链上。每个区块中的第一笔交易，其被称为coinbase交易，将生成新的比特币。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Transaction ID（交易ID）                                      | 一个识别区块链上特定交易的字母和数字串。简单而言，该字符串是交易的双重SHA-256哈希。这个哈希可以用来在节点或区块浏览器上查找交易。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Two Factor Authentication，2FA（双因素认证）                            | 身份管理和访问管理的安全方法，要求使用两种形式的身份验证来访问资源和数据，通常除了标准登录密码外，还需使用辅助设备。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Uncensorable（不可审查）                                    | 没有任何实体能够逆转比特币交易或将钱包或地址列入黑名单的属性。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Unconfiscatable（不可没收）                                    | 指没有任何实体能够在未经授权的情况下从另一个实体那里获取比特币。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Unspent Transaction Outputs，UTXO (未花费交易输出)                       | 尚未花费的输出、因此其可用于新交易的支出。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| User Experience，UX（用户体验）                              | 用户与产品、系统或服务的互动及体验方式。它包括一个人对效用、易用性和效率的感知。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| User Interface，UI（用户界面）                               | 设备中人机交互和通信之处。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Verifiable（可验证）                                     | 一种商品可以容易地与冒牌货和假冒品区分开来的属性。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Virtual（虚拟）                                        | 计算机或计算机网络上进行的或模拟的状态。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Virtual Machine，VM（虚拟机）                                | 在计算领域中，虚拟机是计算机系统的虚拟化或仿真。虚拟机基于计算机架构，并提供物理计算机的功能。它们的实施可能涉及到专用硬件、软件或两者的结合。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Virtual Private Server（虚拟私人服务器）                              | 虚拟私人服务器是互联网托管服务销售的一种虚拟机。"虚拟专用服务器"这个术语也有类似的含义。虚拟私人服务器运行其自己的操作系统副本，客户可能拥有该操作系统实例的“超级用户级”访问权限，因此他们可以安装几乎所有可在该操作系统上运行的软件。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Volatility（波动性）                                      | 资产价格随时间变化程度的衡量。经常经历大幅价格变化的资产更具有波动性，而价格更稳定的资产波动性较小。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Wallet（钱包）| 比特币钱包保存用户的密钥，让用户能够接收比特币、签署交易并检查他们的账户余额。比特币钱包中的私钥和公钥具有两个不同的功能，但在创建钱包时，它们是相互关联的。比特币钱包包含用户的密钥，而不是他们的比特币。从概念上而言，钱包就像一个钥匙链，因为它持有许多对私钥和公钥。这些密钥用于交易签署，让用户能够证明他们在区块链中拥有的交易输出，即他们的比特币。所有比特币都以交易输出的形式记录在区块链上。 |
| Wasabi Wallet（Wasabi钱包）| 一个开源的、非托管的、专注于隐私的桌面比特币钱包，实现了无需信任的 CoinJoin。 |
| Watch-Only Wallet（仅观察的钱包）| 允许您跟踪您在冷存储中的比特币，同时禁用花费资金的比特币钱包。这是因为仅观察钱包不存储或使用私钥，因此无法代表用户授权任何支出。 |
| Whale（鲸鱼）| 在比特币的背景下，鲸鱼是指持有大量比特币的人。 |
| White-Label（白标产品）| 一种由一家公司生产的产品或服务，而其他公司则对其进行重新品牌化，使其看起来像是他们制造的商品。 |
| Whitepaper（白皮书)| 介绍一个新的想法或讨论话题。比特币白皮书将比特币介绍为一个“点对点的电子现金系统”，它“不需要可信任的第三方”。中本聪于2008年10月31日向一个密码学家和密码朋克的电子邮件列表发布了白皮书。 |
| Wrapped Segwit（包装式隔离见证）| 隔离见证升级中包含的一种设计实施，旨在使钱包和其他比特币软件更容易支持隔离见证。为了实现这一点，两个原生的隔离见证脚本，P2WPKH和P2WSH，用作P2SH交易的“赎回脚本”，分别产生了包装式隔离见证脚本类型，分别为P2SH-P2WPKH和P2SH-P2WSH。 |

![image](assets/en/129.webp)
