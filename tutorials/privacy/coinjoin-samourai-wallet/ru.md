---
name: Coinjoin - Samourai Wallet
description: Как выполнить coinjoin в Samourai Wallet?
---
![cover](assets/cover.webp)

***ВНИМАНИЕ:** После ареста основателей Samourai Wallet и изъятия их серверов 24 апреля, инструмент Whirlpool больше не функционирует, даже для пользователей, которые имеют свой собственный Dojo или используют Sparrow Wallet. Тем не менее, существует возможность, что этот инструмент может быть восстановлен в ближайшие недели или запущен в другом виде. Кроме того, теоретическая часть этой статьи остается актуальной для понимания принципов и целей coinjoin в целом (не только Whirlpool), а также для понимания эффективности модели Whirlpool.*

_Мы тщательно следим за развитием этого дела, а также за развитием связанных с ним инструментов. Будьте уверены, что мы обновим этот учебник, как только появится новая информация._

_Этот учебник предоставляется только в образовательных и информационных целях. Мы не поддерживаем и не поощряем использование этих инструментов в преступных целях. Каждый пользователь несет ответственность за соблюдение законов в своей юрисдикции._

---

"*биткоин-кошелек для улиц*"

В этом учебнике вы узнаете, что такое coinjoin и как выполнить его, используя программное обеспечение Samourai Wallet и реализацию Whirlpool.

## Что такое coinjoin в Bitcoin?
**Coinjoin - это техника, которая нарушает прослеживаемость биткоинов в блокчейне**. Она основана на совместной транзакции с определенной структурой одноименной: транзакция coinjoin.

Coinjoins повышают конфиденциальность пользователей Bitcoin, усложняя анализ цепочек для внешних наблюдателей. Их структура позволяет объединять множество монет от разных пользователей в одну транзакцию, тем самым затемняя следы и затрудняя определение связей между входными и выходными адресами.

Принцип coinjoin основан на совместном подходе: несколько пользователей, желающих смешать свои биткоины, вносят одинаковые суммы в качестве входов одной и той же транзакции. Затем эти суммы распределяются как выходы равной стоимости каждому пользователю. В конце транзакции становится невозможным связать определенный выход с известным пользователем на входе. Между входами и выходами не существует прямой связи, что разрывает ассоциацию между пользователями и их UTXO, а также историю каждой монеты.
![coinjoin](assets/notext/1.webp)

Пример транзакции coinjoin (не моя): [323df21f0b0756f98336437aa3d2fb87e02b59f1946b714a7b09df04d429dec2](https://mempool.space/en/tx/323df21f0b0756f98336437aa3d2fb87e02b59f1946b714a7b09df04d429dec2)

Для выполнения coinjoin, обеспечивая при этом, чтобы каждый пользователь в любой момент контролировал свои средства, процесс начинается с создания транзакции координатором, который затем передает ее участникам. Каждый пользователь затем подписывает транзакцию после проверки, что она им подходит. Все собранные подписи наконец интегрируются в транзакцию. Если пользователь или координатор попытаются перенаправить средства, изменив выходы транзакции coinjoin, подписи окажутся недействительными, что приведет к отклонению транзакции узлами.

Существует несколько реализаций coinjoin, таких как Whirlpool, JoinMarket или Wabisabi, каждая из которых стремится управлять координацией среди участников и повысить эффективность транзакций coinjoin.
В этом учебном пособии мы погрузимся в реализацию **Whirlpool**, который я считаю наиболее эффективным решением для выполнения coinjoin на Bitcoin. Хотя он доступен в нескольких кошельках, в этом руководстве мы будем исследовать его использование исключительно с мобильным приложением Samourai Wallet, без Dojo.
## Почему стоит выполнять coinjoin на Bitcoin?
Одна из первоначальных проблем любой системы пиринговых платежей - это двойная траты: как предотвратить попытки злоумышленников тратить одни и те же денежные единицы несколько раз без обращения к центральному органу для арбитража?

Сатоши Накамото предложил решение этой дилеммы через протокол Bitcoin, пиринговую электронную платежную систему, которая работает независимо от любого центрального органа. В своем белом документе он подчеркивает, что единственный способ гарантировать отсутствие двойной траты - это обеспечить видимость всех транзакций внутри платежной системы.

Чтобы гарантировать, что каждый участник осведомлен о транзакциях, они должны быть обнародованы. Таким образом, работа Bitcoin основана на прозрачной и распределенной инфраструктуре, позволяющей любому оператору узла проверять всю цепочку электронных подписей и историю каждой монеты, начиная с ее создания майнером.

Прозрачная и распределенная природа блокчейна Bitcoin означает, что любой пользователь сети может следить и анализировать транзакции всех других участников. В результате, анонимность на уровне транзакций невозможна. Однако анонимность сохраняется на уровне индивидуальной идентификации. В отличие от традиционной банковской системы, где каждый счет связан с личной идентичностью, в Bitcoin средства ассоциируются с парами криптографических ключей, таким образом предлагая пользователям форму псевдонимности за криптографическими идентификаторами.

Таким образом, конфиденциальность на Bitcoin нарушается, когда внешние наблюдатели умудряются ассоциировать конкретные UTXO с идентифицированными пользователями. Как только эта ассоциация установлена, становится возможным отслеживать их транзакции и анализировать историю их биткойнов. Coinjoin - это именно техника, разработанная для разрыва следимости UTXO, тем самым предлагая определенный уровень конфиденциальности пользователям Bitcoin на уровне транзакций.

## Как работает Whirlpool?
Whirlpool выделяется среди других методов coinjoin использованием транзакций "_ZeroLink_", которые гарантируют, что технически невозможно установить связь между всеми входами и всеми выходами. Это идеальное смешивание достигается за счет структуры, в которой каждый участник вносит одинаковую сумму на входе (за исключением комиссии за майнинг), тем самым генерируя выходы совершенно равных сумм.
Такой ограничительный подход к входам придает транзакциям coinjoin Whirlpool уникальную особенность: полное отсутствие детерминированных связей между входами и выходами. Другими словами, каждый выход имеет равную вероятность быть приписанным любому участнику по сравнению со всеми другими выходами в транзакции.
Изначально количество участников в каждом coinjoin Whirlpool было ограничено 5, с 2 новыми участниками и 3 ремиксерами (мы объясним эти понятия далее). Однако увеличение комиссий за транзакции в блокчейне, наблюдаемое в 2023 году, побудило команды Samourai пересмотреть свою модель для улучшения конфиденциальности при снижении затрат. Таким образом, учитывая рыночную ситуацию с комиссиями и количество участников, координатор теперь может организовывать coinjoin, включая 6, 7 или 8 участников. Эти улучшенные сессии называются "_Surge Cycles_". Важно отметить, что, независимо от конфигурации, в coinjoin Whirlpool всегда только 2 новых участника.

Таким образом, транзакции Whirlpool характеризуются одинаковым количеством входов и выходов, которые могут быть:
- 5 входов и 5 выходов;
![coinjoin](assets/notext/2.webp)
- 6 входов и 6 выходов;
![coinjoin](assets/notext/3.webp)
- 7 входов и 7 выходов;
![coinjoin](assets/notext/4.webp) - 8 входов и 8 выходов.
![coinjoin](assets/notext/5.webp)
Модель, предложенная Whirlpool, основана на маленьких транзакциях coinjoin. В отличие от Wasabi и JoinMarket, где надежность анонимных наборов зависит от объема участников в одном цикле, Whirlpool делает ставку на цепочку нескольких малых циклов.

В этой модели пользователь платит комиссию только при своем первоначальном входе в пул, что позволяет ему участвовать в множестве ремиксов без дополнительных комиссий. Новые участники покрывают комиссии за майнинг для ремиксеров.

С каждым дополнительным coinjoin, в котором участвует монета вместе с ее прошлыми партнерами, анонимные наборы будут расти экспоненциально. Цель состоит в том, чтобы воспользоваться этими бесплатными ремиксами, которые с каждым разом способствуют укреплению плотности анонимных наборов, ассоциированных с каждой смешанной монетой.

Whirlpool был разработан с учетом двух важных требований:
- Возможность реализации на мобильных устройствах, учитывая, что Samourai Wallet в первую очередь является приложением для смартфонов;
- Скорость циклов ремикса для значительного увеличения анонимных наборов.
Эти императивы направляли разработчиков Samourai Wallet при проектировании Whirlpool, заставляя их ограничить количество участников на цикл. Слишком малое количество участников могло бы подорвать эффективность coinjoin, резко сократив анонимные наборы, генерируемые каждым циклом, в то время как слишком большое количество участников могло бы вызвать проблемы управления на мобильных приложениях и затруднить поток циклов.
**В конечном итоге, нет необходимости иметь большое количество участников на каждый coinjoin в Whirlpool, поскольку анонимные наборы достигаются за счет накопления нескольких циклов coinjoin.**

[-> Узнать больше о анонимных наборах Whirlpool.](https://planb.network/tutorials/privacy/wst-anonsets)

### Пулы и комиссии за coinjoin
Для того чтобы эти множественные циклы действительно увеличивали анонимные наборы смешанных монет, необходимо установить определенный фреймворк, ограничивающий суммы используемых UTXO. Таким образом, Whirlpool определяет различные пулы.

Пул представляет собой группу пользователей, желающих смешаться вместе, которые договариваются о сумме UTXO для оптимизации процесса coinjoin. Каждый пул указывает фиксированную сумму для UTXO, к которой пользователь должен придерживаться, чтобы участвовать. Таким образом, для выполнения coinjoins с Whirlpool, вам нужно выбрать пул. В настоящее время доступны следующие пулы:
- 0.5 биткоина;
- 0.05 биткоина;
- 0.01 биткоина;
- 0.001 биткоин (= 100,000 сатоши).

Присоединяясь к пулу со своими биткоинами, они будут разделены для генерации UTXO, которые будут идеально однородны с теми, что у других участников пула. Каждый пул имеет максимальный лимит; таким образом, для сумм, превышающих этот лимит, вам будет необходимо либо сделать два отдельных входа в один и тот же пул, либо ориентироваться на другой пул с большей суммой:

| Пул (биткоин) | Максимальная сумма за вход (биткоин) |
|----------------|------------------------------------|
| 0.5            | 35                                 |
| 0.05           | 3.5                                |
| 0.01           | 0.7                                |
| 0.001          | 0.025                              |
Как было упомянуто ранее, UTXO считается принадлежащим к пулу, когда оно готово к интеграции в coinjoin. Однако это не означает, что пользователь теряет владение им. **На протяжении различных циклов смешивания вы сохраняете полный контроль над своими ключами и, следовательно, над своими биткойнами.** Вот что отличает технику coinjoin от других централизованных методов смешивания.

Для входа в пул coinjoin необходимо оплатить сервисные и майнинговые сборы. Сервисные сборы фиксированы для каждого пула и предназначены для компенсации командам, ответственным за разработку и поддержку Whirlpool.

Сервисные сборы за использование Whirlpool оплачиваются один раз при входе в пул. После этого у вас есть возможность участвовать в неограниченном количестве пересмешиваний без дополнительных сборов. Вот текущие фиксированные сборы для каждого пула:

| Пул (биткойн) | Вступительный сбор (биткойн) |
|---------------|------------------------------|
| 0.5           | 0.0175                       |
| 0.05          | 0.00175                      |
| 0.01          | 0.0005 (50,000 сатоши)       |
| 0.001         | 0.00005 (5,000 сатоши)       |

Эти сборы по сути действуют как входной билет для выбранного пула, независимо от суммы, которую вы вносите в coinjoin. Таким образом, независимо от того, присоединяетесь ли вы к пулу 0.01 с точно 0.01 BTC или входите в него с 0.5 BTC, сборы останутся теми же в абсолютном значении.

Перед тем как приступить к coinjoins, пользователь таким образом имеет выбор между 2 стратегиями:
- Выбрать меньший пул, чтобы минимизировать сервисные сборы, зная, что в ответ они получат несколько маленьких UTXO;
- Или предпочесть больший пул, согласившись платить более высокие сборы, чтобы в итоге получить меньшее количество UTXO большей стоимости.

Обычно не рекомендуется объединять несколько смешанных UTXO после циклов coinjoin, так как это может нарушить достигнутую конфиденциальность, особенно из-за эвристики общего владения входами (CIOH). Поэтому может быть разумным выбрать больший пул, даже если это означает оплату большего сбора, чтобы избежать получения слишком многих UTXO малой стоимости на выходе. Пользователю необходимо взвесить эти компромиссы, чтобы выбрать предпочтительный пул.

Помимо сервисных сборов, также необходимо учитывать майнинговые сборы, присущие любой транзакции биткойна. Как пользователь Whirlpool, вам будет необходимо оплатить майнинговые сборы за транзакцию подготовки (`Tx0`), а также за первый coinjoin. Все последующие пересмешивания будут бесплатными благодаря модели Whirlpool, которая основана на оплате новыми участниками.

Действительно, в каждом coinjoin Whirlpool два участника среди входов являются новыми участниками. Остальные входы приходят от пересмешивающих. В результате майнинговые сборы для всех участников транзакции покрываются этими двумя новыми участниками, которые затем также будут иметь право на бесплатные пересмешивания:
![coinjoin](assets/en/6.webp)
Благодаря этой системе сборов Whirlpool действительно отличается от других сервисов coinjoin, поскольку анонимные наборы UTXO не пропорциональны цене, уплаченной пользователем. Таким образом, можно достичь значительно высоких уровней анонимности, заплатив только вступительный сбор пула и майнинговые сборы за две транзакции (за `Tx0` и начальное смешивание).
Важно отметить, что пользователю также придется покрыть комиссии за майнинг, чтобы вывести свои UTXO из пула после завершения нескольких coinjoin, если только он не выбрал опцию `mix to`, о которой мы поговорим в следующем учебном пособии.

### Аккаунты HD кошелька, используемые Whirlpool
Для выполнения coinjoin через Whirlpool, кошелек должен генерировать несколько отдельных аккаунтов. Аккаунт, в контексте HD (*Иерархически Детерминированного*) кошелька, представляет собой секцию, полностью изолированную от других, причем эта изоляция происходит на третьем уровне иерархии кошелька, то есть на уровне `xpub`.

Теоретически HD кошелек может производить до `2^(32/2)` различных аккаунтов. Исходный аккаунт, используемый по умолчанию во всех Bitcoin кошельках, соответствует индексу `0'`.

Для кошельков, адаптированных к Whirlpool, таких как Samourai или Sparrow, используются 4 аккаунта для удовлетворения потребностей процесса coinjoin:
- Аккаунт **депозита**, идентифицируемый индексом `0'`;
- Аккаунт **bad bank** (или "doxxic change"), идентифицируемый индексом `2 147 483 644'`;
- Аккаунт **premix**, идентифицируемый индексом `2 147 483 645'`;
- Аккаунт **postmix**, идентифицируемый индексом `2 147 483 646'`.

Каждый из этих аккаунтов выполняет определенную функцию в процессе coinjoin.

Все эти аккаунты связаны с одним seed, что позволяет пользователю восстановить доступ ко всем своим биткоинам, используя свою фразу восстановления и, при необходимости, свой пароль. Однако, во время этой операции восстановления, необходимо указать программному обеспечению различные индексы аккаунтов, которые использовались.

Теперь давайте рассмотрим различные этапы coinjoin в Whirlpool в рамках этих аккаунтов.

### Различные этапы coinjoin на Whirlpool
**Этап 1: Tx0**
Исходной точкой любого coinjoin в Whirlpool является аккаунт **депозита**. Этот аккаунт автоматически используется, когда вы создаете новый Bitcoin кошелек. На этот аккаунт должны быть зачислены биткоины, которые вы хотите смешать.
`Tx0` представляет собой первый шаг в процессе смешивания Whirlpool. Его цель - подготовить и уравнять UTXO для coinjoin, разделив их на единицы, соответствующие сумме выбранного пула, чтобы обеспечить однородность смешивания. Уравненные UTXO затем отправляются на аккаунт **premix**. Что касается разницы, которая не может войти в пул, она отделяется в специфический аккаунт: **bad bank** (или "doxxic change").
Эта первоначальная транзакция `Tx0` также служит для урегулирования сервисных сборов, причитающихся координатору смешивания. В отличие от последующих шагов, эта транзакция не является совместной; пользователь, следовательно, должен взять на себя все комиссии за майнинг:
![coinjoin](assets/en/7.webp)

В этом примере транзакции `Tx0` вход в размере `372,000 сатоши` с нашего аккаунта **депозита** делится на несколько выходных UTXO, которые распределяются следующим образом:
- Сумма в `5,000 сатоши`, предназначенная для координатора за сервисные сборы, соответствующая входу в пул `100,000 сатоши`;
- Три UTXO, подготовленные для смешивания, перенаправленные на наш аккаунт **premix** и зарегистрированные у координатора. Эти UTXO уравнены по `108,000 сатоши` каждый, чтобы покрыть комиссии за майнинг их будущего первоначального смешивания;
- Излишки, которые не могут попасть в пул, поскольку они слишком малы, считаются токсичной сдачей. Они отправляются на специальный счет. Здесь эта сдача составляет `40 000 сатоши`;
- Наконец, есть `3 000 сатоши`, которые не являются выходом, но являются необходимыми комиссиями за майнинг для подтверждения `Tx0`.

Например, вот реальная транзакция Whirlpool Tx0 (не моя): [edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46](https://mempool.space/en/tx/edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46)

**Шаг 2: Токсичная сдача**
Излишки, которые не могли быть интегрированы в пул, здесь эквивалентные `40 000 сатоши`, перенаправляются на счет **плохого банка**, также называемый "токсичной сдачей", чтобы обеспечить строгое разделение от других UTXO в кошельке.

Этот UTXO опасен для конфиденциальности пользователя, поскольку он не только все еще связан со своим прошлым, и, таким образом, возможно, с идентичностью его владельца, но также отмечен как принадлежащий пользователю, который провел coinjoin.
Если этот UTXO будет объединен с перемешанными выходами, они потеряют всю конфиденциальность, полученную во время циклов coinjoin, особенно из-за эвристики общего владения входом (CIOH). Если он будет объединен с другими токсичными сдачами, пользователь рискует потерять конфиденциальность, поскольку это свяжет различные входы циклов coinjoin. Поэтому с ним нужно обращаться осторожно. Способы управления этим токсичным UTXO будут подробно описаны в последней части этой статьи, а будущие учебные пособия более подробно рассмотрят эти методы на сети PlanB.

**Шаг 3: Первоначальное смешивание**
После завершения `Tx0`, уравненные UTXO отправляются на счет **премикса** нашего кошелька, готовые к введению в их первый цикл coinjoin, также называемый "первоначальным смешиванием". Если, как в нашем примере, `Tx0` генерирует несколько UTXO для смешивания, каждый из них будет интегрирован в отдельный первоначальный coinjoin.

По окончании этих первых смешиваний счет **премикса** будет пуст, в то время как наши монеты, заплатившие комиссии за майнинг за этот первый coinjoin, будут точно скорректированы до суммы, определенной выбранным пулом. В нашем примере, наши первоначальные UTXO в `108 000 сатоши` будут уменьшены ровно до `100 000 сатоши`.
![coinjoin](assets/en/8.webp)
**Шаг 4: Перемикширование**
После первоначального смешивания UTXO переводятся на счет **постмикса**. Этот счет собирает уже перемешанные UTXO и те, которые ожидают перемикширования. Когда клиент Whirlpool активен, UTXO на счете **постмикса** автоматически доступны для перемикширования и будут случайным образом выбраны для участия в этих новых циклах.

Напоминаем, что перемикширования затем проходят абсолютно бесплатно: не требуются никакие дополнительные сервисные сборы или комиссии за майнинг. Сохранение UTXO на счете **постмикса** таким образом сохраняет их ценность неизменной и одновременно улучшает их анонимные наборы. Вот почему важно позволить этим монетам участвовать в нескольких циклах coinjoin. Это ничего вас не стоит, и это увеличивает их уровни анонимности.
Когда вы решаете потратить смешанные UTXO, вы можете сделать это напрямую из этого **постмикс** аккаунта. Рекомендуется хранить смешанные UTXO в этом аккаунте, чтобы воспользоваться бесплатными ремиксами и избежать их выхода из цепочки Whirlpool, что могло бы снизить их конфиденциальность.
Как мы увидим в следующем учебнике, существует также опция `mix to`, которая предлагает возможность автоматически отправлять ваши смешанные монеты в другой кошелек, например, в холодный кошелек, после определенного количества coinjoin.
После изучения теории перейдем к практике с учебником по использованию Whirlpool через приложение Samourai Wallet для Android!
## Учебник: Coinjoin Whirlpool в Samourai Wallet
Существует множество способов использования Whirlpool. Я хочу представить здесь опцию Samourai Wallet (без Dojo), приложение для управления биткойн-кошельком с открытым исходным кодом на Android.

Смешивание в Samourai без Dojo имеет преимущество в том, что оно довольно просто в обращении, быстро настраивается и требует только телефона на Android и подключения к интернету.

Однако у этого метода есть два заметных недостатка:
- Coinjoin будет происходить только тогда, когда Samourai работает в фоновом режиме и подключен. Это означает, что если вы хотите смешивать и ремикшировать свои биткойны 24/7, вы должны постоянно держать Samourai включенным;
- Если вы используете Whirlpool с Samourai Wallet, не позаботившись о подключении собственного Dojo, то вашему приложению придется подключаться к серверу, поддерживаемому командами Samourai, и вы раскроете им `xpub` вашего кошелька. Эти анонимные данные необходимы вашему приложению для поиска ваших транзакций.

Идеальное решение для преодоления этих ограничений - это управление собственным Dojo в сочетании с экземпляром Whirlpool CLI на вашем личном биткойн-ноде. Таким образом, вы избежите утечки информации и достигнете полной независимости. Хотя представленный ниже учебник полезен для определенных целей или для начинающих, для действительной оптимизации вашей сессии coinjoin рекомендуется использовать собственный Dojo. Подробное руководство по настройке этой конфигурации скоро будет доступно на PlanB Network.

### Установка Samourai Wallet
Для начала вам, очевидно, понадобится приложение Samourai Wallet. Вы можете скачать его напрямую с официального сайта, используя APK, с их GitLab или из Google Play Store.

### Создание программного кошелька
После установки программы вам нужно будет приступить к созданию биткойн-кошелька в Samourai. Если у вас уже есть кошелек, вы можете перейти непосредственно к следующему шагу.

При открытии приложения нажмите синюю кнопку `Start`. Затем вас попросят выбрать место в файлах вашего телефона, где будет храниться зашифрованная резервная копия вашего нового кошелька.

![samourai](assets/notext/9.webp)
Активируйте Tor, нажав на соответствующий выключатель. На этом этапе у вас также есть возможность выбрать конкретный Dojo. Однако в этом учебнике мы продолжим с использованием стандартного Dojo; поэтому вы можете оставить эту опцию отключенной. Когда Tor подключен, нажмите кнопку `Создать новый кошелек`.
![samourai](assets/notext/10.webp)

Затем Samourai Wallet предложит вам установить пароль BIP39. Этот дополнительный пароль очень важен, так как он напрямую действует на производные ваших приватных ключей. Потеря этого пароля приведет к невозможности доступа к вашим биткойнам, делая их безвозвратно потерянными. Для восстановления вашего кошелька Samourai необходимо иметь как вашу 12-словную фразу восстановления, так и пароль.
Поэтому крайне важно выбрать надежную фразу-пароль и сделать одну или несколько физических копий на бумаге или на металлическом носителе, чтобы обеспечить безопасность ваших биткойнов. После выполнения этих задач отметьте галочку `Я осознаю, что в случае потери...`, затем нажмите кнопку `ДАЛЕЕ`.
![samourai](assets/notext/11.webp)

Затем вам нужно будет задать PIN-код из 5 до 8 цифр. Этот код будет защищать доступ к вашему кошельку на телефоне. Он будет запрашиваться каждый раз, когда вы захотите открыть приложение Samourai. Выберите надежный PIN-код и обязательно сохраните резервную копию. После этого вы можете нажать кнопку `ДАЛЕЕ`.

![samourai](assets/notext/12.webp)

Samourai предложит вам ввести ваш PIN-код еще раз для подтверждения. Введите его, затем нажмите `ЗАВЕРШИТЬ`.

![samourai](assets/notext/13.webp)

Затем вы получите доступ к вашей фразе восстановления из 12 слов. Эта фраза позволяет восстановить ваш кошелек с ранее введенной фразой-паролем. Настоятельно рекомендуется сделать одну или несколько копий этой фразы на физическом носителе, таком как бумага или металлический материал, чтобы обеспечить безопасность ваших биткойнов в случае возникновения проблем.

После создания этих резервных копий вы будете направлены на интерфейс вашего нового кошелька Samourai.

![samourai](assets/notext/14.webp)

Вам будет предложено получить ваш PayNym Bot. Вы можете запросить его, если хотите, хотя это и не обязательно для нашего учебника.

![samourai](assets/notext/15.webp)
Прежде чем приступить к получению биткойнов на этот новый кошелек, настоятельно рекомендуется повторно проверить валидность резервных копий вашего кошелька (фразы-пароля и фразы восстановления). Чтобы проверить фразу-пароль, вы можете выбрать иконку вашего PayNym Bot, расположенную в верхнем левом углу экрана, затем следовать пути:
```plaintext
Настройки > Устранение неполадок > Тест фразы-пароля/резервной копии
```

Введите вашу фразу-пароль для выполнения проверки.

![samourai](assets/notext/16.webp)

Samourai подтвердит ее валидность.

![samourai](assets/notext/17.webp)

Чтобы проверить вашу резервную копию фразы восстановления, перейдите к иконке вашего PayNym Bot, расположенной в верхнем левом углу экрана, и следуйте этому пути:
```plaintext
Настройки > Кошелек > Показать 12-словную фразу восстановления
```

Samourai отобразит окно с вашей фразой восстановления. Убедитесь, что она точно совпадает с вашей физической резервной копией.

Чтобы пойти дальше и выполнить полное тестирование восстановления, запишите элемент-свидетель вашего кошелька, такой как один из `xpubs`, затем приступите к удалению вашего кошелька (при условии, что он все еще пуст). Цель состоит в том, чтобы попытаться восстановить этот пустой кошелек, используя только ваши физические резервные копии. Если восстановление прошло успешно, это указывает на то, что ваши резервные копии действительны и надежны.

### Получение биткойнов
После создания вашего кошелька вы начнете с одного счета, идентифицируемого индексом `0'`. Это **депозитный** счет, о котором шла речь в предыдущих частях. Именно на этот счет вам нужно будет перевести биткойны, предназначенные для coinjoins.

Для этого нажмите на синий символ `+`, расположенный в нижнем правом углу экрана.

![samourai](assets/notext/18.webp)

Затем нажмите на зеленую кнопку `Получить`.

![samourai](assets/notext/19.webp)

Samourai автоматически сгенерирует новый пустой адрес для получения биткойнов.

![samourai](assets/notext/20.webp)
Вы можете отправить биткойны на смешивание туда.
![samourai](assets/notext/21.webp)

### Создание Tx0
Когда транзакция подтверждена, мы можем начать процесс coinjoin. Для этого нажмите на синюю кнопку `+` в нижнем правом углу экрана.

![samourai](assets/notext/22.webp)

Затем нажмите на `Whirlpool` на синем фоне.

![samourai](assets/notext/23.webp)

Ожидайте, пока Whirlpool инициализируется, и Samourai создаст необходимые аккаунты.

![samourai](assets/notext/24.webp)

Вы попадете на домашнюю страницу Whirlpool. Нажмите на `Start`.
![samourai](assets/notext/25.webp)
Выберите UTXO из аккаунта **депозита**, который вы хотите отправить в циклы coinjoin, затем нажмите на `Next`.

![samourai](assets/notext/26.webp)

На следующем этапе вам нужно будет выбрать уровень комиссии для `Tx0`, а также для вашего первого смешивания. Этот параметр определит скорость подтверждения вашего `Tx0` и вашего первого coinjoin (или первых coinjoins). Имейте в виду, что комиссии за майнинг для `Tx0` и первого смешивания ложатся на вашу ответственность, но за последующие пересмешивания платить не придется. У вас есть выбор между вариантами `Low`, `Normal` или `High`.

![samourai](assets/notext/27.webp)

В том же окне у вас есть возможность выбрать пул, в который вы войдете. Учитывая, что изначально я выбрал UTXO размером `454,258 sats`, мой единственно возможный выбор - пул `100,000 sats`. На этой странице также представлены сервисные сборы пула, помимо комиссий за майнинг, что позволяет вам знать общую стоимость этого цикла coinjoin. Если все вас устраивает, выберите подходящий пул и продолжайте, нажав на синюю кнопку `VERIFY CYCLE DETAILS`.

![samourai](assets/notext/28.webp)

Затем вы можете увидеть все детали вашего цикла coinjoin:
- количество UTXO, которые войдут в пул;
- различные сборы;
- количество доксической сдачи...

Проверьте информацию, затем нажмите на зеленую кнопку `START CYCLE`.

![samourai](assets/notext/29.webp)

Появится окно с предложением пометить токсичную сдачу, полученную в результате вашего входа в цикл coinjoin, как "нерасходуемую". Выбрав `YES`, этот UTXO не будет виден в вашем кошельке и не может быть выбран для будущих транзакций. Однако он останется доступным в списке UTXO в вашем кошельке, где вы можете вручную изменить его статус. Рекомендуется выбрать этот вариант, чтобы избежать любой ошибки обращения, которая может нарушить вашу конфиденциальность в дальнейшем. Если вы выберете `NO`, токсичная сдача останется доступной для использования в вашем кошельке. Если вы хотите узнать больше о управлении и использовании этой токсичной сдачи, советую прочитать последнюю часть этого учебника.

![samourai](assets/notext/30.webp)

Samourai затем транслирует ваш Tx0.

![samourai](assets/notext/31.webp)

### Создание coinjoins
После трансляции Tx0 вы можете найти его на вкладке `Transactions` меню Whirlpool.

![samourai](assets/notext/32.webp)
Ваши UTXO, готовые к смешиванию, находятся на вкладке `Mixing in progress...`, что соответствует аккаунту **Premix**. ![samourai](assets/notext/33.webp)

Как только `Tx0` будет подтверждена, ваши UTXO будут автоматически зарегистрированы у координатора, и начальные смешивания начнутся последовательно автоматическим образом.

![samourai](assets/notext/34.webp)

Проверяя вкладку `Remixing`, соответствующую аккаунту **Postmix**, вы увидите UTXO, полученные в результате начальных смешиваний. Эти монеты останутся готовыми к последующему ремиксингу, который не будет влечь за собой дополнительных сборов. Рекомендую прочитать эту другую статью, чтобы узнать больше о процессе ремиксинга и эффективности цикла coinjoin: [REMIX - WHIRLPOOL](https://planb.network/tutorials/privacy/remix-whirlpool).

![samourai](assets/notext/35.webp)

Временно приостановить ремиксинг UTXO можно, нажав кнопку паузы, расположенную справа от него. Чтобы снова сделать его доступным для ремиксинга, просто нажмите на ту же кнопку второй раз. Важно отметить, что одновременно можно выполнить только один coinjoin на пользователя и на пул. Таким образом, если у вас есть 6 UTXO по `100 000 sats`, готовых к смешиванию, смешиваться может только один из них. После смешивания UTXO кошелек Samourai случайным образом выбирает новый UTXO из ваших доступных, чтобы диверсифицировать и сбалансировать ремиксинг каждой монеты.

![samourai](assets/notext/36.webp)

Для обеспечения непрерывной доступности ваших UTXO для ремиксинга необходимо держать приложение Samourai активным в фоновом режиме. Вы должны увидеть уведомление на вашем телефоне, подтверждающее, что Whirlpool работает. Закрытие приложения или выключение телефона приостановит coinjoins.

### Завершение coinjoins
Чтобы потратить ваши смешанные биткоины, перейдите в аккаунт **Postmix**, отмеченный как `Remixing` во вкладках меню Whirlpool.

![samourai](assets/notext/37.webp)

Нажмите на синий логотип Whirlpool, расположенный в нижнем правом углу.

![samourai](assets/notext/38.webp)

Затем нажмите на `Spend Mixed UTXOs`.

![samourai](assets/notext/39.webp)

Далее вы можете ввести адрес получателя и сумму к отправке так же, как и для любой другой транзакции, совершаемой с помощью кошелька Samourai. Синий фон указывает на то, что средства тратятся с аккаунта Whirlpool, а не с **депозитного** аккаунта.

![samourai](assets/notext/40.webp)

Нажав на 3 маленькие точки в верхнем правом углу, вы можете выбрать конкретные UTXO.
![samourai](assets/notext/41.webp)
Нажав на белый квадрат в верхнем правом углу окна, вы можете отсканировать QR-код адреса получателя с помощью камеры.

![samourai](assets/notext/42.webp)

Введите необходимую информацию для вашей транзакции расходования, затем нажмите на синюю кнопку `VERIFY TRANSACTION`.

![samourai](assets/notext/43.webp)
На следующем шаге у вас будет возможность изменить ставку комиссии, связанную с вашей транзакцией. Вы также можете активировать опцию Stonewall, отметив соответствующий пункт. Если опция Stonewall не доступна для выбора, это означает, что ваш аккаунт **Postmix** не содержит UTXO достаточного размера для поддержки этой конкретной структуры транзакции.
[-> Узнать больше о транзакциях Stonewall.](https://planb.network/tutorials/privacy/stonewall)

Если все устраивает, нажмите на зеленую кнопку `SEND ... BTC`.

![samourai](assets/notext/44.webp)

Затем Samourai приступит к подписанию вашей транзакции перед ее трансляцией в сеть. Вам просто нужно дождаться, пока она будет добавлена в блок майнером.

![samourai](assets/notext/45.webp)

### Использование SCODE
Иногда команда Samourai Wallet предлагает "SCODEs". SCODE - это промокод, который предоставляет скидку на сервисные сборы пула. Samourai Wallet время от времени предлагает такие коды своим пользователям во время специальных мероприятий. Я советую вам [следить за Samourai Wallet](https://twitter.com/SamouraiWallet) в социальных сетях, чтобы не пропустить будущие SCODES.

Чтобы применить SCODE в Samourai, перед началом нового цикла coinjoin перейдите в меню Whirlpool и выберите три маленькие точки, расположенные в верхнем правом углу экрана.

![samourai](assets/notext/46.webp)

Нажмите на `SCODE (промокод) Whirlpool`.

![samourai](assets/notext/47.webp)

Введите SCODE в открывшееся окно, затем подтвердите, нажав на `OK`.

![samourai](assets/notext/48.webp)

Whirlpool автоматически закроется. Дождитесь завершения загрузки Samourai, затем снова откройте меню Whirlpool.

![samourai](assets/notext/49.webp)

Убедитесь, что ваш SCODE был правильно зарегистрирован, еще раз нажав на три маленькие точки, затем выбрав `SCODE (промокод) Whirlpool`. Если все в порядке, вы готовы начать новый цикл Whirlpool со скидкой на сервисные сборы. Важно отметить, что эти SCODE временные: они остаются действительными несколько дней, прежде чем становятся устаревшими.

## Как узнать качество наших циклов coinjoin?
Для того чтобы coinjoin был действительно эффективным, крайне важно, чтобы он демонстрировал хорошую однородность между суммами входов и выходов. Эта однородность увеличивает количество возможных интерпретаций в глазах внешнего наблюдателя, тем самым повышая неопределенность, окружающую транзакцию. Для количественной оценки этой неопределенности, создаваемой coinjoin, можно воспользоваться расчетом энтропии транзакции. Для глубокого изучения этих показателей я отсылаю вас к учебнику: [BOLTZMANN CALCULATOR](https://planb.network/en/tutorials/privacy/boltzmann-entropy). Модель Whirlpool признана той, которая приносит наибольшую однородность в coinjoins.
Далее оценивается производительность нескольких циклов CoinJoin на основе степени группировки, в которой скрывается монета. Размер этих групп определяет то, что называется анонимными наборами (anonsets). Существует два типа анонимных наборов: первый оценивает полученную конфиденциальность против ретроспективного анализа (от настоящего к прошлому) и второй, против перспективного анализа (от прошлого к настоящему). Для подробного объяснения этих двух показателей, приглашаю вас ознакомиться с учебным пособием: [WHIRLPOOL STATS TOOLS - ANONSETS](https://planb.network/tutorials/privacy/wst-anonsets).

## Как управлять постмиксом?
После выполнения циклов CoinJoin лучшая стратегия - сохранять ваши UTXO на счету **постмикса**, ожидая их будущего использования. Даже рекомендуется дать им перемешиваться бесконечно, пока вам не потребуется их потратить.

Некоторые пользователи могут рассмотреть возможность перевода своих перемешанных биткоинов в кошелек, защищенный аппаратным кошельком. Это возможно, но важно строго следовать рекомендациям кошелька Samourai, чтобы не нарушить достигнутую конфиденциальность.

Слияние UTXO является наиболее часто допускаемой ошибкой. Необходимо избегать объединения перемешанных UTXO с неперемешанными UTXO в одной транзакции, чтобы избежать CIOH (*Common-Input-Ownership-Heuristic*). Это требует тщательного управления вашими UTXO в кошельке, особенно с точки зрения маркировки. Помимо CoinJoin, слияние UTXO обычно является плохой практикой, которая часто приводит к потере конфиденциальности, если она не управляется должным образом.
Также следует быть внимательным к консолидации перемешанных UTXO между собой. Умеренные консолидации возможны, если ваши перемешанные UTXO имеют значительные анонимные наборы, но это неизбежно уменьшит конфиденциальность ваших монет. Убедитесь, что консолидации не слишком велики и не проводятся после недостаточного количества перемешиваний, так как это рискует установить выведенные связи между вашими UTXO до и после циклов CoinJoin. В случае сомнений по поводу этих операций, лучшей практикой является не консолидировать постмикс UTXO и переводить их по одному в ваш аппаратный кошелек, генерируя новый пустой адрес каждый раз. Еще раз, не забудьте правильно маркировать каждый полученный UTXO.

Также не рекомендуется переводить ваши постмикс UTXO в кошелек, использующий необычные скрипты. Например, если вы входите в Whirlpool с мультисиг-кошелька, использующего скрипты `P2WSH`, маловероятно, что вы будете перемешаны с другими пользователями, имеющими изначально такой же тип кошелька. Если вы выходите из постмикса в этот же мультисиг-кошелек, уровень конфиденциальности ваших перемешанных биткоинов будет значительно снижен. Помимо скриптов, существует множество других отпечатков кошельков, которые могут вас запутать.

Как и в случае любой биткоин-транзакции, также уместно не повторно использовать адреса получения. Каждая новая транзакция должна быть получена на новом пустом адресе.

Простейшим и самым безопасным решением является оставить ваши перемешанные UTXO на их счету **постмикса**, позволяя им перемешиваться и трогая их только для траты. Кошельки Samourai и Sparrow имеют дополнительные защиты от всех этих рисков, связанных с анализом цепочек. Эти защиты помогают вам избежать ошибок.

## Как управлять токсичной сдачей?
Далее, вам необходимо быть осторожным в управлении токсичной сдачей, сдачей, которая не могла войти в пул CoinJoin. Эти токсичные UTXO, полученные в результате использования Whirlpool, представляют риск для вашей конфиденциальности, поскольку устанавливают связь между вами и использованием CoinJoin. Поэтому крайне важно обращаться с ними осторожно и не комбинировать их с другими UTXO, особенно с перемешанными. Вот различные стратегии, которые следует рассмотреть для их использования:
- **Смешивайте их в меньших пулах:** Если ваш токсичный UTXO достаточно велик, чтобы войти в меньший пул самостоятельно, рассмотрите возможность его смешивания. Это часто является лучшим вариантом. Однако крайне важно не объединять несколько токсичных UTXO для доступа к пулу, так как это может связать ваши различные записи.
- **Отметьте их как "нерасходуемые":** Другой подход заключается в том, чтобы перестать их использовать, отметить как "нерасходуемые" в их специализированном аккаунте и просто Hodl. Это гарантирует, что вы случайно не потратите их. Если стоимость биткоина увеличится, могут появиться новые пулы, более подходящие для ваших токсичных UTXO.
- **Сделайте пожертвования:** Рассмотрите возможность сделать пожертвования, даже скромные, разработчикам, работающим над Биткоином и его сопутствующим программным обеспечением. Вы также можете пожертвовать организациям, принимающим BTC. Если управление вашими токсичными UTXO кажется слишком сложным, вы можете просто избавиться от них, сделав пожертвование.
- **Покупайте подарочные карты:** Платформы, такие как [Bitrefill](https://www.bitrefill.com/), позволяют обменивать биткоины на подарочные карты, которые можно использовать в различных магазинах. Это может быть способ избавиться от ваших токсичных UTXO без потери связанной с ними стоимости.
- **Консолидируйте их на Monero:** Samourai Wallet теперь предлагает сервис атомарного свопа между BTC и XMR. Это идеально для управления токсичными UTXO, консолидируя их на Monero, не подвергая вашу конфиденциальность риску через KYC, перед отправкой их обратно в Биткоин. Однако этот вариант может быть дорогостоящим с точки зрения комиссий за майнинг и премии из-за ограничений ликвидности.
- **Отправьте их в Lightning Network:** Перевод этих UTXO в Lightning Network для получения преимущества сниженных комиссий за транзакции является вариантом, который может быть интересным. Однако этот метод может раскрыть определенную информацию в зависимости от вашего использования Lightning и поэтому должен практиковаться с осторожностью.

Подробные учебные пособия по реализации этих различных техник будут предложены в ближайшее время на PlanB Network.

**Дополнительные ресурсы:**
- [Видеоурок Samourai Wallet](https://planb.network/tutorials/wallet/samourai);
- [Документация Samourai Wallet - Whirlpool](https://docs.samourai.io/whirlpool/basic-concepts);
- [Твиттер-тред о coinjoins](https://twitter.com/SamouraiWallet/status/1489220847336308739);
- [Блог-пост о coinjoins](https://www.pandul.fr/post/comprendre-et-utiliser-le-coinjoin-sur-bitcoin).