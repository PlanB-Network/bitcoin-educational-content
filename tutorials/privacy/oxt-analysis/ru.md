---
name: OXT - Анализ Цепочки
description: Освойте основы анализа цепочки на Bitcoin
---
![обложка](assets/cover.webp)

***ВНИМАНИЕ:** После ареста основателей кошелька Samourai и изъятия их серверов 24 апреля, **веб-сайт OXT.me в настоящее время недоступен**. Тем не менее, существует вероятность, что этот инструмент может быть перезапущен в ближайшие недели. Тем временем вы все еще можете извлечь пользу из этого учебного пособия, чтобы понять основы анализа цепочки на Bitcoin. Все эвристики и шаблоны, представленные здесь, остаются применимыми к транзакциям Bitcoin. Хотя эти инструменты менее оптимизированы, чем OXT, вы можете временно использовать [Mempool.space](https://mempool.space/) или [Bitcoin Explorer](https://bitcoinexplorer.org/), чтобы применить теоретические концепции этой статьи на практике.*

_Мы внимательно следим за развитием этого дела, а также за развитием связанных с ним инструментов. Будьте уверены, что мы обновим это руководство, как только появится новая информация._

_Это руководство предоставляется исключительно в образовательных и информационных целях. Мы не поддерживаем и не поощряем использование этих инструментов в преступных целях. Каждый пользователь несет ответственность за соблюдение законов в своей юрисдикции._

---

В этой статье вы узнаете основные теоретические основы, необходимые для начала базового анализа цепочек на Bitcoin, и, что более важно, для понимания того, как действуют наблюдающие за вами. Хотя эта статья не является практическим руководством по инструменту OXT (тема, которую мы рассмотрим в будущем учебном пособии), она собирает в себе набор критически важных знаний для его использования. Для каждой представленной модели, метрики и индикатора предоставлена ссылка на пример транзакции на OXT, что позволит вам лучше понять его использование и практиковаться во время чтения.

## Введение
Одна из функций денег - решение проблемы двойного совпадения желаний. В системе, основанной на бартере, для завершения обмена требуется не только найти человека, предлагающего товар, который удовлетворяет мои потребности, но и предоставить ему товар эквивалентной стоимости, который удовлетворяет его собственные потребности. Найти этот баланс оказывается сложным. Вот почему мы прибегаем к деньгам, которые позволяют нам перемещать ценность как в пространстве, так и во времени.

Для того чтобы деньги решали эту проблему, существенно, чтобы сторона, предоставляющая товар или услугу, была убеждена в своей способности потратить эту сумму позже. Таким образом, любой рациональный индивид, желающий принять деньги, будь то цифровые или физические, убедится, что они соответствуют двум фундаментальным критериям:
- Монета должна быть целой и подлинной;
- и она не должна быть потрачена дважды.

Если мы используем физические деньги, то первая характеристика является наиболее сложной для подтверждения. В разные периоды истории целостность металлических монет часто нарушалась практиками, такими как обрезание или сверление. Например, в древнем Риме было обычным делом для граждан соскабливать края золотых монет, чтобы собрать немного драгоценного металла, при этом сохраняя их для будущих транзакций. Именно поэтому позже на края монет стали наносить рифление. Подлинность также является сложной характеристикой для проверки на физическом денежном средстве. В наши дни техники борьбы с подделками становятся всё более сложными, вынуждая торговцев инвестировать в дорогостоящие системы верификации.

С другой стороны, из-за их природы, двойное расходование не является проблемой для физических валют. Если я даю вам купюру в 10 евро, она безвозвратно покидает мое владение, чтобы войти в ваше, тем самым исключая любую возможность многократного расходования денежных единиц, которые она представляет.
Для цифровой валюты вызовы отличаются. Обеспечение подлинности и целостности монеты часто бывает проще, но гарантировать отсутствие двойных трат значительно сложнее. Каждый цифровой товар по сути является информацией. В отличие от физических товаров, информация не делится во время обмена, а распространяется путем умножения. Например, если я отправлю вам документ по электронной почте, он затем будет дублирован. С вашей стороны, вы не можете с уверенностью проверить, что я удалил оригинальный документ.

Единственный способ избежать этого дублирования цифрового товара - быть в курсе всех обменов в системе. Таким образом, можно знать, кто что владеет и обновлять счета всех участников на основе совершенных транзакций. Это то, что делается, например, с книжными деньгами. Когда вы платите 10 евро продавцу кредитной картой, банк отмечает этот обмен и обновляет регистр.

На Bitcoin предотвращение двойных трат происходит таким же образом. Задача состоит в том, чтобы подтвердить отсутствие транзакции, которая уже потратила вопросные монеты. Если эти монеты никогда не использовались, тогда мы можем быть уверены, что двойных трат не произойдет. Это знаменитая фраза от Сатоши Накамото в Белой книге: "*Единственный способ подтвердить отсутствие транзакции - быть в курсе всех транзакций.*"

В отличие от банковской модели, на Bitcoin мы не хотим доверять центральному органу. Поэтому все пользователи должны иметь возможность подтвердить это отсутствие двойных трат, не полагаясь на третью сторону. Таким образом, каждый должен быть осведомлен о всех транзакциях Bitcoin.

Именно это публичное распространение информации усложняет защиту конфиденциальности на Bitcoin. В традиционной банковской системе, в теории, только финансовое учреждение знает о совершенных транзакциях. Однако, на Bitcoin, все пользователи информированы о всех транзакциях через свои соответствующие узлы.

Из-за этого ограничения на распространение, модель конфиденциальности Bitcoin отличается от той, что используется в банковской системе. В последней транзакции ассоциируются с идентичностью пользователя, но поток информации перекрывается между доверенной третьей стороной и публикой. Другими словами, ваш банкир знает, что вы покупаете свою багету каждое утро в местной пекарне, но ваш сосед не осведомлен о всех этих транзакциях. В случае с Bitcoin, поскольку поток информации не может быть прерван между транзакциями и общественным доменом, модель конфиденциальности опирается на разделение идентичности пользователя от самих транзакций.
![анализ](assets/en/1.webp)
*Диаграмма, вдохновленная Сатоши Накамото в Белой книге: Bitcoin: A Peer-to-Peer Electronic Cash System, раздел 10 "Конфиденциальность".*
Поскольку транзакции Bitcoin становятся публичными, становится возможным установить связи между ними для выведения информации о участвующих сторонах. Эта деятельность даже составляет специализацию сама по себе, обычно называемую "анализ цепочки". В этой статье я приглашаю вас исследовать основы анализа цепочки, чтобы понять, как отслеживаются ваши биткойны.

Большинство компаний, специализирующихся на анализе цепочки, работают как черные ящики и не раскрывают свои методологии. Поэтому трудно получить информацию об этой практике. Для написания этой статьи я в основном опирался на несколько открытых ресурсов:
- Основная часть моей статьи взята из серии из четырех статей под названием: [Понимание конфиденциальности Bitcoin с OXT](https://medium.com/oxt-research/understanding-bitcoin-privacy-with-oxt-part-1-4-8177a40a5923), произведенной Samourai Wallet в 2021 году;
- Я также использовал различные отчеты от [OXT Research](https://medium.com/oxt-research), а также их бесплатный инструмент анализа цепочки.
- В более широком смысле, мои знания происходят из различных твитов и контента от [@LaurentMT](https://twitter.com/LaurentMT) и [@ErgoBTC](https://twitter.com/ErgoBTC);
- Меня также вдохновил [Space Kek #19](https://podcasters.spotify.com/pod/show/decouvrebitcoin/episodes/SpaceKek-19---Analyse-de-chane--anonsets-et-entropie-e1vfuji), в котором я участвовал вместе с [@louneskmt](https://twitter.com/louneskmt), [@TheoPantamis](https://twitter.com/TheoPantamis), [@Sosthene___](https://twitter.com/Sosthene___) и [@LaurentMT](https://twitter.com/LaurentMT).

Я хотел бы поблагодарить их авторов, разработчиков и продюсеров. Без их разнообразного контента и программного обеспечения эта статья бы не существовала. Также благодарю рецензентов, которые тщательно исправили этот текст и одарили меня своим экспертным советом:
- [Gilles Cadignan](https://twitter.com/gillesCadignan);
- [Ludovic Lars](https://twitter.com/lugaxker) ([https://viresinnumeris.fr/](https://viresinnumeris.fr/)).

*Для вашей информации, я добавил в конец статьи технический мини-глоссарий для определения некоторых терминов. Если вы видите слово, которое не понимаете со звездочкой, его определение находится внизу страницы.*

## Что такое анализ цепочек?
Анализ цепочек - это практика, которая охватывает все методы отслеживания потоков Bitcoin в блокчейне. В общем, анализ цепочек основывается на наблюдении за характеристиками в выборках предыдущих транзакций. Затем он включает в себя идентификацию этих же характеристик в транзакции, которую хочется проанализировать, и выведение вероятных интерпретаций. Этот метод решения проблем, основанный на практическом подходе к нахождению достаточно хорошего решения, называется эвристикой.

Упрощенно, анализ цепочек выполняется в два основных этапа:
1. Идентификация известных характеристик;
2. Выведение гипотез.

Одна из целей анализа цепочек - сгруппировать различные активности в Bitcoin для определения уникальности пользователя, который их выполнял. Впоследствии будет возможно попытаться связать этот пучок активностей с реальной идентичностью.

Вспомните мое введение. Я объяснил, почему первоначальная модель конфиденциальности Bitcoin опиралась на разделение идентичности пользователя от его транзакций. Поэтому можно было бы подумать, что анализ цепочек не нужен, поскольку даже если удается сгруппировать активности в цепочке, их нельзя связать с реальной идентичностью. Теоретически это утверждение верно. Криптографические пары ключей используются для установления условий на UTXO. По сути, эти пары ключей не раскрывают никакой информации об идентичности их владельцев. Таким образом, даже если удается сгруппировать активности, связанные с разными парами ключей, это не говорит нам ничего о сущности за этими активностями.
Однако практическая реальность гораздо сложнее. Существует множество поведений, которые рискуют связать реальную личность с активностью в блокчейне. В анализе это называется точкой входа, и таких точек много. Самая распространенная, конечно, это KYC (Know Your Customer, Знай своего клиента). Если вы выводите свои биткоины с регулируемой платформы на один из своих личных адресов получения, то некоторые люди могут связать вашу личность с этим адресом. В более широком смысле, точкой входа может быть любая форма взаимодействия между вашей реальной жизнью и транзакцией Bitcoin. Например, если вы публикуете адрес получения в своих социальных сетях, это может стать точкой входа для анализа. Если вы совершаете платеж в биткоинах своему пекарю, он может связать ваше лицо (которое является частью вашей личности) с адресом Bitcoin. Эти точки входа почти неизбежны при использовании Bitcoin. Хотя можно стремиться ограничить их масштаб, они останутся присутствовать. Вот почему крайне важно сочетать методы, направленные на сохранение вашей конфиденциальности. Хотя поддержание приемлемого разделения между вашей реальной личностью и вашими транзакциями является похвальным подходом, это остается недостаточным. Действительно, если все ваши активности в блокчейне могут быть сгруппированы вместе, то даже самая маленькая точка входа может нарушить единственный слой конфиденциальности, который вы установили.

Поэтому также необходимо заниматься анализом цепочек в нашем использовании Bitcoin. Делая это, мы можем минимизировать агрегацию наших активностей и ограничить влияние точки входа на нашу конфиденциальность. В частности, чтобы лучше противостоять анализу цепочек, какой подход может быть лучше, чем ознакомиться с методами, используемыми в анализе цепочек? Если вы хотите знать, как улучшить свою конфиденциальность в Bitcoin, вы должны понимать эти методы. Это позволит вам лучше освоить техники, такие как [Coinjoin](https://planb.network/en/tutorials/privacy/coinjoin-samourai-wallet) или [Payjoin](https://planb.network/en/tutorials/privacy/payjoin), и сократить ошибки, которые вы могли бы совершить.

В этом мы можем провести аналогию с криптографией и криптоанализом. Хороший криптограф прежде всего хороший криптоаналитик. Чтобы представить новый алгоритм шифрования, необходимо знать, с какими атаками он столкнется, а также изучить, почему предыдущие алгоритмы были взломаны. Тот же принцип применим к конфиденциальности в Bitcoin. Понимание методов анализа цепочек является ключом к защите от него. Вот почему я предлагаю вам эту статью.

Крайне важно понимать, что анализ цепочек не является точной наукой. Он опирается на эвристики, производные от предыдущих наблюдений или логических интерпретаций. Эти правила позволяют получать довольно надежные результаты, но никогда с абсолютной точностью. Другими словами, анализ цепочек всегда включает в себя измерение вероятности в выводах. Мы можем оценить с большей или меньшей уверенностью, что два адреса принадлежат одной и той же сущности, но полная уверенность всегда будет недостижима.

Основная цель анализа цепочек заключается именно в агрегации различных эвристик для минимизации риска ошибки. Это, в некотором роде, накопление доказательств, которое позволяет нам приблизиться к реальности.

Эти знаменитые эвристики могут быть сгруппированы в разные категории, которые мы подробно рассмотрим вместе:
- Паттерны транзакций (или модели транзакций);
- Внутренние эвристики к транзакции;
- Внешние эвристики к транзакции.

Стоит отметить, что первые две эвристики на Bitcoin были сформулированы самим Сатоши Накамото. Он обсуждает их в части 10 Белой книги. Как мы увидим позже, интересно наблюдать, что эти две эвристики до сих пор сохраняют преимущество в анализе цепочек сегодня. Это:
- эвристика общего владения входом (CIOH);
- и повторное использование адреса.
Давайте вместе исследовать наблюдаемые характеристики и интерпретации, которые можно сделать для проведения анализа.
## Паттерны транзакций (или модели транзакций)
Паттерн транзакции - это просто типичная модель транзакции, которую можно найти в блокчейне, и чья интерпретация вероятно известна. Изучая паттерны, мы сосредоточимся на одной транзакции, которую мы проанализируем на высоком уровне. Другими словами, мы будем смотреть только на количество входов и выходов, не углубляясь в более специфические детали или ее окружение. Исходя из наблюдаемой модели, мы сможем интерпретировать природу транзакции. Затем мы будем искать характеристики ее структуры и делать выводы.

### Простая отправка (или простой платеж)
Эта модель характеризуется использованием одного или нескольких UTXO в качестве входа и созданием двух UTXO в качестве выхода.

![анализ](assets/en/2.webp)

Интерпретация этой модели заключается в том, что мы имеем дело с транзакцией отправки или платежа. Пользователь использовал свои собственные UTXO в качестве входа, чтобы удовлетворить на выходе платежный UTXO и UTXO сдачи (сдача возвращается тому же пользователю). Следовательно, мы знаем, что наблюдаемый пользователь, вероятно, больше не владеет одним из двух UTXO на выходе (платежным), но все еще владеет другим UTXO (сдачей).

На данном этапе нам невозможно указать, какой выход представляет какой UTXO, поскольку это не является целью этой модели. Мы сможем сделать это, опираясь на эвристики, которые мы изучим в следующей части. На данном этапе наша цель ограничивается идентификацией природы рассматриваемой транзакции, которая в данном случае является простой отправкой.

Например, вот транзакция Bitcoin, которая следует паттерну простой отправки:
### Свип ("sweep" по-английски)
Эта модель характеризуется использованием одного UTXO в качестве входа и созданием одного UTXO в качестве выхода.

![анализ](assets/en/3.webp)

Интерпретация этой модели заключается в том, что мы имеем дело с самопереводом. Пользователь перевел свои биткоины самому себе на другой адрес, который он контролирует. Действительно, поскольку в транзакции нет сдачи, очень маловероятно, что мы имеем дело с платежом. Тогда мы знаем, что наблюдаемый пользователь, вероятно, все еще владеет этим UTXO.

Например, вот транзакция Bitcoin, которая следует паттерну свипа:
[35f1072a0fda5ae106efb4fda871ab40e1f8023c6c47f396441ad4b995ea693d](https://mempool.space/tx/35f1072a0fda5ae106efb4fda871ab40e1f8023c6c47f396441ad4b995ea693d)

Однако этот тип паттерна также может выявить самоперевод на счет биржи (платформы обмена криптовалютами). Изучение известных адресов и контекст транзакции позволит нам узнать, является ли это свипом в кошелек самохранения или выводом на платформу.

### Консолидация
Эта модель характеризуется использованием нескольких UTXO в качестве входа и созданием одного UTXO в качестве выхода.

![анализ](assets/en/4.webp)
Интерпретация этой модели заключается в том, что мы находимся в присутствии консолидации. Это общая практика среди пользователей Bitcoin, цель которой - объединить несколько UTXO в предвидении возможного увеличения комиссий за транзакции. Выполняя эту операцию в период, когда комиссии низкие, можно сэкономить на будущих комиссиях.
Мы можем сделать вывод, что пользователь, стоящий за этой транзакцией, вероятно, владел всеми UTXO на входе и по-прежнему владеет UTXO на выходе. Следовательно, это определенно самоперевод.

Так же, как и операция "sweep", этот тип шаблона также может раскрывать самоперевод на счет биржи. Изучение известных адресов и контекст транзакции позволит нам узнать, является ли это консолидацией в кошелек самохранения или выводом на платформу.

Например, вот транзакция Bitcoin, которая принимает шаблон консолидации:
[77c16914211e237a9bd51a7ce0b1a7368631caed515fe51b081d220590589e94](https://mempool.space/tx/77c16914211e237a9bd51a7ce0b1a7368631caed515fe51b081d220590589e94)
### Модель Пакетного Расходования
Эта модель характеризуется использованием нескольких UTXO на входе (часто только одного) и созданием множества UTXO на выходе.

![анализ](assets/en/5.webp)

Интерпретация этой модели заключается в том, что мы находимся в присутствии пакетного расходования. Это практика, которая, вероятно, раскрывает значительную экономическую активность, например, биржу. Пакетное расходование позволяет этим субъектам экономить на комиссиях, объединяя свои расходы в одну транзакцию.

Мы можем сделать вывод, что вход UTXO исходит от компании с значительной экономической активностью, а выходы UTXO будут распределяться. Некоторые принадлежат клиентам компании. Другие могут быть направлены партнерским компаниям. Наконец, определенно будет сдача, которая вернется выпускающей компании.

Например, вот транзакция Bitcoin, которая принимает шаблон пакетного расходования:
[8a7288758b6e5d550897beedd13c70bcbaba8709af01a7dbcc1f574b89176b43](https://mempool.space/tx/8a7288758b6e5d550897beedd13c70bcbaba8709af01a7dbcc1f574b89176b43)

### Транзакции, Специфичные для Протокола
Среди шаблонов транзакций мы также можем идентифицировать модели, которые раскрывают использование конкретного протокола. Например, Whirlpool coinjoins будут иметь легко идентифицируемую структуру, которая позволяет отличать их от других классических транзакций.

![анализ](assets/en/6.webp)

Анализ этого шаблона предполагает, что мы, вероятно, находимся в присутствии коллаборативной транзакции. Также возможно наблюдение coinjoin. Если эта последняя гипотеза окажется точной, то количество выходов может дать нам приблизительную оценку числа участников.

Например, вот транзакция Bitcoin, которая принимает шаблон типа коллаборативной транзакции coinjoin:
[00601af905bede31086d9b1b79ee8399bd60c97e9c5bba197bdebeee028b9bea](https://mempool.space/tx/00601af905bede31086d9b1b79ee8399bd60c97e9c5bba197bdebeee028b9bea)
Существует множество других протоколов, которые имеют свои специфические структуры. Таким образом, мы можем выделить транзакции типа Wabisabi или транзакции Stamps, например.
## Эвристики внутренних транзакций
Внутренняя эвристика - это специфическая характеристика, идентифицированная внутри самой транзакции, без необходимости изучения ее окружения, что позволяет нам делать выводы. В отличие от паттернов, которые сосредоточены на общей структуре транзакции, внутренние эвристики основаны на наборе извлекаемых данных. Это включает в себя:
- Суммы различных UTXO, как входящих, так и исходящих;
- Все, что связано со скриптами: адреса получения, версионирование, locktimes...

В общем, этот тип эвристики позволяет нам идентифицировать сдачу в конкретной транзакции. Сделав это, мы можем затем продолжить отслеживание сущности через множество различных транзакций.

Еще раз напоминаю, что эти эвристики не абсолютно точны. Взятые по отдельности, они позволяют нам идентифицировать только вероятные сценарии. Это накопление нескольких эвристик способствует снижению неопределенности, но никогда полностью ее не устраняет.

### Внутренние сходства
Эта эвристика включает в себя изучение сходств между входами и выходами одной и той же транзакции. Если одна и та же характеристика наблюдается на входах и только на одном из выходов транзакции, то вероятно, что этот выход является сдачей.

Наиболее очевидной характеристикой является повторное использование адреса получения в той же транзакции.

![анализ](assets/en/7.webp)

Эта эвристика оставляет мало места для сомнений. Если их приватный ключ не был скомпрометирован, то один и тот же адрес получения неизбежно выявляет активность одного пользователя. Следующая интерпретация заключается в том, что сдачей транзакции является выход с тем же адресом, что и вход. Это позволяет нам продолжить отслеживание индивидуума с этой сдачи.

Например, вот транзакция, где эту эвристику, вероятно, можно применить:
[54364146665bfc453a55eae4bfb8fdf7c721d02cb96aadc480c8b16bdeb8d6d0](https://mempool.space/tx/54364146665bfc453a55eae4bfb8fdf7c721d02cb96aadc480c8b16bdeb8d6d0)

Эти сходства между входами и выходами не ограничиваются повторным использованием адреса. Любое сходство в использовании скриптов может позволить применить эвристику. Например, иногда можно наблюдать одинаковое версионирование между входом и одним из выходов транзакции.

![анализ](assets/en/8.webp)
На этой диаграмме мы видим, что вход номер 0 разблокирует скрипт P2WPKH (SegWit V0, начинающийся с "bc1q"). Выход номер 0 использует тот же тип скрипта. Однако выход номер 1 использует скрипт P2TR (SegWit V1, начинающийся с "bc1p"). Интерпретация этой характеристики заключается в том, что вероятно, адрес с тем же версионированием, что и вход, является адресом сдачи. Следовательно, он все еще принадлежит тому же пользователю.
Вот транзакция, где эту эвристику, вероятно, можно применить:
[db07516288771ce5d0a06b275962ec4af1b74500739f168e5800cbcb0e9dd578](https://mempool.space/tx/db07516288771ce5d0a06b275962ec4af1b74500739f168e5800cbcb0e9dd578)
В этой транзакции мы видим, что вход номер 0 и выход номер 1 используют скрипты P2WPKH (SegWit V0), в то время как выход номер 0 использует другой тип скрипта, P2PKH (Legacy).
### Платежи Круглыми Суммами
Еще одна внутренняя эвристика, которая может помочь нам определить сдачу, это круглые суммы. Обычно, когда мы имеем дело с простым паттерном платежа (1 вход и 2 выхода), если один из выходов тратит круглую сумму, то он представляет собой платеж.

![анализ](assets/en/9.webp)

Методом исключения, если один выход представляет платеж, другой представляет сдачу. Следовательно, мы можем интерпретировать, что вероятно пользователь на входе все еще владеет выходом, определенным как сдача.

Следует отметить, что эта эвристика не всегда применима, поскольку большинство платежей все еще совершается в единицах фиатной валюты. Действительно, когда торговец во Франции принимает биткойны, обычно они не устанавливают стабильные цены в сатах. Они скорее предпочтут конвертацию между ценой в евро и суммой в биткойнах к оплате. Следовательно, в выходе транзакции не должно быть круглой суммы. Тем не менее, аналитик мог бы попытаться выполнить эту конвертацию, учитывая курс обмена, действующий в момент трансляции транзакции в сеть.

Если однажды биткойн станет предпочтительной единицей учета в наших обменах, эта эвристика может стать еще более полезной для анализа.

Например, вот транзакция, где эта эвристика, вероятно, может быть применена:
### Большой Расход

Когда замечен достаточно большой разрыв между двумя выходами транзакции в простой модели платежа, можно оценить, что больший выход, вероятно, является сдачей.

![анализ](assets/en/10.webp)

Эта эвристика касательно наибольшего выхода, вероятно, является самой неточной из всех. Если она определена сама по себе, она довольно слаба. Однако эту характеристику можно сочетать с другими эвристиками для снижения неопределенности нашей интерпретации.

Например, если мы рассмотрим транзакцию, в которой один из выходов имеет круглую сумму, а другой выход - большую сумму, совместное применение эвристики круглых платежей и касательно наибольшего выхода позволяет нам снизить уровень неопределенности.

Например, вот транзакция, где эта эвристика, вероятно, может быть применена:
[b79d8f8e4756d34bbb26c659ab88314c220834c7a8b781c047a3916b56d14dcf](https://mempool.space/tx/b79d8f8e4756d34bbb26c659ab88314c220834c7a8b781c047a3916b56d14dcf)

## Внешние Эвристики Транзакции
Изучение внешних эвристик - это анализ сходств, паттернов и характеристик определенных элементов, которые не являются неотъемлемой частью самой транзакции. Другими словами, если ранее мы ограничивались использованием элементов, присущих транзакции с помощью внутренних эвристик, теперь мы расширяем наше поле анализа на окружение транзакции благодаря внешним эвристикам.

### Повторное Использование Адреса
Это одна из наиболее известных эвристик среди биткойнеров. Повторное использование адреса позволяет установить связь между различными транзакциями и различными UTXO. Это наблюдается, когда биткойн-адрес получения используется несколько раз.

Интерпретация повторного использования адреса заключается в том, что все UTXO, заблокированные на этом адресе, принадлежат (или принадлежали) одной и той же сущности. Эта эвристика оставляет мало места для неопределенности. Когда она определена, последующая интерпретация имеет большой шанс соответствовать действительности.
Как объясняется во введении, эту эвристику открыл сам Сатоши Накамото. В Белой книге он конкретно упоминает решение, предотвращающее возможность пользователей производить её, которое заключается просто в использовании нового адреса для каждой новой транзакции: "*В качестве дополнительного брандмауэра, для каждой транзакции можно использовать новую пару ключей, чтобы они не были связаны с общим владельцем.*"
Например, вот адрес, используемый повторно в нескольких транзакциях:
[bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0](https://mempool.space/address/bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0)

### Сходство Скриптов и Отпечатков Кошельков
Помимо повторного использования адресов, существует множество других эвристик, которые могут связывать действия с одним кошельком или кластером адресов.

Во-первых, аналитик может использовать сходства в использовании скриптов. Например, определенные меньшинственные скрипты, такие как multisig, могут быть обнаружены проще, чем скрипты SegWit V0. Чем больше группа, в которой мы скрываемся, тем труднее нас обнаружить. Именно поэтому, в протоколе Coinjoin Whirlpool, все участники используют абсолютно одинаковый тип скрипта.

В более широком смысле, аналитик также может сосредоточиться на характерных отпечатках кошелька. Это специфические процессы использования, которые можно было бы идентифицировать для их использования в качестве эвристик трассировки. Другими словами, если наблюдается накопление одних и тех же внутренних характеристик в транзакциях, приписываемых преследуемой сущности, можно попытаться идентифицировать эти же характеристики в других транзакциях.

Например, можно идентифицировать, что преследуемый пользователь систематически отправляет свою сдачу на адреса P2TR* (bc1p…). Если этот процесс повторяется, его можно использовать как эвристику для продолжения нашего анализа. Другие отпечатки также могут быть использованы, такие как порядок UTXO, размещение сдачи в выходах, сигнализация RBF (Replace-by-Fee) или даже номер версии и locktime.
Как указывает [@LaurentMT](https://twitter.com/LaurentMT) в [Space Kek #19](https://podcasters.spotify.com/pod/show/decouvrebitcoin/episodes/SpaceKek-19---Analyse-de-chane--anonsets-et-entropie-e1vfuji) (франкоязычный подкаст), польза от отпечатков кошельков в анализе блокчейна со временем значительно возрастает. Действительно, растущее количество типов скриптов и все более постепенное внедрение этих новых функций программным обеспечением для кошельков усиливают различия. Даже случается, что можно точно идентифицировать программное обеспечение, используемое преследуемой сущностью. Поэтому важно понимать, что изучение отпечатка кошелька особенно актуально для недавних транзакций, более чем для тех, которые были инициированы в начале 2010-х.
Подводя итог, отпечаток может быть любой конкретной практикой, выполняемой автоматически кошельком или вручную пользователем, которая может быть найдена в других транзакциях для помощи в нашем анализе.

### CIOH
CIOH, или "Common Input Ownership Heuristic," что можно перевести как "эвристика общего владения входами" или "эвристика совместного использования", это эвристика, утверждающая, что когда транзакция имеет несколько входов, они, скорее всего, все принадлежат одной сущности. Следовательно, их владение общее.
Для применения CIOH (Common Input Ownership Heuristic - Эвристика общего владения входами) сначала наблюдают за транзакцией, имеющей несколько входов. Это может быть два входа, так и тридцать входов. Как только эта характеристика обнаружена, проверяют, не соответствует ли транзакция известному шаблону. Например, если у неё 5 входов с примерно одинаковым количеством и 5 выходов с точно таким же количеством, мы знаем, что это структура Coinjoin Whirlpool. Следовательно, CIOH не может быть применена.

Однако, если транзакция не соответствует никакому известному шаблону совместной транзакции, то можно интерпретировать, что все входы, скорее всего, принадлежат одному и тому же субъекту. Это может быть очень полезно для расширения уже известного кластера или для продолжения отслеживания.

![анализ](assets/en/11.webp)

CIOH была открыта Сатоши Накамото. Он обсуждает это в части 10 Белой книги: "*[...] связь неизбежна с транзакциями с несколькими входами, которые необходимо показывают, что их входы принадлежали одному и тому же владельцу. Риск заключается в том, что если владелец ключа будет раскрыт, связи могут раскрыть другие транзакции, принадлежащие тому же владельцу.*"
Особенно удивительно отметить, что Сатоши Накамото, даже до официального запуска Bitcoin, уже определил две основные уязвимости конфиденциальности для пользователей, а именно CIOH и повторное использование адресов. Такое предвидение действительно замечательно, поскольку эти две эвристики остаются, даже сегодня, наиболее полезными в анализе цепочек.

### Данные вне цепочки
Очевидно, что анализ цепочек не ограничивается только данными в цепочке. Любые данные из предыдущего анализа или доступные в Интернете также могут быть использованы для уточнения анализа.

Например, если наблюдается, что отслеживаемые транзакции систематически транслируются с одного и того же узла Bitcoin и его IP-адрес может быть идентифицирован, возможно, можно будет выявить другие транзакции от того же субъекта.

Аналитик также имеет возможность опираться на анализы, ранее сделанные открытыми, или на свои собственные предыдущие анализы. Возможно, можно будет найти выход, который указывает на кластер адресов, который уже был идентифицирован. Иногда также возможно опираться на выходы, указывающие на биржу, адреса этих платформ обычно известны.

Аналогично, можно провести анализ методом исключения. Например, если во время анализа транзакции с двумя выходами один из них связан с известным, но отличным кластером адресов от отслеживаемого субъекта, то можно интерпретировать, что другой выход, скорее всего, представляет собой сдачу.

Анализ цепочек также включает часть OSINT (Open Source Intelligence - разведка на основе открытых источников), которая немного более общего характера с поиском в интернете. Поэтому не рекомендуется публиковать адреса для получения напрямую в социальных сетях или на веб-сайте, будь то под псевдонимом или нет.

### Временные модели
Может быть не сразу очевидно, но некоторые человеческие поведения узнаваемы в цепочке. Наиболее полезным в исследовании является ваш режим сна! Да, когда вы спите, вы, предположительно, не транслируете транзакции Bitcoin. Поскольку вы обычно спите примерно в одно и то же время, временные анализы часто используются в анализе цепочек. Это просто включает в себя запись времени, в которое транзакции данного субъекта транслируются в сеть Bitcoin. Анализ этих временных шаблонов позволяет нам вывести множество информации.
Прежде всего, временной анализ иногда может идентифицировать природу отслеживаемого субъекта. Если наблюдается, что транзакции транслируются последовательно в течение 24 часов, это может указывать на сильную экономическую активность. Субъект за этими транзакциями, вероятно, является бизнесом, потенциально международным, и, возможно, с автоматизированными процедурами внутри.
Например, я заметил этот паттерн несколько недель назад, анализируя транзакцию, в которой по ошибке было выделено 19 биткоинов в качестве комиссии. Простой временной анализ позволил мне предположить, что мы имеем дело с автоматизированной службой, а следовательно, скорее всего, с крупной сущностью, такой как биржа: https://twitter.com/Loic_Pandul/status/1701127409712452072
Действительно, через несколько дней было обнаружено, что средства принадлежат PayPal через биржу Paxos.

В противоположность, если видно, что временной паттерн распределен в течение 16 конкретных часов, то можно оценить, что мы имеем дело с индивидуальным пользователем или, возможно, с местным бизнесом в зависимости от объемов обмена.

Помимо природы наблюдаемой сущности, временной паттерн также может дать нам приблизительное местоположение пользователя. Таким образом, мы можем коррелировать другие транзакции и использовать временную метку этих транзакций как дополнительную эвристику, которую можно добавить к нашему анализу.

Например, на адресе, который я упоминал ранее и который использовался несколько раз, можно наблюдать, что транзакции, будь то входящие или исходящие, сосредоточены в интервале 13 часов.
![анализ](assets/notext/12.webp)
*Авторство: OXT*

Этот интервал, скорее всего, соответствует Европе, Африке или Ближнему Востоку. Следовательно, можно интерпретировать, что пользователь, стоящий за этими транзакциями, живет там.

В другом регистре, это также временной анализ этого типа, который позволил выдвинуть гипотезу, что Сатоши Накамото не работал из Японии, а на самом деле из Соединенных Штатов: [https://medium.com/@insearchofsatoshi/the-time-zones-of-satoshi-nakamoto-aa40f035178f](https://medium.com/@insearchofsatoshi/the-time-zones-of-satoshi-nakamoto-aa40f035178f)

### Анализ объемов
Другой внешней эвристикой, которую можно использовать, является анализ торговых объемов. Основываясь на суммах, присутствующих в каждой транзакции, приписываемой сущности, эта информация может быть использована как дополнительная эвристика для остального анализа.
Эта эвристика, очевидно, довольно слабая, но она может помочь уменьшить неопределенность, когда добавляется к другим эвристикам.

## Как защитить себя от анализа цепочек?
Как пользователь биткоина, у вас есть право защищать свою конфиденциальность. Это проистекает из ваших естественных прав владеть собой и распоряжаться собой, которые присущи каждому индивидууму, независимо от каких-либо законодательных ограничений.

Это естественное право на защиту своей конфиденциальности также превращается в требуемое право, закрепленное в статье 12 Всеобщей декларации прав человека, гласящей, что "*Никто не должен подвергаться произвольному вмешательству в его личную жизнь, семью, дом или переписку, ни нападкам на его честь и репутацию. Каждый имеет право на защиту закона от такого вмешательства или нападок.*".

Однако основной деятельностью компаний, специализирующихся на анализе цепочек, является именно вторжение в вашу частную сферу, тем самым компрометируя конфиденциальность вашей переписки. Хотя можно было бы надеяться, что в соответствии с упомянутым требуемым правом, государства энергично защитят нашу конфиденциальность, они не только пренебрегают этим, но и существенно финансируют финансирование этих аналитических компаний. Также было бы наивно надеяться на поддержку от отраслевых ассоциаций, которые, кажется, готовы пойти на все уступки перед законодателем.

Де-факто, это требуемое право на конфиденциальность в биткоине не существует. Поэтому вам, пользователю, предстоит заявить о своем естественном праве и защитить конфиденциальность вашей переписки. Это включает в себя применение различных техник и практик использования, которые позволят вам предотвратить или обмануть эвристики, используемые для анализа цепочек.

### Избегание попадания в эвристики
Прежде всего, перед тем как рассматривать более радикальные методы, рекомендуется максимально ограничить наше воздействие на эвристики, используемые для анализа цепочек. Как было упомянуто ранее, две самые мощные эвристики - это повторное использование адресов и COINJOIN.
Основной принцип обеспечения вашей конфиденциальности в Bitcoin заключается в использовании нового, чистого адреса для каждой входящей транзакции на ваш кошелек. Повторное использование адресов действительно является главной угрозой конфиденциальности в Bitcoin.
Для отдельного пользователя создание нового адреса для каждого входящего платежа очень просто. Современные кошельки делают это автоматически, как только вы нажимаете на "Получить". Так что, если вы хоть немного заботитесь о конфиденциальности ваших транзакций, использование свежих адресов является абсолютным минимумом. Если вам когда-либо понадобится статическая точка контакта в интернете, вместо того чтобы указывать адрес для получения, вы можете использовать решения [вроде PayNym, которые реализуют BIP47](https://planb.network/en/tutorials/privacy/paynym-bip47).
Далее, если вы хотите действовать против анализа цепочек, избегайте объединения UTXO на входе транзакции. Как минимум, если вам действительно нужно объединить, предпочитайте UTXO с одинаковым источником. Эта рекомендация подразумевает хорошее управление вашими UTXO. При покупке ваших биткоинов предпочитайте переводы крупных сумм, чтобы максимизировать количество платежей, которые вы можете совершить без необходимости объединения. Я также советую вам маркировать ваши UTXO в вашем программном обеспечении, чтобы идентифицировать их происхождение и избегать объединения из разных источников.

Более широко, для всех других эвристик, вам нужно знать их, чтобы стараться не попадать в них:
- Не используйте меньшинственные скрипты. Предпочитайте SegWit V0 или, возможно, SegWit V1;
- Не делайте платежи круглыми суммами. Например, если вам нужно отправить 100k сатоши другу, отправьте им 114,486 сатоши. Они купят вам напиток в знак благодарности;
- Старайтесь, чтобы ваша сдача не была значительно больше, чем сумма платежа;
- Не публикуйте ваши адреса для получения в социальных сетях;
- Используйте свой собственный узел под Tor для трансляции ваших транзакций;
- Старайтесь не транслировать ваши транзакции Bitcoin всегда в одно и то же время…

### Использование инструментов конфиденциальности
Вы также можете обратиться к методам, которые делают ваше использование Bitcoin неоднозначным, чтобы предотвратить или ввести в заблуждение анализ цепочек.

Самая популярная техника, безусловно, Coinjoin, структура совместной транзакции, которая мобилизует несколько UTXO одинаковых сумм. Здесь цель - разорвать детерминированные связи, тем самым предотвращая анализы от настоящего к прошлому и от прошлого к настоящему. Coinjoin позволяет создать правдоподобное отрицание, скрывая ваши монеты среди большой группы неразличимых монет. Если вы хотите узнать больше о Coinjoin, как с технической, так и с практической стороны, я предлагаю вам прочитать эти другие статьи и учебные пособия:
- [COINJOIN - SAMOURAI WALLET](https://planb.network/en/tutorials/privacy/coinjoin-samourai-wallet);
- [COINJOIN - SPARROW WALLET](https://planb.network/en/tutorials/privacy/coinjoin-sparrow-wallet);
- [WHIRLPOOL STATS TOOLS - ANONSETS](https://planb.network/en/tutorials/privacy/wst-anonsets).
![анализ](assets/en/13.webp)

CoinJoin является отличным инструментом для создания правдоподобного отрицания для монет, но он не оптимизирован для всех потребностей конфиденциальности пользователей. В частности, CoinJoin не был разработан для использования в качестве платежного инструмента. Он очень строг в отношении обмениваемых сумм, чтобы совершенствовать создание правдоподобного отрицания. Поскольку нельзя свободно выбирать сумму выходов транзакции, CoinJoin не может быть использован для совершения платежей в биткоинах.
Например, представьте, что я хочу оплатить свой багет биткоинами, оптимизируя при этом свою конфиденциальность. Учитывая невозможность выбора количества результирующего UTXO из CoinJoin, я оказываюсь не в состоянии подогнать сумму моих расходов под цену, установленную пекарем. Следовательно, CoinJoin оказывается неадекватным для платежных транзакций.

Другие инструменты были разработаны для удовлетворения потребностей в конфиденциальности в более специфических случаях использования. Например, у нас есть [PayJoin](https://planb.network/en/tutorials/privacy/payjoin), своего рода мини-CoinJoin, вовлекающий только двух участников и основанный на структуре, которая позволяет осуществлять платеж.

Уникальность PayJoin заключается в его способности создавать транзакцию, которая выглядит обычной, хотя на самом деле это мини-CoinJoin между двумя пользователями. В этой структуре получатель транзакции участвует среди входов вместе с фактическим отправителем. Таким образом, получатель вставляет в транзакцию платеж самому себе, который облегчает фактический платеж.

Например, если вы покупаете багет у своего пекаря за 6,000 сатоши из UTXO в 10,000 сатоши, и вы хотите совершить PayJoin, ваш пекарь добавит UTXO на 15,000 сатоши, принадлежащее им, в качестве входа в вашу исходную транзакцию, которую они полностью восстановят как выход, чтобы обмануть эвристику:

![анализ](assets/en/14.webp)

Комиссии за транзакцию игнорируются для упрощения понимания схемы.

Цели PayJoin двояки. Во-первых, он направлен на обман внешнего наблюдателя, создавая ложный след через COH. Действительно, когда аналитик наблюдает за этой транзакцией, он думает, что может применить COH, и, таким образом, предполагает общую собственность различных входов. На самом деле это предположение неверно, поскольку один вход принадлежит отправителю, а другой - получателю. Таким образом, PayJoin портит анализ цепочки, вводя аналитика в заблуждение.

Вторая цель PayJoin - обмануть аналитика относительно фактической суммы транзакции благодаря специфической структуре его выходов. Таким образом, PayJoin входит в область стеганографии. Он позволяет скрыть реальную сумму транзакции внутри обманный транзакции.

Действительно, если мы вернемся к нашему примеру использования PayJoin для покупки багета, внешний наблюдатель может подумать, что мы имеем дело с платежом в 4,000 сатоши или 21,000 сатоши. На самом деле платеж за багет составляет 6,000 сатоши: 21,000 - 15,000 = 6,000. Реальная стоимость платежа, таким образом, скрыта внутри фиктивного платежа, который служит ложным следом для анализа цепочки.

Помимо PayJoin и CoinJoin, существует множество других структур транзакций Bitcoin, которые либо блокируют анализ цепочки, либо обманывают его. Среди них я мог бы упомянуть транзакции [Stonewall](https://planb.network/en/tutorials/privacy/stonewall) и [StonewallX2](https://planb.network/en/tutorials/privacy/stonewall-x2), которые позволяют либо совершить гибкий мини Coinjoin, либо имитировать гибкий мини Coinjoin. Также существуют транзакции [Ricochet](https://planb.network/en/tutorials/privacy/ricochet), которые симулируют изменение владельца биткоинов, совершая множество фиктивных переводов самому себе.

Все эти инструменты доступны в Samourai Wallet на мобильных устройствах и Sparrow Wallet на ПК. Если вы хотите узнать больше об этих специфических структурах транзакций, я советую вам ознакомиться с моими учебными пособиями:
- [PAYJOIN](https://planb.network/en/tutorials/privacy/payjoin);
- [PAYJOIN - SAMOURAI КОШЕЛЕК](https://planb.network/en/tutorials/privacy/payjoin-samourai-wallet);
- [PAYJOIN - SPARROW КОШЕЛЕК](https://planb.network/en/tutorials/privacy/payjoin-sparrow-wallet);
- [STONEWALL](https://planb.network/en/tutorials/privacy/stonewall);
- [STONEWALL X2](https://planb.network/en/tutorials/privacy/stonewall-x2);
- [RICOCHET](https://planb.network/en/tutorials/privacy/ricochet).

## Заключение
Анализ цепочек - это практика, которая включает в себя попытки проследить поток биткойнов в блокчейне. Для этого аналитики ищут определенные паттерны и характеристики, чтобы сформулировать более или менее вероятные гипотезы и интерпретации.

Точность этих эвристик варьируется: некоторые предоставляют более высокую степень уверенности, чем другие, но ни одна из них не может считаться непогрешимой. Однако накопление нескольких совпадающих эвристик может смягчить это врожденное сомнение, хотя полностью исключить его невозможно.
Мы можем классифицировать эти методы на три основные категории:
- Паттерны, сосредоточенные на общей структуре каждой транзакции;
- Внутренние эвристики, которые позволяют исчерпывающе рассмотреть все детали транзакции, не распространяясь на ее контекст;
- Внешние эвристики, которые охватывают анализ транзакции в ее окружении, а также любые внешние данные, которые могут предоставить дополнительную информацию.

Для пользователя биткойна крайне важно освоить основные принципы анализа цепочек, чтобы эффективно противостоять ему и таким образом защитить свою конфиденциальность.

## Технический мини-глоссарий:
**P2PKH:** аббревиатура от Pay to Public Key Hash. Это стандартная модель скрипта, используемая для установления условий расходования UTXO. Она позволяет блокировать биткойны на хеше публичного ключа, то есть на адресе получателя. Этот скрипт ассоциируется со стандартом Legacy и был введен в первых версиях Биткойна Сатоши Накамото. В отличие от P2PK, где публичный ключ явно включен в скрипт, P2PKH использует криптографический отпечаток публичного ключа с некоторыми метаданными, также называемыми "адресом получателя". Этот скрипт включает в себя хеш RIPEMD160 от SHA256 публичного ключа и предписывает, что для доступа к средствам получатель должен предоставить публичный ключ, соответствующий этому хешу, а также действительную цифровую подпись, сгенерированную из соответствующего приватного ключа. Адреса P2PKH кодируются с использованием формата Base58Check, который обеспечивает их устойчивость к опечаткам за счет использования контрольной суммы. Эти адреса всегда начинаются с цифры 1.
**P2TR:** аббревиатура от Pay to Taproot ("платеж в корень"). Это стандартная модель скрипта, используемая для установления условий расходования UTXO. P2TR был введен с реализацией Taproot в ноябре 2021 года. Он использует протокол Schnorr для агрегации криптографических ключей, а также деревья Merkle для альтернативных скриптов, известных как MAST (Merkelized Alternative Script Tree). В отличие от традиционных транзакций, где условия расходования публично раскрываются (иногда при получении, иногда при расходовании), P2TR позволяет скрывать сложные скрипты за одним видимым публичным ключом. Технически скрипт P2TR блокирует биткойны на уникальном публичном ключе Schnorr, обозначаемом как K. Однако этот ключ K на самом деле является агрегатом публичного ключа P и публичного ключа M, последний из которых рассчитывается из корня Merkle списка ScriptPubKeys. Агрегация ключей выполняется с использованием протокола подписи Schnorr. Биткойны, заблокированные с помощью скрипта P2TR, могут быть потрачены двумя различными способами: либо путем публикации подписи для публичного ключа P, либо путем выполнения одного из скриптов, содержащихся в дереве Merkle. Первый вариант называется "путь ключа", а второй - "путь скрипта". Таким образом, P2TR позволяет пользователям отправлять биткойны либо на публичный ключ, либо на несколько скриптов по их выбору. Еще одно преимущество этого скрипта заключается в том, что, хотя существует несколько способов потратить выход P2TR, нужно раскрыть только используемый при расходовании, позволяя неиспользованным альтернативам оставаться приватными. Например, благодаря агрегации ключей Schnorr, публичный ключ P сам может быть агрегированным ключом, потенциально представляющим мультисиг. P2TR является выходом SegWit версии 1, что означает, что подписи для входов P2TR хранятся в свидетельстве транзакции, а не в ScriptSig. Адреса P2TR используют кодировку Bech32m и начинаются с bc1p.

**P2WPKH:** Аббревиатура от Pay to Witness Public Key Hash. Это стандартная модель скрипта, используемая для установления условий расходования UTXO. P2WPKH был введен с реализацией SegWit в августе 2017 года. Этот скрипт похож на P2PKH (Pay to Public Key Hash), поскольку он также блокирует биткойны на основе хеша публичного ключа, то есть адреса получателя. Разница заключается в том, как подписи и скрипты включаются в транзакцию. В случае с P2WPKH информация о скрипте подписи (ScriptSig) перемещается из традиционной структуры транзакции в отдельный раздел, называемый Witness. Этот переход является особенностью обновления SegWit (Segregated Witness). Эта техника имеет преимущество в уменьшении размера данных транзакции в основном теле, сохраняя при этом необходимую информацию о скрипте для проверки в отдельном разделе. Следовательно, транзакции P2WPKH обычно менее дорогие с точки зрения комиссий по сравнению с Legacy транзакциями. Адреса P2WPKH записываются с использованием кодировки Bech32, что способствует более краткой и менее подверженной ошибкам записи благодаря контрольной сумме BCH. Эти адреса всегда начинаются с bc1q, что делает их легко отличимыми от Legacy адресов получения. P2WPKH является выходом SegWit версии 0.
**UTXO:** Акроним для Непотраченного Выхода Транзакции. UTXO - это выход транзакции, который еще не был потрачен или использован в качестве входа для новой транзакции. UTXO представляют собой долю биткойнов, которыми владеет пользователь и которые в настоящее время доступны для траты. Каждый UTXO ассоциирован с определенным выходным скриптом, который определяет необходимые условия для траты биткойнов. Транзакции в Биткойне потребляют эти UTXO в качестве входов и создают новые UTXO в качестве выходов. Модель UTXO фундаментальна для Биткойна, поскольку она позволяет легко проверять, что транзакции не пытаются потратить биткойны, которые не существуют или уже были потрачены. По сути, UTXO - это часть Биткойна.