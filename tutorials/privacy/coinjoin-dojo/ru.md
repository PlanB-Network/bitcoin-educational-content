---
name: Coinjoin - Dojo
description: Как выполнить coinjoin со своим Dojo?
---
![cover](assets/cover.webp)

***ВНИМАНИЕ:** После ареста основателей Samourai Wallet и изъятия их серверов 24 апреля, инструмент Whirlpool больше не функционирует, даже для тех, кто использует свой Dojo или Sparrow Wallet. Тем не менее, существует вероятность, что этот инструмент может быть восстановлен в ближайшие недели или перезапущен иным способом. Кроме того, теоретическая часть этой статьи остается актуальной для понимания принципов и целей coinjoin в целом (не только Whirlpool), а также для понимания эффективности модели Whirlpool.*

_Мы тщательно следим за развитием этого дела, а также за развитием связанных с ним инструментов. Уверяем вас, что мы обновим этот учебник, как только появится новая информация._

_Этот учебник предоставляется только для образовательных и информационных целей. Мы не поддерживаем и не поощряем использование этих инструментов в преступных целях. Каждый пользователь несет ответственность за соблюдение законов в своей юрисдикции._

---

В этом учебнике вы узнаете, что такое coinjoin и как выполнить его с использованием программного обеспечения Samourai Wallet и реализации Whirlpool, используя свой Dojo. На мой взгляд, этот метод в настоящее время является лучшим для смешивания ваших биткойнов.

## Что такое coinjoin в Bitcoin?
**Coinjoin — это техника, которая нарушает прослеживаемость биткойнов в блокчейне**. Она основана на совместной транзакции с определенной структурой одноименного названия: транзакция coinjoin.

Coinjoin повышает конфиденциальность пользователей Bitcoin, усложняя анализ цепочек для внешних наблюдателей. Их структура позволяет объединять множество монет от разных пользователей в одну транзакцию, тем самым затрудняя отслеживание связей между входными и выходными адресами.

Принцип coinjoin основан на совместном подходе: несколько пользователей, желающих смешать свои биткойны, вносят одинаковые суммы в качестве входов одной и той же транзакции. Затем эти суммы распределяются как выходы равной стоимости каждому пользователю. В конце транзакции становится невозможным связать конкретный выход с известным пользователем на входе. Между входами и выходами не существует прямой связи, что нарушает ассоциацию между пользователями и их UTXO, а также историю каждой монеты.
![coinjoin](assets/notext/1.webp)

Пример транзакции coinjoin (не моя): [323df21f0b0756f98336437aa3d2fb87e02b59f1946b714a7b09df04d429dec2](https://mempool.space/en/tx/323df21f0b0756f98336437aa3d2fb87e02b59f1946b714a7b09df04d429dec2)

Для выполнения coinjoin, обеспечивая при этом, чтобы каждый пользователь постоянно контролировал свои средства, процесс начинается с создания транзакции координатором, который затем передает ее участникам. Каждый пользователь затем подписывает транзакцию после проверки того, что она им подходит. Все собранные подписи наконец интегрируются в транзакцию. Если пользователь или координатор попытаются перенаправить средства, изменив выходы транзакции coinjoin, подписи окажутся недействительными, что приведет к отклонению транзакции узлами.

Существует несколько реализаций coinjoin, таких как Whirlpool, JoinMarket или Wabisabi, каждая из которых направлена на управление координацией между участниками и повышение эффективности транзакций coinjoin.
В этом учебном пособии мы погрузимся в реализацию **Whirlpool**, который я считаю наиболее эффективным решением для выполнения coinjoin на Bitcoin. Хотя он доступен в нескольких кошельках, в этом руководстве мы будем исследовать его использование исключительно с мобильным приложением Samourai Wallet, без Dojo.
## Почему стоит выполнять coinjoin на Bitcoin?
Одна из первоначальных проблем любой системы пиринговых платежей - это двойная траты: как предотвратить попытки злоумышленников тратить одни и те же денежные единицы несколько раз без обращения к центральному органу для арбитража?

Сатоши Накамото предложил решение этой дилеммы через протокол Bitcoin, пиринговую электронную платежную систему, которая работает независимо от любого центрального органа. В своем белом листе он подчеркивает, что единственный способ гарантировать отсутствие двойной траты - это обеспечить видимость всех транзакций внутри платежной системы.

Чтобы каждый участник был осведомлен о транзакциях, они должны быть публично раскрыты. Таким образом, работа Bitcoin основана на прозрачной и распределенной инфраструктуре, позволяющей любому оператору узла проверять всю цепочку электронных подписей и историю каждой монеты, начиная с ее создания майнером.

Прозрачная и распределенная природа блокчейна Bitcoin означает, что любой пользователь сети может следить и анализировать транзакции всех других участников. В результате, анонимность на уровне транзакций невозможна. Однако анонимность сохраняется на уровне индивидуальной идентификации. В отличие от традиционной банковской системы, где каждый счет связан с личной идентичностью, в Bitcoin средства ассоциируются с парами криптографических ключей, таким образом предлагая пользователям форму псевдонимности за криптографическими идентификаторами.

Таким образом, конфиденциальность на Bitcoin нарушается, когда внешние наблюдатели умудряются ассоциировать конкретные UTXO с идентифицированными пользователями. Как только эта ассоциация установлена, становится возможным отслеживать их транзакции и анализировать историю их биткойнов. Coinjoin - это именно техника, разработанная для разрыва следимости UTXO, тем самым предлагая определенный уровень конфиденциальности пользователям Bitcoin на уровне транзакций.

## Как работает Whirlpool?
Whirlpool выделяется среди других методов coinjoin использованием транзакций "_ZeroLink_", которые гарантируют, что технически невозможно установить связь между всеми входами и всеми выходами. Это идеальное смешивание достигается за счет структуры, в которой каждый участник вносит одинаковую сумму на входе (за исключением комиссии за майнинг), тем самым генерируя выходы совершенно равных сумм.
Этот ограничительный подход к входам придает транзакциям coinjoin Whirlpool уникальную особенность: полное отсутствие детерминированных связей между входами и выходами. Другими словами, каждый выход имеет равную вероятность быть приписанным любому участнику, по сравнению со всеми другими выходами в транзакции.
Изначально количество участников в каждом coinjoin Whirlpool было ограничено 5, с 2 новыми участниками и 3 ремиксерами (мы объясним эти концепции далее). Однако увеличение комиссий за транзакции в блокчейне, наблюдаемое в 2023 году, побудило команды Samourai пересмотреть свою модель для улучшения конфиденциальности при снижении затрат. Таким образом, учитывая рыночную ситуацию с комиссиями и количество участников, координатор теперь может организовывать coinjoin, включая 6, 7 или 8 участников. Эти улучшенные сессии называются "_Surge Cycles_". Важно отметить, что, независимо от настройки, в coinjoin Whirlpool всегда участвуют только 2 новых входа.

Таким образом, транзакции Whirlpool характеризуются одинаковым количеством входов и выходов, которые могут быть:
- 5 входов и 5 выходов;
![coinjoin](assets/notext/2.webp)
- 6 входов и 6 выходов;
![coinjoin](assets/notext/3.webp)
- 7 входов и 7 выходов;
![coinjoin](assets/notext/4.webp) - 8 входов и 8 выходов.
![coinjoin](assets/notext/5.webp)
Модель, предложенная Whirlpool, основана на маленьких транзакциях coinjoin. В отличие от Wasabi и JoinMarket, где надежность анонимных наборов зависит от объема участников в одном цикле, Whirlpool делает ставку на цепочку множества маленьких циклов.

В этой модели пользователь платит комиссию только при своем первоначальном входе в пул, что позволяет ему участвовать в множестве ремиксов без дополнительных комиссий. Новые участники покрывают комиссии за майнинг для ремиксеров.

С каждым дополнительным coinjoin, в котором участвует монета, вместе с ее прошлыми партнерами по транзакции, анонимные наборы будут расти экспоненциально. Таким образом, цель состоит в том, чтобы воспользоваться этими бесплатными ремиксами, которые с каждым разом способствуют увеличению плотности анонимных наборов, ассоциированных с каждой перемешанной монетой.

Whirlpool был разработан с учетом двух важных требований:
- Возможность реализации на мобильных устройствах, учитывая, что Samourai Wallet в первую очередь является приложением для смартфонов;
- Скорость циклов ремикса для значительного увеличения анонимных наборов.
Эти императивы направляли выборы разработчиков Samourai Wallet при проектировании Whirlpool, заставив их ограничить количество участников на цикл. Слишком малое количество участников могло бы подорвать эффективность coinjoin, резко сократив создаваемые в каждом цикле анонимные наборы, в то время как слишком большое количество участников могло бы вызвать проблемы управления на мобильных приложениях и затруднить поток циклов.
**В конечном итоге, нет необходимости иметь большое количество участников на каждый coinjoin в Whirlpool, поскольку анонимные наборы достигаются за счет накопления нескольких циклов coinjoin.**

[-> Узнать больше о анонимных наборах Whirlpool.](https://planb.network/tutorials/privacy/wst-anonsets)

### Пулы и комиссии за coinjoin
Для того чтобы эти множественные циклы действительно увеличивали анонимные наборы перемешанных монет, необходимо установить определенный фреймворк для ограничения используемых объемов UTXO. Таким образом, Whirlpool определяет различные пулы.

Пул представляет собой группу пользователей, желающих смешаться вместе, которые договариваются об объеме UTXO для оптимизации процесса coinjoin. Каждый пул указывает фиксированный объем для UTXO, к которому пользователь должен придерживаться, чтобы участвовать. Таким образом, для выполнения coinjoins с Whirlpool, вам необходимо выбрать пул. В настоящее время доступны следующие пулы:
- 0.5 биткоина;
- 0.05 биткоина;
- 0.01 биткоина;
- 0.001 биткоина (= 100,000 сатоши).

Присоединяясь к пулу со своими биткоинами, они будут разделены для генерации UTXO, которые будут идеально однородны с теми, что у других участников пула. Каждый пул имеет максимальный лимит; таким образом, для сумм, превышающих этот лимит, вам будет необходимо либо сделать два отдельных входа в тот же пул, либо перейти в другой пул с большей суммой:

| Пул (биткоин) | Максимальная сумма за вход (биткоин) |
|---------------|--------------------------------------|
| 0.5           | 35                                   |
| 0.05          | 3.5                                  |
| 0.01          | 0.7                                  |
| 0.001         | 0.025                                |
Как было упомянуто ранее, UTXO считается принадлежащим к пулу, когда оно готово к интеграции в coinjoin. Однако это не означает, что пользователь теряет владение им. **На протяжении различных циклов смешивания вы сохраняете полный контроль над своими ключами и, следовательно, своими биткойнами.** Вот что отличает технику coinjoin от других централизованных методов смешивания.

Для входа в пул coinjoin необходимо оплатить сервисные сборы, а также комиссии за майнинг. Сервисные сборы фиксированы для каждого пула и предназначены для компенсации командам, ответственным за разработку и поддержку Whirlpool.

Сервисные сборы за использование Whirlpool оплачиваются один раз при входе в пул. После этого у вас есть возможность участвовать в неограниченном количестве пересмешиваний без каких-либо дополнительных сборов. Вот текущие фиксированные сборы для каждого пула:

| Пул (биткойн) | Вступительный взнос (биткойн) |
|---------------|------------------------------|
| 0.5           | 0.0175                       |
| 0.05          | 0.00175                      |
| 0.01          | 0.0005 (50,000 сатоши)       |
| 0.001         | 0.00005 (5,000 сатоши)       |

Эти сборы по сути функционируют как входной билет для выбранного пула, независимо от суммы, которую вы вкладываете в coinjoin. Таким образом, независимо от того, присоединяетесь ли вы к пулу 0.01 с ровно 0.01 BTC или входите в него с 0.5 BTC, сборы останутся теми же в абсолютном значении.

Перед участием в coinjoins пользователь, следовательно, имеет выбор между 2 стратегиями:
- Выбрать меньший пул, чтобы минимизировать сервисные сборы, зная, что в ответ они получат несколько маленьких UTXO;
- Или предпочесть больший пул, согласившись платить более высокие сборы, чтобы в итоге получить меньшее количество UTXO большего номинала.

Обычно не рекомендуется объединять несколько смешанных UTXO после циклов coinjoin, так как это может нарушить достигнутую конфиденциальность, особенно из-за эвристики общего владения входом (CIOH). Поэтому может быть разумным выбрать больший пул, даже если это означает уплату большей суммы, чтобы избежать наличия слишком многих UTXO малого номинала на выходе. Пользователю необходимо взвесить эти компромиссы, чтобы выбрать предпочтительный пул.

Помимо сервисных сборов, также необходимо учитывать комиссии за майнинг, присущие любой транзакции биткойна. Как пользователь Whirlpool, вам будет необходимо оплатить комиссии за майнинг за транзакцию подготовки (`Tx0`), а также за первый coinjoin. Все последующие пересмешивания будут бесплатными благодаря модели Whirlpool, которая опирается на оплату новыми участниками.

Действительно, в каждом coinjoin Whirlpool два участника среди входов являются новыми участниками. Остальные входы приходят от пересмешивающих. В результате комиссии за майнинг для всех участников транзакции покрываются этими двумя новыми участниками, которые затем также будут пользоваться бесплатными пересмешиваниями:
![coinjoin](assets/en/6.webp)
Благодаря этой системе сборов Whirlpool действительно отличается от других сервисов coinjoin, поскольку анонимные наборы UTXO не пропорциональны цене, уплаченной пользователем. Таким образом, можно достичь значительно высоких уровней анонимности, заплатив только вступительный взнос пула и комиссии за майнинг за две транзакции (за `Tx0` и начальное смешивание).
Важно отметить, что пользователю также придется покрыть комиссии за майнинг, чтобы вывести свои UTXO из пула после завершения нескольких coinjoin, если только он не выбрал опцию `mix to`, о которой мы поговорим в следующем учебном пособии.

### Счета HD-кошелька, используемые Whirlpool
Для выполнения coinjoin через Whirlpool кошелек должен генерировать несколько отдельных счетов. Счет, в контексте HD-кошелька (*Иерархически Детерминированный*), представляет собой раздел, полностью изолированный от других, этот раздел происходит на третьем уровне иерархии кошелька, то есть на уровне `xpub`.

Теоретически HD-кошелек может производить до `2^(32/2)` различных счетов. Исходный счет, используемый по умолчанию во всех Bitcoin-кошельках, соответствует индексу `0'`.

Для кошельков, адаптированных к Whirlpool, таких как Samourai или Sparrow, используются 4 счета для удовлетворения потребностей процесса coinjoin:
- Счет **депозита**, идентифицируемый индексом `0'`;
- Счет **bad bank** (или "doxxic change"), идентифицируемый индексом `2 147 483 644'`;
- Счет **premix**, идентифицируемый индексом `2 147 483 645'`;
- Счет **postmix**, идентифицируемый индексом `2 147 483 646'`.

Каждый из этих счетов выполняет определенную функцию в рамках coinjoin.

Все эти счета связаны с одним seed, что позволяет пользователю восстановить доступ ко всем своим биткоинам, используя свою фразу восстановления и, при необходимости, свой пароль. Однако, во время этой операции восстановления, необходимо указать программному обеспечению различные индексы счетов, которые использовались.

Теперь давайте рассмотрим различные этапы coinjoin в Whirlpool на этих счетах.

### Различные этапы coinjoin на Whirlpool
**Этап 1: Tx0**
Исходной точкой любого coinjoin в Whirlpool является счет **депозита**. Этот счет автоматически используется, когда вы создаете новый Bitcoin-кошелек. На этот счет должны быть зачислены биткоины, которые вы хотите смешать.
`Tx0` представляет собой первый шаг в процессе смешивания Whirlpool. Его цель - подготовить и уравнять UTXO для coinjoin, разделив их на единицы, соответствующие сумме выбранного пула, чтобы обеспечить однородность смешивания. Уравненные UTXO затем отправляются на счет **premix**. Что касается разницы, которая не может войти в пул, она отделяется на специфический счет: **bad bank** (или "doxxic change").
Эта исходная транзакция `Tx0` также служит для урегулирования сервисных сборов, причитающихся координатору смешивания. В отличие от последующих шагов, эта транзакция не является совместной; пользователь, следовательно, должен нести все комиссии за майнинг:
![coinjoin](assets/en/7.webp)

В этом примере транзакции `Tx0` вход в размере `372,000 сатоши` с нашего счета **депозита** делится на несколько выходных UTXO, которые распределяются следующим образом:
- Сумма в `5,000 сатоши`, предназначенная для координатора за сервисные сборы, соответствующая входу в пул `100,000 сатоши`;
- Три UTXO, подготовленные для смешивания, перенаправленные на наш счет **premix** и зарегистрированные у координатора. Эти UTXO уравнены по `108,000 сатоши` каждый, чтобы покрыть комиссии за майнинг их будущего первоначального смешивания;
- Избыток, который не может попасть в пул, поскольку он слишком мал, считается токсичной сдачей. Он отправляется на специальный счет. Здесь эта сдача составляет `40 000 сатоши`;
- Наконец, есть `3 000 сатоши`, которые не являются выводом, но являются необходимыми комиссиями за майнинг для подтверждения `Tx0`.

Например, вот реальная транзакция Whirlpool Tx0 (не моя): [edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46](https://mempool.space/en/tx/edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46)

**Шаг 2: Токсичная сдача**
Избыток, который не удалось интегрировать в пул, здесь эквивалентный `40 000 сатоши`, перенаправляется на счет **плохого банка**, также называемый "токсичной сдачей", чтобы обеспечить строгое разделение от других UTXO в кошельке.

Этот UTXO опасен для конфиденциальности пользователя, потому что он не только все еще связан со своим прошлым, и, следовательно, возможно, с личностью его владельца, но также отмечен как принадлежащий пользователю, который провел coinjoin.
Если этот UTXO будет объединен с перемешанными выводами, они потеряют всю конфиденциальность, полученную во время циклов coinjoin, в частности, из-за эвристики общего владения входами (CIOH). Если он будет объединен с другими токсичными сдачами, пользователь рискует потерять конфиденциальность, поскольку это свяжет различные входы циклов coinjoin. Поэтому с ним нужно обращаться осторожно. Способы управления этим токсичным UTXO будут подробно описаны в последней части этой статьи, а будущие учебные пособия более подробно рассмотрят эти методы на сети PlanB.

**Шаг 3: Первоначальное смешивание**
После завершения `Tx0` уравненные UTXO отправляются на **премикс** счет нашего кошелька, готовые к введению в их первый цикл coinjoin, также называемый "первоначальным смешиванием". Если, как в нашем примере, `Tx0` генерирует несколько UTXO, предназначенных для смешивания, каждый из них будет интегрирован в отдельный первоначальный coinjoin.

По окончании этих первых смешиваний **премикс** счет будет пуст, в то время как наши монеты, заплатившие комиссии за майнинг за этот первый coinjoin, будут точно скорректированы до суммы, определенной выбранным пулом. В нашем примере наши первоначальные UTXO в `108 000 сатоши` будут уменьшены ровно до `100 000 сатоши`.
![coinjoin](assets/en/8.webp)
**Шаг 4: Перемикширование**
После первоначального смешивания UTXO переводятся на **постмикс** счет. Этот счет собирает уже перемешанные UTXO и те, которые ожидают перемикширования. Когда клиент Whirlpool активен, UTXO, находящиеся на **постмикс** счете, автоматически доступны для перемикширования и будут случайным образом выбраны для участия в этих новых циклах.

Напомним, что перемикширования затем проходят абсолютно бесплатно: не требуются никакие дополнительные сервисные сборы или комиссии за майнинг. Сохранение UTXO на **постмикс** счете таким образом сохраняет их ценность нетронутой и одновременно улучшает их анонимные наборы. Вот почему важно позволить этим монетам участвовать в нескольких циклах coinjoin. Это ничего вас не стоит, и это увеличивает их уровни анонимности.
Когда вы решаете потратить смешанные UTXO, вы можете сделать это напрямую из этого **постмикс** аккаунта. Рекомендуется хранить смешанные UTXO в этом аккаунте, чтобы воспользоваться бесплатными ремиксами и избежать их выхода из цепочки Whirlpool, что могло бы снизить их конфиденциальность.
Как мы увидим в следующем учебнике, существует также опция `mix to`, которая предлагает возможность автоматически отправлять ваши смешанные монеты в другой кошелек, например, в холодный кошелек, после определенного количества coinjoin.
После изучения теории перейдем к практике с учебником по использованию Whirlpool через приложение Samourai Wallet для Android, синхронизированное с Whirlpool CLI и GUI на вашем собственном Dojo!
## Учебник: Coinjoin Whirlpool с вашим собственным Dojo
Существует множество способов использования Whirlpool. Тот, который я хочу здесь представить, - это опция Samourai Wallet, приложение для управления биткойн-кошельком с открытым исходным кодом на Android, но на этот раз **с вашим собственным Dojo**.

Выполнение coinjoin через Samourai Wallet с использованием вашего собственного Dojo, по моему мнению, является наиболее эффективной стратегией для проведения coinjoin на Bitcoin на сегодняшний день. Этот подход требует некоторых первоначальных инвестиций в плане настройки, но, как только все на месте, он предлагает возможность непрерывно смешивать и ремикшировать ваши биткойны 24 часа в сутки, 7 дней в неделю, без необходимости постоянно держать приложение Samourai активным. Действительно, благодаря работе Whirlpool CLI на узле Bitcoin, вы всегда готовы участвовать в coinjoin. Приложение Samourai затем дает вам возможность тратить ваши смешанные средства в любое время, где бы вы ни находились, прямо с вашего смартфона. Более того, этот метод имеет преимущество в том, что никогда не подключает вас к серверам, управляемым командами Samourai, тем самым сохраняя ваш `xpub` от любого внешнего воздействия.

Этот метод, таким образом, идеален для тех, кто ищет максимальную конфиденциальность и высочайшее качество циклов coinjoin. Однако, он требует наличия у вас узла Bitcoin и, как мы увидим позже, требует некоторой настройки. Таким образом, он больше подходит для пользователей среднего и продвинутого уровня. Для начинающих я рекомендую ознакомиться с coinjoin через эти два других учебника, которые показывают, как это сделать через Sparrow Wallet или Samourai Wallet (без Dojo):
- **[Учебник по coinjoin в Sparrow Wallet](https://planb.network/en/tutorials/privacy/coinjoin-sparrow-wallet)**;
- **[Учебник по coinjoin в Samourai Wallet (без Dojo)](https://planb.network/en/tutorials/privacy/coinjoin-samourai-wallet)**.

### Понимание настройки
Для начала вам понадобится Dojo! Dojo - это реализация узла Bitcoin на основе Bitcoin Core, разработанная командами Samourai.

Чтобы запустить свой собственный Dojo, у вас есть возможность либо установить узел Dojo автономно, либо воспользоваться Dojo поверх другого решения узла Bitcoin "node-in-box". В настоящее время доступны следующие варианты:
- [RoninDojo](https://ronindojo.io/), который представляет собой Dojo с дополнительными инструментами, включая помощника по установке и помощника по администрированию. Я подробно описываю процедуру настройки и использования RoninDojo в этом другом учебнике: [RONINDOJO V2](https://planb.network/en/tutorials/node/ronin-dojo-v2);
- [Umbrel](https://umbrel.com/) с приложением "Samourai Server";
- [MyNode](https://mynodebtc.com/) с приложением "Dojo".
- [Nodl](https://www.nodl.eu/) с приложением "Dojo";
- [Citadel](https://runcitadel.space/) с приложением "Samourai".
![coinjoin](assets/notext/9.webp)
В нашей настройке мы будем взаимодействовать с тремя различными интерфейсами:
- **Samourai Wallet**, который будет хранить наш Bitcoin кошелек, предназначенный для coinjoins. Доступен бесплатно на Android, это приложение с открытым исходным кодом позволяет вам контролировать ваш кошелек для миксинга, особенно для расходования ваших средств после миксинга с вашего смартфона;
- **Whirlpool CLI** (_Командный интерфейс_), который будет работать на узле, хостинге Dojo. Это программное обеспечение будет иметь доступ к ключам вашего кошелька Samourai. Оно отвечает за связь с координатором и управление coinjoins непрерывно. Оно действует как копия вашего кошелька Samourai на вашем узле, готовая участвовать в coinjoins в любое время;
- **Whirlpool GUI** (_Графический пользовательский интерфейс_), графический интерфейс пользователя, который мы будем использовать для мониторинга активности Whirlpool CLI и инициирования миксинга удаленно. Whirlpool GUI предоставляет визуальное представление операций, проводимых Whirlpool CLI. Это программное обеспечение должно быть установлено на компьютере, отдельном от Dojo. Для пользователей Umbrel, MyNode, Nodl и Citadel, Whirlpool GUI обязательно. Однако, с RoninDojo, интерфейс Whirlpool GUI уже интегрирован в веб-интерфейс вашего узла через приложение `Whirlpool`. Поэтому вам не нужно будет устанавливать его на отдельный ПК.

На мой взгляд, использование RoninDojo представляет собой лучшее решение для выполнения coinjoins с Dojo. Поскольку это программное обеспечение для узла в коробке находится в прямом партнерстве с командами Samourai, RoninDojo гораздо более оптимизировано для этого. Более того, интеграция Whirlpool GUI в веб-интерфейс значительно упрощает процесс настройки. В этом руководстве я все же объясню, как это сделать с другими решениями, интегрирующими Dojo (Umbrel, Nodl, MyNode и Citadel).

### Подготовка вашего Dojo
Для начала вам нужно будет установить Dojo и получить QR-код или ссылку, которая позволит вам подключиться к нему удаленно. Эта ссылка является адресом Tor, заканчивающимся на `.onion`. Если вы используете RoninDojo, просто перейдите в меню `Pairing`, чтобы получить эту информацию.
![coinjoin](assets/notext/10.webp)

Ниже `Samourai Dojo` нажмите на кнопку `Pair now`.

![coinjoin](assets/notext/11.webp)

Будут отображены ваш QR-код для подключения и соответствующая ссылка.

![coinjoin](assets/notext/12.webp)

Если вы используете Umbrel, перейдите в App Store и найдите приложение `Samourai Server`. Оно находится во вкладке `Bitcoin`.

![coinjoin](assets/notext/13.webp)

Установите приложение.

![coinjoin](assets/notext/14.webp)

После открытия приложения у вас будет доступ к QR-коду для подключения к вашему Dojo.

![coinjoin](assets/notext/15.webp)

Если вы используете другое программное обеспечение для узла в коробке, такое как MyNode, Citadel или Nodl, процесс аналогичен Umbrel. Вам нужно установить приложение Samourai или Dojo, чтобы получить необходимую информацию для подключения к вашему Dojo.

![coinjoin](assets/notext/16.webp)

### Подготовка вашего кошелька Samourai
После получения информации для подключения к вашему Dojo пришло время настроить ваш кошелек для coinjoins. Существует два сценария: если у вас еще нет кошелька Samourai на вашем смартфоне, процесс прост, просто создайте новый.

С другой стороны, если у вас уже есть кошелек Samourai, вам нужно будет переустановить приложение, чтобы ассоциировать его с новым Dojo. Этот шаг необходим, потому что подключение к Dojo может быть установлено только при первом запуске приложения. Однако благодаря автоматически создаваемому зашифрованному файлу резервной копии Samourai на вашем телефоне, эта процедура проста и быстра.

*Если вы никогда не использовали Samourai, вы можете пропустить эти предварительные шаги и перейти непосредственно к установке приложения.*

Прежде всего, убедитесь, что ваше приложение Samourai Wallet обновлено. Для этого проверьте Google Play Store или сравните версию вашего приложения в `Настройки > Другое` с доступной на сайте Samourai.

![coinjoin](assets/notext/17.webp)

Убедитесь, что у вас есть фраза восстановления вашего кошелька Samourai и что она читаема. Затем проведите тест вашей фразы BIP39, перейдя в `Настройки > Устранение неполадок > Тест фразы/резервной копии`, чтобы подтвердить ее точность.

![coinjoin](assets/notext/18.webp)
Введите вашу фразу, затем проверьте, подтверждает ли Samourai ее действительность.
![coinjoin](assets/notext/19.webp)

Если ваша фраза недействительна или у вас нет вашей фразы восстановления, крайне важно немедленно прекратить процедуру! **Вы рискуете потерять ваши биткоины во время этой операции.** В этом случае рекомендуется перевести ваши средства в другой кошелек и начать с нового пустого кошелька Samourai. Следующие шаги следует выполнять только если вы уверены, что у вас есть вся необходимая информация для восстановления и что ваша фраза действительна.

Затем приступите к созданию зашифрованной резервной копии вашего кошелька и скопируйте ее в буфер обмена. Для выполнения этой операции нажмите на три маленькие точки в верхнем правом углу экрана, затем выберите `Экспорт резервной копии кошелька`.

![coinjoin](assets/notext/20.webp)

**С этого момента не копируйте ничего другого в буфер обмена!** Крайне важно сохранить вашу скопированную резервную копию.

Если вы правильно выполнили предыдущие шаги, теперь вы можете безопасно удалить ваш кошелек Samourai. Для этого перейдите в: `Настройки > Кошелек > Безопасное стирание кошелька`.

![coinjoin](assets/notext/21.webp)

![coinjoin](assets/notext/22.webp)

*Если вы никогда не использовали Samourai и устанавливаете приложение с нуля, вы можете возобновить учебник с этого шага.*

Ваше приложение Samourai теперь сброшено. Откройте приложение и приступите к шагам настройки, как если бы вы использовали его впервые.

![coinjoin](assets/notext/23.webp)

На следующем шаге вы получите доступ к странице, посвященной настройке вашего Dojo. Выберите опцию `Dojo`, затем введите информацию для входа в ваш Dojo. Для этого у вас есть возможность отсканировать информацию, нажав `Сканировать QR`.

![coinjoin](assets/notext/24.webp)

*Для новых пользователей Samourai затем будет необходимо создать кошелек с нуля. Если вам нужна помощь, вы можете ознакомиться с инструкциями по настройке нового кошелька Samourai [в этом учебнике, в разделе "Создание программного кошелька"](https://planb.network/tutorials/privacy/coinjoin-samourai-wallet)*
Если вы приступаете к восстановлению уже существующего кошелька Samourai, выберите `Restore existing wallet`, затем выберите `I have a Samourai backup file`.
![coinjoin](assets/notext/25.webp)
Обычно, файл восстановления всегда должен быть у вас в буфере обмена. Затем нажмите на `PASTE`, чтобы вставить ваш файл в указанное место. Для его расшифровки также необходимо будет ввести фразу-пароль BIP39 вашего кошелька в соответствующее поле, расположенное чуть ниже. Для завершения нажмите на `FINISH`.
![coinjoin](assets/notext/26.webp)

После этого вы будете перенаправлены в ваш кошелек Samourai, который на этот раз будет подключен к вашему собственному Dojo.

![coinjoin](assets/notext/27.webp)

### Установка Whirlpool GUI
Теперь пришло время установить Whirlpool GUI, графический интерфейс пользователя, который позволит вам управлять вашими циклами coinjoin с обычного ПК. Для пользователей RoninDojo этот шаг не требуется, поскольку управление coinjoins можно осуществлять напрямую через веб-интерфейс в `Apps > Whirlpool`. Однако, если вы используете другое решение "node-in-box" для Bitcoin, установка обязательна.
![coinjoin](assets/notext/28.webp)
Перейдите на ваш личный компьютер и загрузите программное обеспечение Whirlpool с официального сайта кошелька Samourai, выбрав версию, соответствующую вашей операционной системе.

![coinjoin](assets/notext/29.webp)

Перед запуском Whirlpool GUI необходимо установить JAVA 8 или более новую версию на вашу машину. Для этого [вы можете установить OpenJDK](https://adoptium.net/).
![coinjoin](assets/notext/30.webp)
Также необходимо, чтобы Tor Daemon или Tor Browser работали в фоновом режиме на вашем компьютере. Убедитесь, что Tor запущен перед каждой сессией использования Whirlpool GUI. Если Tor еще не установлен на вашей машине, [вы можете загрузить и установить его с официального сайта проекта](https://www.torproject.org/download/), затем убедитесь, что он запущен в фоновом режиме.

![coinjoin](assets/notext/31.webp)

После установки JDK на вашу систему и запуска Tor в фоновом режиме, вы можете начать работу с Whirlpool GUI.

![coinjoin](assets/notext/32.webp)

В Whirlpool GUI нажмите на `Advanced: Remote CLI`, чтобы подключить ваш Whirlpool CLI, который находится на вашем Dojo. Вам понадобится Tor адрес вашего Whirlpool CLI.

![coinjoin](assets/notext/33.webp)

Чтобы найти ваш Tor адрес на Umbrel и других решениях "node-in-box", просто запустите приложение Samourai Server или Dojo (название может варьироваться в зависимости от используемого программного обеспечения). Tor адрес будет непосредственно виден на странице приложения.
![coinjoin](assets/notext/34.webp)
В Whirlpool GUI введите полученный ранее Tor адрес в поле `CLI address`. Сохраните префикс `http://`, но не добавляйте порт `:8899` в конце. Вставьте только адрес так, как он был вам предоставлен.
![coinjoin](assets/notext/35.webp)
В поле Tor Proxy введите `socks5://127.0.0.1:9050`, если вы используете Tor Daemon, или `socks5://127.0.0.1:9150`, если используется Tor Browser. Когда вы впервые подключаетесь к Whirlpool CLI через Whirlpool GUI, можно оставить поле ключа API пустым. Если это не ваше первое подключение, пожалуйста, введите ваш ключ API в соответствующее поле. Этот ключ можно найти на той же странице, что и ваш Tor адрес.
![coinjoin](assets/notext/36.webp)

После того как вы заполните все необходимое, нажмите кнопку `Connect`. Пожалуйста, подождите, подключение может занять несколько минут.

![coinjoin](assets/notext/37.webp)

### Сопряжение вашего кошелька Samourai с Whirlpool GUI
*Для пользователей RoninDojo, вы можете продолжить учебник здесь.*

Теперь мы сопряжем ранее настроенный кошелек Samourai с программным обеспечением Whirlpool GUI, или напрямую с RoninDojo для тех, кто использует это программное обеспечение. Независимо от того, используете ли вы Whirlpool GUI или RoninDojo, вам будет предложено вставить или отсканировать информацию для сопряжения вашего кошелька Samourai.

![coinjoin](assets/notext/38.webp)

Чтобы найти эту информацию, перейдите в настройки вашего кошелька.

![coinjoin](assets/notext/39.webp)

Нажмите на `Transactions`, затем на `Pair to Whirlpool GUI`.

![coinjoin](assets/notext/40.webp)

Samourai затем предоставит вам необходимую информацию для установления соединения. Будьте осторожны, эти данные являются конфиденциальными! Вы можете передать их на ваш ПК, либо скопировав их напрямую, либо отсканировав отображаемый QR-код с помощью веб-камеры вашего компьютера после нажатия на символ QR-кода.

![coinjoin](assets/notext/41.webp)

После выполнения этой операции в Whirlpool GUI выберите `Initialize GUI`. Пожалуйста, подождите, так как этот шаг может занять некоторое время.

![coinjoin](assets/notext/42.webp)

Независимо от того, используете ли вы Whirlpool GUI или RoninDojo, вам будет предложено ввести парольную фразу вашего кошелька Samourai. Введите ее в соответствующее поле, затем нажмите кнопку `Login`, чтобы продолжить.

![coinjoin](assets/notext/43.webp)

Затем вы попадете на домашнюю страницу Whirlpool CLI

![coinjoin](assets/notext/44.webp)

### Инициирование coinjoins через Whirlpool GUI
*Для пользователей RoninDojo процесс следования идентичен. Интерфейс приложения Whirlpool, интегрированный в RoninDojo, предлагает те же опции и функциональные возможности, что и программное обеспечение Whirlpool GUI на десктопе. Следовательно, вы можете следовать этим инструкциям таким же образом.*
Теперь, когда все настроено, вы готовы начать миксинг ваших биткоинов. Для этого переведите биткоины, которые вы хотите смешать, на счет **Deposit** вашего кошелька Samourai. Эту операцию можно выполнить либо напрямую через приложение Samourai Wallet, либо через Whirlpool GUI. На главной странице нажмите кнопку `+ Deposit`, расположенную в верхнем левом углу.

![coinjoin](assets/notext/45.webp)
Whirlpool GUI сгенерирует адрес для получения. Также будет отображена минимальная сумма, необходимая для участия в каждом пуле coinjoin. Эта сумма варьируется в зависимости от рынка комиссий. Рекомендуется внести сумму немного выше минимально требуемой, так как если комиссии за майнинг не уменьшатся, ваш UTXO может не быть принят в желаемый пул. Поэтому отправьте ваши биткоины на предоставленный адрес. Чтобы получить новый адрес, просто нажмите на кнопку `Обновить адрес`.

![coinjoin](assets/notext/46.webp)

После подтверждения депозита вы сможете увидеть его в аккаунте **Депозит** в Whirlpool GUI.

![coinjoin](assets/notext/47.webp)

Чтобы начать циклы coinjoin, выберите UTXO, которые вы хотите смешать, и нажмите кнопку `Премикс`. Будьте осторожны: если вы выберете несколько разных UTXO одновременно, они будут объединены во время транзакции подготовки `TX0`. Это слияние может привести к снижению конфиденциальности, особенно если UTXO поступают из разных источников, из-за эвристики общего владения входами (CIOH).

![coinjoin](assets/notext/48.webp)

Открывается страница конфигурации Whirlpool. Вы можете выбрать пул, в который хотите войти. Также выберите комиссии за майнинг, предназначенные для `TX0` и первых coinjoins. В нижней части этой страницы будет представлено резюме с указанием суммы доксической сдачи, а также суммы и количества UTXO, которые будут уравнены и включены в циклы coinjoin. Если вы удовлетворены этой конфигурацией, нажмите кнопку `Премикс`, чтобы начать циклы coinjoin.
![coinjoin](assets/notext/49.webp)

После создания `TX0` вы сможете увидеть ваши уравненные UTXO в аккаунте **Премикс**, ожидающие подтверждения. Чтобы позволить вашим монетам автоматически перемешиваться 24 часа в сутки, 7 дней в неделю, я рекомендую активировать опцию `Автоматически миксовать премикс и постмикс`. Эту функцию вы найдете во вкладке `Конфигурация`, расположенной слева от окна Whirlpool GUI.
![coinjoin](assets/notext/50.webp)
После начала coinjoins вы можете выйти из Whirlpool GUI, а также из Samourai Wallet. Только ваш узел должен оставаться подключенным, чтобы иметь возможность участвовать в непрерывных coinjoins. Однако рекомендуется периодически проверять прогресс ваших циклов coinjoin. Если вы заметите, что ваши UTXO больше не выбираются для coinjoin на протяжении некоторого времени, это может указывать на наличие ошибки. В этом случае перейдите в Whirlpool CLI и выберите `Старт`, чтобы перезапустить вашу доступность для coinjoins.

![coinjoin](assets/notext/51.webp)

Ваши смешанные UTXO видны из аккаунта **Постмикс** в Whirlpool GUI. Кроме того, у вас есть возможность просматривать и тратить их напрямую через интерфейс Whirlpool в вашем Samourai Wallet. Чтобы получить доступ к этому меню, нажмите на синий `+` внизу вашего экрана, затем выберите `Whirlpool`.

![coinjoin](assets/notext/52.webp)

Аккаунты Whirlpool легко идентифицируются в Samourai Wallet по их синему цвету. Это позволяет вам тратить ваши смешанные UTXO откуда угодно и в любое время, прямо с вашего смартфона.

![coinjoin](assets/notext/53.webp)
Чтобы отслеживать ваши автоматические объединения монет (coinjoins), я также рекомендую настроить кошелек только для просмотра через приложение Sentinel. Добавьте ZPUB вашего аккаунта **Postmix** и следите за прогрессом ваших циклов объединения монет в реальном времени. Если вы хотите понять, как использовать Sentinel, рекомендую ознакомиться с этим другим руководством на PlanB Network: [**SENTINEL WATCH-ONLY**](https://planb.network/tutorials/wallet/sentinel)