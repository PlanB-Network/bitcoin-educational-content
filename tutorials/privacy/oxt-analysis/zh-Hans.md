---
name: OXT - 链分析
description: 掌握比特币链分析的基础知识
---
![cover](assets/cover.webp)

***警告：** 继Samourai Wallet的创始人被逮捕以及他们的服务器在4月24日被查封之后，**网站OXT.me目前无法访问**。然而，这个工具可能在未来几周重新启动的可能性仍然存在。在此期间，您仍然可以从本教程中受益，以理解比特币链分析的基础知识。这里介绍的所有启发式方法和模式仍然适用于比特币交易。尽管这些工具的优化程度不如OXT，您可以暂时使用[Mempool.space](https://mempool.space/) 或 [Bitcoin Explorer](https://bitcoinexplorer.org/) 来将本文的理论概念付诸实践。*

_我们正在密切关注此案件的发展以及与之相关工具的发展情况。请放心，一旦有新信息可用，我们将更新本教程。_

_本教程仅供教育和信息目的使用。我们不支持或鼓励使用这些工具进行犯罪活动。每个用户都有责任遵守他们所在司法管辖区的法律。_

---

在本文中，您将学习进行比特币基础链分析所需的基本理论基础，更重要的是，理解那些观察您的人是如何操作的。尽管本文不是关于OXT工具的实践教程（我们将在未来的教程中讨论这个话题），但它汇编了使用该工具所需的一系列关键知识。对于每个模型、指标和指示器，都提供了一个指向OXT上示例交易的链接，这将帮助您更好地理解其用途，并在阅读时进行实践。

## 引言
货币的一个功能是解决双重欲望的问题。在基于物物交换的系统中，完成一次交换不仅需要找到一个提供满足我需求的商品的个体，还需要提供一个等价值的商品满足他们的需求。找到这种平衡证明是复杂的。这就是为什么我们求助于货币，它允许我们在空间和时间上移动价值。

为了让货币解决这个问题，至关重要的是提供商品或服务的一方相信他们以后能够花费那笔钱。因此，任何愿意接受一枚货币（无论是数字的还是物理的）的理性个体都会确保它满足两个基本标准：
- 货币必须是完整和真实的；
- 并且它不能被双重支付。

如果我们使用物理货币，第一个特性是最复杂的要断言的。在历史的不同时期，金属硬币的完整性经常受到剪切或钻孔等做法的影响。例如，在古罗马时期，公民常常刮金币的边缘以收集一点贵金属，同时仍然保留它们用于未来的交易。这就是为什么后来在硬币的边缘上加盖了凹槽。在物理货币媒介上，真实性也是一个难以验证的特性。如今，对抗伪造的技术越来越复杂，迫使商人投资于昂贵的验证系统。

另一方面，由于其性质，物理货币不存在双重支付的问题。如果我给你一张10欧元的钞票，它不可撤销地离开我的占有权进入你的占有权，从而排除了它所代表的货币单位多次支付的可能性。
对于数字货币来说，挑战是不同的。确保一枚硬币的真实性和完整性通常更简单，但确保没有双重支付则更为复杂。每一种数字商品本质上都是信息。与物理商品不同，信息在交换过程中不会分裂，而是通过复制来传播。例如，如果我通过电子邮件发送给你一个文档，那么它就会被复制。在你这一端，你无法确定我是否已经删除了原始文档。

避免数字商品复制的唯一方法是了解系统上的所有交换。这样，人们就可以知道谁拥有什么，并根据进行的交易更新每个人的账户。例如，这就是记账货币所做的。当你用信用卡支付给商家€10时，银行会记录这次交换并更新账本。

在比特币上，防止双重支付的方式也是一样的。它试图确认不存在已经使用过相关硬币的交易。如果这些硬币从未被使用过，那么我们就可以确信不会发生双重支付。这就是中本聪在白皮书中的著名说法：“*确认交易不存在的唯一方法是了解所有交易。*”

与银行模型不同，在比特币上，我们不希望必须信任一个中央实体。因此，所有用户都必须能够确认没有双重支付，而不依赖于第三方。因此，每个人都必须了解所有比特币交易。

正是这种信息的公开传播使得在比特币上保护隐私变得复杂。在传统银行系统中，理论上，只有金融机构知道所进行的交易。然而，在比特币上，所有用户通过各自的节点了解所有交易。

由于这种传播的限制，比特币的隐私模型与银行系统的不同。在后者中，交易与用户的身份相关联，但信息的流动在信任的第三方和公众之间被切断。换句话说，你的银行知道你每天早上在当地的面包店买法棍，但你的邻居并不知道所有这些交易。在比特币的情况下，由于信息流动不能在交易和公共领域之间断开，隐私模型依赖于将用户的身份与交易本身分离。
![分析](assets/en/1.webp)
*图表灵感来源于中本聪在白皮书《比特币：一种点对点的电子现金系统》第10节“隐私”中的描述。*
由于比特币交易是公开的，因此可以在它们之间建立联系，以推断有关参与方的信息。这项活动甚至构成了一个专门领域，通常称为“链分析”。在本文中，我邀请你探索链分析的基础，以理解你的比特币是如何被追踪的。

专门从事链分析的大多数公司都像黑盒一样运作，并且不公开他们的方法论。因此，很难获得有关这种做法的信息。在撰写本文时，我主要依赖于少数可用的公开资源：
- 我的文章大部分内容摘自2021年由Samourai Wallet制作的四篇文章系列：[理解比特币隐私与OXT](https://medium.com/oxt-research/understanding-bitcoin-privacy-with-oxt-part-1-4-8177a40a5923)；
- 我还使用了[OXT研究](https://medium.com/oxt-research)的各种报告，以及他们的免费链分析工具；
- 更广泛地说，我的知识来自于不同的推文和内容，这些内容由[@LaurentMT](https://twitter.com/LaurentMT) 和 [@ErgoBTC](https://twitter.com/ErgoBTC)发布；
- 我还受到了[Space Kek #19](https://podcasters.spotify.com/pod/show/decouvrebitcoin/episodes/SpaceKek-19---Analyse-de-chane--anonsets-et-entropie-e1vfuji)的启发，在这个节目中，我与[@louneskmt](https://twitter.com/louneskmt)、[@TheoPantamis](https://twitter.com/TheoPantamis)、[@Sosthene___](https://twitter.com/Sosthene___) 和 [@LaurentMT](https://twitter.com/LaurentMT)一起参与。

我要感谢他们这些作者、开发者和制作人。没有他们的各种内容和软件，这篇文章就不会存在。我还要感谢那些细心纠正这篇文章并给予我专家建议的审稿人：
- [Gilles Cadignan](https://twitter.com/gillesCadignan)；
- [Ludovic Lars](https://twitter.com/lugaxker) ([https://viresinnumeris.fr/](https://viresinnumeris.fr/))。

*供您参考，我在文章末尾添加了一个技术小词汇表，以定义某些术语。如果您看到一个您不理解的带星号的词，其定义在页面底部。*

## 什么是链上分析？
链上分析是一种实践，包括所有用于追踪比特币在区块链上流动的方法。通常，链上分析依赖于观察以前交易样本中的特征。然后，它涉及到识别想要分析的交易中的这些相同特征，并推断出合理的解释。这种基于实际方法寻找足够好的解决方案的问题解决方法，就是所谓的启发式。

简而言之，链上分析主要分为两个步骤：
1. 已知特征的识别；
2. 假设的推断。

链上分析的目标之一是将比特币上的各种活动分组，以确定执行这些活动的用户的唯一性。随后，将有可能尝试将这一系列活动与一个真实身份联系起来。

请记住我的介绍。我解释了为什么比特币的隐私模型最初依赖于将用户的身份与他们的交易分开。因此，人们可能会认为链上分析是不必要的，因为即使有人设法将链上活动分组，他们也无法将其与真实身份关联。从理论上讲，这种说法是准确的。加密密钥对用于建立UTXOs上的条件。本质上，这些密钥对不会透露其持有者的任何身份信息。因此，即使有人成功地将与不同密钥对相关的活动分组，这也无法告诉我们这些活动背后的实体是谁。
然而，实际情况要复杂得多。存在许多行为可能将真实身份与链上活动联系起来。在分析中，这被称为入口点，而且这样的入口点有很多。最常见的当然是KYC（了解你的客户）。如果你从一个受监管的平台提取比特币到你的个人接收地址，那么一些人能够将你的身份与这个地址联系起来。更广泛地说，入口点可以是你的真实生活与比特币交易之间的任何形式的互动。例如，如果你在社交网络上发布一个接收地址，这可以成为分析的一个入口点。如果你用比特币向你的面包师支付，他们可以将你的面孔（这是你身份的一部分）与一个比特币地址关联起来。使用比特币时，这些入口点几乎是不可避免的。尽管人们可能寻求限制它们的范围，但它们仍将存在。这就是为什么结合旨在保护你的隐私的方法至关重要。虽然保持你的真实身份与你的交易之间的可接受分离是值得称赞的做法，但这仍然不够。事实上，如果你所有的链上活动都可以被聚集在一起，那么即使是最小的入口点也可能破坏你所建立的唯一的隐私层。

因此，在我们使用比特币时，也有必要处理链分析。通过这样做，我们可以最小化我们活动的聚集，并限制入口点对我们隐私的影响。确切地说，为了更好地对抗链分析，有什么比熟悉链分析中使用的方法更好的方法呢？如果你想知道如何在比特币上提高你的隐私，你必须理解这些方法。这将使你能够更好地掌握像[Coinjoin](https://planb.network/en/tutorials/privacy/coinjoin-samourai-wallet)或[Payjoin](https://planb.network/en/tutorials/privacy/payjoin)这样的技术，并减少你可能犯的错误。

在这方面，我们可以将密码学和密码分析做一个类比。一个好的密码学家首先是一个好的密码分析师。为了想象一个新的加密算法，人必须知道它将面临什么攻击，也要研究为什么之前的算法被破解。对于比特币上的隐私同样适用这一原则。理解链分析的方法是防御它的关键。这就是为什么我向你提供这篇文章的原因。

理解链分析不是一门精确科学至关重要。它依赖于从先前的观察或逻辑解释中得出的启发式规则。这些规则允许得到相当可靠的结果，但永远不会有绝对的精确性。换句话说，链分析总是涉及到在得出的结论中加入概率维度。我们可以或多或少确定地估计两个地址属于同一实体，但总的确定性总是遥不可及。

链分析的整个目标正是在于聚集各种启发式规则以最小化错误的风险。从某种意义上说，这是一种证据的积累，使我们能够更接近现实。

这些著名的启发式规则可以分为不同的类别，我们将一起详细介绍：
- 交易模式（或交易模型）；
- 交易内部启发式；
- 交易外部启发式。

值得注意的是，比特币上的前两个启发式是由中本聪自己提出的。他在白皮书的第10部分讨论了它们。正如我们稍后将看到的，观察这两个启发式在今天的链分析中仍然保持着优势是有趣的。这些是：
- 共同输入所有权启发式（CIOH）；
- 和地址重用。
让我们一起探索可观察的特征及其解释，以进行分析。

## 交易模式（或交易模型）
交易模式简单来说就是区块链上可以找到的典型交易模型，其解释很可能是已知的。在研究模式时，我们将关注我们将要高层次分析的单一交易。换句话说，我们只会查看输入和输出的数量，而不会详细探讨其更具体的细节或其环境。从观察到的模型中，我们将能够解释交易的性质。然后，我们将寻找有关其结构的特征，并推导出一个解释。

### 简单发送（或简单支付）
此模型的特点是消耗一个或多个UTXO作为输入，并产生两个UTXO作为输出。

![analysis](assets/en/2.webp)

这个模型的解释是，我们处于发送或支付交易的状态。用户已经消耗了他们自己的UTXO作为输入，以满足输出中的支付UTXO和找零UTXO（找零返回给同一用户）。因此，我们知道观察到的用户很可能不再拥有输出中的两个UTXO之一（支付那个），但仍然拥有另一个UTXO（找零那个）。

在这一点上，我们无法指定哪个输出代表哪个UTXO，因为这不是这个模型的目标。我们将能够通过依赖我们将在下一部分研究的启发式方法来做到这一点。在这个阶段，我们的目标仅限于识别所讨论的交易的性质，即在这种情况下，是一个简单发送。

例如，这里是一个采用简单发送模式的比特币交易：
### 清扫（英文中的“sweep”）
此模型的特点是消耗单个UTXO作为输入，并产生单个UTXO作为输出。

![analysis](assets/en/3.webp)

这个模型的解释是，我们处于自我转账的状态。用户已经将他们的比特币转移到了他们自己拥有的另一个地址。事实上，由于交易中没有找零，我们很不可能是在处理一笔支付。然后我们知道，观察到的用户很可能仍然拥有这个UTXO。

例如，这里是一个采用清扫模式的比特币交易：
[35f1072a0fda5ae106efb4fda871ab40e1f8023c6c47f396441ad4b995ea693d](https://mempool.space/tx/35f1072a0fda5ae106efb4fda871ab40e1f8023c6c47f396441ad4b995ea693d)

然而，这种类型的模式也可以揭示一个自我转账到交易账户（加密货币交易平台）的行为。将是已知地址和交易上下文的研究，将使我们能够知道这是一个清扫到自我托管钱包还是提现到平台的操作。

### 合并
此模型的特点是消耗多个UTXO作为输入，并产生单个UTXO作为输出。

![analysis](assets/en/4.webp)
此模型的解释是，我们正处于一种整合（consolidation）状态。这是比特币用户间的一种常见做法，旨在通过合并多个UTXOs来预期交易费用的可能增加。通过在费用较低的时期执行此操作，可以节省未来的费用。
我们可以推断，执行此交易的用户很可能拥有所有输入的UTXOs，并且仍然拥有输出的UTXO。因此，这肯定是一次自我转账。

就像扫荡一样，这种模式也可以揭示向交易所账户的自我转账。通过研究已知地址和交易上下文，我们可以知道这是向自我保管钱包的整合还是提现到平台。

例如，这里有一个采用整合模式的比特币交易：
[77c16914211e237a9bd51a7ce0b1a7368631caed515fe51b081d220590589e94](https://mempool.space/tx/77c16914211e237a9bd51a7ce0b1a7368631caed515fe51b081d220590589e94)
### 批量支出模型
此模型的特点是输入少量UTXOs（通常只有一个）并产生许多UTXOs作为输出。

![analysis](assets/en/5.webp)

此模型的解释是，我们正处于批量支出状态。这是一种可能揭示重大经济活动的做法，例如交易所。批量支出允许这些实体通过将其支出合并到单一交易中来节省费用。

我们可以推断，UTXO的输入来自于具有重大经济活动的公司，而UTXO的输出将会分散。一些将属于公司的客户。其他可能转向合作公司。最后，肯定会有一部分变更返回给发行公司。

例如，这里有一个采用批量支出模式的比特币交易：
[8a7288758b6e5d550897beedd13c70bcbaba8709af01a7dbcc1f574b89176b43](https://mempool.space/tx/8a7288758b6e5d550897beedd13c70bcbaba8709af01a7dbcc1f574b89176b43)

### 特定协议的交易
在交易模式中，我们还可以识别出揭示使用特定协议的模型。例如，Whirlpool coinjoins将具有容易识别的结构，使它们与其他经典交易区别开来。

![analysis](assets/en/6.webp)

对此模式的分析表明，我们很可能处于一种协作交易的状态。也有可能观察到一个coinjoin。如果这个后者的假设被证明是准确的，那么输出的数量可以为我们提供参与者数量的大致估计。

例如，这里有一个采用协作交易类型coinjoin模式的比特币交易：
[00601af905bede31086d9b1b79ee8399bd60c97e9c5bba197bdebeee028b9bea](https://mempool.space/tx/00601af905bede31086d9b1b79ee8399bd60c97e9c5bba197bdebeee028b9bea)
有许多其他协议拥有它们自己特定的结构。因此，我们可以区分Wabisabi类型或Stamps交易等特定交易。
## 内部交易启发式
内部启发式是在不需要检查其环境的情况下，仅通过交易本身识别出的特定特征，这允许我们进行推断。与关注交易整体结构的模式不同，内部启发式基于可提取数据集。这包括：
- 不同UTXO的进出金额；
- 与脚本相关的所有内容：接收地址、版本控制、锁定时间...

通常，这种类型的启发式允许我们识别特定交易中的找零。这样做，我们可以继续跟踪实体跨多个不同交易的活动。

再次提醒，这些启发式并不绝对精确。单独使用时，它们只能让我们识别出可能的场景。是多个启发式的累积贡献于减少不确定性，但永远无法完全消除不确定性。

### 内部相似性
这种启发式涉及研究同一交易的输入和输出之间的相似性。如果在输入和交易的仅一个输出上观察到相同的特征，则很可能这个输出构成了找零。

最明显的特征是在同一交易中重用接收地址。

![分析](assets/en/7.webp)

这种启发式留下的疑问很少。除非他们的私钥被泄露，否则相同的接收地址不可避免地揭示了单一用户的活动。随之而来的解释是，交易的找零是输入和输出地址相同的那个输出。这允许我们继续追踪这个个体的变化。

例如，这里有一个可能适用此启发式的交易：
[54364146665bfc453a55eae4bfb8fdf7c721d02cb96aadc480c8b16bdeb8d6d0](https://mempool.space/tx/54364146665bfc453a55eae4bfb8fdf7c721d02cb96aadc480c8b16bdeb8d6d0)

这些输入和输出之间的相似性不仅限于地址重用。任何在脚本使用上的相似性都可以应用启发式。例如，有时可以观察到输入和交易的一个输出之间相同的版本控制。

![分析](assets/en/8.webp)
在这个图表中，我们可以看到输入编号0解锁了一个P2WPKH脚本（SegWit V0以"bc1q"开头）。输出编号0使用相同类型的脚本。然而，输出编号1使用了一个P2TR脚本（SegWit V1以"bc1p"开头）。这个特征的解释是，与输入版本控制相同的地址很可能是找零地址。因此，它仍然属于同一用户。
这里有一个可能适用此启发式的交易：
[db07516288771ce5d0a06b275962ec4af1b74500739f168e5800cbcb0e9dd578](https://mempool.space/tx/db07516288771ce5d0a06b275962ec4af1b74500739f168e5800cbcb0e9dd578)
在这笔交易中，我们可以看到输入编号0和输出编号1使用了P2WPKH脚本（SegWit V0），而输出编号0使用了不同的脚本类型，即P2PKH（传统）。
### 圆整数额支付
另一个内部启发式方法，可以帮助我们识别找零的是圆整数额。通常，在面对一个简单的支付模式（1个输入和2个输出）时，如果其中一个输出花费了一个圆整数额，那么它代表了支付。

![分析](assets/en/9.webp)

通过排除法，如果一个输出代表支付，另一个则代表找零。因此，我们可以解读为输入中的用户仍然拥有被识别为找零的输出。

应当注意的是，这个启发式方法并不总是适用，因为大多数支付仍然是以法定货币单位进行的。实际上，当法国的商家接受比特币时，通常他们不会以sats显示稳定的价格。他们宁愿选择将欧元价格和应支付的比特币金额之间进行转换。因此，交易输出中不应该有圆整数。尽管如此，分析师可以尝试进行这种转换，考虑到交易在网络上广播时的汇率。

如果有一天，比特币成为我们交易中首选的计价单位，这个启发式方法对于分析可能会变得更加有用。

例如，这里是一个可能适用这个启发式方法的交易示例：
### 大额支出

当在一个简单支付模型的两个交易输出之间发现足够大的差距时，可以估计较大的输出很可能是找零。

![分析](assets/en/10.webp)

这个关于最大输出的启发式方法可能是所有中最不精确的。如果单独识别，它相当弱。然而，这个特征可以与其他启发式方法结合使用，以减少我们解释的不确定性。

例如，如果我们检查一个交易，其中一个输出是圆整数额，另一个输出金额更大，圆整数支付启发式方法和关于最大输出的启发式方法的联合应用允许我们降低不确定性水平。

例如，这里是一个可能适用这个启发式方法的交易：
[b79d8f8e4756d34bbb26c659ab88314c220834c7a8b781c047a3916b56d14dcf](https://mempool.space/tx/b79d8f8e4756d34bbb26c659ab88314c220834c7a8b781c047a3916b56d14dcf)

## 交易外部启发式
研究外部启发式是分析某些元素的相似性、模式和特征，这些元素并非交易本身固有的。换句话说，如果之前我们限于利用交易内在的元素进行内部启发式分析，现在我们通过外部启发式扩展了分析领域到交易的环境。

### 地址重用
这是比特币用户中最为人所知的启发式之一。地址重用允许在不同的交易和不同的UTXOs之间建立联系。当一个比特币接收地址被多次使用时，就会观察到地址重用。

地址重用的解释是，锁定在这个地址上的所有UTXOs都属于（或曾属于）同一个实体。这个启发式留下的不确定性很小。当它被识别时，随之而来的解释很有可能对应现实。
正如引言中所解释的，这种启发式方法是由中本聪本人发现的。在白皮书中，他特别提到了一种防止用户产生它的解决方案，那就是对每一笔新交易都使用一个新地址：“*作为一个额外的防火墙，每一笔交易都可以使用一对新的密钥，以保持它们不与一个共同的所有者关联。*”

例如，这里有一个地址在多笔交易中被重复使用：
[bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0](https://mempool.space/address/bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0)

### 脚本的相似性和钱包指纹
除了地址重用之外，还有许多其他启发式方法可以将行动链接到同一个钱包或一组地址。

首先，分析师可以使用脚本使用上的相似性。例如，某些少数脚本，如多签名，比SegWit V0脚本更容易被发现。我们隐藏的群体越大，我们就越难被发现。这就是为什么在Coinjoin Whirlpool协议上，所有参与者都使用完全相同类型的脚本的原因。

更广泛地说，分析师还可以关注钱包的特征指纹。这些是特定于使用的过程，人们可能会寻求识别它们，以便将它们作为追踪启发式方法。换句话说，如果观察到归因于被追踪实体的交易上有相同内部特征的积累，人们可以尝试在其他交易上识别这些相同的特征。

例如，可以识别出被追踪用户系统性地将他们的零钱发送到P2TR*地址（bc1p…）。如果这一过程重复，它可以作为我们分析的启发式方法。其他指纹也可以使用，如UTXOs的顺序、输出中零钱的放置、RBF（Replace-by-Fee）的标记，甚至是版本号和锁定时间。
正如[@LaurentMT](https://twitter.com/LaurentMT)在[Space Kek #19](https://podcasters.spotify.com/pod/show/decouvrebitcoin/episodes/SpaceKek-19---Analyse-de-chane--anonsets-et-entropie-e1vfuji)（一个法语播客）中指出的，钱包指纹在链分析中的作用随着时间的推移显著增加。实际上，脚本类型的增加和这些新功能由钱包软件逐渐部署的加剧，突出了差异。甚至有时可以准确识别被追踪实体使用的软件。因此，了解钱包指纹的研究对于近期交易特别相关，比起那些在2010年代初期发起的交易更是如此。
总结来说，指纹可以是任何特定的实践，由钱包自动执行或用户手动执行，可以在其他交易上找到以协助我们的分析。

### CIOH
CIOH，即“Common Input Ownership Heuristic”，可以翻译为“输入共同所有权启发式”或“共同消费启发式”，是一种启发式方法，它声明当一个交易有多个输入时，这些输入很可能都来自单一实体。因此，它们的所有权是共同的。
要应用CIOH，首先要观察一个有多个输入的交易。这可能是两个输入，也可能是三十个输入。一旦发现了这个特征，就要检查交易是否不符合已知模式。例如，如果它有5个输入，数量大致相同，以及5个输出，数量完全相同，我们知道这是Coinjoin Whirlpool的结构。因此，CIOH不能被应用。

然而，如果交易不符合任何已知的协作交易模式，那么可以解释为所有输入很可能来自同一个实体。这对于扩展已知的群集或继续跟踪非常有用。

![分析](assets/en/11.webp)

CIOH是由中本聪发现的。他在白皮书的第10部分讨论了这一点：“*[…]与多输入交易的链接是不可避免的，这必然揭示了它们的输入是由同一所有者拥有的。风险在于，如果一个密钥的所有者被揭露，链接可能会揭示属于同一所有者的其他交易。*”
特别值得注意的是，中本聪甚至在比特币正式推出之前，就已经识别出了用户的两个主要隐私漏洞，即CIOH和地址重用。这种远见非常了不起，因为这两种启发式方法，即使在今天，仍然是链上分析中最有用的。

### 链下数据
显然，链上分析不仅限于链上数据。之前的分析数据或可在互联网上访问的任何数据也可以用来精细化分析。

例如，如果观察到被追踪的交易系统性地从同一个比特币节点广播，并且可以识别其IP地址，那么可能会发现来自同一实体的其他交易。

分析师还可以依赖之前公开的分析，或他们自己之前的分析。也许人们会发现一个输出指向一个已经被识别的地址群集。有时，也可以依赖指向交易所的输出，这些平台的地址通常是已知的。

同样，人们可以通过排除法进行分析。例如，如果在分析一个有两个输出的交易时，其中一个输出与被追踪实体不同的已知地址群集相关联，那么可以解释为另一个输出很可能代表找零。

链上分析还包括一部分更通用的OSINT（开源情报），即互联网搜索。这就是为什么建议不要在社交媒体或网站上直接发布接收地址，无论是使用化名还是不使用化名。

### 时间模型
人们可能不会立即想到，但某些人类行为在链上是可以识别的。在研究中最有用的是你的睡眠模式！是的，当你睡觉时，你大概不会广播比特币交易。由于你通常在大约相同的时间睡觉，因此在链上分析中常用时间分析。它仅涉及记录给定实体的交易广播到比特币网络的时间。分析这些时间模式允许我们推断出许多信息。
首先，时间分析有时可以识别被追踪实体的性质。如果观察到交易在24小时内持续广播，这可能表明强烈的经济活动。这些交易背后的实体可能是一家企业，可能是国际性的，也许内部有自动化程序。
例如，几周前，在分析一个错误地分配了19比特币作为手续费的交易时，我认识到了这一模式。一个简单的时间分析让我假设我们正在处理一个自动化服务，因此很可能是一个大实体，如一个交易所：https://twitter.com/Loic_Pandul/status/1701127409712452072
确实，几天后，发现这些资金属于PayPal，通过Paxos交易所。

相反，如果我们看到时间模式相对分散在16个特定小时内，那么可以估计我们正在处理一个个人用户，或者可能是一个根据交换量来判断的本地商业。

除了观察到的实体的性质外，时间模式还可以给我们一个用户大致位置的线索。因此，我们可以将其他交易相关联，并使用这些交易的时间戳作为可以添加到我们分析中的额外启发式方法。

例如，在我之前提到的多次重用的地址上，可以观察到无论是进账还是出账的交易都集中在一个13小时的时间间隔内。
![analysis](assets/notext/12.webp)
*Credit: OXT*

这个间隔很可能对应于欧洲、非洲或中东。因此，可以解释说这些交易背后的用户生活在那里。

在不同的注册中，也是这种类型的时间分析让人假设中本聪不是在日本操作，而实际上是在美国：[https://medium.com/@insearchofsatoshi/the-time-zones-of-satoshi-nakamoto-aa40f035178f](https://medium.com/@insearchofsatoshi/the-time-zones-of-satoshi-nakamoto-aa40f035178f)

### 交易量分析
另一个可以使用的外部启发式方法是交易量分析。基于归因于一个实体的每笔交易中的金额，这些信息可以作为分析其余部分的额外启发式方法。
这个启发式方法显然相当弱，但当与其他启发式方法结合时，它可以帮助减少不确定性。

## 如何保护自己免受链分析？
作为比特币用户，你有权保护你的隐私。这源于你拥有和处置自己的自然权利，这是每个个体固有的，不受任何立法约束。

这种保护个人隐私的自然权利也转化为一种索赔权，载于《世界人权宣言》第12条，声明“*任何人不得受到任意干涉其隐私、家庭、住宅或通信的行为，也不得对其荣誉和声誉进行攻击。每个人都有权得到法律的保护，以免受到这种干涉或攻击。*”。

然而，专门从事链分析的公司的核心业务正是侵入你的私人领域，从而妨碍你的通信保密性。虽然人们可能希望，按照上述索赔权，国家会积极保护我们的隐私，但他们不仅忽视了这样做，而且还大量资助这些分析公司的融资。也徒劳地希望从行业协会那里得到支持，这些协会似乎愿意面对立法者做出所有让步。

事实上，比特币上的隐私索赔权并不存在。因此，由你，用户，来主张你的自然权利并保护你的通信保密性。这涉及采用各种技术和使用实践，这将使你能够防止或欺骗用于链分析的启发式方法。

### 避免落入启发式方法
首先，在考虑更激进的方法之前，建议尽可能限制我们对链分析所使用的启发式方法的暴露。如前所述，两种最有力的启发式方法是地址重用和COINJOIN。
确保你在比特币上的隐私的基本原则在于，对于钱包的每笔进账交易使用一个新的、干净的地址。地址重用确实是对比特币保密性的主要威胁。
对于个人用户来说，为每笔进账支付生成一个新地址非常简单。现代钱包在你点击“接收”后会自动做到这一点。因此，如果你对交易隐私有哪怕一丝重视，使用新地址代表了最基本的要求。如果你需要在互联网上有一个静态的联系点，可以使用[像PayNym这样实现BIP47的解决方案](https://planb.network/en/tutorials/privacy/paynym-bip47)代替放置接收地址。
接下来，如果你想对抗链分析，避免在交易输入时合并UTXO。至少，如果你真的需要合并，优先选择来源相同的UTXO。这个建议意味着需要良好管理你的UTXO。购买比特币时，优先选择涉及大额的转账，以最大化不需要合并就能进行支付的次数。我还建议你在软件中给你的UTXO贴上标签，以识别它们的来源并避免合并不同来源的UTXO。

更广泛地说，对于所有其他启发式方法，你需要了解它们，尽量不要落入其中：
- 不要使用少数脚本。优先选择SegWit V0或可能的SegWit V1；
- 不要进行整数支付。例如，如果你需要向朋友发送100k sats，那么发送114,486 sats。他们会回报你一杯饮料；
- 尽量不要让找零远大于支付输出；
- 不要在社交媒体上发布你的接收地址；
- 使用自己的节点在Tor下广播你的交易；
- 尽量不要总是在同一时间广播你的比特币交易...

### 使用隐私工具
你也可以转向使你使用比特币变得模糊的方法，以防止或欺骗链分析。

最受欢迎的技术肯定是Coinjoin，一种协作交易结构，动用了多个相同金额的UTXO。这里的目标是打破确定性链接，从而阻止从现在到过去和从过去到现在的分析。Coinjoin通过在一大群无法区分的硬币中隐藏你的硬币，实现了合理的否认性。如果你想了解更多关于Coinjoin的技术和实践信息，我建议你阅读这些其他文章和教程：
- [COINJOIN - SAMOURAI WALLET](https://planb.network/en/tutorials/privacy/coinjoin-samourai-wallet);
- [COINJOIN - SPARROW WALLET](https://planb.network/en/tutorials/privacy/coinjoin-sparrow-wallet);
- [WHIRLPOOL STATS TOOLS - ANONSETS](https://planb.network/en/tutorials/privacy/wst-anonsets).
![analysis](assets/en/13.webp)

CoinJoin是为硬币创建合理否认性的绝佳工具，但它并不适用于所有用户隐私需求。具体来说，CoinJoin并非设计成为一种支付工具。它对交换的金额非常严格，以完善产生合理否认性的能力。由于不能自由选择交易输出的金额，因此CoinJoin不能用于进行比特币支付。
例如，想象一下我想用比特币支付我的法棍面包，同时优化我的隐私。由于无法选择CoinJoin结果中UTXO的金额，我会发现自己无法调整我的支出金额以适应面包师傅设定的价格。因此，CoinJoin对于支付交易来说是不够的。

为了满足更具体使用案例中的隐私需求，人们构想了其他工具。例如，我们有[PayJoin](https://planb.network/en/tutorials/privacy/payjoin)，这是一种只涉及两个参与者的迷你CoinJoin，基于一个允许支付的结构。

PayJoin的独特之处在于它能够产生一笔看起来普通的交易，而实际上是两个用户之间的迷你CoinJoin。在这种结构中，交易的接收者参与输入，与实际发送者一起。因此，接收者在交易中插入了一笔对自己的支付，以便促成实际支付。

例如，如果你从你的面包师傅那里以10,000 sats的UTXO购买了一根价值6,000 sats的法棍面包，并且你想进行PayJoin，你的面包师傅会添加一个属于他们的15,000 sats的UTXO作为输入到你原始的交易中，他们将完全恢复为输出，以此来欺骗启发式分析：

![分析](assets/en/14.webp)

为了简化对方案的理解，忽略了交易费用。

PayJoin的目标有两个。首先，它旨在通过创建一个通过COH的诱饵来欺骗外部观察者。实际上，当分析师观察这笔交易时，他们会认为可以应用COH，从而假设不同输入的共同所有权。实际上，这个假设是不正确的，因为一个输入属于发送者，而另一个属于接收者。因此，PayJoin通过引导分析师走错路来破坏链分析。

PayJoin的第二个目标是通过其输出的特定结构欺骗分析师关于交易实际金额的信息。因此，PayJoin属于隐写术领域。它允许将交易的真实金额隐藏在一个欺骗性交易中。

实际上，如果我们重新审视使用PayJoin购买法棍面包的例子，外部观察者可能会认为我们正在处理一笔4,000 sats或21,000 sats的支付。实际上，法棍面包的支付是6,000 sats：21,000 - 15,000 = 6,000。因此，支付的真实价值隐藏在一个充当链分析诱饵的假支付中。

除了PayJoin和CoinJoin之外，还有许多其他比特币交易结构，要么阻止链分析，要么欺骗它。其中，我可以提到[Stonewall](https://planb.network/en/tutorials/privacy/stonewall)和[StonewallX2](https://planb.network/en/tutorials/privacy/stonewall-x2)交易，它们允许进行灵活的迷你Coinjoin或模仿灵活的迷你Coinjoin。还有[Ricochet](https://planb.network/en/tutorials/privacy/ricochet)交易，通过进行大量假装对自己的转账来模拟比特币所有权的变更。

所有这些工具都可以在移动端的Samourai Wallet和PC端的Sparrow Wallet上使用。如果你想了解更多关于这些特定交易结构的信息，我建议你发现我的教程：
- [PAYJOIN](https://planb.network/en/tutorials/privacy/payjoin)；
- [PAYJOIN - SAMOURAI 钱包](https://planb.network/en/tutorials/privacy/payjoin-samourai-wallet)；
- [PAYJOIN - SPARROW 钱包](https://planb.network/en/tutorials/privacy/payjoin-sparrow-wallet)；
- [STONEWALL](https://planb.network/en/tutorials/privacy/stonewall)；
- [STONEWALL X2](https://planb.network/en/tutorials/privacy/stonewall-x2)；
- [RICOCHET](https://planb.network/en/tutorials/privacy/ricochet)。

## 结论
链分析是一种试图追踪比特币链上流动的实践。为此，分析师寻找模式和特征，以便提出或多或少可信的假设和解释。

这些启发式方法的准确性各不相同：有些提供了更高程度的确定性，但没有一个能够声称是绝对可靠的。然而，多个趋同的启发式方法的累积可以缓解这种固有的疑问，尽管完全消除它是不可能的。
我们可以将这些方法分为三个不同的主要类别：
- 模式，专注于每笔交易的整体结构；
- 内部启发式，允许对交易的所有细节进行详尽的检查，而不扩展到其上下文；
- 外部启发式，包括对交易及其环境的分析，以及可能提供洞察的任何外部数据。

作为比特币用户，掌握链分析的基本原则以有效对抗之，从而保护您的隐私是至关重要的。

## 技术小词汇表：
**P2PKH：** 是 Pay to Public Key Hash 的缩写。它是一种标准的脚本模型，用于建立对UTXO的支出条件。它允许将比特币锁定在公钥的哈希上，即接收地址上。这种脚本与Legacy标准相关联，并由Satoshi Nakamoto在比特币的最初版本中引入。与P2PK不同，P2PK在脚本中明确包含公钥，P2PKH使用公钥的加密印记，以及一些元数据，也称为“接收地址”。这个脚本包括公钥的SHA256的RIPEMD160哈希，并规定，要访问资金，收件人必须提供与此哈希匹配的公钥，以及从关联的私钥生成的有效数字签名。P2PKH地址使用Base58Check格式编码，通过使用校验和来给它们提供抵抗错别字的能力。这些地址总是以数字1开头。
**P2TR:** 是指向Taproot支付（"pay to the root"）的缩写。它是一种标准的脚本模型，用于在UTXO上建立支付条件。P2TR在2021年11月引入Taproot实施时被引入。它利用Schnorr协议来聚合加密密钥，以及用于备选脚本的Merkle树，这些备选脚本被称为MAST（Merkelized Alternative Script Tree）。与传统交易不同，传统交易中支付条件是公开暴露的（有时在收据上，有时在支付时），P2TR允许在单个明显的公钥后隐藏复杂脚本。技术上，P2TR脚本在一个独特的Schnorr公钥上锁定比特币，表示为K。然而，这个K键实际上是公钥P和公钥M的聚合，后者是从ScriptPubKeys列表的Merkle根计算出来的。键聚合使用Schnorr签名协议执行。使用P2TR脚本锁定的比特币可以通过两种不同的方式花费：要么发布公钥P的签名，要么满足Merkle树中包含的一个脚本。第一个选项称为“键路径”，第二个称为“脚本路径”。因此，P2TR允许用户将比特币发送到公钥或他们选择的多个脚本。这种脚本的另一个优点是，尽管有多种方式可以花费P2TR输出，但只有使用的那种方式需要在花费时被揭示，允许未使用的替代方案保持私密。例如，由于Schnorr键聚合，公钥P本身可以是一个聚合键，可能代表一个多签名。P2TR是版本1的SegWit输出，这意味着P2TR输入的签名存储在交易的见证部分，而不是ScriptSig中。P2TR地址使用Bech32m编码，以bc1p开头。

**P2WPKH:** 是向见证公钥哈希支付（Pay to Witness Public Key Hash）的缩写。它是一种标准的脚本模型，用于在UTXO上建立支付条件。P2WPKH在2017年8月引入SegWit实施时被引入。这种脚本类似于P2PKH（向公钥哈希支付），因为它也基于公钥的哈希（即接收地址）锁定比特币。区别在于签名和脚本是如何包含在交易中的。在P2WPKH的情况下，签名脚本信息（ScriptSig）从传统交易结构移动到一个称为见证的单独部分。这一移动是SegWit（隔离见证）更新的一个特点。这种技术有减少主体中交易数据大小的优点，同时在一个单独的部分保留了验证所需的脚本信息。因此，P2WPKH交易在费用方面通常比传统交易便宜。P2WPKH地址使用Bech32编码书写，这有助于更简洁、更少出错的书写，得益于BCH校验和。这些地址始终以bc1q开头，使它们容易与传统接收地址区分开来。P2WPKH是版本0的SegWit输出。
**UTXO:** 是未花费交易输出（Unspent Transaction Output）的缩写。UTXO是指尚未被用作新交易输入的交易输出。UTXOs代表用户拥有并且当前可用于支出的比特币的一部分。每个UTXO都与一个特定的输出脚本关联，该脚本定义了花费比特币所需的条件。比特币中的交易消耗这些UTXOs作为输入，并创建新的UTXOs作为输出。UTXO模型对于比特币至关重要，因为它允许轻松验证交易是否试图花费不存在或已经被花费的比特币。本质上，UTXO是比特币的一部分。