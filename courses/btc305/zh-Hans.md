---
name: 比特币与BTC支付服务器（BTCPay Server）
goal: 为您的企业安装BTC支付服务器
objectives:
  - 理解btcpayserver。
  - 自己运行并配置BTC支付服务器。
  - 在您的日常业务中使用btcpayserver。
---

# 比特币与BTCPay服务器

这是由Alekos和Bas编写的关于BTCPay服务器操作器的入门课程，由melontwist和asi0按照PlanB课程格式进行改编。

一个未完成的故事

“这是谎言，我对你的信任已破碎，我将让你变得陈旧”。

由BTCPay服务器基金会制作

+++

# 引言

<partId>59e43fe3-b494-5da6-b4b4-9df5bdf08916</partId>

## 对作者的比特币和BTCPay服务器的好评

<chapterId>e1fe6294-3c82-5203-9537-779f9087c35a</chapterId>

BTCPay服务器是什么？它来源于什么？我们从这两个问题开始。我们非常重视透明度和一些标准，以在比特币领域中构建信任。
一个项目违背了这些价值。BTCPay服务器的主要开发者Nicolas Dorier将此事视为个人攻击，并承诺淘汰他们。多年后，我们今天正在朝着这个未来努力，每天都在全力将其变得开源。

> 这是谎言，我对你的信任已破碎，我将让你变得陈旧
> Nicolas Dorier

在Nicolas发表这番话之后，建设就开始了。我们现在已经为BTCPay服务器的项目投入了大量的努力，而且越来越多的人想要帮助推动这一进程。最为人所熟知的为r0ckstardev、MrKukks、Pavlenex，以及第一个使用该软件的商家astupidmoose。

开源是什么意思？为这个项目需要投入什么？

FOSS是自由和开源软件的简称（Free & Open-Source Software）。前者指的是允许任何人复制、修改甚至分发软件版本（甚至可为盈利使用）的条款。后者指的是公开分享源代码，鼓励公众改进它并为它贡献。
这让充满激情且经验丰富的用户为他们已使用并从很有价值的软件做出贡献。随着时间的推移，这个开源软件在采用方面上往往优于专有软件。这与比特币的理念“信息渴望自由”是一致的。它汇集了充满激情的人们，形成了一个社区，而且将其变得更有趣。就像比特币，FOSS是不可避免的。

### 开始前说明

本课程由多个部分组成。课堂老师负责其中许多部分的教学。此外，您将获得访问权限的演示环境，一个为您自己托管的服务器，而且可能还有一个域名。如果您独立完成此课程，请注意您将无法使用标记为DEMO的环境。
注意：如果您通过课堂学习本课程，服务器名称可能会因您的课堂设置而有所不同。由于这个原因，服务器名称中的变量可能会有所不同。

### 课程结构

每个章节都有各自的目标和知识评估。在本课程中，我们将探索每个目标，并在每个课程块（即章节）的结尾总结其关键特点。我们为您提供了一些插图，为了巩固对相关内容的理解。每个课程块中都有已被设定的目标。这些目标不仅仅是一个清单。它们为您提供了进入新技能集的指南。知识评估的难度将逐渐增加，以帮助您更好地设置您的BTCPay服务器。

### 学生在课程中会获得什么？
通过BTCPay Server课程，学生可以理解比特币的技术性和非技术性的基本原理。通过BTCPay Server的全面培训项目，学生将能够操作自己的比特币基础设施。

### 重要的网址或联系机会

BTCPay Server基金会位于日本东京，他们已允许Alekos和Bas编写此课程的内容。您可以通过下列网站联系BTCPay Server基金会：

- https://foundation.btcpayserver.org
- 加入官方聊天频道：https://chat.btcpayserver.org

## 比特币简介

<chapterId>5c0bc234-c188-5b4a-94d5-adee87a120e2</chapterId>

### 通过课堂练习理解比特币

这是一个课堂练习，所以如果您独立参加这个课程，您不能进行练习，但您仍然可以阅读练习内容。完成这项任务的最少人数为9至11位人之间。

练习将在您观看BBC的介绍“比特币和区块链是如何运作的”之后开始。

![比特币和区块链是如何运作的](https://youtu.be/mhE_vvwAiRc)

这个练习的参加者人数要求为至少9位。这个练习旨在通过实际体验理解比特币的运作原理。通过在网络中充当多种角色，您将可以以互动和有趣的方式学习。此练习不涉及闪电网络。

### 示例；需要9至11位人

角色如下：

- 1位顾客
- 1位商家
- 7到9位比特币节点

**设置如下：**

顾客使用比特币从商店购买产品。

**第一场景 - 传统银行体系**

- 设置方式：
  - 请参见附加的 Figjam - 活动示意图中的图表/说明 - [活动示意图](https://www.figma.com/file/ckmvMq02Jm2MegSsVCDFhc/Day-1-Classroom-Activity?type=whiteboard&node-id=0-1&t=KR31ofMaJX6S95UL-0)。
  - 三名学生将分别充当顾客（Alice）、商家（Bob）和银行角色。
- 按顺序演示列出的场景：
  - 顾客- 在线浏览商店并找到一件他/她想要的、价值为25美元的商品，并告知商家他们想要购买
  - 商家- 请求付款。
  - 顾客- 将卡信息发送给商家
  - 商家- 将信息转发给银行（为了识别出他们自己和身份/信息），请求支付
  - 银行将收集顾客和商家（Alice和Bob）的相关信息，并检查顾客的余额是否充足。
  - 银行将从Alice的账户扣除25美元，向Bob的账户添加24美元，并收取1美元的服务费
  - 商家从银行已获得验证，然后将商品寄给顾客。
- 评论：
  - Bob和Alice必须与银行有关系。
  - 银行收集有关Bob和Alice的信息。
  - 银行收取费用。
  - 必须一直信任银行来保管每个参与者的资金。

**场景2 - 比特币系统**

- 设置：
  -  请参见附加的 Figjam - 活动示意图中的图表/说明 - [活动示意图](https://www.figma.com/file/ckmvMq02Jm2MegSsVCDFhc/Day-1-Classroom-Activity?type=whiteboard&node-id=0-1&t=KR31ofMaJX6S95UL-0)。
- 指示九名学生代替银行角色，他们将充当网络中的计算机（比特币节点/矿工）的角色，以取代银行。
- 每一台计算机都拥有所有过去交易的完整历史记录（因此，账户余额是准确而无伪造的），以及一套规则：
  - 验证交易的签名是否符合要求（钥匙要匹配锁）
  - 向网络中的参与者传播交易信息，并接收有效并丢弃无效的交易（包括任何尝试双重支付的交易）
- 定期使用从“随机”计算机收到的新交易更新/添加记录，前提是所有内容都是有效的（注意：现在，为了简化，我们忽略了所有这些的工作证明组件），否则拒绝这些交易并继续之前的操作，直到下一个“随机”计算机发送更新
  - 如果内容有效，则奖励适当金额。
- 演练事件序列：
  - 客户- 在线浏览商店并找到他们想要的25美元商品，并通知商家他们想要购买
  - 商家- 通过从他们的钱包发送客户一个发票/地址来请求付款。
  - 客户- 构建一个交易（发送价值25美元的BTC到商家提供的地址）并将其广播到比特币网络。
- 计算机- 接收交易并验证：
  - 发送地址中至少有25美元的BTC
  - 交易被正确签名（由客户“解锁”）
  - 如果不是这种情况，则交易不会在网络中传播，如果是，则它会传播并等待。
  - 商家可以检查交易是否正在等待中。
- 一台计算机被“随机”选择来提议通过广播包含该交易的“一个区块”来完成提议的交易；如果检查无误，他们将获得BTC奖励。
  - 可选/高级 - 代替随机选择一台计算机，通过让计算机掷骰子直到某个预定结果发生来模拟挖矿（例如，第一个掷出双六的被选中）
  - 它还可以演示如果两台计算机几乎同时赢得比赛，导致链分裂的情况。
  - 计算机检查有效性，如果规则满足，则更新/添加记录到他们的账本，并将区块广播给同伴。
  - 被随机选择的计算机因提议有效区块而获得奖励。
  - 商家检查交易是否已完成；因此，资金已收到，商品已发送给客户。
- 评论：
  - 注意，不需要预先存在的银行关系。
  - 无需第三方协助；由代码/激励措施替代。
  - 除了直接交换所需的必要信息外，没有人收集数据（例如，收货地址）。
  - 人们之间不需要信任（除了商家发送商品），在很多方面就像现金购买。
  - 钱直接由个人拥有。
  - 为了简化，比特币账本以美元显示，但实际上是BTC。
  - 我们模拟了一次交易的广播，但实际上，网络中有多个交易正在等待，区块一次包含成千上万的交易。节点还检查网络中是否有双重支付交易待处理（如果是这种情况，我会丢弃除一个之外的所有交易）。
- 作弊情景：
  - 如果客户没有25美元的BTC怎么办？
    - 他们将无法创建交易，因为“解锁”和“所有权”是同一回事，计算机检查交易是否正确签名；否则，他们会拒绝它。
- 如果随机选择的计算机试图“更改账本”会怎样？ - 该区块会被拒绝，因为其他每一台计算机都有完整的历史记录，并会注意到更改，这违反了它们的规则之一。
    - 随机计算机将不会获得奖励，且其区块中的任何交易都不会被最终确认。

## 知识评估

<chapterId>1461f064-933d-50ea-8935-324b68ec5d5f</chapterId>

### KA课堂讨论

讨论在第二种情景下课堂练习中所做的一些过度简化，并更详细地描述实际的比特币系统是如何运作的。

### KA词汇复习

定义之前部分介绍的以下关键术语：

- 节点
- 内存池
- 难度目标
- 区块

**作为一个小组讨论一些额外的术语含义：**

区块链、交易、双重支付、拜占庭将军问题、挖矿、工作量证明（PoW）、哈希函数、区块奖励、区块链、最长链、51%攻击、输出、输出锁定、找零、聪、公钥/私钥、地址、公钥密码学、数字签名、钱包

# 介绍BTCPay服务器

<partId>9c8a2d0c-9ba1-5c39-874c-f9eaf1bba663</partId>

## 理解BTCPay服务器登录界面

<chapterId>14aad54c-9bd8-54f2-9455-178b8ae63408</chapterId>

### 使用BTCPay服务器

本课程块的目标将是对BTCPay服务器软件有一个总体的理解。在共享环境中，建议跟随讲师的演示，并跟随BTCPay服务器课程手册与老师一起学习。您将学习通过多种方法创建钱包。示例包括热钱包设置和通过BTCPay服务器保险库连接的硬件钱包。这些目标发生在演示环境中，由您的课程讲师显示并提供访问。

如果您自己跟随此课程，您可以在https://directory.btcpayserver.org/filter/hosts找到第三方主机的列表，用于演示目的。我们强烈建议不要将这些第三方选项用作生产环境，但它们适用于介绍使用比特币和BTCPay服务器的目的。

作为BTCPay服务器摇滚明星培训生，您可能之前有设置比特币节点的经验。本课程将专门讨论BTCPay服务器软件堆栈。

BTCPay服务器中的许多选项在其他与比特币钱包相关的软件中以某种形式存在。

### BTCPay服务器登录屏幕

当您被欢迎进入演示环境时，您会被要求‘登录’或‘创建您的账户’。出于安全原因，服务器管理员可能会关闭创建新账户的功能。BTCPay服务器的标志和按钮颜色可以更改，因为BTCPay服务器是开源软件。第三方主机可以对软件进行白标签处理并更改整个外观。

![image](assets/en/0.webp)

### 创建账户窗口

在BTCPay服务器上创建账户需要有效的电子邮件地址字符串；example@email.com将是电子邮件的有效字符串。

密码需要至少8个字符长，包括字母、数字和字符。设置密码后，您将必须验证输入的密码，以确保它与第一个密码字段中输入的密码正确无误。
当电子邮件和密码字段都正确填写后，点击“创建账户”按钮。这将在讲师的BTCPay服务器实例上保存电子邮件和密码。
![image](assets/en/1.webp)

**！注意！**

如果你自己跟随本课程，创建这个账户可能是你在第三方主机上要做的事情；因此，我们再次提醒，永远不要将这些用作生产环境，而只用于培训目的。

### 由BTCPay服务器管理员创建账户

BTCPay服务器实例的管理员也可以为BTCPay服务器创建账户。BTCPay服务器实例的管理员可以点击“服务器设置”（1），点击“用户”标签（2），然后在用户标签的右上角点击“+添加用户”按钮（3）。在目标（4.3）中，你将了解更多关于管理员控制账户的信息。

![image](assets/en/2.webp)

作为管理员，你需要用户的电子邮件地址并设置一个标准密码。作为管理员，建议通知用户在使用账户前应更改此密码以确保安全。如果管理员没有设置密码，并且服务器上设置了SMTP，用户将收到一封电子邮件，其中包含一个邀请链接来创建他们的账户并自行设置密码。

### 示例

按照讲师的课程进行操作时，跟随讲师提供的链接，在提供的演示环境中创建你的账户。确保你的电子邮件地址和密码被安全保存；在本课程的其余演示目标中，你将需要这些登录凭据。

你的讲师可能已经提前收集了电子邮件地址，并在此练习之前发送了邀请链接。如果有指示，请检查你的电子邮件。

在没有讲师的情况下进行课程时，使用BTCPay服务器演示环境创建你的账户；前往

https://mainnet.demo.btcpayserver.org/login。

这个账户只应用于演示/培训目的，绝不用于业务。

### 技能总结

在本节中，你学到了以下内容：

- 如何通过界面在托管服务器上创建账户。
- 服务器管理员如何在服务器设置中手动添加用户。

### 知识评估

#### KA概念回顾

给出使用演示服务器用于生产目的是个坏主意的理由。

## 管理用户账户

<chapterId>b58ca6ee-b7fc-5e81-a6aa-c8ff212b4c55</chapterId>

### 在BTCPay服务器上管理账户

商店所有者创建账户后，他们可以在BTCPay服务器UI的左下角管理它。在账户按钮下面，有多个高级设置。

- 暗/亮模式。
- 隐藏敏感信息开关。
- 管理账户。

![image](assets/en/3.webp)

### 暗和亮模式

BTCPay服务器的用户可以在UI的暗模式或亮模式版本之间选择。面向客户的页面不会改变。它们使用客户偏好的关于暗或亮模式的设置。

### 隐藏敏感信息开关

隐藏敏感信息按钮带来了一个快速简单的安全层。每当你需要操作你的BTCPay服务器，但可能有人在公共场所偷看你的肩膀时，打开隐藏敏感信息，BTCPay服务器中的所有值都将被隐藏。可能有人能够偷看你的肩膀，但不再能看到你正在处理的值。

### 管理账户

一旦用户账户被创建，这里就是管理密码、双因素认证或API密钥的地方。
### 管理账户 - 账户
可选择使用不同的电子邮件地址更新您的账户。为了确保您的电子邮件地址正确，BTCPay Server允许您发送验证电子邮件。如果用户设置了新的电子邮件地址并确认验证有效，则点击保存。用户名保持与之前的电子邮件相同。

用户可能决定删除他们的整个账户。这可以通过点击账户标签上的删除按钮来完成。

![image](assets/en/4.webp)

**！注意！**

更改电子邮件后，账户的用户名不会改变。之前给出的电子邮件地址将保留为登录名。

### 管理账户 - 密码

学生可能想要更改他的密码。他可以通过前往密码标签来做到这一点。在这里，他需要输入他的旧密码，并可以将其更改为新密码。

![image](assets/en/5.webp)

### 双因素认证 (2fa)

为了限制密码被盗的后果，您可以使用双因素认证（2fa），这是一种相对较新的安全方法。您可以通过管理账户和双因素认证标签激活双因素认证。在使用用户名和密码登录后，您必须完成第二步。

BTCPay Server允许通过两种方式启用2FA，基于应用的2FA（Authy、Google、Microsoft认证器）或通过安全设备（FIDO2或LNURL Auth）。

### 双因素认证 - 基于应用

根据您的手机操作系统（Android或iOS），用户可以选择以下应用之一；

1. 下载双因素认证器；
   - 对于[Android](https://play.google.com/store/apps/details?id=com.authy.authy)或[iOS](https://apps.apple.com/us/app/authy/id494168017)的Authy
   - 对于[Android](https://play.google.com/store/apps/details?id=com.azure.authenticator)或[iOS](https://apps.apple.com/us/app/microsoft-authenticator/id983156458)的Microsoft Authenticator
   - 对于[Android](https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=e%C2%80)或[iOS](https://apps.apple.com/us/app/google-authenticator/id388497605)的Google Authenticator
2. 下载并安装认证器应用后。
   - 扫描BTCPay Server提供的QR码
   - 或将BTCPay Server生成的密钥手动输入到您的认证器应用中。
3. 认证器应用将为您提供一个唯一的代码。在BTCPay Server中输入这个唯一的代码以验证设置，然后点击验证以完成过程。

![image](assets/en/6.webp)

### 技能总结

在本节中，您学到了以下内容：

- 账户管理选项以及在BTCPay Server实例上管理账户的各种方式。
- 如何设置基于应用的2FA。

### 知识评估

#### KA 概念回顾

描述基于应用的2FA如何帮助保护您的账户

## 创建新店铺

<chapterId>463b3634-b49f-5512-a711-3b2e096fc2e0</chapterId>

### 创建您的店铺向导
当新用户登录到BTCPay Server时，环境是空的，需要创建一个首个商店。BTCPay Server的引导向导将给用户一个“创建您的商店”（1）的选项。商店可以被视为满足您比特币需求的家。一个新的BTCPay Server节点将从同步比特币区块链（2）开始。根据您运行BTCPay Server的基础设施，这可能需要几小时到几天不等。实例的当前版本显示在您的BTCPay Server UI的右下角。这在故障排除时用作参考是很有用的。
![image](assets/en/7.webp)

### 创建您的商店向导

按照本课程将开始于一个与前一页略有不同的屏幕。由于您的讲师已经准备了演示环境，比特币区块链已经提前同步，因此您将不会看到节点的同步状态。

用户可能决定删除他们的整个账户。这可以通过点击账户标签上的删除按钮来完成。

![image](assets/en/8.webp)

**！注意！**

BTCPay Server账户可以创建无限数量的商店。每个商店都是一个钱包或“家”。

### 示例

首先点击“创建您的商店”。

![image](assets/en/9.webp)

这将为您使用BTCPay服务器创建您的第一个家和仪表板。

(1) 点击“创建您的商店”后，BTCPay Server将要求您命名商店；这可以是对您有用的任何东西。

![image](assets/en/10.webp)

(2) 接下来必须设置一个默认商店货币，可以是法定货币或以比特币/聪为单位。对于演示环境，我们将其设置为USD。

![image](assets/en/11.webp)

(3) 作为商店设置的最后一个参数，BTCPay Server要求您设置一个“首选价格来源”，以便将比特币的价格与当前法定价格进行比较，从而使您的商店显示比特币与商店设置的法定货币之间的正确汇率。我们将在演示示例中坚持使用默认设置，并将其设置为Kraken交易所。BTCPay Server使用Kraken API来检查汇率。

![image](assets/en/12.webp)

(4) 现在这些商店参数已经设置好，点击创建按钮，BTCPay Server将创建您的第一个商店的仪表板，向导将继续。

![image](assets/en/13.webp)

恭喜您，您已经创建了您的第一个商店，这完成了本练习。

![image](assets/en/14.webp)

### 技能总结

在本节中，您学到了：

- 商店创建和配置默认货币，结合价格来源偏好。
- 每个“商店”都是从BTCPay Server的这次安装中分离出来的新家。

# 介绍保护比特币密钥

<partId>25da22d8-fd37-51c5-af2a-58b9f3b046b2</partId>

## 理解比特币密钥生成

<chapterId>d162735b-847b-578e-83b8-a044ab703ec5</chapterId>

### 生成比特币密钥涉及什么？

创建比特币钱包时，会创建一个所谓的“种子”。在最后一个目标中，您创建了一个“种子”，之前生成的一系列词也被称为助记词。种子用于派生单个比特币密钥，并用于发送或接收比特币。种子短语绝不应与第三方或不受信任的同伴共享。
种子生成遵循业界标准，称为“分层确定性”（HD）框架。
![image](assets/en/15.webp)

### 地址

BTCPay Server 构建以生成新地址。这缓解了公钥或地址重用的问题。使用相同的公钥使得追踪您的整个支付历史变得非常容易。将密钥视为一次性使用的凭证将显著提高您的隐私。我们也使用比特币地址，不要将这些与公钥混淆。

地址是通过“哈希算法”从公钥派生而来的。然而，大多数钱包和交易将显示地址而不是那些公钥。一般来说，地址比公钥短，通常以`1`、`3`或`bc1`开头，而公钥以`02`、`03`或`04`开头。

- 以`1.....`开头的地址仍然非常常见。如创建新商店章节所述，这些是传统地址。该地址类型用于P2PKH交易。P2Pkh使用Base58编码，这使得地址区分大小写。其结构基于公钥，并附加一个作为标识符的数字。

- 以`bc1...`开头的地址正慢慢变得非常常见。这些被称为（原生）SegWit地址。这些地址提供比其他提到的地址更好的费用结构。原生SegWit地址使用Bech32编码，并且只允许小写字母。

- 以`3...`开头的地址通常仍然被交易所用作存款地址。这些地址在创建新商店章节中提到，包装或嵌套的SegWit地址。然而，它们也可以作为“多签名地址”。当用作SegWit地址时，交易费用再次有一些节省，但不如原生SegWit。P2SH地址使用Base58编码。这使得它像传统地址一样区分大小写。

- 以`2...`开头的地址是测试网地址。它们用于接收测试网比特币（tBTC）。您绝对不应该混淆这一点，将比特币发送到这些地址。出于开发目的，您可以生成一个测试网钱包。在线上有多个水龙头可以获取测试网比特币。永远不要购买测试网比特币。测试网比特币是被挖出来的。这可能是开发者使用Regtest的一个原因。这是一个为开发者准备的游乐场环境，缺少某些网络组件。然而，比特币对于开发目的来说非常有用。

### 公钥

公钥在实践中的使用越来越少。随着时间的推移，比特币用户已经开始用地址代替它们。它们确实仍然存在并偶尔被使用。一般来说，公钥比地址的字符串要长得多。就像地址一样，它们以特定的标识符开头。

- 首先，`02...`和`03...`是非常标准的公钥标识符，以SEC格式编码。这些可以被处理并转换为接收地址，用于创建多签名地址，或用于验证签名。早期的比特币交易使用公钥作为P2PK交易的一部分。

- 然而，HD钱包使用不同的结构。`xpub...`、`ypub...`或`zpub...`被称为扩展公钥，也叫xpubs。这些密钥用于派生许多公钥，因为它是HD钱包的一部分。由于您的xpub包含您的整个历史记录，即过去和未来的交易，因此永远不要与不受信任的方分享这些。

### 技能总结

在本节中，您学到了以下内容：
- 地址与公钥数据类型之间的差异以及使用地址而不是公钥的好处。
### 知识评估

描述相比于地址重用或公钥方法，为每笔交易使用新地址的好处。

## 使用硬件钱包保护密钥

<chapterId>c54a6d61-5a43-5fdb-93ae-c6750de9c612</chapterId>

### 存储比特币密钥

在生成种子短语后，本书中生成的12 - 24个单词列表需要适当的备份和安全措施，因为这些单词是恢复钱包访问权限的唯一方式。HD钱包的结构以及它如何使用那一个种子确定性地生成地址，你创建的所有地址都将使用这一串代表你的种子或恢复短语的助记词列表进行备份。

保护好你的恢复短语。如果被人访问，特别是带有恶意的人，他们可以转移你的资金。保持种子安全和记住它是相互的。存储比特币私钥有几种方法，每种方法都有其优点和缺点，无论是在安全性、隐私性、便利性还是物理手段上。由于私钥的重要性，比特币用户倾向于在“自我保管”中存储和安全保管这些密钥，而不是使用像银行这样的“托管”服务。根据用户的情况，他必须使用冷存储解决方案或热钱包。

### 比特币密钥的热存储和冷存储

通常，比特币钱包被划分为热钱包或冷钱包。大多数权衡在于便利性、易用性和安全风险。这些方法也可以在托管解决方案中看到。然而，这里的权衡主要是基于安全性和隐私性的，超出了本课程的范围。

### 热钱包

热钱包是通过移动设备、网络或桌面软件与比特币互动的最便捷方式。钱包始终连接到互联网，使用户能够发送或接收比特币。然而，这也是它的弱点，钱包因为始终在线，现在更容易受到黑客或你设备上的恶意软件的攻击。在BTCPay Server中，热钱包将私钥存储在实例上。如果有恶意的人访问你的BTCPay Server商店，他们可以从这个地址窃取资金。当BTCPay Server在托管环境中运行时，你应该始终考虑这一点，并且最好不要在这种情况下使用热钱包。当BTCPay Server安装在你拥有的、由你安全信任的硬件上时，风险配置大大降低，但它永远不会消失！

### 冷钱包

个人将他们的比特币转移到冷钱包是因为它可以将私钥与互联网隔离。从方程式中移除互联网连接降低了恶意软件、间谍软件和SIM卡交换的风险。只要采取适当的预防措施以避免丢失比特币私钥，冷存储被认为在安全性和自主性方面优于热存储。冷存储最适合大量的比特币，这些比特币不打算经常花费，因为钱包设置的复杂性。

有各种方法可以将比特币密钥存储在冷存储中，从纸质钱包到脑钱包、硬件钱包，或者从一开始就是一个钱包文件。大多数钱包使用BIP 39来生成种子短语。然而，在比特币核心软件中，尚未就使用它达成共识。比特币核心软件仍然会生成一个需要存储在安全的离线位置的Wallet.dat文件。

### 技能总结

在本节中，你学到了：

- 热钱包和冷钱包在功能性和它们的权衡方面的差异。

### 知识评估 概念回顾
- 什么是钱包？
- 热钱包和冷钱包之间有什么区别？

- 描述一下“生成钱包”是什么意思？

## 使用您的比特币密钥

<chapterId>bff488de-5052-56e6-b696-97e896f762ae</chapterId>

### BTCPay服务器钱包

BTCPay服务器包含以下标准钱包功能：

- 交易
- 发送
- 接收
- 重新扫描
- 拉支付
- 支付
- PSBT
- 通用设置

### 交易

管理员可以在交易视图中查看连接到这个特定商店的链上钱包的进出交易。每笔交易都区分了收到和发送。收到的将是绿色，而外出的交易将是红色。在BTCPay服务器的交易视图中，管理员还将看到一组标准标签。

| 交易类型         | 描述                                                  |
| -------------- | ---------------------------------------------------- |
| App            | 通过应用创建的发票收到的付款                            |
| invoice        | 通过发票收到的付款                                      |
| payjoin        | 未支付，发票计时器仍未到期                              |
| payjoin-exposed| 通过发票payjoin提案暴露了UTXO                          |
| payment-request| 通过支付请求收到的付款                                  |
| payout         | 通过支付或退款发送的付款                                |

### 如何发送

BTCPay服务器的发送功能从您的BTCPay服务器链上钱包发送交易。BTCPay服务器允许多种方式签署您的交易以支出资金。交易可以通过以下方式签名：

- 硬件钱包
- 支持PSBT的钱包
- HD私钥或恢复种子。
- 热钱包

#### 硬件钱包

BTCPay服务器内置了硬件钱包支持，允许您在不向第三方应用或服务器泄露信息的情况下，使用您的硬件钱包与BTCPay保险库一起使用。BTCPay服务器内的硬件钱包集成允许您导入硬件钱包，并通过您的设备上的简单确认来支出收到的资金。您的私钥永远不会离开设备，所有资金都将针对您的完整节点进行验证，因此不会有数据泄露。

#### 使用支持PSBT的钱包签名

PSBT（部分签名比特币交易）是一种交换格式，用于还需要完全签名的比特币交易。PSBT在BTCPay服务器中得到支持，并且可以用兼容的硬件和软件钱包签名。

构建一个完全签名的比特币交易通过以下步骤进行：

- 构建一个具有特定输入和输出但没有签名的PSBT
- 导出的PSBT可以被支持此格式的钱包导入
- 可以使用钱包检查和签名交易数据
- 从钱包导出签名的PSBT文件，并与BTCPay服务器导入
- BTCPay服务器产生最终的比特币交易
- 您验证结果并将其广播到网络

#### 使用HD私钥或助记词种子签名

如果您之前使用BTCPay服务器创建了一个钱包，您可以通过将您的私钥输入到适当的字段来支出资金。在钱包>设置中设置适当的“AccountKeyPath”；否则，您无法支出。

#### 使用热钱包签名

如果您在设置商店时创建了一个新钱包并将其启用为热钱包，它将自动使用存储在服务器上的种子签名。

### RBF（费用替代）
Replace-By-Fee (RBF) 是比特币协议的一个特性，它允许您替换之前已广播但尚未确认的交易。这使得您可以随机化您的钱包交易指纹，或者通过提高手续费率来替换它，以将交易在确认（挖矿）优先级队列中提高位置。这将有效地替换原始交易，因为更高的手续费率将被优先处理，一旦确认，将使原始交易无效（不会发生双重支付）。
点击“高级设置”按钮以查看RBF选项；

![image](assets/en/16.webp)

- 为了更高的隐私随机化，允许交易被自动替换以随机化交易指纹。
- 是的，标记交易为RBF并明确替换（默认不替换，仅通过输入）
- 不，不允许交易被替换。

### 硬币选择

硬币选择是一个高级隐私增强功能，允许您在制作交易时选择您想要花费的硬币。例如，使用刚从混币操作中得到的新硬币进行支付。

硬币选择与钱包标签功能原生协作。这让您可以为进账资金贴上标签，以便更顺畅地管理和花费UTXO。

BTCPay Server还支持BIP-329进行标签管理。BIP-329允许对转账设置标签；如果您从支持这一特定BIP的钱包转账并设置了标签，BTCPay Server将识别这些标签并导入它们。迁移服务器时，这些信息也可以被导出并导入到新环境中。

### 如何接收

在BTCPay Server上点击接收按钮时，它会生成一个未使用的地址，可用于接收支付。管理员也可以通过生成新的“发票”来生成新地址。

BTCPay Server总是要求生成下一个可用地址以避免地址重用。点击“生成下一个可用的BTC地址”后，BTCPay Server生成了一个新地址和QR码。它还允许您直接为地址设置标签，以便更好地管理您的地址。

![image](assets/en/17.webp)

![image](assets/en/18.webp)

#### 重新扫描

重新扫描功能依赖于Bitcoin Core 0.17.0的“Scantxoutset”来扫描区块链当前状态（称为UTXO集）以查找属于配置的派生方案的硬币。钱包重新扫描解决了BTCPay Server用户遇到的两个问题。

1. 间隙限制问题 - 大多数第三方钱包是轻钱包，它们在许多用户之间共享一个节点。依赖轻节点和全节点的钱包限制了它们在区块链上跟踪的无余额地址的数量（通常为20），以防止性能问题。BTCPay Server为每个发票生成一个新地址。考虑到上述情况，在BTCPay Server生成20个连续未支付的发票后，外部钱包停止获取交易，假设没有新的交易发生。一旦在第21个、第22个等发票支付后，您的外部钱包将不会显示它们。另一方面，内部地，BTCPay Server钱包跟踪它生成的任何地址，并具有更大的间隙限制。它不依赖于第三方，总是可以显示正确的余额。
2. 间隙限制解决方案 - 如果您的[外部/现有钱包](https://docs.btcpayserver.org/WalletSetup/#use-an-existing-wallet)允许配置间隙限制，简单的解决方法是增加它。然而，大多数钱包不允许这样做。我们所知道允许配置间隙限制的唯一钱包是Electrum、Wasabi和Sparrow Wallet。不幸的是，您可能会在许多其他钱包中遇到问题。为了获得最佳的用户体验和隐私，考虑放弃外部钱包，使用BTCPay Server内部钱包。
#### BTCPay Server 使用 “mempoolfullrbf=1”

BTCPay Server 使用 “mempoolfullrbf=1”；我们已将其作为默认设置添加到您的BTCPay Server设置中。然而，我们还提供了一个您可以自行禁用的片段。没有 “mempoolfullrbf=1”，如果客户使用未标记RBF的交易双重支付，商家只能在确认后才知道。

管理员可能想要选择退出此设置。通过以下字符串，您可以更改默认设置。

```
BTCPAYGEN_EXCLUDE_FRAGMENTS="$BTCPAYGEN_EXCLUDE_FRAGMENTS;opt-mempoolfullrbf"
. btcpay-setup.sh -i**
```

### BTCPay Server 钱包设置

BTCPay Server内的钱包设置提供了对钱包一般设置的清晰快速概览。如果钱包是通过BTCPay Server创建的，所有这些设置都会预先填充。

![image](assets/en/19.webp)

BTCPay Server内的钱包设置提供了对钱包一般设置的清晰快速概览。BTCPay Server的钱包设置从钱包状态开始。它是只读钱包还是热钱包？根据钱包类型，操作可能会有所不同，从重新扫描钱包以查找丢失的交易，修剪历史中的旧交易，为支付链接注册钱包，到替换和删除附加到商店的当前钱包。在BTCPay Server的钱包设置中，管理员可以为钱包设置标签，以便更好地管理钱包。在这里，管理员还能看到派生方案、账户密钥（xpub）、指纹和密钥路径。钱包设置中的支付只有2个主要设置。如果交易在发票过期后（设置分钟数）内未确认，则认为支付无效。当支付交易获得X数量的确认时，认为发票已确认。管理员还可以设置一个开关，在支付时显示推荐费用或设置手动确认目标的区块数量。

![image](assets/en/20.webp)

**！注意！**

如果您自己跟随本课程，创建这个账户可能是您在第三方主机上要做的事情，因此我们再次提醒，永远不要将这些用作生产环境，而只是用于培训目的。

### 示例

#### 在BTCPay Server中设置比特币钱包

BTCPay Server允许两种钱包设置方式。一种方式是导入已经存在的比特币钱包。导入可以通过连接硬件钱包、导入钱包文件、输入扩展公钥、扫描钱包的二维码，或者最不受欢迎的，手动输入之前创建的钱包恢复种子来完成。在BTCPay Server中，也可以创建新钱包。配置BTCPay Server生成新钱包有两种可能的方式。
BTCPay Server中的热钱包选项允许使用像'Payjoin'或'Liquid'这样的功能。然而，存在一个缺点，为这个钱包生成的恢复种子将被存储在服务器上，任何拥有管理员控制权的人都可以获取恢复种子。由于您的私钥是由您的恢复种子派生的，恶意行为者可能会获得您当前和未来资金的访问权！
为了在BTCPay Server中减轻这种风险，管理员可以在服务器设置 > 策略 > “允许非管理员为他们的商店创建热钱包”中设置为否，这是默认设置。为了增强这些热钱包的安全性，服务器管理员应该在被允许拥有热钱包的账户上启用2FA认证。在公共服务器上存储私钥是危险的，带有风险。有些风险类似于闪电网络风险（见下一章节了解闪电网络风险）。

BTCPay Server提供的第二个选项是通过创建一个仅观察钱包来生成一个新钱包。BTCPay Server将一次性生成您的私钥。在用户确认已经记录下他们的种子短语后，BTCPay Server将从服务器上擦除私钥。结果是，您的商店现在连接了一个仅观察钱包。要花费您在仅观察钱包上收到的资金，请参见章节如何发送，可以通过使用BTCPay Server Vault、PSBT（部分签名的比特币交易）或者，最不推荐的，手动提供您的种子短语。

在上一部分中，您创建了一个新的“商店”。安装向导将继续询问要“设置一个钱包”还是“设置一个闪电网络节点”。在这个示例中，您将遵循“设置一个钱包”的向导过程（1）。

![image](assets/en/21.webp)

点击“设置一个钱包”后，向导将继续请求您想如何继续；BTCPay Server现在提供将现有比特币钱包连接到您的新商店的选项。如果您没有钱包，BTCPay Server建议创建一个新的。这个示例将遵循“创建一个新钱包”的步骤（2）。按照步骤学习如何“连接一个现有的钱包（1）。

![image](assets/en/22.webp)

**！注意！**

如果您在教室中参加这个课程，当前示例和我们生成的种子仅用于教育目的。这些地址上不应该有任何超出练习所需的大量金额。

(1) 通过点击“创建一个新钱包”按钮，继续“新钱包”向导。

![image](assets/en/23.webp)

(2) 点击“创建一个新钱包”后，向导的下一个窗口将给出“热钱包”和“仅观察钱包”的选项。如果您跟随一位讲师，您的环境是一个共享的演示环境，您只能创建一个仅观察钱包。注意下面两幅图之间的区别。由于您在跟随讲师的演示环境中，创建一个“仅观察钱包”并继续“新钱包”向导。

![image](assets/en/24.webp)

![image](assets/en/25.webp)

(3) 继续新钱包向导，您现在处于创建BTC仅观察钱包部分。这里我们可以设置钱包的“地址类型”，BTCPay Server允许您选择您偏好的地址类型；截至本课程编写之时，仍然推荐使用bech32地址。在本部分的第一章中详细了解地址。

- Segwit (bech32)
- 原生SegWit地址以`bc1q`开头。
  - 示例：`bc1qXXXXXXXXXXXXXXXXXXXXXX`
- 传统地址
  - 传统地址以数字`1`开头。
  - 示例：`15e15hXXXXXXXXXXXXXXXXXXXX`
- Taproot（高级用户）
  - Taproot地址以`bc1p`开头。
  - 示例：`bc1pXXXXXXXXXXXXXXXXXXXXXXXX`
- Segwit封装
  - Segwit封装地址以`3`开头。
  - 示例：`37BBXXXXXXXXXXXXXXX`

选择segwit（推荐）作为首选的钱包地址类型。

![image](assets/en/26.webp)

(4) 在设置钱包参数时，BTCPay Server允许用户通过BIP39设置一个可选的密码短语，请确保确认您的密码。

![image](assets/en/27.webp)

(5) 设置完钱包的地址类型并可能设置了一些高级选项后，点击创建，BTCPay Server将生成您的新钱包。请注意，这是在生成您的种子短语之前的最后一步。请确保只在一个不会有人通过看您的屏幕而偷取种子短语的环境中进行此操作。

![image](assets/en/28.webp)

(6) 在向导的下一个屏幕中，BTCPay Server会显示您新生成的钱包的恢复种子短语；这些是恢复您的钱包和签署交易的关键。BTCPay Server生成一个由12个单词组成的种子短语。这些单词将在此设置屏幕后从服务器中删除。这个钱包特别是一个仅观察钱包。建议不要以数字或照片形式存储这个种子短语。用户只有在积极确认他们已经记下了他们的种子短语后，才能在向导中进一步操作。

![image](assets/en/29.webp)

(7) 点击完成并保护新生成的比特币种子短语后，BTCPay Server将更新您的商店并附上新钱包，准备接收支付。在用户界面的左侧导航菜单中，注意到比特币现在已被突出显示并在钱包下激活。

![image](assets/en/30.webp)

### 示例：记录种子短语

这是使用比特币的一个非常特别且安全的时刻。如前所述，只有您应该访问或知道您的种子短语。当您跟随教师和课堂进行时，生成的种子应该只在本课程中使用。来自同学的窥视、不安全的系统以及许多其他因素使这些密钥仅具有教育性和不可信赖。然而，生成的密钥仍应为课程示例而存储。

我们将在当前情况下使用的第一种方法，也是最不安全的一种，是按正确顺序记录种子短语。种子短语卡片包含在提供给学生的课程材料中，或在BTCPay Server GitHub上找到。我们将使用这张卡片记录上一步生成的单词。确保按正确的顺序记录下来。记录下来后，根据软件给出的内容检查，确保您按正确的顺序记录下来。记录下来后，点击复选框，声明您已正确记录下您的种子短语。

### 示例：在硬件钱包上存储种子短语

在本课程中，我们讲到了在硬件钱包上存储种子短语。按照教师的课程进行可能不会总是包括这样的设备。在课程指南材料中写有一份适合此练习的硬件钱包列表。
我们将在这个示例中使用BTCPay Server保险库和Blockstream Jade硬件钱包。
您也可以通过视频跟随学习如何连接硬件钱包。
![BTCPay Server - 如何将您的硬件钱包与BTCPay Vault连接。](https://youtu.be/s4qbGxef43A)

下载BTCPay Server保险库：https://github.com/btcpayserver/BTCPayServer.Vault/releases

确保您下载了适合您系统的正确文件。Windows用户应下载[BTCPayServerVault-2.0.5-setup.exe](https://github.com/btcpayserver/BTCPayServer.Vault/releases/download/Vault%2Fv2.0.5/BTCPayServerVault-2.0.5-setup.exe)包，Mac用户下载[BTCPayServerVault-osx-x64-2.0.5.dmg](https://github.com/btcpayserver/BTCPayServer.Vault/releases/download/Vault%2Fv2.0.5/BTCPayServerVault-osx-x64-2.0.5.dmg)，Linux用户应下载[BTCPayServerVault-Linux-2.0.5.tar.gz](https://github.com/btcpayserver/BTCPayServer.Vault/releases/download/Vault%2Fv2.0.5/BTCPayServerVault-Linux-2.0.5.tar.gz)

安装BTCPay Server保险库后，通过点击桌面上的图标启动软件。当BTCPay Server保险库正确安装并首次启动时，它会请求权限以用于Web应用程序。它会请求授权给您工作的特定BTCPay Server。接受这些条件。BTCPay Server保险库现在将搜索硬件设备。一旦找到设备，BTCPay Server将识别Vault正在运行并已获取您的设备。

**！注意！**

使用热钱包时，除了管理员外不要将您的SSH密钥或服务器管理员账户给予任何其他人。任何能访问这些账户的人都将能够访问热钱包中的资金。

### 技能总结

在本节中，您学到了以下内容：

- 比特币钱包的交易视图及其各种分类。
- 从比特币钱包发送时可用的各种选项，从硬件到热钱包。
- 使用大多数钱包时面临的间隙限制问题，以及如何纠正这个问题。
- 如何在BTCPay Server内生成一个新的比特币钱包，包括将密钥存储在硬件钱包中并备份恢复短语。

在这个目标中，您已经学会了如何在BTCPay Server内生成一个新的比特币钱包。我们还没有深入探讨如何保护或使用这些密钥。在这个目标的快速概述中，您已经学会了如何设置第一个商店。您已经学会了如何生成比特币恢复种子短语。

### 知识评估实践回顾

描述一种生成密钥的方法和一种保护它们的方案，以及安全方案的权衡/风险。

## BTCPay Server闪电钱包

<chapterId>1bbece7e-0197-57e6-a93a-561cf384d946</chapterId>

当服务器管理员配置新的BTCPay Server实例时，他可以设置一个闪电网络实现，LND、Core Lightning或Eclair；有关更详细的安装说明，请参见配置BTCPay Server的部分。
如果在课堂上跟随操作，通过自定义节点将闪电网络节点连接到您的BTCPay服务器是可行的。不是BTCPay服务器上的服务器管理员的用户默认无法使用内部闪电网络节点。这是为了保护服务器所有者免于损失其资金。服务器管理员可以安装插件，通过LNBank访问他们的闪电节点；这超出了本书的范围；在官方插件页面上阅读更多关于LNBank的信息。

### 连接内部节点（服务器管理员）

服务器管理员可以使用BTCPay服务器的内部闪电网络节点。无论闪电网络的实现如何，连接到内部闪电网络节点的方式都是相同的。

转到之前设置的商店，并在左侧菜单中点击“闪电”钱包。BTCPay服务器提供两种设置可能性，使用内部节点（默认仅限服务器管理员）或自定义节点（外部连接）。服务器管理员可以点击“使用内部节点”选项。不需要进一步的配置。点击“保存”按钮并注意到通知，表示“BTC闪电节点已更新”。商店现在已成功获得闪电网络功能。

### 连接外部节点（服务器用户/商店所有者）

由于商店所有者默认不允许使用服务器管理员的闪电网络节点。需要连接到一个外部节点，无论是商店所有者在BTCPay服务器设置之前拥有的节点，如果服务器管理员提供了LNBank插件，或者是像Alby这样的托管解决方案。

转到之前设置的商店，并在左侧菜单下的钱包中点击“闪电”。由于商店所有者默认不允许使用内部节点，此选项被灰色显示。使用自定义节点是商店所有者默认可用的唯一选项。

BTCPay服务器需要连接信息；之前制作的（或托管解决方案）将提供特定于闪电网络实现的信息。在BTCPay服务器中，商店所有者可以使用以下连接；

- 通过TCP或Unix域套接字连接的C-lightning。
- 通过HTTPS的Lightning Charge
- 通过HTTPS的Eclair
- 通过REST代理的LND
- 通过REST API的LNDhub

![image](assets/en/31.webp)

点击“测试连接”以确保您正确输入了连接详情。连接确认无误后，点击保存，BTCPay服务器将显示商店已更新了闪电网络节点。

### 管理内部闪电网络节点LND（服务器管理员）

连接内部闪电网络节点后，服务器管理员将在仪表板上注意到专门用于闪电网络信息的新磁贴。

- 闪电网络余额
- 通道中的BTC
  - 正在打开的通道中的BTC
  - 本地余额中的BTC
  - 远程余额中的BTC
  - 正在关闭的通道中的BTC
- BTC链上
  - 已确认的BTC
  - 未确认的BTC
  - 保留的BTC
- 闪电网络服务
  - 骑闪电（RTL）。

通过在“闪电网络服务”磁贴中点击骑闪电（RTL）标志或在左侧菜单下的钱包中点击“闪电”，服务器管理员可以进入RTL进行闪电网络节点管理。

**注意！**

如果内部闪电网络节点连接失败 - 如果内部连接失败，请确认：

1. 比特币链上节点已完全同步
2. 在“闪电”>“设置”>“BTC闪电设置”下，内部闪电节点已被“启用”
如果您无法连接到您的Lightning节点，请尝试重启您的服务器，或阅读BTCPay Server官方文档以获取更多详情；https://docs.btcpayserver.org/Troubleshooting/ 。在您的Lightning节点显示为“在线”之前，您无法在您的商店接受Lightning支付。尝试通过点击“公共节点信息”链接来测试您的Lightning连接。

### Lightning钱包

在左侧菜单栏的Lightning钱包选项中，服务器管理员将找到轻松访问RTL、他们的公共节点信息和特定于他们的BTCPay Server商店的Lightning设置的入口。

#### 内部节点信息

服务器管理员可以点击内部节点信息，并查看他们的服务器状态（在线/离线）和Clearnet或Tor的连接字符串。

![image](assets/en/32.webp)

#### 更改连接

如果商店所有者决定在Lightning设置中更改连接。
在公共节点信息商店旁边，所有者可以找到这个选项。它将恢复外部lightning节点连接的初始设置，填写新的Lightning节点信息，点击保存，并使用新的节点信息更新商店。

![image](assets/en/33.webp)

#### 服务

如果服务器管理员决定为Lightning实现安装多个服务，它们将在此列出。对于标准的LND实现，管理员将拥有Ride The Lightning (RTL)作为节点管理的标准工具。

#### BTC Lightning钱包设置

在之前的步骤中将Lightning节点添加到商店之后，在Lightning钱包的设置中，商店所有者仍然可以选择通过使用Lightning设置顶部的切换按钮为他们的商店停用它。

![image](assets/en/34.webp)

#### Lightning支付选项

商店所有者可以设置以下参数，以增强他们的客户的Lightning体验。

- 以Satoshis显示Lightning支付金额。
- 在Lightning发票中添加私有通道的跳转提示。
- 在结账时统一链上和Lightning支付URL/QR码。
- 为lightning发票设置描述模板。

#### LNURL

商店所有者可以选择是否使用LNURL。Lightning Network URL，或LNURL，是一种提议的标准，用于Lightning付款方和收款方之间的互动。简而言之，LNURL是一个以lnurl为前缀的bech32编码url。预期Lightning钱包解码URL，联系URL，并等待一个包含进一步指令的JSON对象，最值得注意的是定义knurl行为的标签。

- 启用LNURL
- LNURL经典模式
  - 为了钱包兼容性，Bech32编码（经典）与明文URL（即将推出）
- 允许收款方传递评论。

### 示例 1

#### 通过内部节点连接到Lightning（管理员）

此选项仅在您是此实例的管理员或管理员已更改默认设置，用户可以使用内部lightning节点时可用。

作为管理员，在左侧菜单栏点击Lightning钱包。BTCPay Server将要求使用两个选项之一连接Lightning节点，一个内部节点或一个自定义外部节点。点击使用内部节点并点击保存。

#### 管理您的Lightning节点（RTL）

连接到内部lightning节点后，BTCPay Server将更新并显示通知“BTC Lightning节点已更新”，确认您现在已将Lightning连接到您的商店。

管理lightning节点是服务器管理员的任务。这涉及到：

- 管理交易
- 管理流动性
  - 入站流动性
  - 出站流动性
- 管理同伴和通道
  - 已连接的同伴
  - 通道费用
  - 通道状态
- 频繁备份通道状态。
- 检查路由报告。
- 或者，使用如Loop这样的服务。

所有闪电网络节点的管理标准操作都是通过RTL完成的（假设您运行的是LND实现）。管理员可以在BTCPay Server中点击他们的闪电钱包，并找到一个按钮来打开RTL。BTCPay Server的主仪表板现已更新，加入了闪电网络磁贴，包括快速访问RTL的入口。

### 示例 2

#### 通过Alby连接到闪电网络

当通过像Alby这样的托管服务连接时，店主首先应该创建一个账户，访问：https://getalby.com/

![image](assets/en/35.webp)

创建Alby账户后，前往您的BTCPay Server商店。

步骤1：在仪表板上点击“设置一个闪电节点”或在钱包下面点击“闪电”。

![image](assets/en/36.webp)

步骤2：插入Alby提供的钱包连接凭证。在Alby的仪表板上，点击钱包。这里您将找到“钱包连接凭证”。复制这些凭证。将Alby的凭证粘贴到BTCPay Server的连接配置字段中。

![image](assets/en/37.webp)

步骤3：向BTCPay Server提供连接详情后，点击“测试连接”按钮以确保连接正常工作。注意屏幕顶部的“成功连接到闪电节点”的消息。这确认一切都在正常工作。

![image](assets/en/38.webp)

步骤4：点击保存，您的商店现在通过Alby连接到了一个闪电节点。

![image](assets/en/39.webp)

**！注意！**

永远不要将比您愿意失去的更多价值托管给闪电网络解决方案。

### 技能总结

在本节中，您学到了：

- 如何连接内部或外部闪电节点
- 仪表板中各种与闪电相关的磁贴的内容和功能
- 如何使用Voltage Surge或Alby配置闪电钱包

### 知识评估 实践回顾

描述连接商店的闪电钱包的一些不同选项。

# BTCPay Server界面

<partId>25e88b81-e1ab-515f-a035-09f2a3075556</partId>

## 仪表板概览

<chapterId>410ff28b-a272-5c91-93e0-48d5b28c53ab</chapterId>

BTCPay Server是一个模块化软件包。然而，每个BTCPay Server都有标准，管理员/用户将与之交互。从仪表板开始。每个BTCPay Server登录后的主要入口点。仪表板提供了您的商店表现如何、钱包当前余额以及过去7天内的最后交易的概览。由于它是一个模块化视图，插件可能会利用这个视图为他们的好处并在仪表板上创建他们的磁贴。对于本课程书，我们将只讨论标准插件/应用程序及其在BTCPay Server中的相应视图。

### 仪表板磁贴

在BTCPay Server仪表板的主视图中，有几个标准磁贴可用。这些磁贴旨在让店主或管理员快速一览地管理他的商店。

- 钱包余额
- 交易活动
- 闪电余额（如果商店启用了闪电网络）
- 闪电服务（如果商店启用了闪电网络）
- 最近的交易。
- 最近的发票
- 当前活跃的众筹
- 商店表现/畅销商品。
钱包余额磁贴快速概览了您的钱包资金和表现。它可以以BTC或法定货币的形式显示，时间跨度包括周、月或年的图表。
![image](assets/en/40.webp)

### 交易活动

在钱包余额磁贴旁边，BTCPay Server展示了待处理支付、过去7天内的交易数量，以及您的商店是否已经发出任何退款的快速概览。点击管理按钮，您可以进入待处理支付的管理界面（在BTCPay Server - 支付章节了解更多关于支付的信息）。

![image](assets/en/41.webp)

### 闪电网络余额

仅当激活了闪电网络时可见。

当管理员允许闪电网络访问权限时，BTCPay Server仪表板现在有一个新的磁贴，显示您的闪电节点信息。渠道中有多少BTC，这些如何在本地或远程（入站或出站流动性）中平衡，渠道是正在关闭还是开启，以及闪电节点上链上持有多少比特币。

![image](assets/en/42.webp)

### 闪电服务

仅当闪电网络活跃时可见。

在BTCPay Server仪表板上查看您的闪电余额旁边，管理员还将看到闪电服务的磁贴。在这里，管理员可以找到他们用来管理闪电节点的工具的快速按钮；例如，Ride the Lightning是BTCPay Server用于闪电节点管理的标准工具之一。

![image](assets/en/43.webp)

### 最近的交易

最近交易磁贴将显示您商店的最新交易。通过一次点击，BTCPay Server实例的管理员现在可以看到最新的交易，并判断是否需要关注。

![image](assets/en/44.webp)

### 最近的发票

最近的发票磁贴显示了您的BTCPay Server生成的最新6张发票，包括状态和发票金额。磁贴还包括一个“查看全部”按钮，以便轻松访问完整的发票概览。

![image](assets/en/45.webp)

### 销售点和众筹

作为BTCPay Server提供的一套标准插件或应用程序，销售点和众筹是BTCPay Server的两个主要插件。BTCPay Server用户可以根据需要为每个商店和钱包生成任意多的销售点或众筹。每个都会创建一个新的仪表板磁贴，显示插件的表现。

![image](assets/en/46.webp)

注意销售点和众筹磁贴之间的细微差别。管理员在销售点磁贴中看到的是热销商品。在众筹磁贴中，这变成了顶级福利。两个磁贴都有快速按钮来管理相应的应用程序，并查看由热销商品或顶级福利创建的最近发票。

![image](assets/en/47.webp)

**!?注意!?**

余额图表和最近的交易仅适用于链上支付方式。关于闪电网络余额和交易的信息还在待办事项中。截至BTCPay Server版本1.6.0，基本的闪电网络余额已经可用。

### 技能总结

在本节中，您学到了以下内容：

- 主要登陆页面上磁贴的核心布局，被称为仪表板。
- 每个磁贴内容的基本了解。

### 知识评估回顾

尽可能多地从记忆中列出仪表板上的磁贴。

## BTCPay Server - 商店设置

<chapterId>e8faef7b-278d-550e-a511-bc3a442daf64</chapterId>
在BTCPay Server软件中，我们知道有两种类型的设置。BTCPay Server特定于商店的设置，可以在左侧菜单栏的仪表盘下方找到设置按钮，以及在菜单栏底部紧挨账户上方找到的BTCPay Server设置。只有服务器管理员才能查看BTCPay Server特定于服务器的设置。
商店设置由许多标签页组成，以对每组设置进行分类。

- 通用
- 汇率
- 结账外观
- 访问令牌
- 用户
- 角色
- Webhooks
- 支付处理器
- 电子邮件
- 表单

### 通用

在通用设置标签页中，商店所有者设置他们的品牌和支付默认设置。在商店的初始设置时，会给商店命名；这将在商店名称下的通用设置中反映出来。这里商店所有者还可以设置他们的网站以匹配品牌，并为管理员在数据库中识别设置一个商店ID。

#### 品牌

由于BTCPay Server是FOSS，商店所有者可以进行自定义品牌以匹配他们的商店。设置品牌颜色，存储品牌的标志，并为面向公众/客户的页面（发票、支付请求、拉取支付）添加自定义CSS。

#### 支付

在支付设置中，商店所有者可以设置他们商店的默认货币（无论是比特币还是任何法定货币）。

#### 允许任何人创建发票

此设置是为在BTCPay Server之上的开发者或构建者准备的。通过为您的商店开启此设置，它允许外部世界在您的BTCPay Server实例上创建发票。

#### 在发票中添加额外费用（网络费）

BTCPay内的一个功能，用于保护商家免受尘埃攻击或客户在商家需要一次性移动大量比特币时推高费用。例如，客户创建了一个20美元的发票，并分20次支付了1美元直到发票完全支付。现在，商家有了一个更大的交易，增加了挖矿成本，以防商家稍后决定移动这些资金。默认情况下，当发票通过多笔交易支付时，BTCPay会在总发票金额中添加额外的网络成本，以覆盖商家的这笔费用。BTCPay提供了几个选项来自定义这个保护功能。您可以应用网络费：

- 只有在客户为发票支付了不止一次时（在上面的例子中，如果客户创建了一个20美元的发票并支付了1美元，现在总发票应付金额是19美元+网络费。网络费在第一次支付后应用）
- 在每次支付时（包括第一次支付，在我们的例子中，总额将立即是20美元+网络费，即使是第一次支付）
- 从不添加网络费（完全禁用网络费）

虽然它可以防止尘埃交易，但如果没有适当的沟通，也可能对企业产生负面影响。客户可能会有额外的问题，并认为您在向他们多收费。

#### 如果全额未在之后支付，发票过期？

发票计时器默认设置为15分钟。计时器是一种针对波动性的保护机制，因为它根据比特币对法定货币的汇率锁定了比特币金额。如果客户在规定时间内未支付发票，发票被视为过期。一旦交易在区块链上可见（0确认），发票就被视为“已支付”，但当达到商家定义的确认次数（通常是1-6次）时，才被视为“完成”。计时器可以按分钟自定义。

#### 即使支付金额比预期少X%，也认为发票已支付？
当客户使用交易所钱包直接支付发票时，交易所会收取少量费用。这意味着这样的发票不被视为完全完成。发票的状态变为“部分支付”。如果商家想接受未完全支付的发票，您可以在这里设置百分比率。

### 汇率

在BTCPay Server中，当生成发票时，它总是需要最新和最准确的比特币对法币的价格。在BTCPay Server中创建新商店时，管理员会被要求设置他们偏好的价格来源；商店设置完成后，商店所有者可以随时在此标签页更改他们的价格来源。

#### 高级汇率规则脚本

主要由高级用户使用。如果开启，商店所有者可以围绕价格行为以及如何向客户收费创建脚本。

#### 测试

您偏好的货币对的快速测试地点。这还包括通过REST查询检查默认货币对的功能。

### 结账外观

结账外观标签页从特定于发票的设置和默认支付方式开始，并在满足特定要求时启用特定支付方式。

#### 发票设置

默认支付方式。BTCPay Server在标准配置中有三个选项。

- BTC（链上）
- BTC（LNURL-pay）
- BTC（链下 & 闪电网络）

我们可以为我们的商店设置参数，其中客户只会在价格低于X金额时与闪电网络交互，反之，当X大于Y时，总是呈现链上支付选项。

![image](assets/en/48.webp)

#### 结账

截至BTCPay Server 1.7版本发布，它引入了一个新的结账界面，称为Checkout V2。自从1.9版本标准化以来，管理员和商店所有者仍然可以将结账设置为之前的版本。通过使用“使用经典结账”切换，商店所有者可以将商店恢复到之前的结账体验。BTCPay Server还为在线商务或店内体验提供了一组预设。

![image](assets/en/49.webp)

当客户与商店互动并生成发票时，发票有一个过期时间。默认情况下，BTCPay Server将其设置为5分钟，管理员可以根据需要设置这个时间。通过检查以下参数，可以进一步自定义结账页面：

- 通过显示五彩纸屑庆祝支付
- 显示商店头部（名称和logo）
- 显示“在钱包中支付”按钮
- 统一链上和链下支付的URL/QR码
- 以聪显示闪电网络支付金额
- 结账时自动检测语言

![image](assets/en/50.webp)

当未设置自动检测语言时，BTCPay Server默认会显示英语。商店所有者可以将此默认设置更改为他们偏好的语言。

![image](assets/en/51.webp)

点击下拉菜单，商店所有者可以设置一个自定义HTML标题，在结账页面显示。

![image](assets/en/52.webp)

为了确保客户知道他的支付方式，商店所有者可以明确设置他的结账总是要求用户选择他们偏好的支付方式。当发票支付后，BTCPay Server允许客户返回到网上商店。商店所有者可以设置在客户支付后自动重定向。

![image](assets/en/53.webp)

#### 公开收据

在公开收据设置中，商店所有者可以将收据页面设置为公开，并在收据页面上显示支付列表和收据的二维码，以便客户可以轻松地数字化访问。
### 访问令牌

访问令牌用于与特定的电子商务集成或自定义构建集成配对。

### 用户

商店用户是商店所有者可以管理其员工成员、他们的账户以及对商店的访问权限的地方。员工成员创建账户后，商店所有者可以将特定用户添加到商店中，作为访客用户或所有者。要进一步定义员工的角色，请参阅下一节“BTCPay Server商店设置 - 角色”。

### 角色

商店所有者可能会发现用户的标准角色不够显著。在自定义角色设置中，商店所有者可以为其业务中的每个角色定义确切需求。

(1) 要创建新角色，请点击“+ 添加角色”按钮。

(2) 输入角色名称，例如，“收银员”。

(3) 配置角色的个别权限。

- 修改您的商店。
- 管理与您的商店关联的交易账户。
  - 查看与您的商店关联的交易账户。
- 管理您的拉取支付。
- 创建拉取支付。
  - 创建未经批准的拉取支付。
- 修改发票。
  - 查看发票。
  - 创建发票。
  - 从与您的商店关联的闪电节点创建发票。
- 查看您的商店。
  - 查看发票。
  - 查看您的支付请求。
  - 修改商店的Webhooks。
- 修改您的支付请求。
  - 查看您的支付请求。
- 使用与您的商店关联的闪电节点。
  - 查看与您的商店关联的闪电发票。
  - 从与您的商店关联的闪电节点创建发票。
- 将资金存入与您的商店关联的交易账户。
- 从交易账户提取资金到您的商店。
- 在您商店的交易账户上交易资金。

当角色被创建时，名称是固定的，之后在编辑模式中不能更改。

### Webhooks

在BTCPay Server中，创建一个新的“Webhook”相当容易。在BTCPay Server商店设置 - Webhooks标签中，商店所有者可以通过点击“+ 创建Webhook”轻松创建一个新的webhook。Webhooks允许BTCPay Server将与您的商店相关的HTTP事件发送到其他服务器或电子商务集成。

您现在处于创建Webhook的视图中。确保您知道您的Payload URL并将其粘贴到您的BTCPay Server中。当您粘贴了payload URL时，下面会显示webhook密钥。复制webhook密钥并在端点上提供它。当一切都设置好后，您可以在BTCPay Server中切换到自动重新发送。我们将尝试在10秒后、1分钟后以及10分钟后最多6次重新发送任何失败的传送。您可以在每个事件之间切换或指定您的需求事件。确保启用webhook并点击添加webhook以保存它。

Webhooks并不意味着与Bitpay API兼容。在BTCPay Server中有两个独立的IPNs（在BitPay术语中：“即时支付通知”）。

- Webhook
- 通知

仅当您通过Bitpay api创建发票时，使用通知URL。

### 支付处理器
支付处理器与BTCPay Server中的支付概念协同工作。支付聚合器可以批量处理多笔交易并一次性发送。通过支付处理器，店主可以自动化批量支付。BTCPay Server提供了两种自动化支付方法，链上(On-chain)和链下(Off-chain，即LN)。
店主可以分别点击配置两种支付处理器。店主可能只想每隔X小时运行一次链上处理器，而链下处理器可能每几分钟就运行一次。对于链上支付，您还可以设置目标区块，以便包含该交易。默认情况下，这被设置为1（或下一个可用区块）。请注意，设置链下支付处理器只有间隔计时器，没有区块目标。闪电网络支付是即时的。

![image](assets/en/62.webp)
![image](assets/en/63.webp)

只有当店主的店铺连接了热钱包时，才能配置链上处理器。

![image](assets/en/64.webp)

设置支付处理器后，您可以通过返回到BTCPay Server商店设置中的支付处理器标签页来快速移除或修改它。

**!?注意!?**

链上支付处理器 - 链上支付处理器只能在配置了连接热钱包的店铺上工作。如果没有连接热钱包，BTCPay Server不持有钱包的密钥，因此无法自动处理支付。

### 电子邮件

BTCPay Server可以使用电子邮件进行通知，或者，如果设置正确，可以用来恢复在该实例上创建的账户，因为标准的BTCPay Server在密码丢失时不会发送电子邮件，例如。

![image](assets/en/65.webp)

在店主可以设置电子邮件规则以针对其店铺的特定事件触发电子邮件之前，我们必须设置一些基本的电子邮件设置。BTCPay Server需要这些设置来发送基于您的店铺的事件或密码重置的电子邮件。

BTCPay Server通过使用“快速填充”选项使填写这些信息变得更加容易：

- Gmail.com
- Yahoo.com
- Mailgun
- Office365
- SendGrid

使用快速填充选项后，BTCPay Server将为SMTP服务器和端口预填充字段；现在，店主只需要填写他的电子邮件地址、登录名（通常与您的电子邮件地址相同）和密码。BTCPay Server在电子邮件设置中提供的高级选项是禁用TLS证书安全检查；默认情况下，这是启用的。

![image](assets/en/66.webp)

通过电子邮件规则，店主可以设置特定事件以触发发送到特定电子邮件地址的电子邮件。

- 发票已创建
- 发票收到付款
- 发票处理中
- 发票已过期
- 发票已结算
- 发票无效
- 发票付款已结算

如果客户提供了电子邮件地址，这些触发器也可以将信息发送给客户。店主可以预填主题行，以明确说明为什么会发生此电子邮件以及是什么触发了它。

![image](assets/en/67.webp)

### 表单

由于BTCPay Server不收集任何数据，店主可能想要在结账体验中添加自定义表单；这样，店主可以从他的客户那里收集额外的信息。BTCPay Server表单构建器由两部分组成，一个是视觉上的，另一个是表单的更高级的代码视图。
在创建新表单时，BTCPay Server会打开一个新窗口，请求关于您希望新表单收集的基本信息。首先，店主需要为他们的新表单给出一个明确的名称，设置后这个名称就不能更改了。
![image](assets/en/68.webp)

店主给表单命名后，您还可以将“允许表单公开使用”的开关切换到ON，它会变成绿色。这样做是为了让表单在面向顾客的每个地方都能被使用。例如，如果店主创建了一个不通过他的销售点的单独发票，他可能仍然想要收集顾客的信息；将此开关切换到ON就允许收集这些信息。

![image](assets/en/69.webp)

每个表单都以至少1个新表单字段开始。店主可以选择字段应该是什么类型；

- 文本
- 数字
- 密码
- 电子邮件
- URL
- 电话号码
- 日期
- 隐藏字段
- 字段集
- 开放评论的文本区域。
- 选项选择器

每种类型都带有要填写的参数。店主可以根据自己的喜好设置。在第一个创建的字段下面，店主可以继续向这一个表单添加新字段。

![image](assets/en/70.webp)

#### 高级自定义表单

BTCPay Server还允许您用代码构建表单，特别是JSON。店主可以点击编辑器旁边的CODE按钮，而不是查看编辑器，进入他们的表单代码。在字段定义中，只能设置以下字段；字段的值存储在发票的元数据中：

| 字段                  | 描述                                                                                                                                                                                                                                                                                                                                                                                                       |
| --------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| .fields.constant      | 如果为true，则必须在表单定义中设置.value，用户将无法更改字段的值。（例如：表单定义的版本）                                                                                                                                                                                                                                                                                                               |
| .fields.type          | HTML输入类型文本、单选、复选、密码、隐藏、按钮、颜色、日期、datetime-local、月、周、时间、电子邮件、数字、范围、搜索、URL、选择、电话                                                                                                                                                                                                                                                                     |
| .fields.options       | 如果.fields.type是select，可选择的值列表                                                                                                                                                                                                                                                                                                                                                                  |
| .fields.options.text  | 此选项显示的文本                                                                                                                                                                                                                                                                                                                                                                                           |
| .fields.options.value | 如果选择了此选项，字段的值                                                                                                                                                                                                                                                                                                                                                                                |
| .fields.type=fieldset | 在子.fields.fields周围创建HTML字段集（见下文）                                                                                                                                                                                                                                                                                                                                                            |
| .fields.name          | 字段的JSON属性名称，如它将出现在发票的元数据中                                                                                                                                                                                                                                                                                                                                                            |
| .fields.value         | 字段的默认值                                                                                                                                                                                                                                                                                                                                                                                               |
| .fields.required      | 如果为true，字段将是必需的                                                                                                                                                                                                                                                                                                                                                                                |
| .fields.label         | 字段的标签                                                                                                                                                                                                                                                                                                                                                                                                 |
| .fields.helpText      | 提供字段解释的附加文本                                                                                                                                                                                                                                                                                                                                                                                     |
| .fields.fields        | 您可以在层次结构中组织您的字段，允许子字段嵌套在发票的元数据中。这种结构可以帮助您更好地组织和管理收集的信息，使其更容易访问和解释。例如，如果您有一个收集客户信息的表单，您可以将字段分组到一个名为customer的父字段下。在这个父字段内，您可能有像name、Email和address这样的子字段。 |
字段名称代表存储在发票元数据中的用户提供值的JSON属性名称。一些众所周知的名称可以被解释并修改发票的设置。

| 字段名称             | 描述                  |
| ------------------ | ---------------------|
| invoice_amount     | 发票的金额            |
| invoice_currency   | 发票的货币            |

您可以通过向表单的URL添加查询字符串来自动填充发票的字段，例如"?your_field=value"。

以下是此功能的一些用例：

- 协助用户输入：使用已知的客户信息预填字段，使他们更容易完成表单。例如，如果您已经知道客户的电子邮件地址，您可以预填电子邮件字段以节省他们的时间。
- 个性化：根据客户偏好或细分定制表单。例如，如果您有不同的客户等级，您可以使用相关数据预填表单，如他们的会员等级或特定优惠。
- 跟踪：使用隐藏字段和预填值跟踪客户访问的来源。例如，您可以为每个营销渠道（例如，Twitter、Facebook、Email）创建带有预填utm_media值的链接。这有助于您分析营销努力的有效性。
- A/B测试：使用不同的值预填字段以测试不同的表单版本，使您能够优化用户体验和转化率。

### 技能总结

在本节中，您学到了以下内容：

- 商店设置中标签的布局和功能
- 微调底层汇率处理、部分支付、轻微欠款等多种选项。
- 自定义结账外观，包括根据价格启用主链与Lightning的发票。
- 管理跨角色的商店访问级别和权限。
- 配置自动电子邮件及其触发器
- 创建自定义表单以在结账时收集额外的客户信息。

### 知识评估

#### KA回顾

商店设置和服务器设置之间有什么区别？

#### KA假设

描述您可能在结账外观>发票设置中选择的一些选项，以及为什么。

## BTCPay Server - 服务器设置

<chapterId>1dd858a2-49ea-586b-9bc1-75a65f508df6</chapterId>

BTCPay Server由两个不同的设置视图组成。一个专用于商店设置，另一个用于服务器设置。后者仅当您是服务器管理员时可用，不适用于商店所有者。服务器管理员可以添加用户，创建自定义角色，配置电子邮件服务器，设置策略，运行维护任务，检查附加到BTCPay Server的所有服务，上传文件到服务器或检查日志。

### 用户

如前所述，服务器管理员可以通过将他们添加到用户标签中来邀请用户到他们的服务器。

### 服务器范围的自定义角色

BTCPay Server知道两种自定义角色，商店特定的自定义角色和在BTCPay Server设置中的服务器范围的自定义角色。两者都持有类似的权限集；然而，如果通过BTCpay Server设置 - 角色标签设置，应用的角色将是服务器范围的，并适用于多个商店。注意服务器设置中自定义角色的“服务器范围”标签。
### 服务器范围内的自定义角色

服务器范围内的自定义角色权限集合：

- 修改您的商店。
- 管理与您的商店链接的交易账户。
  - 查看与您的商店链接的交易账户。
- 管理您的拉取支付。
- 创建拉取支付。
  - 创建未经批准的拉取支付。
- 修改发票。
  - 查看发票。
  - 创建发票。
  - 从与您的商店关联的闪电网络节点创建发票。
- 查看您的商店。
  - 查看发票。
  - 查看您的支付请求。
  - 修改商店的Webhooks。
- 修改您的支付请求。
  - 查看您的支付请求。
- 使用与您的商店关联的闪电网络节点。
  - 查看与您的商店关联的闪电网络发票。
  - 从与您的商店关联的闪电网络节点创建发票。
- 向与您的商店链接的交易账户存款。
- 从与您的商店链接的交易账户中提款到您的商店。
- 在您商店的交易账户上进行交易。

**!?注意!?**

当角色被创建时，名称是固定的，编辑模式下无法更改。

### 电子邮件

服务器范围内的电子邮件设置看起来与特定于商店的电子邮件设置相似。然而，这种设置不仅处理商店或管理员日志的触发器。这种电子邮件设置还在BTCPay服务器的登录页面上提供了密码恢复功能。它的工作方式类似于特定于商店的设置；管理员可以快速填写他们的电子邮件参数并输入他们的电子邮件凭据，服务器现在可以发送电子邮件。

### 政策

BTCPay服务器的政策管理员可以在诸如现有用户设置、新用户设置、通知设置和维护设置等主题上设置一些设置。这些设置旨在将新用户注册为管理员或普通用户，甚至通过添加到服务器头部来隐藏BTCPay服务器，使其不被搜索引擎发现。

#### 现有用户设置

这里可用的选项与自定义角色分开。这些额外的权限可能会使商店或商店所有者容易受到攻击。可以添加给现有用户的政策：

- 允许非管理员在他们的商店中使用内部闪电网络节点。
  - 这将允许商店所有者使用服务器管理员的闪电网络节点，因此，使用他的资金！注意，这不是提供闪电网络访问的解决方案。
- 允许非管理员为他们的商店创建热钱包。
  - 这将允许在您的BTCPay服务器实例上拥有账户的任何人创建热钱包，并在管理员的服务器上存储他们的恢复种子。这可能会使管理员因持有第三方资金而承担责任！
- 允许非管理员为他们的商店导入热钱包。
  - 类似于创建热钱包的前一个话题，这个政策允许导入热钱包，与创建热钱包部分提到的危险相同。

#### 新用户设置

我们可以设置一些重要的设置来管理来到服务器的新用户。我们可以为新注册设置确认电子邮件，通过登录屏幕禁用新用户创建，并限制非管理员通过API创建用户的访问权限。

- 要求注册时确认电子邮件。
  - 服务器管理员必须设置了电子邮件服务器！
- 在服务器上禁用新用户注册
- 禁用非管理员访问用户创建API端点的权限。

默认情况下，BTCPay服务器已启用禁用新用户注册并关闭了非管理员访问用户创建API端点的权限。这是出于安全考虑，任何可能找到您服务器的BTCPay登录页面的随机人员都不能开始创建账户。
#### 通知设置
![image](assets/en/76.webp)

#### 维护设置

BTCPay Server 是一个托管在 GitHub 上的开源项目。每当 BTCPay Server 发布软件的新版本时，管理员可以收到新版本可用的通知。管理员可能还希望阻止搜索引擎（google、yahoo、duckduckgo）索引 BTCPay Server 域名。由于 BTCPay Server 是 FOSS（自由开源软件），全球的开发者可能想要创建新功能；BTCPay Server 有一个实验性功能，当开启时，管理员可以使用尚未用于生产的功能，纯粹用于测试目的。

- 检查 GitHub 上的发布并在新版本的 BTCPay Server 可用时通知。
- 阻止搜索引擎索引此站点
- 启用实验性功能。

![image](assets/en/77.webp)

#### 插件

BTCPay Server 可以添加插件并扩展其功能集。默认情况下，插件从 BTCPay Server 插件构建器仓库加载。然而，管理员可能选择查看处于预发布状态的插件，如果插件开发者允许，服务器管理员现在可以安装插件的测试版本。

![image](assets/en/78.webp)

##### 自定义设置

标准的 BTCPay Server 部署将通过安装时设置的域名可访问。然而，服务器管理员可以重新映射根域名，并从特定商店显示创建的应用之一。服务器管理员还可以将特定域名映射到特定应用。

- 在网站的根目录显示应用
  - 显示可能在根域名上显示的应用列表。

![image](assets/en/79.webp)

- 将特定域名映射到特定应用。
  - 当您点击设置特定域名为特定应用时，管理员可以根据需要为特定应用指向多个域名。

![image](assets/en/80.webp)

#### 区块浏览器

BTCPay Server 标准配置包括 mempool.space 作为其交易的区块浏览器。当 BTCPay Server 生成新的发票，并且有一笔与之相关的交易时，店主可以点击打开交易；BTCPay Server 将标准指向 mempool.space 作为区块浏览器；服务器管理员可以根据自己的偏好更改这一设置。

![image](assets/en/81.webp)

### 服务

BTCPay Server 设置：服务标签是您的 BTCPay Server 使用的组件概览。您的 BTCPay Server 暴露的服务可能会根据部署方法而有所不同。

BTCPay Server 管理员可以点击每项服务后的“查看信息”以打开它并设置特定设置。

![image](assets/en/82.webp)

#### LND (gRPC)

BTCPay 对外暴露 LND 的 GRPC 服务；您将在这个特定设置菜单中找到连接信息；这里列出了兼容的钱包。BTCPay Server 还提供了一个 QR 码用于扫描并在移动钱包中应用连接。

服务器管理员可以打开更多详情查看；

- 主机详情
- 使用 SSL
- Macaroon
- AdminMacaroon
- InvoiceMacaroon
- ReadonlyMacaroon
- GRPC SSL 密码套件 (GRPC_SSL_CIPHER_SUITES)

#### LND (REST)

BTCPay 对外暴露 LND 的 REST 服务；您将在这里找到连接信息；这里列出了兼容的钱包。兼容的钱包包括 Joule、Alby 和 ZeusLN。BTCPay Server 提供了一个 QR 码用于连接，扫描并在兼容的钱包中应用。

- REST Uri
- Macaroon
- AdminMacaroon- InvoiceMacaroon
- ReadonlyMacaroon

#### LND 种子备份

LND 种子备份对于在服务器损坏的情况下从您的 LND 钱包中恢复资金非常有用。由于 Lightning 节点是一个热钱包，您可以在此页面上找到机密种子信息。

LND 记录了恢复过程。请参阅 https://github.com/lightningnetwork/lnd/blob/master/docs/recovery.md 以获取文档。

#### 骑乘闪电

Ride the Lightning 是一个作为开源软件构建的 Lightning 节点管理工具。BTCPay Server 在其堆栈中使用 RTL 作为 Lightning 节点管理组件。BTCPay Server 管理员可以通过服务器设置 - 服务标签页或点击 Lightning 钱包来访问 RTL。

#### 全节点 P2P

服务器管理员可能想要将他们的比特币节点连接到移动钱包。此页面公开了通过 P2P 协议远程连接到您的全节点的信息。在编写本书时，BTCPay Server 列出了 Blockstream Green 和 Wasabi 钱包作为兼容钱包。BTCPay Server 提供了一个用于连接的 QR 码，扫描并应用于兼容钱包。

#### 全节点 RPC

此页面公开了通过 RPC 协议远程连接到您的全节点的信息。

#### SSH

SSH 用于维护目的。BTCPay Server 显示了连接到您的服务器的初始连接命令和被授权连接到您的服务器的 SSH 公钥。服务器管理员可能想要通过 BTCPay Server 的 UI 关闭 SSH 更改。

#### 动态 DNS

动态 DNS 允许您拥有一个指向您的服务器的稳定 DNS 名称，即使您的 IP 地址定期更改。如果您在家中托管 BTCPay Server 并希望拥有一个清晰的域名来访问您的服务器，这是推荐的。

请注意，您需要正确配置您的 NAT 和 BTCPay Server 安装以获取 HTTPS 证书。

### 主题

BTCPay Server 标准提供两种主题：浅色和深色模式。可以通过点击左下角的账户并在深色主题或浅色主题之间切换来切换这些主题。BTCPay Server 管理员可以通过提供自定义 CSS 主题来添加他们的主题。

管理员可以通过添加自己的自定义 CSS 或设置他们的自定义主题为完全自定义来扩展浅色/深色主题。

![image](assets/en/83.webp)

#### 服务器品牌

服务器管理员可以通过设置您公司的服务器范围品牌来更改 BTCPay Server 的品牌。由于 BTCPay Server 是 FOSS，服务器管理员可以白标签软件并更改外观以适应他们的业务。

![image](assets/en/84.webp)

### 维护

作为服务器管理员，您的用户期望您好好照顾服务器。在 BTCPay Server 的维护标签页中，管理员可以进行一些基本维护。设置 BTCPay Server 实例的域名，重启或清理服务器。可能最重要的是，运行更新。

BTCPay Server 是一个开源项目，频繁更新。每个新版本都通过您的 BTCPay Server 通知或 BTCPay Server 通过其官方渠道通信来宣布。

![image](assets/en/85.webp)

#### 域名

在设置 BTCPay Server 之后，管理员可能想要改变他原来的域名。在维护标签页中，管理员可以更改域名。点击确认并在域名上设置适当的 DNS 记录后，BTCPay Server 更新并重启以返回到新域名。

![image](assets/en/86.webp)

#### 重启

重启 BTCPay Server 及相关服务。

![image](assets/en/87.webp)

#### 清理
BTCPay Server 通过 Docker 组件运行；随着更新，可能会留下 Docker 镜像、临时文件等残留物。服务器管理员可以通过运行清理脚本来清理这些内容，并在他们的环境中回收空间。
![image](assets/en/88.webp)

#### 更新

可能是维护标签页中最重要的选项。BTCPay Server 由社区构建，因此，其更新周期比大多数软件产品更频繁。当 BTCPay Server 有新版本发布时，管理员将在他们的通知中心收到通知。通过点击更新按钮，BTCPay Server 将检查 GitHub 上的最新版本，更新服务器并重启。在更新之前，总是建议服务器管理员阅读通过 BTCPay Server 官方渠道分发的发布说明。

![image](assets/en/89.webp)

### 日志

面对问题从来都不是一件有趣的事情。本文档解释了最常见的工作流程和步骤，以高效地识别您的问题并自己解决或在社区的帮助下解决。

识别问题至关重要。

#### 复现问题

首先也是最重要的，尝试确定问题发生的时机。尝试复现问题。尝试更新并重启您的服务器，以验证您是否可以复现您的问题。如果它更好地描述了您的问题，请截图。

##### 更新服务器

如果您的 BTCPay Server 版本比 BTCPay Server 的[最新版本](https://github.com/btcpayserver/btcpayserver/releases)旧得多。更新您的服务器可能会解决问题。

##### 重启服务器

重启服务器是解决许多最常见的 BTCPay Server 问题的简单方法。您可能需要 SSH 进入您的服务器来重启它。

##### 重启服务

对于某些问题，您可能只需要重启 BTCPay Server 部署中的特定服务。例如，重启 lets encrypt 容器以续订 SSL 证书。

```bash
sudo su -
cd btcpayserver-docker
docker restart letsencrypt-nginx-proxy-companion
```

使用 docker ps 来找到您想要重启的其他服务的名称。

#### 查看日志

日志可以提供一个重要的信息片段。在接下来的段落中，我们将描述如何获取 BTCPay 各个部分的日志信息。

##### BTCPay 日志

从 v1.0.3.8 版本开始，您可以轻松地从前端访问 BTCPay Server 日志。如果您是服务器管理员，请转到服务器设置 > 日志并打开日志文件。如果您不知道日志中的特定错误意味着什么，请在故障排除时提及它。

如果您想要更详细的日志，并且正在使用 Docker 部署，您可以使用命令行查看特定 Docker 容器的日志。请参阅这些[指导](https://docs.btcpayserver.org/FAQ/ServerSettings/#how-to-ssh-into-my-btcpay-running-on-vp%C2%80)以 SSH 进入运行在 VPS 上的 BTCPay 实例。

在下一页，BTCPay Server 使用的容器名称的通用列表。

运行下面的命令以按容器名称打印日志。替换容器名称以查看其他容器的日志。

```bash
sudo su -
cd btcpayserver-docker
docker ps
docker logs --tail 100 generated_btcpayserver_1
```

| 日志对应     | 容器名称                          |
| ------------ | --------------------------------- |
| BTCPayServer | generated_btcpayserver_1          |
| NBXplorer    | generated_nbxplorer_1             |
| Bitcoind     | btcpayserver_bitcoind             |
| Postgres     | generated_postgres_1              |
| 代理        | letsencrypt-nginx-proxy-companion |
| Nginx        | nginx-gen                         |
| Nginx        | nginx                             |
| c-lightning  | btcpayserver_clightning_bitcoin   |
| LND          | btcpayserver_lnd_bitcoin          |
| RTL          | generated_lnd_bitcoin_rtl_1       |
| Thunderhub   | generated_bitcoin_thub_1          |
| LibrePatron  | librepatron                       |
| Tor          | tor-gen                           |
| Tor          | tor                               |

###### 闪电网络 LND - Docker

当使用 Docker 时，有几种方法可以访问您的 LND 日志。首先以 root 登录：

```bash
sudo su -
# 导航到正确的目录：
cd btcpayserver-docker
# 查找容器名称：
<partId>6f124f36-b51c-5e53-a734-08fb1f20db25</partId>
docker ps
# 通过容器名称打印日志：
docker logs --tail 100 btcpayserver_lnd_bitcoin
```

或者，您可以通过使用容器 ID 快速打印日志（只需要唯一 ID 字符的前两个字符，例如最左边的两个字符）：

```bash
docker logs '添加您的容器 ID'
```

如果出于任何原因您需要更多日志

```bash
sudo su -
cd /var/lib/docker/volumes/generated_lnd_bitcoin_datadir/_data/logs/bitcoin/mainnet/
ls
```

您将看到类似

```bash
lnd.log lnd.log.13 lnd.log.15 lnd.log.16.gz lnd.log.17.gz
```

要访问这些日志的未压缩日志，请执行 `cat lnd.log` 或如果您想要另一个，请使用 `cat lnd.log.15`。

要访问 `.gzip` 中的压缩日志，请使用 `gzip -d lnd.log.16.gz`（在这种情况下，我们正在访问 `lnd.log.16.gz`）。这应该会给您一个新文件，您可以执行 `cat lnd.log.16`。如果上述操作不起作用，您可能需要先使用 `sudo apt-get install gzip` 安装 gzip。

###### 闪电网络 c-lightning - Docker

```bash
sudo su -
docker ps
# 查找 c-lightning 容器 ID。
<partId>8f12e767-13df-5bc4-85e4-00e227091300</partId>
docker logs '在这里添加您的容器 ID'
```

或者，使用这个

```bash
docker logs --tail 100 btcpayserver_clightning_bitcoin
```

您也可以使用 c-lightning cli 命令获取日志信息。

```bash
bitcoin-lightning-cli.sh getlog
```

#### 比特币节点日志

除了[查看日志](https://docs.btcpayserver.org/Troubleshooting/#2-looking-through-the-logs)您的 Bitcoind 容器外，您还可以使用任何[bitcoin-cli 命令](https://developer.bitcoin.org/reference/rpc/index.html)

[(打开新窗口)](https://developer.bitcoin.org/reference/rpc/index.html) 从您的比特币节点获取信息。BTCPay 包含一个脚本，允许您轻松与您的比特币节点通信。

在 btcpayserver-docker 文件夹内，使用您的节点获取区块链信息：

```bash
bitcoin-cli.sh getblockchaininfo
```
BTCPay Server具有本地文件系统，并直接将商店（产品）资产、标志和品牌上传到服务器。服务器的文件系统只能由服务器管理员访问；商店所有者可以在商店级别上传他们的标志/品牌。
当服务器管理员处于文件存储选项卡时，可以直接上传到您的服务器或更改文件存储提供商为本地文件系统或Azure Blob存储。

![image](assets/en/90.webp)

![image](assets/en/91.webp)

### 技能总结

在本节中，您学到了以下内容：

- 商店和服务器设置之间的区别，特别是它们与用户、角色和电子邮件的关系
- 为Lightning或Bitcoin热钱包的使用和创建、新用户注册和电子邮件通知设置服务器范围的策略。
- 如何添加自定义主题（而不是提供的简单明暗选项）以及创建自定义标志
- 通过提供的GUI执行简单的服务器维护任务
- 解决问题，包括获取Docker容器或您的节点的任何详细信息
- 管理文件存储

### 知识评估

#### KA 概念复习

通过服务器与商店设置分配的角色有何不同，以及一个比另一个更有潜在用途的描述是什么？

#### KA 实践复习

描述在“策略”选项卡中启用的一些可能的用例。

#### KA 实践复习

描述管理员在“维护”选项卡中可能定期进行的一些操作。

## BTCPay Server - 支付

<chapterId>e2b71ff9-3f4f-5e71-9771-8e03fbbef00f</chapterId>

发票是卖方发给买方以收取付款的文件。

在BTCPay Server中，发票代表一个必须在定义的时间间隔内以固定汇率支付的文件。发票有过期时间，因为它们在指定的时间框架内锁定汇率，以保护接收方免受价格波动的影响。

BTCPay Server的核心是充当比特币发票管理系统的能力。发票是跟踪和管理收到的付款的重要工具。

除非您使用内置的[Wallet](https://docs.btcpayserver.org/Wallet/)手动接收付款，否则商店内的所有付款都将显示在发票页面上。此页面按日期累积排序付款，是发票管理和付款故障排除的中心部分。

![image](assets/en/92.webp)

### 概述

#### 发票状态

下表列出并描述了BTCPay中的标准发票状态，并建议常见操作。操作只是建议。用户需要根据他们的用例和业务定义最佳行动方案。

| 发票状态                   | 描述                                                                                   | 操作                                                                                      |
| -------------------------- | -------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- |
| 新建                        | 未支付，发票计时器尚未过期                                                             | 无                                                                                      |
| 新建（部分支付）            | 已支付，但不是全额，发票计时器尚未过期                                                 | 无                                                                                      |
| 过期                        | 未支付，发票计时器已过期                                                               | 无                                                                                      |
| 过期（部分支付） \*\*       | 已支付，但不是全额，并且已过期                                                         | 联系买家安排退款或要求他们支付欠款。可选地将发票标记为已结算或无效                     |
| 过期（迟付）               | 在发票计时器过期后全额支付                                                             | 联系买家安排退款或如果接受迟确认则处理订单。                                            |
| 已结算（多付） | 付款超过发票金额，已结算，收到足够数量的确认 | 联系买家安排退还多余金额，或选择等待买家联系您 ||
| 处理中 | 已全额支付，但未收到商店设置中指定的足够数量的确认 | 联系买家安排退还多余金额，或选择等待买家联系您 |
| 处理中（多付） | 付款超过发票金额，未收到足够数量的确认 | 等待结算然后联系买家安排退还多余金额，或选择等待买家联系您 |
| 已结算 | 已全额支付，在商店中收到足够数量的确认 | 履行订单 |
| 已结算（标记） | 状态从处理中或无效状态手动更改为已结算 | 商店管理员已将付款标记为已结算 |
| 无效\* | 已支付，但在商店设置中指定的时间内未收到足够数量的确认 | 在区块链浏览器上检查交易，如果收到足够的确认，标记为已结算 |
| 无效（标记） | 状态从已结算或过期状态手动更改为无效 | 商店管理员已将付款标记为无效 |
| 无效（多付） | 付款超过发票金额，但在商店设置中指定的时间内未收到足够数量的确认 | 在区块链浏览器上检查交易，如果收到足够的确认，标记为已结算 |

#### 发票详情

发票详情页面包含与发票相关的所有信息。

发票信息根据发票状态、汇率等自动创建。如果发票是通过销售点应用程序创建的，包含产品信息，产品信息也会自动创建。

#### 发票筛选

可以通过位于搜索按钮旁边的快速筛选器或通过点击顶部的（帮助）链接切换的高级筛选器来筛选发票。用户可以按商店、订单ID、项目ID、状态或日期筛选发票。

#### 发票导出

BTCPay Server发票可以导出为CSV或JSON格式。有关发票导出和会计的更多信息。

#### 退款发票

如果出于任何原因，您想要发起退款，您可以轻松地从发票视图创建退款。

#### 归档发票

由于BTCPay Server的不重用地址功能，您的商店的发票页面上常常会看到许多过期的发票。要将它们从您的视图中隐藏，选择列表中的发票并将其标记为已归档。标记为已归档的发票不会被删除。对已归档发票的付款仍会被您的BTCPay Server检测到（延迟支付状态）。您可以随时通过从搜索过滤器下拉菜单中选择已归档发票来查看商店的已归档发票。

#### 默认货币

商店默认货币，这是在商店创建向导中设置的

#### 允许任何人创建发票

如果您想允许外部世界在您的商店中创建发票，您应该启用此选项。此选项仅在您使用支付按钮或通过API或第三方HTML网站发出发票时有用。销售点应用程序已预授权，不需要为随机访客打开您的POS商店并创建发票启用此功能。

#### 向发票添加额外费用（网络费）

- 仅当客户为发票支付多次时
- 每次支付时
- 永不添加网络费
#### 发票在 .. 分钟后未全额支付将过期。
发票计时器默认设置为15分钟。计时器是一种针对价格波动的保护机制，因为它根据加密货币对法币的汇率锁定了加密货币金额。如果客户在规定时间内未支付发票，发票将被视为已过期。只要交易在区块链上可见（0确认），发票就被视为“已支付”，但在达到商家定义的确认次数（通常为1-6次）时，发票才被视为“完成”。计时器是可自定义的。

#### 即使支付金额比预期少 ..%，也视为发票已支付。

在客户使用交易所钱包直接支付发票的情况下，交易所会收取少量费用。这意味着这样的发票并未完全完成。发票获得“部分支付”状态。如果商家想接受未付全款的发票，您可以在此处设置百分比率。

### 请求

支付请求是一项功能，允许BTCPay商店所有者创建长期有效的发票。资金按支付时的汇率支付给支付请求。这允许用户在不与商店所有者协商或验证支付时的汇率的情况下，按照自己的便利进行支付。

用户可以分批支付请求。支付请求将保持有效，直到全额支付或商店所有者要求设置过期时间为止。地址从不重复使用。每次用户点击支付以为支付请求创建发票时，都会生成一个新地址。

商店所有者可以打印支付请求（或导出发票数据）以便记录和会计。BTCPay会自动在您商店的发票列表中将发票标记为支付请求。

#### 自定义您的支付请求

- 发票金额 - 设置请求的支付金额
- 计价单位 - 以法币或加密货币显示请求金额
- 支付数量 - 仅允许单次支付或部分支付
- 过期时间 - 允许支付直至某个日期或无过期限
- 描述 - 文本编辑器、数据表格、嵌入照片和视频
- 外观 - 使用CSS主题的颜色和样式

![image](assets/en/93.webp)

#### 创建支付请求

在左侧菜单中，转到支付请求并点击“创建支付请求”。

![image](assets/en/94.webp)

提供请求名称、金额、显示计价单位、关联商店、过期时间和描述（可选）

如果您想允许部分支付，请选择允许收款人以其计价单位创建发票的选项。

点击保存并查看以审查您的支付请求。

BTCPay为支付请求创建一个URL。分享此URL以查看您的支付请求。需要多个相同的请求吗？您可以使用主菜单中的克隆选项复制支付请求。

![image](assets/en/95.webp)

**警告**

支付请求依赖于商店，意味着每个支付请求在创建时都与一个商店关联。确保您的商店连接到了属于该支付请求的钱包。

#### 已支付请求

付款人和请求者在发送支付后可以查看支付请求的状态。如果已全额收到付款，状态将显示为已结算。如果只进行了部分支付，应付金额将显示尚欠余额。

![image](assets/en/96.webp)

#### 自定义支付请求

可以使用支付请求的文本编辑器编辑描述内容。如果您想使用额外的颜色主题或自定义CSS样式，这两个选项都可用。
非技术用户可以使用[bootstrap主题](https://docs.btcpayserver.org/Development/Theme/#2-bootstrap-themes)。通过提供额外的CSS代码，可以进一步自定义，如下所示。
```css
:root {
  --btcpay-font-family-base: "Source Sans Pro", -apple-system,
    BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  --btcpay-primary: #7d4698;
  --btcpay-primary-accent: #59316b;
  --btcpay-body-text: #333a41;
  --btcpay-body-bg: #fff;
  --btcpay-bg-tile: #f8f9fa;
}

#mainNav {
  color: white;
  background: linear-gradient(#59316b, #331840);
}

#mainNav .btn-link {
  color: white;
}
```

### 拉式支付

传统上，接收方分享他们的比特币地址来进行比特币支付，发送方稍后向这个地址发送资金。这样的系统被称为推式支付，因为发送方在接收方可能不可用时发起支付，将支付推给接收方。

但是，如果角色颠倒呢？

如果不是发送方推送支付，而是发送方允许接收方在他们认为合适的时候拉取支付呢？这就是拉式支付的概念。这允许了几种新的应用，例如：

- 订阅服务（订阅者允许服务每隔一定时间拉取资金）
- 退款（商家允许客户在他们认为合适的时候将退款资金拉到他们的钱包）
- 面向自由职业者的基于时间的计费（雇主允许自由职业者根据报告的时间将资金拉到他们的钱包）
- 赞助（赞助者允许接收者每月拉取资金以继续支持他们的工作）
- 自动售卖（交易所的客户允许交易所每月自动从他们的钱包拉取资金进行售卖）
- 余额提现系统（高流量服务允许用户从他们的余额请求提现，服务可以轻松地批量处理所有用户的支付，定期进行）

### 支付

支付功能与[拉式支付](https://docs.btcpayserver.org/PullPayments/)紧密相关。这个功能允许你在你的BTCPay中创建支付。这个功能允许你处理拉式支付（退款、薪资支付或提现）。

#### 示例 1：退款

我们从退款示例开始。客户在你的商店购买了一件商品，但不幸的是他们必须退回商品。他们想要退款。在BTCPay中，你可以创建一个[退款](https://docs.btcpayserver.org/Refund/)并提供客户链接来认领他们的资金。一旦客户提供了他们的地址并认领了资金，它将显示在支付中。

它的第一个状态是等待批准。店员可以检查是否有多个等待中的，经过选择后，你使用操作按钮。

操作按钮上的选项

- 批准选定的支付
- 批准并发送选定的支付
- 取消选定的支付

下一步是批准并发送选定的支付，因为我们想退款给客户。检查客户的地址，显示金额，以及我们是否希望从退款中扣除费用。一旦你完成了检查，剩下的只是签署交易。
客户现在可以在索赔页面上获得更新。他可以通过提供的链接跟踪交易，该链接指向区块浏览器和他的交易。一旦交易被确认，状态变更为已完成。

#### 示例 2：工资

现在让我们来看看工资支付，因为这是在商店内部驱动的，而不是根据客户的请求。其基础是相同的；它使用拉取支付。但是我们不是创建退款，我们将创建一个[拉取支付](https://docs.btcpayserver.org/PullPayments/)。

转到您的BTCPay服务器中的拉取支付标签页。在右上角，点击创建拉取支付按钮。

现在我们进入到创建支付的界面，给它一个名称和所需金额的所需货币，填写描述，这样员工就知道这是关于什么的。下一部分类似于退款。员工填写目的地址和他想从这次支付中索取的金额。他可能决定将其分成2个不同的索赔，发送到不同的地址，或者甚至通过闪电网络部分索赔。

如果有多个等待中的支付，您可以批量签名并发送这些支付。一旦签名，支付就会移动到进行中标签页并显示交易。当网络接受后，支付移动到已完成标签页。已完成标签页纯粹是出于历史目的。它保存了已处理的支付和属于它的交易

### 拉取支付

#### 概念

当发送者配置拉取支付时，他们可以配置多个属性：

- 拉取请求名称
- 限额
- 单位（如BTC, SAT, USD）
- 支付方式
  - BTC链上
  - BTC链下
- 描述
- 自定义CSS
- 结束日期（对于闪电网络BOLT11可选）

此后，发送者可以使用链接与接收者分享拉取支付，允许接收者创建支付。接收者将选择他们的支付方式：

- 使用哪种支付方式
- 将钱发送到哪里

一旦创建了支付，它将计入当前期间拉取支付的限额。然后发送者将通过设置支付的速率来批准支付并继续支付。

对于发送者，我们提供了一种易于使用的方式，通过[BTCPay内部钱包](https://docs.btcpayserver.org/Wallet/)批量支付几个支付。

#### Greenfield API

BTCPay服务器为发送者和接收者提供了完整的API，该API在您实例的`/docs`页面中有文档记录。（或在文档网站https://docs.btcpayserver.org上）

由于我们的API暴露了拉取支付的全部能力，发送者可以根据自己的需求自动化支付。

### 技能总结

在本节中，您学到了以下内容：

- 深入理解BTCPay服务器的发票状态以及可以对其执行的操作
- 自定义和管理称为请求的延长寿命发票机制。
- BTCPay服务器独特的拉取支付功能开启的额外灵活支付可能性，特别是如何处理退款和工资支付。

### 知识评估

#### KA 概念回顾

发票和支付请求之间有哪些差异，使用后者可能的一个好理由是什么？

#### KA 概念回顾

拉取支付如何在通常可以在链上完成的操作上进行扩展？描述它们启用的一些用例。

## BTCPay服务器默认插件
<chapterId>7d673dc4-bd5d-5411-819b-f135f1d86636</chapterId>
### 默认插件和应用程序

BTCPay服务器配备了一套标准的插件（应用程序），可以将BTCPay服务器转变为电子商务支付网关。通过添加销售点、众筹平台和简易支付按钮，BTCPay服务器成为一种易于部署的解决方案。

### 销售点

BTCPay服务器的标准插件之一是销售点（PoS）。通过PoS插件，店主可以直接从BTCPay服务器创建一个网上商店，店主不需要第三方电子商务解决方案来运营一个网上商店。基于Web的PoS应用程序允许拥有实体店的用户轻松接受比特币，无需费用或第三方，直接进入他们的钱包。PoS可以轻松地在支持Web浏览的平板电脑或其他设备上显示。用户可以轻松创建一个主屏幕快捷方式，以快速访问Web应用程序。

#### 如何创建新的销售点

BTCPay服务器允许店主快速以多种布局创建销售点。BTCPay服务器认识到，并非每个商店都是电子商务，也不是每个商店都是酒吧或餐厅，它为您的PoS提供了多种标准设置。

当店主在左侧菜单栏中点击“销售点”时，BTCPay服务器现在会要求输入一个名称；这个名称将在左侧菜单栏中可见。点击创建以创建PoS。

![image](assets/en/97.webp)

#### 更新新创建的销售点

创建新的PoS后，接下来的屏幕将是更新您的销售点并为您的商店添加项目。

##### 应用名称

在这里给您的销售点起的名字将在BTCPay服务器的主菜单中可见。

##### 显示标题

公众访问您的商店时会看到公开标题或名称。BTCPay服务器标准地将您的商店命名为“茶店”。请将其替换为您商店的名称。

![image](assets/en/98.webp)

#### 选择销售点样式

BTCPay服务器能够以多种方式显示其销售点。

- 产品列表
  - 一种商店视图，客户一次只能购买1个产品。
- 带购物车的产品列表。
  - 一种商店视图，客户可以一次购买多个项目，并在屏幕右侧获得购物车概览。
- 仅键盘
  - 没有产品列表，只有直接开具发票的键盘。
- 打印显示（带QR的可打印产品列表）
  - 如果您不能始终以数字方式显示您的产品列表，需要产品的“离线”解决方案；BTCPay服务器有一个打印显示功能，作为离线商店。

![image](assets/en/99.webp)

#### 销售点样式 - 产品列表

![image](assets/en/100.webp)

#### 销售点样式 - 产品列表 + 购物车

![image](assets/en/101.webp)

#### 销售点样式 - 仅键盘

![image](assets/en/102.webp)

#### 销售点样式 - 打印显示

![image](assets/en/103.webp)

#### 货币

店主可以为他的销售点设置与他整体默认货币不同的货币。商店的默认货币将自动填充此字段。

#### 描述

向世界介绍您的商店；您在卖什么，价格是多少？解释您的商店的所有内容都在这里。
#### 产品

当创建了一个销售点时，标准的BTCPay服务器会为商店添加几个项目作为参考。点击任何标准项目上的编辑按钮，以更好地理解每个可能的项目选项。

在您的商店中创建新产品包括以下字段：

- 标题
- 价格（固定、最低或自定义）
- 图片URL
- 描述
- 库存
- ID
- 购买按钮文本
- 启用/禁用

一旦店主填写了所有新产品字段，点击保存，您会注意到销售点的产品部分现在正在被填充。始终确保在屏幕右上角保存，以避免店主在添加产品时可能会丢失他们的进度。

店主也可以使用“原始编辑器”来配置他们的产品。原始编辑器需要对JSON结构有基本的了解。

#### 结账

BTCPay服务器允许对小型销售点特定的结账自定义。店主可以设置“购买x”文本或通过添加表单来请求特定的客户数据。

#### 小费

并非所有商店都需要在销售中提供小费选项。店主可以根据他们的商店需要开启或关闭此功能。如果商店开启了小费功能，店主可以设置他们喜欢的小费字段文本。BTCPay服务器的小费基于百分比金额工作。店主可以用逗号分隔添加多个百分比。

#### 折扣

作为店主，您可能想在结账时给客户一个自定义折扣；在您的商店结账时，折扣切换变得可用。然而，这对于自助结账系统来说是非常不建议的。

#### 自定义支付

当自定义支付选项被开启时，客户可以输入他们设置的价格，等于或高于商店生成的原始发票。

#### 额外选项

为您的销售点设置好一切后，还有一些额外的选项。店主可以通过Iframe轻松嵌入他们的销售点，或嵌入一个链接到特定商店项目的支付按钮。为了使刚创建的销售点商店风格化，店主可以在额外选项的底部添加自定义CSS。

#### 删除此应用

如果店主想要从他的BTCPay服务器完全删除销售点，可以在更新销售点的底部点击“删除此应用”按钮来完全销毁他们的销售点应用。点击“删除此应用”时，BTCPay服务器会通过输入`DELETE`并点击删除按钮来请求确认。删除后，店主返回到BTCPay服务器仪表板。

### BTCPay服务器 - 众筹

除了销售点插件，BTCPay服务器还提供创建众筹的选项。就像任何其他众筹平台一样，店主可以设定目标，为贡献创建福利，并根据他们的需求进行自定义。

#### 如何设置新的众筹

通过BTCPay服务器左侧的主菜单点击众筹插件，在插件部分下方。BTCPay服务器现在将请求一个众筹的名称；这个名称也将显示在左侧菜单栏中。

#### 更新新创建的销售点

一旦应用被命名，下一个屏幕将是更新应用以具有上下文。

#### 应用名称

您的众筹给定的名称将在BTCPay服务器的主菜单中可见。

#### 显示标题
为公众提供的众筹活动标题。

#### 标语

给众筹活动一个简短的口号，让人一眼就能认出这次募捐是关于什么的。

![image](assets/en/107.webp)

#### 特色图片网址

每个众筹活动都有一个主图，那是你能直接识别的一个标志性横幅。如果你拥有管理权限，这张图片可以存储在你的服务器上，管理员可以在 BTCPay Server 的设置 - 文件下上传。当你是商店拥有者时，必须通过第三方主机（例如 imgur）将图片上传到网上。

#### 使众筹活动公开

这个开关使你的众筹活动公开，因此对外界可见。出于测试目的或者想检查你的主题是否正确应用，你可能想在构建众筹活动期间将其设置为关闭。

#### 描述

向世界介绍你的众筹活动，你在为什么筹款？解释你的众筹活动的所有内容都在这里。

![image](assets/en/108.webp)

#### 众筹目标

为募捐项目设定一个目标金额，以及目标货币的单位。确保如果你的目标设定了日期范围，包括这些目标和结束日期在众筹的目标下。

![image](assets/en/109.webp)

#### 福利

福利在你的众筹活动中起着很大的作用。这是因为福利为人们参与你的活动提供了一种方式。它们既能激发自私的动机，也能激发慈善的动机。它们让你能够接触到支持者的消费能力，而不仅仅是他们的慈善钱包——你可以猜哪个更重要。

创建一个新的福利包括以下字段：

- 标题
- 价格（固定、最低或自定义）
- 图片网址
- 描述
- 库存
- ID
- 购买按钮文本
- 启用/禁用

一旦商店拥有者填写了所有新建福利的字段，点击保存，你会注意到众筹的福利部分现在开始填充了。

![image](assets/en/110.webp)

### BTCPay Server - 销售点

#### 贡献

商店拥有者可以选择如何展示福利，它们如何排序，甚至如何与其他福利相比较。然而，一旦达到众筹目标，商店拥有者可能想停止向这个募捐活动流入的捐款。因此，他可以开启“达到目标后不允许额外贡献”。这将停止众筹接受捐款。

##### 众筹行为

众筹的标准仅将通过众筹创建的发票计入目标。然而，可能有些情况下，商店拥有者希望这个商店中创建的所有发票都计入众筹。

#### 额外的自定义选项

BTCpay Server 提供了一些额外的自定义选项。添加声音、动画或甚至讨论线程到众筹中。商店拥有者也可以通过输入他们自己的自定义 CSS 来改变众筹的外观和感觉。

#### 删除此应用

如果商店拥有者想要从他的 BTCPay Server 完全删除众筹活动，在更新众筹时，商店拥有者可以点击页面底部的“删除此应用”按钮来彻底销毁他们的众筹应用。点击“删除此应用”时，BTCPay Server 会要求通过输入`DELETE`并点击删除按钮来确认。删除后，商店拥有者将返回到 BTCPay Server 仪表板。

### BTCPay Server - 支付按钮
易于嵌入的HTML和高度可定制的支付按钮允许店主接收小费和捐赠。在BTCPay Server的左侧菜单栏中，店主可以点击“Plugins”部分下方的“Pay Button”，然后点击启用以创建支付按钮。

#### 通用设置

在支付按钮的通用设置中，店主可以设置

- 标准价格
- 默认货币
- 默认支付方式
  - 使用店铺默认
  - BTC链上
  - BTC链下（闪电网络）
  - BTC链下（LNURL-pay）
- 结账描述
- 订单ID

#### 显示选项

BTCPay Server的支付按钮可以配置以适应不同的风格。按钮可以有固定或自定义金额，显示方式可以是滑块或加减切换。

#### 使用模态框

创建支付按钮时，店主可以选择客户点击时的行为，是在模态框中显示还是作为新页面显示。

**!?注意!?**

警告：支付按钮仅应用于小费和捐赠

不推荐使用支付按钮进行电子商务集成，因为用户可以修改订单相关信息。对于电子商务，您应该使用我们的Greenfield API。如果此商店处理商业交易，我们建议您在使用支付按钮前创建一个单独的商店。

#### 自定义支付按钮文本

默认情况下，BTCPay Server的支付按钮显示为“用BTCPay支付”。店主可以根据自己的意愿设置这段文本，并将BTCPay Server的logo更换为自己的。通过使用“支付按钮文本”设置文本，并在“支付按钮图片URL”下粘贴图片URL。

##### 图片大小

按钮中的图片大小只能设置为三个默认值。

- 146x40px
- 168x46px
- 209x57px

#### 按钮类型

BTCPay Server对支付按钮有三种状态。

- 固定金额
  - 在按钮的通用设置中预设的价格。
- 自定义金额
  - BTCPay Server的支付按钮有+和-切换来设置自定义价格。
  - 使用自定义金额时，BTCPay Server将请求最小值、最大值以及价格应如何逐渐增加。
  - 按钮可以设置为“使用简单输入样式”。这将去除+/-切换。
  - 按钮和切换内联显示。
- 滑块
  - 类似于自定义金额，但在视觉上不同，因为它有滑块而不是+/-切换。
  - 使用滑块时，BTCPay Server将请求最小值、最大值以及价格应如何逐渐增加。

**!?注意!?**

可以在顶部的警告描述中删除支付按钮。

#### 支付通知

服务器IPN（即时支付通知）用于webhooks，可以通过URL填写以发布购买数据。

#### 邮件通知

每当发生支付时，BTCPay Server可以通知店主。

#### 浏览器重定向

客户完成购买后，如果店主设置了此链接，他将被重定向到这个链接。

#### 高级支付按钮选项

指定应在创建发票后附加到结账页面的额外查询字符串参数。例如，`lang=da-DK`将默认加载丹麦语的结账页面。

#### 使用应用作为端点

直接将支付按钮链接到之前的某个PoS或众筹应用中的一个项目。
商店所有者可以点击下拉菜单并选择他们想要的应用程序；一旦选择了应用程序，商店所有者就可以添加需要链接的项目。
#### 生成的代码

由于BTCPay Server的支付按钮是易于嵌入的HTML，BTCPay Server在配置支付按钮后会在底部显示要复制到网站的生成代码。

商店所有者可以将生成的代码复制到他们的网站上，BTCPay Server的支付按钮将直接在他们的网站上激活。

#### 支付通知

服务器IPN（即时支付通知）用于Webhooks，可以通过URL填写以发布购买数据。

#### 邮件通知

每当发生支付时，BTCPay Server可以通知商店所有者。

#### 浏览器重定向

当客户完成购买时，如果商店所有者设置了此链接，他将被重定向到这个链接。

#### 高级支付按钮选项

指定应在创建发票后附加到结账页面的额外查询字符串参数。例如，`lang=da-DK`将默认以丹麦语加载结账页面。

#### 将应用程序用作端点

直接将支付按钮链接到之前的某个PoS或众筹应用中的项目。商店所有者可以点击下拉菜单并选择他们想要的应用程序，一旦选择了应用程序，商店所有者就可以添加需要链接的项目。

#### 生成的代码

由于BTCPay Server的支付按钮是易于嵌入的HTML，BTCPay Server在配置支付按钮后会在底部显示要复制到网站的生成代码。商店所有者可以将生成的代码复制到他们的网站上，BTCPay Server的支付按钮将直接在他们的网站上激活。

### 技能总结

在本节中，您学到了：

- 如何使用BTCPay Server集成的PoS插件轻松创建自定义商店
- 如何使用BTCPay Server集成的众筹插件轻松创建自定义众筹应用
- 使用支付按钮插件生成自定义支付按钮的代码

### 知识评估

#### KA回顾

BTCPay Server标配的三个内置插件是什么？用几句话描述每个插件的用途。

# 配置BTCPay Server

<partId>ff38596c-7de3-5e5c-ba50-9b9edbbbb5eb</partId>

## 在LunaNode环境中安装BTCPay Server的基本了解

<chapterId>d0a28514-ffcf-529b-9156-29141f0b060a</chapterId>

### 在托管环境（LunaNode）上安装BTCPay Server

这些步骤将提供开始在LunaNode上使用BTCPay Server所需的所有信息。有许多部署软件的选项。
您可以在 https://docs.btcpayserver.org 找到BTCPay Server的所有详细信息。

#### 我们从哪里开始？

在这部分中，您将熟悉LunaNode作为托管提供商，了解使用BTCPay Server的第一步，并学习如何使用闪电网络。在我们完成所有步骤后，您可以运行一个接受比特币的网上商店或众筹平台！

这是部署BTCPay Server的众多方式之一。阅读我们的文档了解更多详情，

https://docs.btcpayserver.org.

### BTCPay Server - LunaNode部署

#### LunaNode部署
首先，访问LunaNode.com的网站，在那里我们将创建一个新账户。点击右上角的“注册”或使用他们主页上的“开始使用”向导。
![image](assets/en/111.webp)

创建新账户后，LunaNode会发送一封验证电子邮件。一旦验证了账户，与Voltage相比，你会立即被引导去充值账户余额。这个余额是用来支付服务器空间和托管成本的。

![image](assets/en/112.webp)

#### 为你的LunaNode账户添加信用

点击“存入信用”后，你可以设置想要充值的金额以及支付方式。LunaNode和BTCPay Server的费用在每月10美元到20美元之间。
与Voltage.cloud相比，你确实可以完全访问你的虚拟私人服务器（VPS），因此可以更多地控制你的服务器。创建新账户后，LunaNode会发送一封验证电子邮件。
一旦验证了账户，与Voltage相比，你现在会立即被引导去充值账户余额。这个余额是用来支付服务器空间和托管成本的。

#### 如何部署新服务器？

在这个指南中，我们将通过创建一组API密钥并使用LunaNode制作的BTCPay Server启动器来进行设置。

在你的LunaNode仪表板中，点击右上角的API。这将打开一个新页面。我们只需要为API密钥设置一个名称。其余的将由LunaNode处理，本指南不会涉及。点击“创建API凭证”按钮。
创建API凭证后，你会得到一长串字母和字符。这是你的API密钥。

![image](assets/en/113.webp)

#### 如何部署新服务器？

这些凭证有两部分，API密钥和API ID；我们两者都需要。在我们进行下一步之前，让我们在浏览器中打开第二个标签页，访问https://launchbtcpay.lunanode.com/

这里你将被要求提供你的API密钥和API ID。这是为了验证是你在配置这个新服务器。API密钥应该还在你之前的标签页中打开；如果你在下面的表格中向下滚动，你会找到API ID。

返回带有启动器的页面，用你的API密钥和ID填写字段，然后点击继续。

![image](assets/en/114.webp)

在下一步，你可以提供一个域名。如果你已经拥有一个域名并想用它来使用BTCPay Server，请确保你也在你的域名上添加了DNS记录（称为`A`记录）。如果你没有拥有一个域名，使用LunaNode提供的域名（你可以稍后在BTCPay Server设置中更改这个）并点击继续。

阅读更多关于为BTCPay Server设置或更改DNS记录的信息；https://docs.btcpayserver.org/FAQ/Deployment/#how-to-change-your-btcpay-server-domain-name

#### 在LunaNode上启动BTCPay Server

在完成之前的步骤后，我们可以为我们的新服务器设置所有选项。这里我们将选择比特币（BTC）作为我们支持的货币；我们可以设置一个电子邮件来获取关于加密证书续订的通知；这不是强制性的。
本指南旨在建立一个Mainnet环境（现实世界的比特币）；然而，LunaNode还允许您将其设置为Testnet或Regtest以进行开发目的。在本指南中，我们将保留Mainnet选项。
选择您的Lightning实现。LunaNode提供两种不同的实现，LND和Core Lightning。对于本指南，我们将选择LND。这两种实现有一些小但真实的差异；关于此，我们推荐阅读详尽的文档；https://docs.btcpayserver.org/LightningNetwork#getting-started-with-btcpay-server-and-core-lightning-cln

![image](assets/en/115.webp)

LunaNode提供多种虚拟机（VM）计划。这些计划在价格范围和服务器规格上有所不同。对于本指南，m2计划就足够了；然而，如果您选择的货币不仅仅是比特币，考虑使用至少m4。

加速初始区块链同步；这是可选的，取决于您的需求。有一些高级选项，如设置Lightning别名，指向特定的GitHub发布，或设置SSH密钥；本指南中不会涉及这些。

填写完表单后，您需要点击启动VM，LunaNode将开始创建您的新VM，其中包括安装了BTCPay Server。这个过程需要几分钟；一旦您的服务器准备好，LunaNode会给您提供新BTCPay Server的链接。

创建过程之后，点击您的BTCPay Server链接；在这里，您将被要求创建一个管理员账户。

![image](assets/en/116.webp)

### 技能总结

在本节中，您学到了：

- 在LunaNode上创建和资助一个账户
- 使用BTCPay Server启动器创建您自己的服务器

### 知识评估

#### KA概念回顾

描述在VPS上运行BTCPay Server实例与在托管实例上创建账户之间的一些差异。

## 在Voltage环境上安装BTCPay Server

<chapterId>11c7d284-b4d2-5542-872c-df9bd9c1491b</chapterId>

您将熟悉Voltage.cloud作为托管提供商，了解使用BTCPay Server的第一步，并学习如何使用Lightning Network。完成所有步骤后，您可以运行一个接受比特币的网上商店或众筹平台！

这是部署BTCPay Server的众多方法之一。阅读我们的文档了解更多详情，
https://docs.btcpayserver.org。

### BTCPay Server - Voltage.cloud部署

首先，访问网站Voltage.cloud并注册一个新账户。创建账户时，您可以注册7天免费试用。点击右上角的“注册”或使用其主页上的“尝试7天免费试用”。

![image](assets/en/117.webp)

创建账户后，点击仪表盘上的`NODES`按钮。一旦我们选择了Nodes并创建了一个新节点，我们就会看到Voltage提供的可能的节点。由于本指南还将讨论LightningNetwork，在Voltage，我们首先需要在创建BTCPay Server之前选择我们的Lightning实现。点击LightningNode。

![image](assets/en/118.webp)
在这里，您需要选择您想要的闪电网络节点类型。Voltage为您的闪电网络设置提供了多种选项。这与使用LunaNode部署时有所不同。为了本指南的目的，一个轻节点就足够了。在Voltage.cloud上阅读更多关于不同之处。

![image](assets/en/119.webp)

给您的节点命名，设置密码，并保护好这个密码。如果这个密码丢失，您将失去对备份的访问权限，而Voltage无法恢复它。创建节点后，Voltage会显示进度。Voltage已为您创建了闪电网络节点。我们现在可以创建BTCPay Server实例，并直接访问闪电网络。

点击仪表盘左上角的“节点”。在这里，您可以设置BTCPay Server实例的下一部分。进入节点概览后点击“创建新的”。您将看到一个与之前相似的屏幕。现在我们选择的不是闪电网络节点，而是BTCPay Server。

Voltage会显示您的BTCPay Server的地理位置，Voltage的主机位于美国西部地区。在这里，您还将看到托管服务器的成本。点击创建并给您的BTCPay Server命名。启用闪电网络，Voltage会显示在上一步中创建的闪电网络节点。点击创建，Voltage将创建一个BTCPay Server实例。

![image](assets/en/120.webp)

点击创建后，Voltage会提供默认的用户名和密码。这些与您之前在Voltage设置的密码相似。点击登录账户按钮，将重定向您到您的BTCPay Server。

欢迎来到您的新BTCPay Server实例。由于我们已经在创建过程中设置了闪电网络，它会显示闪电网络已经启用！

### 技能总结

在本章中，您学到了：

- 在Voltage.cloud上创建账户
- 在账户上一起运行BTCPay Server和闪电网络节点的步骤

### 知识评估

#### KA 概念回顾

Voltage和LunaNode设置之间有哪些关键差异？

## 在Umbrel节点上安装BTCPay Server

<chapterId>3298e292-6476-5fe0-836c-7fa021348799</chapterId>

按照这些步骤完成后，您可以在本地网络上的BTCPay商店接受闪电支付。如果您在餐厅或商业中运行一个umbrel节点，这个过程也适用。如果您想将这个商店连接到公共网站，请按照高级练习将您的umbrel节点暴露给公众。

https://umbrel.com/

![image](assets/en/121.webp)

### BTCPay Server - Umbrel部署

在您的Umbrel节点与比特币区块链完全同步后，转到Umbrel应用商店，并在应用下搜索BTCPay Server。

![image](assets/en/122.webp)

点击BTCPay Server查看应用详情。当BTCPay Server的详情打开时，右下角显示运行应用所需的要求。它显示需要比特币和闪电网络节点。如果您还没有在Umbrel上安装闪电网络节点，请点击安装。这个过程可能需要几分钟。

![image](assets/en/123.webp)

安装您的闪电网络节点后：

1. 在应用详情中点击打开或在Umbrel的仪表盘上点击应用。
2. 点击设置一个新节点；您将看到24个单词，用于恢复您的闪电网络节点。
3. 将这些写下来。

![image](assets/en/124.webp)
Umbrel 会要求验证刚刚记录下来的词语。在 Lightning 节点设置完成后，返回到 Umbrel 应用商店并找到 BTCPay Server。点击安装按钮，Umbrel 会显示所需组件是否已安装，以及 BTCPay Server 需要访问这些组件。安装完成后，点击应用详情右上角的打开按钮，或通过您的 Umbrel 仪表板打开 BTCPay Server。

Umbrel 会要求验证刚刚记录下来的词语。

![image](assets/en/125.webp)

**!?注意!?**

确保像之前学到的存储密钥一样，将这些存储在适当的位置。

在 Lightning 节点设置完成后，返回到 Umbrel 应用商店并找到 BTCPay Server。点击安装按钮，Umbrel 会显示所需组件是否已安装，以及 BTCPay Server 需要访问这些组件。

![image](assets/en/126.webp)

安装完成后，点击应用详情右上角的打开按钮，或通过您的 Umbrel 仪表板打开 BTCPay Server。

![image](assets/en/127.webp)

### 技能总结

在本节中，您学到了：

- 在 Umbrel 节点上安装具有 Lightning 功能的 BTCPay Server 的步骤

### 知识评估

#### KA 概念回顾

Umbrel 上的设置与之前两个托管选项有何不同？

# 结论

<partId>d72e6fa5-0870-5f00-9143-9466ed22e2bd</partId>

## 课程总结

<chapterId>c07ac2a5-f97e-5c57-8a80-4955b48128d4</chapterId>

![image](assets/en/128.webp)

您还应该对比特币是什么、它如何工作以及如何通过像 Lightning Network 这样的第二层技术进行扩展有一个大致的了解。在本课程中，我们广泛地介绍了任何人如何使用 BTCPay Server，从初始安装到商店创建和复杂的发票管理，成为一个财务自主的个人或商家。

恭喜您完成本课程。我们希望您喜欢这些内容，并继续使用和探索 BTCPay Server，对比特币以及不断增长的建设者和参与者社区所带来的光明未来感到兴奋，正如我们一样。

> **FOSS 是不可避免的。**

### 术语表

| 术语                                        | 定义                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 51% 攻击                                  | 故意构建一个新的最长区块链以替换区块链中的区块的行为。这允许你替换已经被挖掘到区块链中的交易。当你拥有大部分的挖掘能力时，执行这种攻击最为容易，这就是为什么它被称为“多数攻击”或“51% 攻击”。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| AccountKey                                  | 用于重定基的账户密钥                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| AccountKeyPath                              | 从根到账户密钥的路径，由主公钥指纹作为前缀。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 地址 | 比特币地址紧凑地编码了支付给接收者所需的信息。一个现代地址由一串字母和数字组成，以bc1开头，看起来像是bc1qw508d6qejxtdg4y5r3zarvary0c5xw7kv8f3t4。地址是接收者锁定脚本的简写，发送者可以使用它将资金签名转给接收者。大多数地址要么代表接收者的公钥，要么代表定义更复杂支出条件的某种形式的脚本。前面的例子是一个bech32地址，编码了一个见证程序，将资金锁定到公钥的哈希上（参见支付到见证公钥哈希）。还有一些较旧的地址格式，以1或3开头，使用Base58Check地址编码来代表公钥哈希或脚本哈希。 |
| 地址类型 | 一个地址可以代表几种不同的脚本。地址经过编码并加上前缀以传达其脚本类型。传统地址使用Base58，当一个传统地址是公钥的哈希时，它被称为P2PKH地址，以‘1’开头。较少情况下，传统地址是脚本的哈希，在这种情况下，它将以‘3’开头。目前，所有SegWit地址都使用Bech32编码，并以前缀‘bc1’开头。 |
| 应用 | BTCPay Server有插件，可能本身就作为一个应用程序运行。 |
| BIP 329 | 导出/导入钱包标签 |
| BIP49 | 定义使用P2WPKH嵌套在P2SH（BIP 141）序列化格式的HD钱包的派生方案，用于隔离见证交易。 |
| 比特币地址 | 你发送比特币的字母数字字符串，因此它“现在居住”在那里是一个标识符，由大约33个字母和数字组合的字符串组成。在当前协议版本中，地址以1、3或b开头。拥有接收者的地址是启动比特币交易的必要部分。比特币地址从公钥生成，可以从一组公钥生成多个地址以提高隐私。比特币地址就像电子邮件地址一样，如果你想发送消息，你需要知道它的去向，比特币也是如此。在发送比特币交易之前，你需要确保接收者的地址是准确的，因为比特币交易是不可逆的，你可能会将比特币发送到不属于接收者的地址。 |
| bitcoin与Bitcoin | Bitcoin是货币网络，而bitcoin（小写）是Bitcoin网络上的货币单位。你使用比特币货币或代币在Bitcoin网络上进行交易。 |
| 区块 | 区块是比特币区块链中的一种数据结构，由一个头部和一系列比特币交易的主体组成。区块带有时间戳，并承诺一个特定的前驱（父）区块。当哈希处理区块头时，提供了使区块链概率上不可变的工作证明。区块必须遵守网络共识强制执行的规则以扩展区块链。当一个区块被添加到区块链时，包含的交易被认为获得了第一次确认。 |
| 区块浏览器 | 一个在线工具，使你能够搜索有关区块链的实时和历史信息，包括与区块、交易、地址等相关的数据。 |
| 区块哈希                                    | 区块哈希是区块数据的SHA-256哈希值，通常以十六进制格式表示。区块哈希可以被解释为一个非常大的数字。为了满足工作量证明（Proof-of-Work）的要求，区块哈希必须低于某个特定的阈值。因此，所有区块哈希都以一系列的零开始，后跟一个字母数字字符串。有些区块的前导零多达二十个，而早期的区块前导零少至八个。所需零的数量大致显示了区块发布时挖矿的难度。                                                                                                                                                                                                                                                                                                                                                   |
| 区块高度                                    | 每个区块按升序编号，从零开始。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 区块奖励                                    | 包括区块补贴（新创建的比特币）和区块中包含的所有交易费用之和。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 区块大小                                    | 每个区块有限的数据容量。未能放入某个区块的数据，将被记录在后续的某个区块中。就比特币区块而言，它曾经的区块大小为1MB，然而在一次软分叉后，区块大小技术上可以容纳高达4MB的数据。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 区块补贴                                    | 每个区块中新铸造的比特币数量。每生产并添加到区块链上的区块，允许该区块的创建者铸造一定数量的新比特币。补贴起始于每个区块50 BTC，每210,000个区块或大约4年减半一次。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 区块链                                      | 所有比特币交易的分布式日志或数据库。交易被分组为称为区块的离散更新，最多限制到4百万权重单位。通过称为挖矿的随机过程，大约每10分钟产生一个区块。每个区块包括一个计算密集型的“工作量证明”。工作量证明要求用于调节区块间隔，并保护区块链免受重写历史的攻击：攻击者需要超越现有的工作量证明才能替换已发布的区块，使每个区块随着后续区块的堆叠而概率性地不可变。                                                                                                                                                                                                                                                                                                                                                   |
| BTCPAY服务器保险库                         | 为了在易用性、安全性和隐私性之间达到最佳平衡，建议将BTCPay服务器钱包与硬件钱包一起使用。BTCPay保险库旨在桥接硬件钱包和BTCPay服务器。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 拜占庭将军问题                              | 一个博弈论问题，描述了去中心化方在不依赖可信中心方的情况下达成共识的难度。名称来源于几位将军围攻拜占庭的场景。他们包围了城市，但必须集体决定何时攻击。如果所有将军同时攻击，他们将获胜，但如果他们在不同时间攻击，他们将失败。将军们之间没有安全的通信渠道，因为他们发送或接收的任何消息可能已被拜占庭的防御者截获或欺骗性地发送。将军们如何组织同时攻击？                                                                                                                                                                                                                                                                                                                                 |
| 审查                                        | 对可以传输给大众的信息进行控制。就比特币而言，审查是指第三方停止交易的能力。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 找零                                        | UTXO返回给发送者钱包的部分，通常通过不同的地址。相当于输入总和减去花费金额和交易费用的总和。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Child Pays For Parent (CPFP)                | 一种费用提升技术，用户通过在子交易中以高费率花费一个低费率未确认交易的输出，以此鼓励矿工将这两笔交易都包含在一个区块中。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Coinbase Transaction                        | 每个区块中的第一笔交易，它将区块奖励和交易费用分配给挖出该区块的人。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Coincidence of Wants                        | 一种经济现象，其中两方各持有对方想要的物品，因此他们直接交换这些物品，无需任何货币媒介。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Cold Storage                                | 一种在不连接互联网的情况下管理数据的方式。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Cold Wallet                                 | 一种比特币钱包，可以安全地离线存储您的私钥，通常在一个物理设备上。也被称为硬件钱包，它通过使用一个类似U盘的设备（不连接互联网）来保护您的数字比特币免受在线黑客的攻击。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Command Line Interface (CLI)                | 通过用户或客户端的命令与设备或计算机程序进行交互，以及设备或程序以文本行形式的响应。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Commitment Transaction                      | 承诺交易是一种比特币交易，由通道双方签名，编码了通道的最新余额。每次通过通道进行新的支付或转发时，通道余额将更新，并且双方将签署一笔新的承诺交易。重要的是，在Alice和Bob之间的通道中，Alice和Bob都保留自己版本的承诺交易，该交易也由另一方签名。在任何时候，Alice或Bob都可以通过将他们的承诺交易提交到比特币区块链来关闭通道。提交较旧（过时）的承诺交易在闪电网络中被视为作弊（即协议违规），可能会被另一方通过惩罚交易处罚，将通道中的所有资金据为己有。 |
| Confirmation                                | 一旦交易被包含在一个区块中，它就获得了一次确认。当另一个区块在区块链上被挖出时，该交易获得两次确认，以此类推。六次或更多次确认被认为是充分的证明，表明交易不能被逆转。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Crowdfund (CF)                              | BTCPay Server的一个默认插件，允许店主轻松创建一个典型的众筹网站。他们可以轻松设定目标，为贡献创建福利，并根据需要进行定制。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Cryptography                                | 一种特殊系统，原始消息被改变，以便只有预期的接收者可以接收到它。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Dashboard                                   | BTCPay Server的中心登陆页面。它提供了一个店铺所有活动的概览，跨越多个摘要磁贴显示。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Demo                                        | 指软件演示发生在其中的虚拟环境。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Deployment                                  | 软件部署是使软件系统可供使用的所有活动。一般的部署过程包括几个相互关联的活动，以及它们之间可能的转换。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 导出路径 | 一种数据，告诉分层确定性（HD）钱包如何在一棵密钥树中导出特定的密钥。导出路径作为比特币标准被使用，并在BIP 32的一部分中随HD钱包一起引入。 |
| 难度调整 | 每2016个区块（大约两周）对难度目标进行调整，以尝试确保平均每10分钟挖出一个区块。因此，它在区块之间创建了一致的时间间隔，并且在网络中一致地发行新的比特币（通过区块奖励）。 |
| 难度目标 | 在挖矿中使用，它是一个区块哈希必须低于该数值的数字，以便将区块添加到区块链上。 |
| 数字签名 | 数字签名是一种用于验证数字消息或文件的真实性和完整性的数学方案。它可以被视为一种加密承诺，其中消息不被隐藏。 |
| 可分割性 | 一种商品可以被分成较小的数量而不失去价值的属性。因为经济交易经常以不同的金额发生，货币必须具备可分割性，才能在经济中广泛使用。 |
| Docker | 一种软件，将软件打包成称为容器的标准化单元，这些容器包含运行软件所需的一切，包括库、系统工具、代码和运行时。 |
| 双重支付 | 成功将一些钱支付多于一次的结果。比特币通过验证添加到区块链上的每笔交易遵守共识规则来防止双重支付；这意味着检查交易的输入是否未被之前花费过。 |
| 耐用性 | 货币的属性，其中货币可以保持其原始状态随时间推移并承受重复使用。耐用的货币必须能够承受潜在的损害。 |
| Electrum | Electrum是最受欢迎的比特币钱包之一，创建于2011年。 |
| 扩展公钥（Xpub） | 也称为Xpub的扩展公钥，是一个作为HD钱包特性的父密钥，可以从xpub导出密钥。这个Xpub是在BIP 32中引入的标准。钱包在幕后使用它来导出公钥。不建议分享Xpub，您的资金不会直接面临被转移的风险，xpub不能导出私钥。分享xpub的好处可能是为了在BTCPay Server中的众筹目的。xpub通过在线方式共享，而私钥保持在HWW上离线。 |
| F.U.D. | 恐惧、不确定和怀疑的缩写；通常是故意引发的，以便让竞争对手处于不利地位。 |
| 费用 | 在闪电网络的上下文中，节点将为转发其他用户的支付收取路由费用。个别节点可以设置自己的费用政策，这将计算为固定的基础费用和取决于支付金额的费率之和。在比特币的上下文中，交易的发送者支付给矿工一个交易费用，以包括该交易在一个区块中。比特币交易费用不包括基础费用，并且线性地依赖于交易的重量，而不是金额。 |
| 法定货币 | 由政府发行的货币，不由如黄金等商品支持。 |
| 有限 | 指比特币的供应上限。 |
| 分叉 | 对协议或代码片段的更改。分叉通常用于升级项目。在开源社区中，分叉的存在是因为许多个体选择在不同时间下载并运行相同的软件，并且不总是更新。如果两个用户下载并运行软件的第1版，只有一个用户在第2版发布时升级，那么更新的用户就运行着第1版的分叉版本。 |
| 资金交易 | 用于打开支付通道的交易。资金交易的价值（以比特币计）正好是支付通道的容量。资金交易的输出是一个2-of-2多签名脚本（multisig），每个通道合作伙伴控制一个密钥。由于其多签名的性质，只能通过通道合作伙伴之间的共同同意来花费。它最终将被其中一个承诺交易或关闭交易所花费。 |
| 可替代性 | 指某物（如货币或商品）的性质，其中一部分或数量可以由另一等量的部分或数量替换，以偿还债务或结算账户。 |
| 地址间隙限制 | 指为了计算账户余额而在区块链中检查交易的公共地址的标准数量。超出地址间隙限制的地址上接收的交易不会被检测到。 |
| 创世区块 | 比特币区块链中的第一个区块。比特币的创造者中本聪在2009年1月3日挖出了创世区块，并包含了当天的《金融时报》头条：“财政大臣处于为银行提供第二次救助的边缘。” |
| Github | 一个平台和基于云的服务，用于软件开发和使用Git的版本控制，允许开发者存储和管理他们的代码。 |
| 八卦协议 | LN节点通过与其对等节点交换八卦消息来发送和接收有关闪电网络拓扑的信息。八卦协议主要在BOLT #7中定义，并定义了node_announcement、channel_announcement和channel_update消息的格式。为了防止垃圾邮件，只有当节点已经有一个通道时，节点公告消息才会被转发；只有当通道的资金交易被比特币网络确认时，通道公告消息才会被转发。通常，闪电节点会与他们的通道合作伙伴连接，但连接任何其他闪电节点来处理八卦消息也是可以的。 |
| 格雷欣法则 | 表明“劣币驱逐良币”。换句话说，在使用两种货币的经济中，个体会花费不断贬值的劣币，并持有保值的良币。因此，劣币将在日常交易中的流通和使用方面占主导地位，而良币将在储蓄和长期投资方面占主导地位。 |
| 减半 | 一个事件，每210,000个区块（大约四年）将比特币的发行率减半。 |
| 硬分叉（Hard Fork）                           | 一种不向后兼容的共识变更。向后不兼容发生在之前无效的行为被认定为有效时。为了在硬分叉后保持共识，所有节点都需要升级。否则，旧节点会根据旧规则拒绝交易或区块，认为它们无效，而升级后的节点会接受它们为有效。因此，在比特币中，尽一切努力避免硬分叉。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 硬件钱包（Hardware Wallet, HWW）             | 一种特殊类型的比特币钱包，它将用户的私钥存储在一个安全的硬件设备中。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 哈希函数（Hash Function）                     | 哈希函数是一种将任意大小的数据映射到固定大小的位字符串（哈希）的加密算法，并且设计为单向函数，即不可逆转的函数。从理想的加密哈希函数的输出重建输入数据的唯一方法是尝试暴力搜索可能的输入，看它们是否产生匹配。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 哈希率（Hash Rate）                           | 在比特币网络上，矿工每秒产生的哈希数量的度量。单个哈希是为区块创建工作量证明的尝试。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 热钱包（Hot Wallet）                          | 一种具有外部连接的设备，尤其是连接到互联网的。热钱包是一种连接互联网的比特币钱包。这些钱包对于日常消费更为方便，但由于它们与互联网交互，因此不如冷存储选项安全。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 初始区块下载（Initial Block Download, IBD）  | 从头开始构建完整比特币区块链的过程。当一个新节点设置并加入网络时，它会连接到其他节点并请求区块。新节点处理这些区块并构建区块链，直到它赶上并与网络同步。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 发票（Invoice）                               | 由卖方向买方发出的商业文件，涉及销售交易并指示卖方提供给买方的产品、数量和商定价格。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 了解你的客户（Know Your Customer, KYC）      | 旨在防止金融机构被用于非法资金转移的法律，要求所有金融账户能够识别到个人或组织。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 第二层（Layer 2）                            | 构建在区块链之上的网络，例如，闪电网络（Lightning Network）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 传统地址（Legacy Address）                   | 传统地址使用Base58编码，当传统地址是公钥的哈希时，即所谓的P2PKH地址，它以‘1’开头。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 闪电网络（Lightning Network）                | 一种建立在比特币之上的协议。它创建了一个支付通道网络，通过使用HTLCs和洋葱路由，使得通过网络的支付可以无需信任地转发。闪电网络的其他组成部分包括闲话协议、传输层和支付请求。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 流动性（Liquidity）                          | 一个特定资产在给定市场内订单簿的几个特征的度量。流动性是一个指标，表明大订单对资产价格的市场影响程度。具有更高流动性的资产拥有更深的订单簿深度。这意味着它能够吸收更多的订单，而价格变动较小。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 最长链 | 构建起来耗费最多努力的区块链。之所以这样命名，是因为直观上一个包含更多区块的区块链会比一个区块较少的链条耗费更多能量来构建，但更准确地说，它是指生产过程中需要更多工作的链条，所以更好的名称可能是“最重链”。 |
| 主链 | 在闪电网络的上下文中，这指的是比特币网络。 |
| 交换媒介 | 一种促进经济内其他商品和服务交换的商品类型。历史上，像贝壳、珠子和黄金这样的物品被用作交换媒介。 |
| 内存池 | 简称为“内存池”，它是一个临时存储已被节点接收的交易的地方。 |
| 矿工 | 一个参与通过哈希过程添加新区块以构建区块链的节点。 |
| 挖矿 | 从最近的比特币交易中构建一个区块，然后解决所需的工作证明计算问题的过程。它是通过该过程更新共享的比特币账本（即比特币区块链）和将新交易包含在账本中的过程。这也是发行新比特币的过程。每当创建一个新区块时，挖矿节点将接收该区块的coinbase交易中创建的新比特币。 |
| 多重签名（multisig） | 需要多于一个签名来授权支出的脚本。支付通道总是编码为需要来自支付通道每个合作伙伴的一个签名的多重签名地址。在两方支付通道的标准情况下，使用2-of-2多重签名地址。 |
| 节点 | 参与网络的计算机。特别是比特币或闪电网络。 |
| 输出 | 在比特币交易中创建的比特币包。 |
| 输出锁 | 放置在输出上的一组要求。必须满足这些要求才能在交易中使用输出。最常见的例子是拥有私钥的简单要求。 |
| P2SH地址 | P2SH地址是脚本的20字节哈希的Base58Check编码。P2SH地址以“3”开头。P2SH地址隐藏了所有复杂性，因此支付的发送者不会看到脚本。 |
| P2WPKH地址 | “原生SegWit v0”地址格式，P2WPKH地址是bech32编码的，以“bc1q”开头。 |
| P2WSH地址 | “原生Segwit v0”脚本地址格式，P2WSH地址是bech32编码的，以“bc1q”开头。 |
| 部分签名比特币交易（PSBT） | 一个促进未签名交易可移植性的比特币标准，它允许多方轻松签署同一交易。当多方希望向同一交易添加输入时，这最为有用。PSBT由BIP 174引入，允许用户更容易地在冷存储设备上签署交易，然后从连接到互联网的设备上广播已签名的交易。 |
| 寻路                                       | 在闪电网络中，寻找从源头到目的地支付路径的过程。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 比特币支付到公钥哈希（P2PKH）              | P2PKH是一种输出类型，将比特币锁定到公钥的哈希上。通过P2PKH脚本锁定的输出可以通过提供与哈希匹配的公钥和由相应私钥创建的数字签名来解锁（花费）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 比特币支付到脚本哈希（P2SH）                | P2SH是一种灵活的输出类型，允许使用复杂的比特币脚本。使用P2SH时，详细说明花费输出条件的复杂脚本（赎回脚本）不会出现在锁定脚本中。相反，价值被锁定到一个脚本的哈希上，必须提供并满足该脚本才能花费输出。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 比特币支付到Taproot（P2TR）                 | Taproot在2021年11月激活，是一种新的输出类型，将比特币锁定到一棵花费条件树上，或一个单一的根条件上。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 比特币支付到见证公钥哈希（P2WPKH）          | P2WPKH是P2PKH的SegWit等价物，使用隔离见证。花费P2WPKH输出的签名放在见证树中，而不是ScriptSig字段中。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 比特币支付到见证脚本哈希（P2WSH）           | P2WSH是P2SH的SegWit等价物，使用隔离见证。花费P2WSH输出的签名和脚本放在见证树中，而不是ScriptSig字段中。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Payjoin                                    | 一种特殊类型的比特币交易，其中发送者和接收者共同贡献输入，以打破常见的输入所有权启发式规则，这是一种用来剥夺比特币用户隐私的假设。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 支付通道                                    | 闪电网络上两个节点之间的财务关系，通过向多签名地址支付比特币交易创建。通道合作伙伴可以使用该通道在彼此之间来回发送比特币，而无需将所有交易提交到比特币区块链上。在典型的支付通道中，只有两笔交易，即资金注入交易和承诺交易，被添加到区块链上。通过通道发送的支付不会记录在区块链中，被称为“链下”发生。                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 支付请求                                    | 一项功能，允许BTCPay商店所有者创建长期有效的发票。支付给支付请求的资金使用支付时的汇率。这允许用户根据自己的便利进行支付，无需在支付时与商店所有者协商或验证汇率。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 支付                                       | 与拉取支付相关的功能。此功能允许您处理拉取支付（退款、工资支付或提款）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 插件                                       | 安装在程序上的软件附加组件，增强其功能。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 销售点（PoS）                               | BTCPay Server的默认插件，允许商店所有者直接从BTCPay Server创建网上商店。商店所有者不需要任何第三方电子商务解决方案就可以运营网上商店。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 可携带性                                    | 商品易于跨空间运输的能力。可携带性是硬通货的一个重要特性；为了使一种货币被广泛采用，因而可用，它必须能够相对容易地跨越边界、在个人之间移动，并且能够长距离传输。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 工作量证明（PoW）                           | 需要大量计算才能找到的数据，并且任何人都可以轻松验证以证明产生它所需的工作量。在比特币中，矿工必须找到一个数值解决方案来满足全网的目标，称为难度目标。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 匿名化                                      | 个人使用假名来保护他们的身份或建立与他们真实身份分开的声誉。公钥用于允许比特币用户在对区块链保持匿名的同时接收比特币。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 公钥密码学                                  | 涉及一对称为公钥和私钥的密钥，这对密钥与需要电子验证其身份或签名或加密数据的实体相关联。公钥被公开发布，而相应的私钥保密。用公钥加密的数据只能用相应的私钥解密。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 公钥/私钥                                   | 在公钥密码学中使用的密钥对。公钥在公开场合与他人共享，可以被视为一个账号，而私钥保密，可以被视为密码。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 拉支付                                      | 传统上，要进行比特币支付，接收者分享他们的比特币地址，然后发送者稍后向此地址发送资金。这样的系统被称为推支付，因为发送者启动支付，而接收者可能不可用，实际上是将支付推给接收者。与发送者“推”支付的典型场景不同，发送者允许接收者在接收者认为合适的时候拉取支付。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 兔子洞                                      | 引用《爱丽丝梦游仙境》中的英雄通过进入一个兔子洞开始冒险。在比特币中，它指的是一旦人们开始理解比特币，就会探索看似无穷无尽的话题并以新的视角看待它们。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 接收                                        | 将比特币发送到提供的地址的过程。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 注册                                        | 创建账户或注册服务的过程，通常通过选择用户名和密码完成。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 费用替代（RBF）                             | 比特币交易可以被指定为RBF，以允许发送者用另一个支付更高费用的类似交易替换此交易。这种机制存在是为了允许用户在网络变得拥堵和费用意外上升时做出响应。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 代码库                                      | 在版本控制系统中，代码库是存储一组文件或目录结构的元数据的数据结构。根据使用的版本控制系统是分布式的，如Git或Mercurial，还是集中式的，如Subversion、CVS或Perforce，代码库中的所有信息可能在每个用户的系统上被复制，或可能维护在单个服务器上。代码库包含的元数据包括，但不限于，代码库更改的历史记录、一组提交对象以及称为头的提交对象的一组引用。                                                                                                                                                                                                                                                                                                                                                   |
| 重新扫描 | 对当前UTXO集合状态进行扫描，以寻找属于之前配置的派生方案的硬币的过程。 |
| 撤销密钥 | 每个可撤销的序列成熟合约（RSMC）包含两个撤销密钥。每个通道合作伙伴知道一个撤销密钥。知道两个撤销密钥后，RSMC的输出可以在预定义的时间锁内被花费。在协商新的通道状态时，旧的撤销密钥被共享，从而“撤销”旧状态。撤销密钥用于阻止通道合作伙伴广播旧的通道状态。 |
| 路由 | 使用闪电网络路径进行支付的过程。 |
| 路由费 | 在闪电网络中，转发其他用户支付的费用。个别节点可以设置自己的费用政策，这将计算为固定的基础费用和一个取决于支付金额的费率之和。 |
| 可销售性 | 商品在市场上可以被持有者随时出售的便利性，且价格损失最小。 |
| Satoshi（sat） | Satoshi是比特币可以在区块链上记录的最小单位（面额）。一个Satoshi是1比特币的1/100百万分之一（0.00000001），以比特币的创造者Satoshi Nakamoto的名字命名。 |
| Satoshi Nakamoto | 设计比特币并创建其原始参考实现的个人或团体使用的名字。作为实现的一部分，他们还设计了第一个区块链数据库。在此过程中，他们是第一个解决数字货币双重支付问题的人。他们的真实身份仍然未知。 |
| Satoshi Per Byte | 用于衡量交易优先级的单位，由交易费用的Satoshi除以交易的字节大小定义。 |
| Satoshi Per Verabyte | 与Satoshi Per Byte的概念相似，但用于使用Segwit的新地址。等于交易大小（以权重单位计算）除以4。权重单位是通过取交易大小（不包括见证人）乘以3，加上包括见证人的交易大小来计算的。 |
| 稀缺性 | 商品不能无成本复制的属性。稀缺性不依赖于商品现有单位的数量，而是依赖于生产更多单位的成本。 |
| 脚本 | 比特币使用一种称为比特币脚本的交易脚本系统。它类似于Forth编程语言，简单、基于栈，并从左到右处理。它有意设计为图灵不完全，没有循环或递归。 |
| 种子短语 | 存储恢复链上比特币资金所需的所有信息的单词列表。钱包软件通常会生成一个种子短语，并指示用户将其写在纸上。如果用户的计算机损坏或硬盘变得损坏，他们可以再次下载相同的钱包软件，并使用纸质备份取回他们的比特币。 |
| 隔离见证 (SegWit) | 隔离见证（SegWit）是2017年引入的比特币协议升级，为签名和其他交易授权证明添加了一个新的见证字段。这个新的见证字段不计入交易ID的计算中，解决了大多数第三方交易可变性问题。隔离见证作为一个软分叉部署，是一项技术上使比特币的协议规则更加严格的变更。 |
| 自主主权 | 一种管理数字身份的模型，个人或企业拥有对其账户和个人数据的控制权。 |
| 发送 | 将比特币移动到一个地址的过程。 |
| 敏感模式 | 通过商店设置中的开关启用，激活后会在所有视图中隐藏数值信息（例如，比特币数量）。 |
| 服务器设置 | 在BTCPay服务器中适用于全服务器的设置（与仅限于单个商店范围的商店设置不同）。 |
| SHA-256 | 一种加密哈希函数。是一系列称为安全哈希算法（SHA）函数的哈希函数家族的成员。 |
| Shopify | 一家加拿大跨国电子商务公司，总部位于安大略省的渥太华。Shopify是其专有电子商务平台以及零售销售点系统的名称。 |
| SMTP | 简单邮件传输协议是一种用于电子邮件传输的互联网标准通信协议。 |
| 软分叉 | 一种协议升级，向前和向后兼容，因此允许旧节点和新节点继续使用同一链。 |
| 软件栈 | 在计算中，解决方案栈或软件栈是一组软件子系统或组件，需要创建一个完整的平台，以便不需要额外的软件就能支持应用程序。 |
| 商店 | BTCPay服务器中的商店可以被视为特定比特币钱包的“家”，扩展了BTCPay服务器的所有功能。 |
| 商店设置 | BTCPay服务器中特定于商店的设置。 |
| Taproot | 比特币的升级，将引入几个新功能。该升级在BIPs 340、341和342中描述，引入了Schnorr签名方案、Taproot和Tapscript。这些升级共同引入了传输比特币的新的、更高效、灵活和私密的方式。 |
| Thier's Law | 好钱会驱逐坏钱的法则。 |
| 第三方主机 | 当个人或公司的网站由另一家企业拥有和管理的服务器运行时。另一种选择是在您自己的数据中心的服务器上托管您的网站。 |
| 时间锁 | 时间锁是一种限制在指定的未来时间或区块高度之前花费一些比特币的限制。时间锁在许多比特币合约中占据重要地位，包括支付渠道和HTLCs。 |
| 拓扑                                        | 闪电网络的拓扑描述了作为数学图的闪电网络的形状。图的节点是闪电节点（网络参与者/对等方）。图的边是支付通道。闪电网络的拓扑通过八卦协议的帮助公开广播，未公告的通道除外。这意味着闪电网络的规模可能远大于公布的通道和节点数量。了解拓扑在支付的源路由过程中特别感兴趣，发送者在其中发现一条路线。                                                                                                                                                                                                                                                                                                                                                   |
| 交易                                        | 交易是比特币用来将比特币从一个地址转移到另一个地址的数据结构。几千个交易被聚合在一个区块中，然后该区块被记录（挖掘）在区块链上。每个区块中的第一笔交易，称为coinbase交易，生成新的比特币。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 交易ID                                      | 一个识别区块链上特定交易的字母和数字串。该字符串简单地是交易的双重SHA-256哈希。这个哈希可以用来在节点或区块浏览器上查找交易。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 双因素认证 (2FA)                            | 一种身份和访问管理安全方法，要求使用两种形式的身份验证来访问资源和数据，通常除了标准登录密码外，还需使用辅助设备。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 不可审查                                    | 没有任何实体能够逆转比特币交易或将钱包或地址列入黑名单的属性。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 不可没收                                    | 没有任何实体能够违背实体的意愿取走比特币的属性。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 未花费交易输出 (UTXO)                       | 尚未花费、因此可用于新交易的输出。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 用户体验 (UX)                               | 用户与产品、系统或服务的互动及体验方式。它包括一个人对效用、易用性和效率的感知。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 用户界面 (UI)                               | 设备中人机交互和通信的点。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 可验证                                      | 一种商品可以容易地与冒牌货和假冒品区分开来的属性。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 虚拟                                        | 在计算机或计算机网络上存在或被模拟的。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 虚拟机 (VM)                                 | 在计算中，虚拟机是计算机系统的虚拟化或仿真。虚拟机基于计算机架构，并提供物理计算机的功能。它们的实现可能涉及专用硬件、软件或两者的结合。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 虚拟私人服务器                              | 虚拟私人服务器是互联网托管服务销售的一种虚拟机。"虚拟专用服务器"这个术语也有类似的含义。虚拟私人服务器运行其自己的操作系统副本，客户可能拥有该操作系统实例的超级用户级访问权限，因此他们可以安装几乎任何在该操作系统上运行的软件。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 波动性                                      | 资产价格随时间变化程度的衡量。经常经历大幅价格变化的资产更具有波动性，而价格更稳定的资产波动性较小。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 钱包 | 比特币钱包保存用户的密钥，允许用户接收比特币、签署交易并检查他们的账户余额。比特币钱包中的私钥和公钥具有两个不同的功能，但在创建时是相互关联的。比特币钱包包含用户的密钥，而不是他们实际的比特币。从概念上讲，钱包就像一个钥匙链，因为它持有许多对私钥和公钥。这些密钥用于签署交易，允许用户证明他们拥有区块链上的交易输出，即他们的比特币。所有比特币都以交易输出的形式记录在区块链上。 |
| Wasabi 钱包 | 一个开源的、非托管的、专注于隐私的桌面比特币钱包，实现了无需信任的 CoinJoin。 |
| 仅观察钱包 | 允许您跟踪您在冷存储中的比特币，同时禁用花费资金的能力的比特币钱包。这是因为仅观察钱包不存储或使用私钥，因此无法代表用户授权任何支出。 |
| 鲸鱼 | 在比特币的背景下，鲸鱼是指持有大量比特币的人。 |
| 白标产品 | 一种由一家公司生产的产品或服务，其他公司重新品牌，使其看起来像是他们制造的。 |
| 白皮书 | 介绍一个新的想法或讨论话题。比特币白皮书将比特币介绍为一个“点对点的电子现金系统”，它“不需要可信任的第三方”。中本聪于2008年10月31日向一个密码学家和密码朋克的电子邮件列表发布了白皮书。 |
| 包装的Segwit | SegWit升级中包含的一种设计实现，旨在使钱包和其他比特币软件更容易支持SegWit。为了实现这一点，两个原生的SegWit脚本，P2WPKH和P2WSH，被用作P2SH交易的“赎回脚本”，分别产生了包装的SegWit脚本类型P2SH-P2WPKH和P2SH-P2WSH。 |

![image](assets/en/129.webp)
